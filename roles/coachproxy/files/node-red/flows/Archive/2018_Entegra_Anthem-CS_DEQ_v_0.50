[{"id":"5a05b8f3.894b88","type":"tab","label":"Main","disabled":false},{"id":"2fdd8124.05e35e","type":"tab","label":"Notify / System","disabled":false,"info":""},{"id":"477cac19.6a9e64","type":"tab","label":"Logic","disabled":false,"info":""},{"id":"f6c367c2.63b9b8","type":"tab","label":"Configuration","disabled":false,"info":""},{"id":"b437d470.625068","type":"tab","label":"Automations","disabled":false,"info":""},{"id":"5900d0c.97552b","type":"ui_tab","z":"5a05b8f3.894b88","name":"Status","icon":"visibility","order":7},{"id":"c1170463.5c7f8","type":"mqtt-broker","broker":"localhost","port":"1883","clientid":"","usetls":false,"verifyservercert":true,"compatmode":true,"keepalive":"15","cleansession":true,"birthTopic":"","birthQos":"0","birthRetain":"true","birthPayload":"","willTopic":"","willQos":"0","willRetain":"true","willPayload":""},{"id":"221dd600.02338a","type":"ui_tab","z":"5a05b8f3.894b88","name":"Exterior","icon":"directions_bus","order":3},{"id":"ca7e3f9c.a33c","type":"ui_tab","z":"5a05b8f3.894b88","name":"Interior","icon":"home","order":2},{"id":"b515d680.664548","type":"ui_group","z":"5a05b8f3.894b88","name":"Stool","tab":"ca7e3f9c.a33c","order":4,"disp":true,"width":"6","collapse":true},{"id":"4da57d95.96a5cc","type":"ui_tab","name":"Notifications","icon":"notifications_active","order":11,"disabled":false,"hidden":false},{"id":"b2130e68.3a338","type":"sqlitedb","z":"2fdd8124.05e35e","db":"/coachproxy/node-red/coachproxy.sqlite"},{"id":"2e0a52f8.6acbee","type":"ui_group","z":"5a05b8f3.894b88","name":"Main","tab":"ca7e3f9c.a33c","order":2,"disp":true,"width":"6","collapse":true},{"id":"cae5b35a.e3024","type":"ui_group","z":"5a05b8f3.894b88","name":"Water Pump","tab":"803d3461.22e8e8","order":2,"disp":true,"width":"6","collapse":true},{"id":"517030c5.11f8b8","type":"ui_group","z":"5a05b8f3.894b88","name":"Bedroom","tab":"ca7e3f9c.a33c","order":5,"disp":true,"width":"6","collapse":true},{"id":"f92ef285.8be6b","type":"ui_group","z":"5a05b8f3.894b88","name":"Bath","tab":"ca7e3f9c.a33c","order":3,"disp":true,"width":"6","collapse":true},{"id":"4e2af34d.8f765c","type":"ui_group","z":"5a05b8f3.894b88","name":"Exterior Lights","tab":"221dd600.02338a","order":1,"disp":true,"width":"6","collapse":true},{"id":"f6ae28b7.041968","type":"ui_group","name":"Locks","tab":"b4dcab90.f67fb8","order":2,"disp":true,"width":"6","collapse":true},{"id":"87ed7eaa.ab8fe","type":"ui_group","name":"Readings","tab":"5900d0c.97552b","order":1,"disp":true,"width":"6","collapse":true},{"id":"a4a573ee.d6bdf","type":"ui_group","name":"Generator","tab":"5900d0c.97552b","order":3,"disp":true,"width":"6","collapse":true},{"id":"d944623c.5b46b8","type":"ui_group","name":"Memory Master","tab":"ca7e3f9c.a33c","order":1,"disp":true,"width":"6","collapse":true},{"id":"f961f048.b0646","type":"ui_group","name":"Software Information","tab":"10cd091e.2c38a7","order":1,"disp":true,"width":"6","collapse":true},{"id":"cd05e210.dac658","type":"ui_group","name":"Network Information","tab":"10cd091e.2c38a7","order":3,"disp":true,"width":"6","collapse":true},{"id":"b29ba418.731d88","type":"ui_base","theme":{"name":"theme-custom","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#169dd3","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"default":"#4B7930","baseColor":"#3d89be","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","reset":false},"themeState":{"base-color":{"default":"#3d89be","value":"#3d89be","edited":false},"page-titlebar-backgroundColor":{"value":"#3d89be","edited":true},"page-backgroundColor":{"value":"#e8e8e8","edited":true},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#75acd3","edited":true},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#3d89be","edited":true},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"eRVin","hideToolbar":"false","allowSwipe":"false","dateFormat":"YYYY/MM/DD","sizes":{"sx":48,"sy":48,"gx":14,"gy":14,"cx":6,"cy":6,"px":4,"py":6},"lockMenu":"false"}},{"id":"5d7e55cd.f34c2c","type":"ui_group","name":"Awnings","tab":"221dd600.02338a","order":2,"disp":true,"width":"6","collapse":true},{"id":"39ecc94c.7e22c6","type":"ui_group","name":"Welcome","tab":"2b742e36.100002","order":1,"disp":true,"width":"6","collapse":false},{"id":"dd373808.7ec1d8","type":"ui_group","d":true,"name":"Coach Options","tab":"2b742e36.100002","order":4,"disp":true,"width":"6","collapse":false},{"id":"e1a5049d.4cee88","type":"ui_group","d":true,"name":"Save and Install","tab":"2b742e36.100002","order":6,"disp":true,"width":"6","collapse":false},{"id":"b9bfcd9c.3c935","type":"sqlitedb","db":"/coachproxy/node-red/coachproxy.sqlite"},{"id":"2b742e36.100002","type":"ui_tab","name":"About","icon":"info","order":14,"disabled":false,"hidden":false},{"id":"10cd091e.2c38a7","type":"ui_tab","name":"System","icon":"settings","order":12},{"id":"fb4c3e00.5737a","type":"ui_group","name":"Power","tab":"5900d0c.97552b","order":2,"disp":true,"width":"6","collapse":true},{"id":"23adf1d9.326cae","type":"ui_group","name":"Remote Access - ngrok","tab":"10cd091e.2c38a7","order":5,"disp":true,"width":"6","collapse":true},{"id":"7dcb24f9.ce47cc","type":"ui_group","name":"Alexa Commands","tab":"d8112be0.b69068","order":2,"disp":true,"width":"6","collapse":true},{"id":"a027aa68.277858","type":"ui_group","name":"Restart Alexa Integration","tab":"d8112be0.b69068","order":1,"disp":true,"width":"6","collapse":true},{"id":"f4d0f875.b5dda8","type":"ui_group","d":true,"name":"User Interface Options","tab":"2b742e36.100002","order":5,"disp":true,"width":"6","collapse":false},{"id":"7f355d52.ee5a24","type":"ui_group","name":"Notification Rules","tab":"4da57d95.96a5cc","order":4,"disp":true,"width":"6","collapse":true},{"id":"d0c7f134.375fd","type":"ui_group","name":"Notification Settings","tab":"4da57d95.96a5cc","order":1,"disp":true,"width":"6","collapse":true},{"id":"9ed66528.add608","type":"ui_group","name":"Notification Email Address","tab":"4da57d95.96a5cc","order":2,"disp":true,"width":"6","collapse":true},{"id":"e4fd4ed4.a377f","type":"ui_group","name":"Copyright","tab":"2b742e36.100002","order":3,"disp":true,"width":"6","collapse":false},{"id":"b043acd4.87089","type":"ui_group","name":"Notification SMTP Server","tab":"4da57d95.96a5cc","order":3,"disp":true,"width":"6","collapse":true},{"id":"d361ec81.7d08a","type":"ui_group","name":"Switch Panels","tab":"ca7e3f9c.a33c","order":6,"disp":true,"width":"6","collapse":true},{"id":"803d3461.22e8e8","type":"ui_tab","name":"Aquahot","icon":"whatshot","order":5,"disabled":false,"hidden":false},{"id":"cf9b6bb9.e5ef38","type":"ui_group","name":"Controls","tab":"803d3461.22e8e8","order":1,"disp":true,"width":"6","collapse":true},{"id":"ae3b3824.48abe8","type":"ui_group","name":"Cockpit Shades","tab":"1a09069c.93f929","order":3,"disp":true,"width":"6","collapse":true},{"id":"5725fb8d.051db4","type":"ui_group","name":"General Shades","tab":"1a09069c.93f929","order":1,"disp":true,"width":"6","collapse":true},{"id":"5a6f1f47.88d1c","type":"ui_group","name":"Living Room Shades","tab":"1a09069c.93f929","order":4,"disp":true,"width":"6","collapse":true},{"id":"3806de6b.607142","type":"ui_group","name":"Bedroom Shades","tab":"1a09069c.93f929","order":5,"disp":true,"width":"6","collapse":true},{"id":"6fd8f21b.f22b1c","type":"ui_group","name":"Bathroom Shades","tab":"1a09069c.93f929","order":6,"disp":true,"width":"6","collapse":true},{"id":"1a09069c.93f929","type":"ui_tab","name":"Shades","icon":"wb_cloudy","order":4,"disabled":false,"hidden":false},{"id":"ca514016.47102","type":"ui_group","name":"Info","tab":"2b742e36.100002","order":2,"disp":true,"width":"6","collapse":false},{"id":"5cbd9089.f3b65","type":"ui_group","d":true,"name":"Old Welcome","tab":"2b742e36.100002","order":7,"disp":true,"width":"6","collapse":false},{"id":"7ef807d5.1ca3b8","type":"ui_group","name":"Scene Control","tab":"b77c5ec5.c13b5","order":1,"disp":true,"width":"6","collapse":true},{"id":"b77c5ec5.c13b5","type":"ui_tab","name":"Scenes","icon":"photo","order":1,"disabled":false,"hidden":false},{"id":"abfd1685.b229d8","type":"ui_group","name":"Lights On Mode","tab":"e0c750f3.500ed","order":1,"disp":true,"width":"6","collapse":true},{"id":"ec9d7f42.8db13","type":"ui_group","name":"Scene Builder","tab":"b77c5ec5.c13b5","order":2,"disp":true,"width":"6","collapse":true},{"id":"fe130cc1.4b7f6","type":"ui_group","name":"How to use Scene Builder","tab":"b77c5ec5.c13b5","order":3,"disp":true,"width":"6","collapse":true},{"id":"e0c750f3.500ed","type":"ui_tab","name":"Options","icon":"check_box","order":9,"disabled":false,"hidden":false},{"id":"dd035f6c.5d73e","type":"ui_group","name":"Show/Hide Tabs","tab":"e0c750f3.500ed","order":3,"disp":true,"width":"6","collapse":true},{"id":"d8112be0.b69068","type":"ui_tab","name":"Alexa","icon":"amazon","order":10,"disabled":false,"hidden":false},{"id":"b4dcab90.f67fb8","type":"ui_tab","name":"Locks","icon":"lock","order":6,"disabled":false,"hidden":false},{"id":"c2caa18b.132cd","type":"ui_group","name":"Show/Hide Groups","tab":"e0c750f3.500ed","order":4,"disp":true,"width":"6","collapse":true},{"id":"97b9ad54.9933e","type":"ui_group","name":"System Information","tab":"10cd091e.2c38a7","order":2,"disp":true,"width":"6","collapse":true},{"id":"1098dc18.d96274","type":"ui_tab","name":"Location","icon":"location_on","order":8,"disabled":false,"hidden":false},{"id":"4ba9cfc2.1a222","type":"ui_group","name":"Moon Phase","tab":"1098dc18.d96274","order":2,"disp":true,"width":"6","collapse":true},{"id":"fc3455d4.45be98","type":"ui_group","name":"GPS Status","tab":"1098dc18.d96274","order":1,"disp":true,"width":"6","collapse":true},{"id":"b7dc85ae.2ad0a8","type":"ui_group","name":"Map","tab":"1098dc18.d96274","order":5,"disp":true,"width":"6","collapse":true},{"id":"9c7e0074.77f72","type":"ui_group","name":"Install Configuration File","tab":"10cd091e.2c38a7","order":7,"disp":true,"width":"6","collapse":true},{"id":"9108c0fb.ca8ee","type":"ui_spacer","name":"spacer","group":"d944623c.5b46b8","order":3,"width":1,"height":1},{"id":"62846913.637978","type":"ui_spacer","name":"spacer","group":"d944623c.5b46b8","order":5,"width":3,"height":1},{"id":"f91d30ee.81533","type":"ui_group","name":"Sofa/Sconce Mode","tab":"e0c750f3.500ed","order":2,"disp":true,"width":"6","collapse":true},{"id":"9ee7e038.56def","type":"ui_group","name":"Manual Lat/Lon","tab":"1098dc18.d96274","order":3,"disp":true,"width":"6","collapse":true},{"id":"fcc7d16a.5f2a2","type":"ui_group","name":"Sunset/Sunrise","tab":"1098dc18.d96274","order":4,"disp":true,"width":"6","collapse":true},{"id":"7706781c.a53ca8","type":"ui_group","name":"Change System Password","tab":"10cd091e.2c38a7","order":8,"disp":true,"width":"6","collapse":true},{"id":"7d76c12c.bccc4","type":"ui_group","name":"Remote Access - Dataplicity","tab":"10cd091e.2c38a7","order":4,"disp":true,"width":"6","collapse":true},{"id":"63653a99.e1cbd4","type":"sftp","host":"home158431021.1and1-data.host","port":"22","tryKeyboard":false,"key":"","keyname":"","algorithms_kex":"ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group-exchange-sha256,diffie-hellman-group14-sha1","algorithms_cipher":"aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm,aes128-gcm@openssh.com,aes256-gcm,aes256-gcm@openssh.com","algorithms_serverHostKey":"ssh-rsa,ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521","algorithms_hmac":"hmac-sha2-256,hmac-sha2-512,hmac-sha1","algorithms_compress":"none,zlib@openssh.com,zlib"},{"id":"43a9d023.b2434","type":"ui_group","name":"Update Configuration Files","tab":"10cd091e.2c38a7","order":6,"disp":true,"width":"6","collapse":true},{"id":"8918319e.52f4","type":"ui_switch","z":"5a05b8f3.894b88","name":"13_Bath_Ceiling","label":"Ceiling","tooltip":"","group":"f92ef285.8be6b","order":1,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"13_state_Bath Ceiling","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":920,"y":940,"wires":[["ba8aebb.ea06618"]]},{"id":"e3a07cfd.ff85a","type":"ui_slider","z":"5a05b8f3.894b88","name":"13_Bath_Ceiling_brightness","label":"","tooltip":"","group":"f92ef285.8be6b","order":2,"width":3,"height":1,"passthru":false,"outs":"end","topic":"13_brightness","min":"1","max":"100","step":"","x":880,"y":980,"wires":[["ba8aebb.ea06618"]]},{"id":"b7651bea.41be5","type":"ui_switch","z":"5a05b8f3.894b88","name":"14_Bath_Lav","label":"Lav","tooltip":"","group":"f92ef285.8be6b","order":3,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"14_state_Bath Lav","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":930,"y":1020,"wires":[["ba8aebb.ea06618"]]},{"id":"bde18df6.2960f","type":"ui_slider","z":"5a05b8f3.894b88","name":"14_Bath_Lav_brightness","label":"","tooltip":"","group":"f92ef285.8be6b","order":4,"width":3,"height":1,"passthru":false,"outs":"end","topic":"14_brightness","min":"1","max":"100","step":"","x":890,"y":1060,"wires":[["ba8aebb.ea06618"]]},{"id":"f766527c.b54708","type":"ui_switch","z":"5a05b8f3.894b88","name":"16_Bath_accent","label":"Accent","tooltip":"","group":"f92ef285.8be6b","order":5,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"16_state_Bath Accent","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":920,"y":1180,"wires":[["ba8aebb.ea06618"]]},{"id":"32fb20fc.33fb1","type":"ui_slider","z":"5a05b8f3.894b88","name":"16_Bath_Accent_brightness","label":"","tooltip":"","group":"f92ef285.8be6b","order":6,"width":3,"height":1,"passthru":false,"outs":"end","topic":"16_brightness","min":"1","max":"100","step":"","x":880,"y":1220,"wires":[["ba8aebb.ea06618"]]},{"id":"77238d9f.d85fac","type":"ui_switch","z":"5a05b8f3.894b88","name":"17_BR_Ceiling","label":"Ceiling","tooltip":"","group":"517030c5.11f8b8","order":1,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"17_state_Bedroom Ceiling","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":920,"y":1260,"wires":[["ba8aebb.ea06618"]]},{"id":"b5f5aa62.b1b8c","type":"ui_slider","z":"5a05b8f3.894b88","name":"17_BR_Ceiling_brightness","label":"","tooltip":"","group":"517030c5.11f8b8","order":2,"width":3,"height":1,"passthru":false,"outs":"end","topic":"17_brightness","min":"1","max":"100","step":"","x":880,"y":1300,"wires":[["ba8aebb.ea06618"]]},{"id":"4f494263.b11554","type":"exec","z":"5a05b8f3.894b88","command":"/coachproxy/rv-c/dc_dimmer.pl ","addpay":true,"append":"","useSpawn":"","name":"","x":1770,"y":1360,"wires":[[],[],[]]},{"id":"e291aabb.d74588","type":"ui_switch","z":"5a05b8f3.894b88","name":"20_BR_Vanity","label":"Vanity","tooltip":"","group":"517030c5.11f8b8","order":7,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"20_state_Bedroom Vanity","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":920,"y":1500,"wires":[["ba8aebb.ea06618"]]},{"id":"d573ae50.c4dc38","type":"ui_slider","z":"5a05b8f3.894b88","name":"20_BR_Vanity_brightness","label":"","tooltip":"","group":"517030c5.11f8b8","order":8,"width":3,"height":1,"passthru":false,"outs":"end","topic":"20_brightness","min":"1","max":"100","step":"","x":890,"y":1540,"wires":[["ba8aebb.ea06618"]]},{"id":"93ad9c5a.823bf8","type":"ui_switch","z":"5a05b8f3.894b88","name":"21_BR_Courtesy","label":"Courtesy","tooltip":"","group":"517030c5.11f8b8","order":9,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"21_state_Bedroom Courtesy","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":910,"y":1580,"wires":[["ba8aebb.ea06618"]]},{"id":"a6532b96.f6876","type":"ui_slider","z":"5a05b8f3.894b88","name":"21_BR_Courtesy_brightness","label":"","tooltip":"","group":"517030c5.11f8b8","order":10,"width":3,"height":1,"passthru":false,"outs":"end","topic":"21_brightness","min":"1","max":"100","step":"","x":880,"y":1620,"wires":[["ba8aebb.ea06618"]]},{"id":"de5083f5.8f342","type":"ui_switch","z":"5a05b8f3.894b88","name":"19_BR_Accent","label":"Accent","tooltip":"","group":"517030c5.11f8b8","order":5,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"19_state_Bedroom Accent","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":920,"y":1420,"wires":[["ba8aebb.ea06618"]]},{"id":"255e8300.e6f6dc","type":"ui_slider","z":"5a05b8f3.894b88","name":"19_BR_Accent_brightness","label":"","tooltip":"","group":"517030c5.11f8b8","order":6,"width":3,"height":1,"passthru":false,"outs":"end","topic":"19_brightness","min":"1","max":"100","step":"","x":880,"y":1460,"wires":[["ba8aebb.ea06618"]]},{"id":"443d87c4.3023d","type":"ui_switch","z":"5a05b8f3.894b88","name":"18_BR_Reading","label":"Reading","tooltip":"","group":"517030c5.11f8b8","order":3,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"18_state_Bedroom Reading","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":920,"y":1340,"wires":[["ba8aebb.ea06618"]]},{"id":"9ff3b254.0a9e","type":"ui_slider","z":"5a05b8f3.894b88","name":"18_BR_Reading_brightness","label":"","tooltip":"","group":"517030c5.11f8b8","order":4,"width":3,"height":1,"passthru":false,"outs":"end","topic":"18_brightness","min":"1","max":"100","step":"","x":880,"y":1380,"wires":[["ba8aebb.ea06618"]]},{"id":"6462abc1.33600c","type":"ui_switch","z":"5a05b8f3.894b88","name":"113_Main_Entry","label":"Entry","tooltip":"","group":"2e0a52f8.6acbee","order":25,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"113_state_Entry Ceiling","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":920,"y":3180,"wires":[["ba8aebb.ea06618"]]},{"id":"21309d67.8efe4a","type":"ui_switch","z":"5a05b8f3.894b88","name":"23_Stool_Accent","label":"Accent","tooltip":"","group":"b515d680.664548","order":3,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"23_state_Stool Accent","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":910,"y":1740,"wires":[["ba8aebb.ea06618"]]},{"id":"36b5f55f.b2f8d2","type":"ui_slider","z":"5a05b8f3.894b88","name":"23_MB_Accent_brightness","label":"","tooltip":"","group":"b515d680.664548","order":4,"width":3,"height":1,"passthru":false,"outs":"end","topic":"23_brightness","min":"1","max":"100","step":"","x":880,"y":1780,"wires":[["ba8aebb.ea06618"]]},{"id":"f1ceb03a.ba774","type":"ui_switch","z":"5a05b8f3.894b88","name":"22_Stool_Ceiling","label":"Ceiling","tooltip":"","group":"b515d680.664548","order":1,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"22_state_Stool Ceiling","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":910,"y":1660,"wires":[["ba8aebb.ea06618"]]},{"id":"285ed135.2d577e","type":"ui_slider","z":"5a05b8f3.894b88","name":"22_Stool_Ceiling_brightness","label":"","tooltip":"","group":"b515d680.664548","order":2,"width":3,"height":1,"passthru":false,"outs":"end","topic":"22_brightness","min":"1","max":"100","step":"","x":880,"y":1700,"wires":[["ba8aebb.ea06618"]]},{"id":"637f5dcf.b94644","type":"ui_switch","z":"5a05b8f3.894b88","d":true,"name":"Water Pump /pump_out/","label":"Pump","tooltip":"","group":"cae5b35a.e3024","order":1,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"93_state","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":890,"y":3580,"wires":[["ba8aebb.ea06618"]]},{"id":"94997def.bc00f","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/16","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":1200,"wires":[["6c5178e1.6a4be8"]]},{"id":"dcd1dd69.6b88e8","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/17","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":1280,"wires":[["409db98b.807d48"]]},{"id":"bcbe9f30.8997b8","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/18","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":1360,"wires":[["81a2736.51b639"]]},{"id":"be4844ec.4d88e8","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/19","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":1440,"wires":[["4c177e88.ea6a7"]]},{"id":"fcc9e896.4ff07","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/20","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":1520,"wires":[["ede65af9.7b44e8"]]},{"id":"cdd86688.7e2b4","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/21","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":1600,"wires":[["55a2f976.8a3eb8"]]},{"id":"4352ebec.6c8734","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/22","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":1680,"wires":[["38e39d9a.7e7722"]]},{"id":"c4f28dec.12421","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/23","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":1760,"wires":[["bc502eba.b0b12"]]},{"id":"ef7c89aa.d895e8","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/113","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":3180,"wires":[["c1d41b37.eaf988"]]},{"id":"e58035a7.f3d3f","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/30","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":2320,"wires":[["56c43894.eca948"]]},{"id":"f9ad487e.96c1f","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/32","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":2480,"wires":[["3a5d5d6f.be61b2"]]},{"id":"cd54bb31.376898","type":"mqtt in","z":"5a05b8f3.894b88","d":true,"name":"/pump_in/","topic":"RVC/DC_DIMMER_STATUS_3/37","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":80,"y":3580,"wires":[["6b2a8e3c.7dae6"]]},{"id":"73925679.728a08","type":"ui_button","z":"5a05b8f3.894b88","name":"/entry-unlock/","group":"f6ae28b7.041968","order":6,"width":"3","height":"1","passthru":false,"label":"Unlock","color":"","bgcolor":"","icon":"fa-unlock","payload":"0","payloadType":"str","topic":"1","x":1560,"y":920,"wires":[["49eafa.00923508"]]},{"id":"7e1d595d.b09b2","type":"ui_button","z":"5a05b8f3.894b88","name":"/entry-lock/","group":"f6ae28b7.041968","order":5,"width":"3","height":"1","passthru":false,"label":"Lock","color":"","bgcolor":"","icon":"fa-lock","payload":"1","payloadType":"str","topic":"1","x":1570,"y":960,"wires":[["49eafa.00923508"]]},{"id":"d89a399f.b2ddd8","type":"ui_button","z":"5a05b8f3.894b88","name":"/cargo-unlock/","group":"f6ae28b7.041968","order":9,"width":"3","height":"1","passthru":false,"label":"Unlock","color":"","bgcolor":"","icon":"fa-unlock","payload":"0","payloadType":"str","topic":"6","x":1560,"y":1040,"wires":[["49eafa.00923508"]]},{"id":"a6eb1e7.1674b6","type":"ui_button","z":"5a05b8f3.894b88","name":"/cargo-lock/","group":"f6ae28b7.041968","order":8,"width":"3","height":"1","passthru":false,"label":"Lock","color":"","bgcolor":"","icon":"fa-lock","payload":"1","payloadType":"str","topic":"6","x":1570,"y":1080,"wires":[["49eafa.00923508"]]},{"id":"62b3ea56.044ecc","type":"exec","z":"5a05b8f3.894b88","command":"/coachproxy/rv-c/locks.pl ","addpay":true,"append":"","useSpawn":"","timer":"","oldrc":false,"name":"locks.pl /locks/+pred/","x":2280,"y":960,"wires":[[],[],[]]},{"id":"fde339a0.7cf7","type":"ui_button","z":"5a05b8f3.894b88","name":"/all-unlock/","group":"f6ae28b7.041968","order":3,"width":"3","height":"1","passthru":false,"label":"Unlock","color":"","bgcolor":"","icon":"fa-unlock","payload":"0","payloadType":"str","topic":"0","x":1570,"y":800,"wires":[["49eafa.00923508"]]},{"id":"35ee5a13.541cb6","type":"ui_button","z":"5a05b8f3.894b88","name":"/all-lock/","group":"f6ae28b7.041968","order":2,"width":"3","height":"1","passthru":false,"label":"Lock","color":"","bgcolor":"","icon":"fa-lock","payload":"1","payloadType":"str","topic":"0","x":1580,"y":840,"wires":[["49eafa.00923508"]]},{"id":"9466733.a8a561","type":"ui_template","z":"5a05b8f3.894b88","group":"f6ae28b7.041968","name":"All Locks","order":1,"width":"","height":"","format":"<!DOCTYPE html>\n<div style=\"height: 8px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 8px; border-bottom: 1px solid black; text-align: left\">\n  <span style=\"font-size: 16px; background-color: #FEFEFE; padding: 0 10px; margin-left: 10px;overflow:hidden;\">\n    All\n  </span>\n</div>\n<div style=\"height: 11px;\">&nbsp;</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1580,"y":760,"wires":[["49eafa.00923508"]]},{"id":"db246d2e.857918","type":"ui_template","z":"5a05b8f3.894b88","group":"f6ae28b7.041968","name":"Entrance Door","order":4,"width":"","height":"","format":"<!DOCTYPE html>\n<div style=\"height: 8px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 8px; border-bottom: 1px solid black; text-align: left;\">\n  <span style=\"font-size: 16px; background-color: #FEFEFE; padding: 0 10px; margin-left: 10px;overflow:hidden;\">\n    Entrance Door\n  </span>\n</div>\n<div style=\"height: 11px;\">&nbsp;</div>\n","storeOutMessages":true,"fwdInMessages":true,"x":1560,"y":880,"wires":[["49eafa.00923508"]]},{"id":"6ce45de7.95ff2c","type":"ui_template","z":"5a05b8f3.894b88","group":"f6ae28b7.041968","name":"Cargo Bays","order":7,"width":"","height":"","format":"<!DOCTYPE html>\n<div style=\"height: 8px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 8px; border-bottom: 1px solid black; text-align: left\">\n  <span style=\"font-size: 16px; background-color: #FEFEFE; padding: 0 10px; margin-left: 10px;overflow:hidden;\">\n    Cargo Bays\n  </span>\n</div>\n<div style=\"height: 11px;\">&nbsp;</div>","storeOutMessages":true,"fwdInMessages":true,"x":1570,"y":1000,"wires":[["49eafa.00923508"]]},{"id":"d9f0c30b.5a865","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"CP/TANK_STATUS/Fresh","qos":"2","broker":"c1170463.5c7f8","x":310,"y":4360,"wires":[["f350bf6f.91161"]]},{"id":"72a77d4d.b70dbc","type":"ui_text","z":"5a05b8f3.894b88","group":"87ed7eaa.ab8fe","order":2,"width":"2","height":"1","name":"Fresh:","label":"Fresh","format":"{{msg.payload}}%","layout":"col-center","x":730,"y":4360,"wires":[]},{"id":"44c283a8.34eebc","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"CP/TANK_STATUS/Grey","qos":"2","broker":"c1170463.5c7f8","x":310,"y":4400,"wires":[["b5d0e09f.8e198"]]},{"id":"418bd951.4eb67","type":"ui_text","z":"5a05b8f3.894b88","group":"87ed7eaa.ab8fe","order":3,"width":"2","height":"1","name":"Grey:","label":"Grey","format":"{{msg.payload}}%","layout":"col-center","x":730,"y":4400,"wires":[]},{"id":"54c15885.cc5ca","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"CP/TANK_STATUS/Black","qos":"2","broker":"c1170463.5c7f8","x":310,"y":4440,"wires":[["76d3f82c.3278b8"]]},{"id":"a47ac593.4ed008","type":"ui_text","z":"5a05b8f3.894b88","group":"87ed7eaa.ab8fe","order":4,"width":"2","height":"1","name":"Black:","label":"Black","format":"{{msg.payload}}%","layout":"col-center","x":730,"y":4440,"wires":[]},{"id":"9791bcf6.b8f638","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"CP/GENERATOR_STATUS","qos":"2","broker":"c1170463.5c7f8","x":290,"y":4660,"wires":[["cd976c85.83861"]]},{"id":"72ef6a2f.590cdc","type":"ui_switch","z":"5a05b8f3.894b88","name":"Gen Controls Enable","label":"Gen Controls Enable","group":"a4a573ee.d6bdf","order":3,"width":"6","height":"1","passthru":false,"decouple":"false","topic":"genstartenable","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":980,"y":4800,"wires":[["caa4aa9b.d6b008"]]},{"id":"b5543be8.394ec8","type":"ui_button","z":"5a05b8f3.894b88","name":"Start Generator","group":"a4a573ee.d6bdf","order":4,"width":"3","height":"1","passthru":false,"label":"Start Gen","tooltip":"","color":"","bgcolor":"","icon":"fa-repeat","payload":"1","payloadType":"str","topic":"generator","x":960,"y":4868,"wires":[["caa4aa9b.d6b008"]]},{"id":"994b4acd.107d2","type":"ui_button","z":"5a05b8f3.894b88","name":"Stop Generator","group":"a4a573ee.d6bdf","order":5,"width":"3","height":"1","label":"Stop Gen","color":"","icon":"fa-stop","payload":"0","payloadType":"str","topic":"generator","x":960,"y":4904.5,"wires":[["caa4aa9b.d6b008"]]},{"id":"d833682c.3e8508","type":"inject","z":"5a05b8f3.894b88","name":"Check Gen Start Enabled Timer","repeat":"1","crontab":"","once":true,"topic":"checkgenenable","payload":"","payloadType":"date","x":267,"y":4808,"wires":[["a68e7ccb.63a44"]]},{"id":"5ff865b5.d4fae4","type":"exec","z":"5a05b8f3.894b88","command":"/coachproxy/rv-c/generator.pl ","addpay":true,"append":"","useSpawn":"","timer":"","oldrc":false,"name":"generator.pl /gencontrol/+pred/","x":1460,"y":4840,"wires":[["73737c10.325eac"],[],[]]},{"id":"4251713d.675418","type":"ui_slider","z":"5a05b8f3.894b88","name":"Panel Brightness","label":"","tooltip":"","group":"d361ec81.7d08a","order":2,"width":3,"height":1,"passthru":false,"outs":"end","topic":"Panel Lights","min":"1","max":"100","step":"","x":2170,"y":100,"wires":[["10e80e93.5f0211"]]},{"id":"f9363c14.d66b","type":"exec","z":"5a05b8f3.894b88","command":"/coachproxy/rv-c/panel_lights_entegra.pl","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":2700,"y":80,"wires":[[],[],[]]},{"id":"da91aa38.849028","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"CP/IGNITION","qos":"2","broker":"c1170463.5c7f8","x":270,"y":4580,"wires":[["555e9ef4.cfe45"]]},{"id":"efa73c57.fe0448","type":"ui_text","z":"5a05b8f3.894b88","group":"87ed7eaa.ab8fe","order":8,"width":"3","height":"1","name":"Ignition /ignition/+pred/","label":"Ignition","format":"{{msg.payload}}","layout":"col-center","x":790,"y":4580,"wires":[]},{"id":"9ee193c3.f6d9f8","type":"ui_switch","z":"5a05b8f3.894b88","name":"Panels","label":"Panels","tooltip":"","group":"d361ec81.7d08a","order":1,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"Panel Lights","onvalue":"100","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":2130,"y":60,"wires":[["10e80e93.5f0211"]]},{"id":"b68c8b7c.d9bdb","type":"ui_template","z":"5a05b8f3.894b88","group":"a4a573ee.d6bdf","name":"Generator Note","order":1,"width":"0","height":"0","format":"<div>\n<p>\nAs a safety precaution for operating the generator,\nyou must turn on 'Gen Controls Enable', then press\n'Start Gen' or 'Stop Gen' within 5 seconds.\nGenerator may take up to 60 seconds to start.\n</p>\n<p>&nbsp;</p>\n</div>\n","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":960.5000114440918,"y":4833.750005722046,"wires":[["caa4aa9b.d6b008"]]},{"id":"79a50935.763808","type":"ui_template","z":"5a05b8f3.894b88","group":"a4a573ee.d6bdf","name":"Gen Start Status","order":6,"width":"","height":"","format":"<div layout=\"row\" layout-align=\"center center\"><b>{{msg.payload}}</b></div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":970,"y":4941,"wires":[["caa4aa9b.d6b008"]]},{"id":"89272dac.c0747","type":"mqtt in","z":"5a05b8f3.894b88","name":"GenStart Message","topic":"GENSTART/MESSAGE","broker":"c1170463.5c7f8","x":333,"y":4941,"wires":[["6de4b0ab.83a33"]]},{"id":"73737c10.325eac","type":"delay","z":"5a05b8f3.894b88","name":"","pauseType":"delay","timeout":"15","timeoutUnits":"seconds","rate":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1690,"y":4840,"wires":[["11ac0817.4d68f"]]},{"id":"11ac0817.4d68f","type":"template","z":"5a05b8f3.894b88","name":"Blank","field":"payload","fieldType":"msg","format":"handlebars","syntax":"plain","template":"","x":637,"y":4902,"wires":[["c3a72e26.0072f"]]},{"id":"37f7ef2e.907208","type":"inject","z":"5a05b8f3.894b88","name":"","repeat":"","crontab":"","once":true,"topic":"","payload":"","payloadType":"str","x":450,"y":4880,"wires":[["11ac0817.4d68f"]]},{"id":"d1486c83.b98ce8","type":"ui_button","z":"5a05b8f3.894b88","name":"Mem On","group":"d944623c.5b46b8","order":1,"width":3,"height":1,"passthru":false,"label":"Mem On","tooltip":"","color":"","bgcolor":"","icon":"","payload":"1","payloadType":"str","topic":"master","x":1620,"y":260,"wires":[["a4f9a80d.d8f2a"]]},{"id":"a4f9a80d.d8f2a","type":"exec","z":"5a05b8f3.894b88","command":"/coachproxy/rv-c/master.pl","addpay":true,"append":"13 14 16 17 18 19 20 21 22 23 24 25 26 27 29 30 31 32 33 34 35","useSpawn":"","timer":"","oldrc":false,"name":"","x":1860,"y":260,"wires":[[],[],[]]},{"id":"79af75e.49c4c8c","type":"ui_button","z":"5a05b8f3.894b88","name":"Mem Off","group":"d944623c.5b46b8","order":4,"width":3,"height":1,"passthru":false,"label":"Mem Off","tooltip":"","color":"","bgcolor":"","icon":"","payload":"0","payloadType":"str","topic":"master","x":1621,"y":301,"wires":[["a4f9a80d.d8f2a"]]},{"id":"4b03da62.b8a3d4","type":"ui_template","z":"5a05b8f3.894b88","group":"87ed7eaa.ab8fe","name":"Tanks","order":1,"format":"<!DOCTYPE html>\n<div style=\"height: 8px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 8px; border-bottom: 1px solid black; text-align: left\">\n  <span style=\"font-size: 16px; background-color: #FEFEFE; padding: 0 10px; margin-left: 10px;\">\n    Tanks\n  </span>\n</div>\n<div style=\"height: 11px;\">&nbsp;</div>","storeOutMessages":true,"fwdInMessages":true,"x":730,"y":4260,"wires":[[]]},{"id":"f5333ce8.df1fa","type":"ui_template","z":"5a05b8f3.894b88","group":"fb4c3e00.5737a","name":"12V Power Label","order":1,"width":"","height":"","format":"<div style=\"height: 8px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 8px; border-bottom: 1px solid black; text-align: left\">\n  <span style=\"font-size: 16px; background-color: #FEFEFE; padding: 0 10px; margin-left: 10px;\">\n    12V Power\n  </span>\n</div>\n<div style=\"height: 11px;\">&nbsp;</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":450,"y":3740,"wires":[[]]},{"id":"787d153b.a17b74","type":"ui_text","z":"5a05b8f3.894b88","group":"a4a573ee.d6bdf","order":2,"width":"6","height":"1","name":"Generator State /genstatus/+pred/","label":"Status","format":"{{msg.payload}}","layout":"","x":920,"y":4660,"wires":[]},{"id":"9634a554.eba588","type":"ui_button","z":"2fdd8124.05e35e","name":"Shutdown","group":"97b9ad54.9933e","order":7,"width":"3","height":"1","passthru":false,"label":"Shutdown","color":"","bgcolor":"","icon":"fa-power-off","payload":"","payloadType":"str","topic":"shutdown","x":560,"y":1900,"wires":[["415af2a8.5a947c"]]},{"id":"415af2a8.5a947c","type":"exec","z":"2fdd8124.05e35e","command":"sudo /coachproxy/bin/safe_shutdown","addpay":false,"append":"","useSpawn":"","name":"","x":830,"y":1900,"wires":[[],[],[]]},{"id":"4c3ea3a.8a313dc","type":"ui_button","z":"2fdd8124.05e35e","name":"Reboot","group":"97b9ad54.9933e","order":6,"width":"3","height":"1","passthru":true,"label":"Reboot","tooltip":"","color":"","bgcolor":"","icon":"fa-repeat","payload":"","payloadType":"str","topic":"reboot","x":560,"y":1840,"wires":[["14f6b812.2c4f78"]]},{"id":"14f6b812.2c4f78","type":"exec","z":"2fdd8124.05e35e","command":"sudo /coachproxy/bin/safe_reboot","addpay":false,"append":"","useSpawn":"","name":"","x":820,"y":1840,"wires":[[],[],[]]},{"id":"2c3ffc9c.ac652c","type":"ui_text","z":"2fdd8124.05e35e","group":"97b9ad54.9933e","order":8,"width":"","height":"","name":"Shutdown Feedback","label":"","format":"{{msg.payload}}","layout":"col-center","x":820,"y":2020,"wires":[]},{"id":"edae305b.745bc","type":"mqtt in","z":"2fdd8124.05e35e","name":"","topic":"GLOBAL/MESSAGE","qos":"0","datatype":"auto","broker":"c1170463.5c7f8","x":130,"y":320,"wires":[["2efaba3c.f2b586"]]},{"id":"4c937d76.07d3cc","type":"mqtt in","z":"2fdd8124.05e35e","name":"","topic":"GLOBAL/SN","qos":"0","broker":"c1170463.5c7f8","x":150,"y":1300,"wires":[["961203aa.9823c"]]},{"id":"961203aa.9823c","type":"ui_text","z":"2fdd8124.05e35e","group":"97b9ad54.9933e","order":4,"width":"","height":"","name":"Serial Number","label":"Serial Number","format":"{{msg.payload}}","layout":"","x":340,"y":1300,"wires":[]},{"id":"ed8f62b5.c7ed48","type":"ui_text","z":"2fdd8124.05e35e","group":"f961f048.b0646","order":1,"width":"","height":"","name":"eRVin OS Version","label":"eRVin OS Version","format":"{{msg.payload}}","layout":"","x":950,"y":1360,"wires":[]},{"id":"f47d0e1c.87d328","type":"inject","z":"2fdd8124.05e35e","name":"Every Minute","repeat":"60","crontab":"","once":true,"onceDelay":"","topic":"","payload":"","payloadType":"date","x":160,"y":1780,"wires":[["e1ba3e99.4f13a"]]},{"id":"e1ba3e99.4f13a","type":"exec","z":"2fdd8124.05e35e","command":"date +%s -d \"$(uptime -s)\"","addpay":false,"append":"","useSpawn":"","name":"Uptime","x":380,"y":1780,"wires":[["3fcf94be.9ffbec"],[],[]]},{"id":"b6168986.1a2508","type":"ui_text","z":"2fdd8124.05e35e","group":"97b9ad54.9933e","order":5,"width":"","height":"","name":"Uptime","label":"Uptime","format":"{{msg.payload}}","layout":"","x":780,"y":1780,"wires":[]},{"id":"bcfdd5c3.eb51c","type":"mqtt in","z":"2fdd8124.05e35e","name":"","topic":"GLOBAL/SHUTDOWN","qos":"0","broker":"c1170463.5c7f8","x":560,"y":2020,"wires":[["2c3ffc9c.ac652c"]]},{"id":"1d7a9c0d.1599ac","type":"ui_button","z":"5a05b8f3.894b88","d":true,"name":"All On","group":"d944623c.5b46b8","order":2,"width":2,"height":1,"passthru":false,"label":"All On","tooltip":"","color":"","bgcolor":"","icon":"","payload":"2","payloadType":"str","topic":"master","x":1610.2857360839844,"y":219.5712890625,"wires":[["a4f9a80d.d8f2a"]]},{"id":"4514ad25.024a8c","type":"ui_text","z":"5a05b8f3.894b88","d":true,"group":"cae5b35a.e3024","order":2,"width":"3","height":"1","name":"water-pump 3 spaces","label":"","format":"{{msg.payload}}","layout":"row-spread","x":740,"y":3520,"wires":[]},{"id":"555e9ef4.cfe45","type":"rbe","z":"5a05b8f3.894b88","name":"","func":"rbe","gap":"","start":"","inout":"out","x":570,"y":4580,"wires":[["efa73c57.fe0448"]]},{"id":"5b0c641c.f195ec","type":"rbe","z":"5a05b8f3.894b88","name":"","func":"rbe","gap":"","start":"","inout":"out","x":690,"y":4660,"wires":[["787d153b.a17b74"]]},{"id":"76d3f82c.3278b8","type":"rbe","z":"5a05b8f3.894b88","name":"","func":"rbe","gap":"","start":"","inout":"out","x":570,"y":4440,"wires":[["a47ac593.4ed008","f5adb9ac.093858"]]},{"id":"b5d0e09f.8e198","type":"rbe","z":"5a05b8f3.894b88","name":"","func":"rbe","gap":"","start":"","inout":"out","x":570,"y":4400,"wires":[["418bd951.4eb67","f5adb9ac.093858"]]},{"id":"f350bf6f.91161","type":"rbe","z":"5a05b8f3.894b88","name":"","func":"rbe","gap":"","start":"","inout":"out","x":570,"y":4360,"wires":[["72a77d4d.b70dbc","f5adb9ac.093858"]]},{"id":"c3a72e26.0072f","type":"rbe","z":"5a05b8f3.894b88","name":"","func":"rbe","gap":"","start":"","inout":"out","x":797,"y":4941,"wires":[["79a50935.763808"]]},{"id":"84e70031.58d4f","type":"template","z":"5a05b8f3.894b88","name":"2015-2018 Lock Command","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{{topic}} {{payload}}","x":2020,"y":960,"wires":[["62b3ea56.044ecc"]]},{"id":"caa4aa9b.d6b008","type":"file function","z":"5a05b8f3.894b88","name":"genset_safety","filename":".node-red/js/genset_safety.js","reloadfile":false,"outputs":1,"x":1211.8572006225586,"y":4831.142890930176,"wires":[["5ff865b5.d4fae4"]]},{"id":"a68e7ccb.63a44","type":"file function","z":"5a05b8f3.894b88","name":"genset_countdown","filename":".node-red/js/genset_countdown.js","reloadfile":false,"outputs":"2","x":598.5714111328125,"y":4807.714597702026,"wires":[["72ef6a2f.590cdc"],["6de4b0ab.83a33"]]},{"id":"6de4b0ab.83a33","type":"file function","z":"5a05b8f3.894b88","name":"genset_clear_buffer","filename":".node-red/js/genset_clear_buffer.js","reloadfile":false,"outputs":1,"x":607.5714372907366,"y":4940.428774152482,"wires":[["c3a72e26.0072f"]]},{"id":"2efaba3c.f2b586","type":"change","z":"2fdd8124.05e35e","name":"Alert!","rules":[{"t":"set","p":"topic","pt":"msg","to":"Alert!","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":330,"y":320,"wires":[["d86399a0.0a9b08"]]},{"id":"3fcf94be.9ffbec","type":"file function","z":"2fdd8124.05e35e","name":"uptime_parse","filename":".node-red/js/uptime_parse.js","reloadfile":false,"outputs":1,"x":580,"y":1780,"wires":[["b6168986.1a2508"]]},{"id":"1c295a6.055fca6","type":"ui_template","z":"5a05b8f3.894b88","group":"87ed7eaa.ab8fe","name":"Chassis Label /chassislabel/","order":7,"width":"6","height":"1","format":"<!DOCTYPE html>\n<div style=\"height: 10px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 10px; border-bottom: 1px solid black; text-align: left\">\n  <span style=\"font-size: 16px; background-color: #FEFEFE; padding: 0 10px; margin-left: 10px;\">\n    Chassis: <b>{{msg.payload.source}}</b>\n  </span>\n</div>\n<div style=\"height: 8px;\">&nbsp;</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":800,"y":4540,"wires":[[]]},{"id":"3d0470ed.386b4","type":"ui_chart","z":"5a05b8f3.894b88","name":"Tanks Bar Chart","group":"87ed7eaa.ab8fe","order":6,"width":0,"height":0,"label":"","chartType":"bar","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"0","ymax":"100","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#999999","#424242","#941100","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"x":980,"y":4300,"wires":[[]]},{"id":"e9d02061.5900d","type":"inject","z":"5a05b8f3.894b88","name":"Tank Chart Setup","repeat":"","crontab":"","once":true,"onceDelay":"0.1","topic":"","payload":"","payloadType":"date","x":290,"y":4300,"wires":[["12a8a80a.7a4e88"]]},{"id":"12a8a80a.7a4e88","type":"function","z":"5a05b8f3.894b88","name":"Tank Chart Setup","func":"var msgs = [\n    {topic: 'Fresh', payload: 0},\n    {topic: 'Grey', payload: 0},\n    {topic: 'Black', payload: 0},\n];\n\nreturn [msgs];","outputs":1,"noerr":0,"x":530,"y":4300,"wires":[["f5adb9ac.093858"]]},{"id":"29d34722.717808","type":"comment","z":"2fdd8124.05e35e","name":"System Tab","info":"","x":150,"y":1260,"wires":[]},{"id":"4f256116.a0922","type":"function","z":"f6c367c2.63b9b8","name":"Save Option","func":"// Save the user's selection for future use\nflow.set(msg.topic, msg.payload); ","outputs":1,"noerr":0,"x":1150,"y":760,"wires":[[]]},{"id":"6a460ddd.614d34","type":"ui_switch","z":"f6c367c2.63b9b8","d":true,"name":"","label":"Heated Floors","tooltip":"","group":"dd373808.7ec1d8","order":3,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"floorheat","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":780,"y":640,"wires":[["4f256116.a0922"]]},{"id":"e17935c4.9179d8","type":"ui_switch","z":"f6c367c2.63b9b8","d":true,"name":"","label":"Aqua-Hot","tooltip":"","group":"dd373808.7ec1d8","order":2,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"aquahot","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":760,"y":580,"wires":[["4f256116.a0922"]]},{"id":"d47744cb.8e65a8","type":"ui_switch","z":"f6c367c2.63b9b8","d":true,"name":"","label":"Third Air Conditioner Zone","tooltip":"","group":"dd373808.7ec1d8","order":8,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"thirdtstat","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":820,"y":980,"wires":[["4f256116.a0922"]]},{"id":"ebfe21a.9252fe","type":"ui_switch","z":"f6c367c2.63b9b8","d":true,"name":"","label":"Ceiling Fan","tooltip":"","group":"dd373808.7ec1d8","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"ceilfan","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":770,"y":700,"wires":[["4f256116.a0922"]]},{"id":"dc84eec5.90206","type":"ui_switch","z":"f6c367c2.63b9b8","d":true,"name":"","label":"TV Lift","tooltip":"","group":"dd373808.7ec1d8","order":5,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"tvlift","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":750,"y":780,"wires":[["4f256116.a0922"]]},{"id":"3e7decdc.b1a0f4","type":"ui_switch","z":"f6c367c2.63b9b8","d":true,"name":"","label":"Bus Undercoach Light (2018+)","tooltip":"","group":"dd373808.7ec1d8","order":6,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"busundercoach","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":830,"y":840,"wires":[["4f256116.a0922"]]},{"id":"a5725878.456328","type":"ui_switch","z":"f6c367c2.63b9b8","d":true,"name":"","label":"Second Furnace Zone","tooltip":"","group":"dd373808.7ec1d8","order":9,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"secondfurnace","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":800,"y":1060,"wires":[["4f256116.a0922"]]},{"id":"d1929547.5808b8","type":"change","z":"f6c367c2.63b9b8","name":"Set Saved Heated Floors","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.floorheat = 'true'","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":640,"wires":[["6a460ddd.614d34"]]},{"id":"a11e14a2.3f8368","type":"function","z":"f6c367c2.63b9b8","name":"Set Aqua-Hot","func":"// Populate the \"Aqua-Hot\" toggle based on the chosen model.\n\nvar aquahot_standard = ['Allegro_Bus', 'Zephyr'];\nvar msg = { topic: '', payload: '' };\n\nif (flow.get('model')) {\n    if (aquahot_standard.includes(flow.get('model'))) {\n        msg.payload = true;\n    }\n} else {\n    msg = null;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":600,"wires":[["e17935c4.9179d8"]]},{"id":"9367e589.40dcc8","type":"change","z":"f6c367c2.63b9b8","name":"Set Saved Aquahot","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.aquahot = 'true'","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":560,"wires":[["e17935c4.9179d8"]]},{"id":"52b131c0.3e0bc","type":"function","z":"f6c367c2.63b9b8","name":"Set Third Tstat","func":"// Populate the \"Number of Thermostats\" toggle based on the chosen model.\n\nvar third_zone = ['Phaeton', 'Allegro_Bus', 'Zephyr'];\nvar msg = { topic: '', payload: '', enabled: true };\n\nif (flow.get('model')) {\n    if (third_zone.includes(flow.get('model'))) {\n        msg.payload = true;\n    }\n}\n\nif (flow.get('year') < 2018 && flow.get('model').substr(0,8) != 'VanLeigh') {\n    msg.enabled = false;\n    msg.payload = false;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":1000,"wires":[["d47744cb.8e65a8"]]},{"id":"96cb49b8.8b8178","type":"change","z":"f6c367c2.63b9b8","name":"Set Saved Third Tstat","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.thirdtstat = 'true'","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":960,"wires":[["d47744cb.8e65a8"]]},{"id":"d7334b34.c939a8","type":"change","z":"f6c367c2.63b9b8","name":"Set Saved Ceiling Fan","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.ceilfan = 'true'","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":680,"wires":[["ebfe21a.9252fe"]]},{"id":"c850c110.ae628","type":"function","z":"f6c367c2.63b9b8","name":"Set Ceiling Fan","func":"// Populate the \"Ceiling Fan\" toggle based on the chosen model.\n\nvar ceilfan_standard = ['Phaeton', 'Allegro_Bus', 'Zephyr'];\nvar msg = { topic: '', payload: '' };\n\nif (flow.get('model')) {\n    if (ceilfan_standard.includes(flow.get('model'))) {\n        msg.payload = true;\n    }\n} else {\n    msg = null;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":720,"wires":[["ebfe21a.9252fe"]]},{"id":"9b73dccc.9604f","type":"function","z":"f6c367c2.63b9b8","name":"Set TV Lift","func":"// Populate the \"TV Lift\" toggle based on the chosen model.\n\nvar tvlift = ['37_BH', '40_IH', '44_OH', '45_MP', '45_OPP', '45_PZ'];\nvar msg = { topic: '', payload: '' };\n\nmsg.payload = tvlift.includes(flow.get('floorplan'));\n\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":800,"wires":[["dc84eec5.90206"]]},{"id":"e55635a0.d71c08","type":"change","z":"f6c367c2.63b9b8","name":"Set Saved TV Lift","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.tvlift = 'true'","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":760,"wires":[["dc84eec5.90206"]]},{"id":"339d95b3.f8e70a","type":"change","z":"f6c367c2.63b9b8","name":"Set Saved Under Light","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.busundercoach = 'true'","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":840,"wires":[["3e7decdc.b1a0f4"]]},{"id":"fae26113.b499f","type":"change","z":"f6c367c2.63b9b8","name":"Set Saved Second Furnace","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.secondfurnace = 'true'","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":1040,"wires":[["a5725878.456328"]]},{"id":"415cf9bf.4a48f8","type":"link in","z":"f6c367c2.63b9b8","name":"Stored Configs Out","links":["f064e789.8ee718"],"x":95,"y":440,"wires":[["4dfe1b9e.8930a4","9367e589.40dcc8","d1929547.5808b8","d7334b34.c939a8","e55635a0.d71c08","96cb49b8.8b8178","4e592cfc.f31974","339d95b3.f8e70a","fae26113.b499f","3d01252.b8a7ada","c55f7e9a.5b269","bb656f06.c9eb4","d6e99aed.9f4498","4eb415af.b6f65c","f900b347.058da"]]},{"id":"9f2c8e4f.b0e94","type":"link in","z":"f6c367c2.63b9b8","name":"Coach Config Changed - Out","links":["8b7ede7f.8f951"],"x":95,"y":740,"wires":[["a11e14a2.3f8368","52b131c0.3e0bc","9adc4e9b.8e2d2","9b73dccc.9604f","c850c110.ae628","98b23545.c429e8","b28430f0.302e8","5dff0e93.907d5"]]},{"id":"4dfe1b9e.8930a4","type":"delay","z":"f6c367c2.63b9b8","name":"","pauseType":"delay","timeout":"750","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":290,"y":480,"wires":[["7fdd649c.54de1c"]]},{"id":"b33f57fb.ddb3c8","type":"change","z":"f6c367c2.63b9b8","name":"Set Saved Model","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.model","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":420,"wires":[["25d3ff72.475b8"]]},{"id":"8466b73c.6d83f8","type":"change","z":"f6c367c2.63b9b8","name":"Set Saved Year","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.year","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":360,"wires":[["6303f680.65dfe8"]]},{"id":"4e592cfc.f31974","type":"change","z":"f6c367c2.63b9b8","name":"Buttons Enabled?","rules":[{"t":"set","p":"enabled","pt":"msg","to":"payload.floorplan != null","tot":"jsonata"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":1560,"wires":[["66a1a845.bdd5e8"]]},{"id":"9adc4e9b.8e2d2","type":"change","z":"f6c367c2.63b9b8","name":"Buttons Enabled?","rules":[{"t":"set","p":"enabled","pt":"msg","to":"$flowContext('floorplan') != ''","tot":"jsonata"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":1600,"wires":[["66a1a845.bdd5e8"]]},{"id":"7fdd649c.54de1c","type":"change","z":"f6c367c2.63b9b8","name":"Set Saved Floor Plan","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.floorplan","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":480,"wires":[["21735e3b.c9fa92"]]},{"id":"25d3ff72.475b8","type":"ui_dropdown","z":"f6c367c2.63b9b8","d":true,"name":"Model Menu","label":"","tooltip":"","place":"Coach model","group":"5cbd9089.f3b65","order":3,"width":"0","height":"0","passthru":true,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"model","x":770,"y":420,"wires":[["c14463eb.5b67e"]]},{"id":"6303f680.65dfe8","type":"ui_dropdown","z":"f6c367c2.63b9b8","d":true,"name":"Year Menu","label":"","tooltip":"","place":"Coach year","group":"5cbd9089.f3b65","order":2,"width":"0","height":"0","passthru":true,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"year","x":770,"y":360,"wires":[["5da86ad4.9ce744"]]},{"id":"66a1a845.bdd5e8","type":"ui_button","z":"f6c367c2.63b9b8","d":true,"name":"Save and Install","group":"e1a5049d.4cee88","order":2,"width":0,"height":0,"passthru":false,"label":"Save and Install","tooltip":"","color":"","bgcolor":"","icon":"fa-check","payload":"","payloadType":"str","topic":"save","x":790,"y":1580,"wires":[["67d471e1.e9d42","956586e8.3221f8","d61ef8cb.9169a8","6504b8c0.3a9508"]]},{"id":"21735e3b.c9fa92","type":"ui_dropdown","z":"f6c367c2.63b9b8","d":true,"name":"Floor Plan Menu","label":"","tooltip":"","place":"Coach floor plan","group":"5cbd9089.f3b65","order":4,"width":"0","height":"0","passthru":true,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"floorplan","x":780,"y":480,"wires":[["5da0435a.8fc65c"]]},{"id":"c14463eb.5b67e","type":"change","z":"f6c367c2.63b9b8","name":"Save Model","rules":[{"t":"set","p":"model","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":990,"y":420,"wires":[["8b7ede7f.8f951","4c222ef8.3b6f2"]]},{"id":"5da86ad4.9ce744","type":"change","z":"f6c367c2.63b9b8","name":"Save Year","rules":[{"t":"set","p":"year","pt":"flow","to":"$number(msg.payload)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":980,"y":360,"wires":[["8b7ede7f.8f951","e166715c.d96cc"]]},{"id":"67d471e1.e9d42","type":"function","z":"f6c367c2.63b9b8","name":"Save to Database","func":"// Save the global config settings to the database\n\nvar msgs = [];  // An array of database query messages\n\nfor (var item of ['year', 'model', 'floorplan', 'aquahot', 'floorheat', 'ceilfan', 'tvlift', 'thirdtstat', 'secondfurnace', 'midheat', 'rearheat', 'busundercoach', 'powerbed', 'shades_interior']) {\n    var newmsg = {};\n    newmsg.topic = 'INSERT OR REPLACE INTO configs (key, value) VALUES(?, ?)';\n    newmsg.payload = [item, String(flow.get(item))];\n    msgs.push(newmsg);\n}\n\nreturn [msgs, {payload: 'Saving changes...'}];","outputs":2,"noerr":0,"x":1070,"y":1560,"wires":[["c2127265.468ad"],["426d2ff7.9aa5f"]],"outputLabels":["array of queries","feedback message"]},{"id":"956586e8.3221f8","type":"delay","z":"f6c367c2.63b9b8","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1040,"y":1600,"wires":[["430d058c.29f94c","7cd87312.e8638c"]]},{"id":"d61ef8cb.9169a8","type":"change","z":"f6c367c2.63b9b8","name":"Disable Button","rules":[{"t":"set","p":"enabled","pt":"msg","to":"false","tot":"bool"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":1660,"wires":[["66a1a845.bdd5e8"]]},{"id":"6504b8c0.3a9508","type":"delay","z":"f6c367c2.63b9b8","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":630,"y":1700,"wires":[["fc78cf2.39df13","60ea3bd5.a290b4"]]},{"id":"fc78cf2.39df13","type":"change","z":"f6c367c2.63b9b8","name":"Enable Button","rules":[{"t":"set","p":"enabled","pt":"msg","to":"true","tot":"bool"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":1700,"wires":[["66a1a845.bdd5e8"]]},{"id":"5da0435a.8fc65c","type":"function","z":"f6c367c2.63b9b8","name":"Save Floor Plan","func":"// Save the user's selection for future use\nif (msg.payload !== '') {\n    flow.set('floorplan', msg.payload);\n    return msg;\n}","outputs":1,"noerr":0,"x":1000,"y":480,"wires":[["8b7ede7f.8f951"]]},{"id":"8b7ede7f.8f951","type":"link out","z":"f6c367c2.63b9b8","name":"Coach Config Changed - In","links":["9f2c8e4f.b0e94","6ec94471.102c8c","c8c58e81.c105a"],"x":1135,"y":480,"wires":[]},{"id":"c2127265.468ad","type":"sqlite","z":"f6c367c2.63b9b8","mydb":"b9bfcd9c.3c935","name":"","x":1340,"y":1540,"wires":[[]]},{"id":"426d2ff7.9aa5f","type":"ui_text","z":"f6c367c2.63b9b8","d":true,"group":"e1a5049d.4cee88","order":3,"width":0,"height":0,"name":"Feedback Text","label":"","format":"{{msg.payload}}","layout":"row-center","x":1670,"y":1560,"wires":[]},{"id":"430d058c.29f94c","type":"exec","z":"f6c367c2.63b9b8","command":"/coachproxy/configurator/cp_config.pl --habridge","addpay":false,"append":"","useSpawn":"true","timer":"","oldrc":false,"name":"","x":1350,"y":1600,"wires":[[],[],[]]},{"id":"7cd87312.e8638c","type":"change","z":"f6c367c2.63b9b8","name":"Message: Building configuration...","rules":[{"t":"set","p":"payload","pt":"msg","to":"Building configuration...","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1360,"y":1640,"wires":[["426d2ff7.9aa5f"]]},{"id":"60ea3bd5.a290b4","type":"change","z":"f6c367c2.63b9b8","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":1740,"wires":[["426d2ff7.9aa5f"]]},{"id":"b9c3efcf.5b28","type":"change","z":"f6c367c2.63b9b8","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1420,"y":1460,"wires":[["426d2ff7.9aa5f"]]},{"id":"7439d0ba.87459","type":"ui_ui_control","z":"f6c367c2.63b9b8","name":"Update when tab is displayed","x":190,"y":160,"wires":[["1f4566f5.e96699","b54d8c76.440fd"]]},{"id":"1f4566f5.e96699","type":"template","z":"f6c367c2.63b9b8","name":"Load Configs","field":"topic","fieldType":"msg","format":"handlebars","syntax":"plain","template":"select * from configs;","output":"str","x":440,"y":160,"wires":[["56106b2a.7d2784"]]},{"id":"56106b2a.7d2784","type":"sqlite","z":"f6c367c2.63b9b8","mydb":"b9bfcd9c.3c935","name":"coachproxy.sqlite","x":650,"y":160,"wires":[["13e55d69.864273"]]},{"id":"13e55d69.864273","type":"function","z":"f6c367c2.63b9b8","name":"Parse Configs","func":"// msg.payload = msg.payload[0];\n// return msg;\n\nvar payload = {};\nfor (var i = 0; i < (msg.payload).length; i++) {\n    var key = msg.payload[i].key;\n    var val = msg.payload[i].value;\n    flow.set(key, val);\n    if (val !== '') {\n        payload[key] = val;\n    }\n}\n\nmsg.payload = payload;\nreturn msg;","outputs":1,"noerr":0,"x":860,"y":160,"wires":[["f064e789.8ee718"]]},{"id":"f064e789.8ee718","type":"link out","z":"f6c367c2.63b9b8","name":"Stored Configs In","links":["415cf9bf.4a48f8","a9afea44.76da08"],"x":995,"y":160,"wires":[]},{"id":"53414f0e.6d8a","type":"ui_template","z":"f6c367c2.63b9b8","group":"39ecc94c.7e22c6","name":"eRVin Logo","order":1,"width":"6","height":"6","format":"<img src=\"ervin_logo.jpg\">","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"local","x":470,"y":260,"wires":[[]]},{"id":"805121eb.01323","type":"ui_template","z":"f6c367c2.63b9b8","d":true,"group":"dd373808.7ec1d8","name":"Configuration Message","order":1,"width":"0","height":"0","format":"<div style=\"height: 150px;\">\n<p>\n    Next, confirm the configuration options below are\n    correct for your coach.\n</p>\n<p>\n    <br>\n    Some options are only relevant to specific years\n    (e.g. thermostats) or models (e.g. undercoach lights).\n</p>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":810,"y":540,"wires":[[]]},{"id":"21500205.ffa20e","type":"ui_template","z":"f6c367c2.63b9b8","d":true,"group":"5cbd9089.f3b65","name":"Old Welcome Message","order":1,"width":"0","height":"0","format":"<div style=\"height: 130px;\">\n<p>\n    Welcome to eRVin!\n</p>\n<p>\n    <br>\n    Please select your year, model, and floor plan\n    below to begin. Note, you may need to scroll down\n    in the menu to find your model or floor plan.\n</p>\n</div>\n","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":990,"y":260,"wires":[["6303f680.65dfe8"]]},{"id":"47165ea9.fdf12","type":"ui_template","z":"f6c367c2.63b9b8","d":true,"group":"e1a5049d.4cee88","name":"Save and Install Message","order":1,"width":"0","height":"0","format":"<div style='height: 220px;'>\n<p>\n    When finished, use the \"Save and Install\" button\n    below to save your changes and re-configure\n    CoachProxyOS.\n</p>\n<p>\n    <br>\n    <b>Important</b>: Your web browser will disconnect momentarily while CoachProxyOS reloads. This re-configuration process will take approximately 30 seconds to complete.\n</p>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":810,"y":1540,"wires":[[]]},{"id":"d031d4bf.52d7b8","type":"mqtt in","z":"2fdd8124.05e35e","name":"","topic":"GLOBAL/VER","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":150,"y":1340,"wires":[["ccf1905a.52a16"]]},{"id":"8a00f07e.fdd1f","type":"sqlite","z":"2fdd8124.05e35e","mydb":"b2130e68.3a338","name":"CoachProxy","x":890,"y":160,"wires":[["cdca660e.2a75e8"]]},{"id":"bb8e213c.41e4","type":"inject","z":"2fdd8124.05e35e","name":"At launch","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"","topic":"","payload":"0","payloadType":"num","x":100,"y":80,"wires":[["7544e81a.afed08","61fe328c.5c91cc"]]},{"id":"59ca8f91.7aff9","type":"template","z":"2fdd8124.05e35e","name":"Load settings2","field":"topic","fieldType":"msg","format":"handlebars","syntax":"plain","template":"select * from settings2;","output":"str","x":700,"y":160,"wires":[["8a00f07e.fdd1f"]]},{"id":"cdca660e.2a75e8","type":"function","z":"2fdd8124.05e35e","name":"Store settings2","func":"for (var i = 0; i < (msg.payload).length; i++) {\n    var key = msg.payload[i].key;\n    var value = msg.payload[i].value;\n\n    // If a JSON string is passed in, parse it and save the resulting\n    // object into global context. Otherwise, just save the raw value.\n    if (typeof(value) == 'string' && (value.charAt(0) == '[' || value.charAt(0) == '{')) {\n        global.set('settings2.' + key, JSON.parse(value));\n    } else {\n        global.set('settings2.' + key, value);\n    }\n}\n\n// Returning NULL would terminate the flow, but other\n// nodes want to know when settings have been loaded.\nreturn {};","outputs":1,"noerr":0,"x":1080,"y":160,"wires":[["b8e34e9a.dc367"]]},{"id":"1afee14e.f145af","type":"comment","z":"2fdd8124.05e35e","name":"settings2 database : Link here to save settings or be notified when settings are loaded","info":"","x":340,"y":40,"wires":[]},{"id":"5927abd3.f623e4","type":"function","z":"2fdd8124.05e35e","name":"Save settings2","func":"// Save the provided key and value to the settings2 DB table, and\n// update the settings2 global context.\nvar key = msg.topic;\nvar value = msg.payload;\n\n// If a JSON string is passed in, parse it and save the resulting\n// object into global context. Otherwise, just save the raw value.\nif (typeof(value) == 'string' && (value.charAt(0) == '[' || value.charAt(0) == '{')) {\n    global.set('settings2.' + key, JSON.parse(value));\n} else {\n    global.set('settings2.' + key, value);\n}\n\nvar newmsg = {};\nnewmsg.topic = 'INSERT OR REPLACE INTO settings2 (key, value) VALUES(?, ?)';\nnewmsg.payload = [key, String(value)];\n\nreturn newmsg;","outputs":1,"noerr":0,"x":700,"y":200,"wires":[["8a6a2b57.dbc188"]]},{"id":"8a6a2b57.dbc188","type":"sqlite","z":"2fdd8124.05e35e","mydb":"b2130e68.3a338","name":"CoachProxy","x":890,"y":200,"wires":[["b8e34e9a.dc367"]]},{"id":"b8e34e9a.dc367","type":"link out","z":"2fdd8124.05e35e","name":"Settings2 has been loaded","links":["8a1f3ae4.1ea3a8","cab70e7f.c6c35","72269b85.831204"],"x":1215,"y":200,"wires":[]},{"id":"e357c5ad.eaba18","type":"link in","z":"2fdd8124.05e35e","name":"Save key/value to settings2","links":["3a3cc1a1.4ee1ee","53444718.65a778","bc50fc72.5c00a","2ad4a4a5.c0435c"],"x":535,"y":200,"wires":[["5927abd3.f623e4"]]},{"id":"a71b65f6.8762e8","type":"comment","z":"2fdd8124.05e35e","name":"Send a message to GLOBAL/MESSAGE to display a pop-up alert","info":"","x":270,"y":260,"wires":[]},{"id":"d86399a0.0a9b08","type":"ui_toast","z":"2fdd8124.05e35e","position":"top right","displayTime":"5","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"","name":"","x":530,"y":320,"wires":[]},{"id":"e1e629e7.af8af8","type":"mqtt in","z":"f6c367c2.63b9b8","name":"","topic":"GLOBAL/SHUTDOWN","qos":"2","broker":"c1170463.5c7f8","x":1400,"y":1500,"wires":[["426d2ff7.9aa5f"]]},{"id":"1ad1aea9.866741","type":"ui_switch","z":"f6c367c2.63b9b8","d":true,"name":"","label":"Mid Zone Heat Pump","tooltip":"","group":"dd373808.7ec1d8","order":10,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"midheat","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":800,"y":1140,"wires":[["4f256116.a0922"]]},{"id":"771b1df0.fe0b74","type":"ui_switch","z":"f6c367c2.63b9b8","d":true,"name":"","label":"Rear Zone Heat Pump","tooltip":"","group":"dd373808.7ec1d8","order":11,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"rearheat","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":800,"y":1220,"wires":[["4f256116.a0922"]]},{"id":"3d01252.b8a7ada","type":"change","z":"f6c367c2.63b9b8","name":"Set Saved Mid Heat Pump","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.midheat = 'true'","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":1120,"wires":[["1ad1aea9.866741"]]},{"id":"c55f7e9a.5b269","type":"change","z":"f6c367c2.63b9b8","name":"Set Saved Rear Heat Pump","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.rearheat = 'true'","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":1200,"wires":[["771b1df0.fe0b74"]]},{"id":"176c91be.746e3e","type":"ui_template","z":"f6c367c2.63b9b8","d":true,"group":"dd373808.7ec1d8","name":"Config HVAC Header","order":7,"width":"6","height":"1","format":"<div style=\"width: 100%; height: 10px; border-bottom: 1px solid black; text-align: center\">\n  <span style=\"background-color: #ffffff; padding: 0 10px;\">\n    2018+ Thermostat Controls\n  </span>\n</div>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":800,"y":940,"wires":[[]]},{"id":"98b23545.c429e8","type":"function","z":"f6c367c2.63b9b8","name":"Set Second Furnace","func":"// Populate the \"Number of Furnaces\" toggle based on the chosen model.\n\nvar second_furn = ['Phaeton', 'Allegro_Bus', 'Zephyr'];\nvar msg = { topic: '', payload: '', enabled: true };\n\nif (flow.get('model')) {\n    if (second_furn.includes(flow.get('model'))) {\n        msg.payload = true;\n    }\n}\n\nif (flow.get('year') < 2018 && flow.get('model').substr(0,8) != 'VanLeigh') {\n    msg.enabled = false;\n    msg.payload = false;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":480,"y":1080,"wires":[["a5725878.456328"]]},{"id":"b28430f0.302e8","type":"function","z":"f6c367c2.63b9b8","name":"Set Mid Heat Pump","func":"var mid_hp = ['Phaeton', 'Allegro_Bus', 'Zephyr'];\nvar msg = { topic: '', payload: '', enabled: true };\n\nif (flow.get('model')) {\n    if (mid_hp.includes(flow.get('model'))) {\n        msg.payload = true;\n    }\n}\n\nif (flow.get('year') < 2018 && flow.get('model').substr(0,8) != 'VanLeigh') {\n    msg.enabled = false;\n    msg.payload = false;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":1160,"wires":[["1ad1aea9.866741"]]},{"id":"5dff0e93.907d5","type":"function","z":"f6c367c2.63b9b8","name":"Set Rear Heat Pump","func":"var rear_hp = ['Phaeton', 'Allegro_Bus', 'Zephyr'];\nvar msg = { topic: '', payload: '', enabled: true };\n\nif (flow.get('model')) {\n    if (rear_hp.includes(flow.get('model'))) {\n        msg.payload = true;\n    }\n}\n\nif (flow.get('year') < 2018 && flow.get('model').substr(0,8) != 'VanLeigh') {\n    msg.enabled = false;\n    msg.payload = false;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":480,"y":1240,"wires":[["771b1df0.fe0b74"]]},{"id":"bb656f06.c9eb4","type":"delay","z":"f6c367c2.63b9b8","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":290,"y":420,"wires":[["b33f57fb.ddb3c8"]]},{"id":"ec2c7c9d.42b27","type":"ui_switch","z":"f6c367c2.63b9b8","d":true,"name":"","label":"Power Smart Bed","tooltip":"","group":"dd373808.7ec1d8","order":6,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"powerbed","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":790,"y":880,"wires":[["4f256116.a0922"]]},{"id":"d6e99aed.9f4498","type":"change","z":"f6c367c2.63b9b8","name":"Set Saved Power Bed","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.powerbed = 'true'","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":880,"wires":[["ec2c7c9d.42b27"]]},{"id":"282a6d56.cf1e62","type":"ui_text","z":"2fdd8124.05e35e","group":"a027aa68.277858","order":3,"width":0,"height":0,"name":"Feedback Text","label":"","format":"{{msg.payload}}","layout":"row-center","x":600,"y":2380,"wires":[]},{"id":"85eb19db.becd18","type":"mqtt in","z":"2fdd8124.05e35e","name":"","topic":"GLOBAL/SHUTDOWN","qos":"2","broker":"c1170463.5c7f8","x":340,"y":2380,"wires":[["282a6d56.cf1e62"]]},{"id":"165202ff.dbfd0d","type":"ui_template","z":"5a05b8f3.894b88","d":true,"group":"2e0a52f8.6acbee","name":"Custom CSS","order":26,"width":0,"height":0,"format":"<link rel=\"stylesheet\" href=\"css/font-awesome-animation.min.css\">\n<style type=\"text/css\">button { touch-action: manipulation; }</style>\n","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"global","x":930,"y":480,"wires":[[]]},{"id":"702c340b.b0efcc","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/13","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":960,"wires":[["43df7d4d.dddce4"]],"info":"To parse the MQTT data to JSON, instead of a separate JSON node on the output, simply set the output of this MQTT node to \"a parsed JSON object\"."},{"id":"2f4d0c99.e23bf4","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/14","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":1040,"wires":[["bb2ed260.6accf"]]},{"id":"ede65af9.7b44e8","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":1520,"wires":[["e291aabb.d74588"],["d573ae50.c4dc38"]],"outputLabels":["on/off value","brightness value"]},{"id":"55a2f976.8a3eb8","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":1600,"wires":[["93ad9c5a.823bf8"],["a6532b96.f6876"]],"outputLabels":["on/off value","brightness value"]},{"id":"38e39d9a.7e7722","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":1680,"wires":[["f1ceb03a.ba774"],["285ed135.2d577e"]],"outputLabels":["on/off value","brightness value"]},{"id":"99e7d694.1fd918","type":"comment","z":"5a05b8f3.894b88","name":"Basic power display (2015-2017)","info":"","x":210,"y":3740,"wires":[]},{"id":"1f37898c.ab8036","type":"template","z":"2fdd8124.05e35e","name":"Load presets","field":"topic","fieldType":"msg","format":"handlebars","syntax":"plain","template":"select * from presets;","output":"str","x":690,"y":80,"wires":[["b7dc14dd.f21c28"]]},{"id":"b7dc14dd.f21c28","type":"sqlite","z":"2fdd8124.05e35e","mydb":"b2130e68.3a338","name":"CoachProxy","x":890,"y":80,"wires":[["7b893f4b.6cfd4"]]},{"id":"7b893f4b.6cfd4","type":"function","z":"2fdd8124.05e35e","name":"Store presets","func":"var presets = [];\nfor (let i = 1; i <= 10; i++) {\n    presets[i] = { name: '' };\n}\n\nfor (let i = 0; i < (msg.payload).length; i++) {\n    let number = msg.payload[i].number;\n    let data = JSON.parse(msg.payload[i].data);\n    presets[number] = data;\n}\n\nglobal.set('presets', presets);\n\n// Returning NULL would terminate the flow, but other\n// nodes want to know when settings have been loaded.\nreturn {};","outputs":1,"noerr":0,"x":1080,"y":80,"wires":[["e93057bd.d997f8"]]},{"id":"e93057bd.d997f8","type":"link out","z":"2fdd8124.05e35e","name":"presets have been loaded","links":["56509485.b3fb0c","a29e5196.33994","c6d920b4.871a"],"x":1215,"y":80,"wires":[]},{"id":"6e343550.d4c04c","type":"ui_template","z":"2fdd8124.05e35e","group":"a027aa68.277858","name":"Voice Discovery Notes","order":1,"width":"6","height":"3","format":"<div style='margin-bottom: 1em;'>\nIf Alexa Discovery is not finding any devices, you can\nrestart the voice software with the button below,\nthen immediately try discovery again via Alexa.\n</div>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":340,"y":2440,"wires":[[]]},{"id":"46cd9439.7db8dc","type":"ui_button","z":"2fdd8124.05e35e","name":"","group":"a027aa68.277858","order":2,"width":"6","height":"1","passthru":false,"label":"Restart Voice Integration","color":"","bgcolor":"","icon":"fa-refresh","payload":"Restarting Voice Software...","payloadType":"str","topic":"","x":350,"y":2480,"wires":[["4e666121.1cd37","7ae2fd18.387b74","282a6d56.cf1e62"]]},{"id":"4e666121.1cd37","type":"exec","z":"2fdd8124.05e35e","command":"/coachproxy/ha-bridge/re-init","addpay":false,"append":"","useSpawn":"","timer":"","oldrc":false,"name":"","x":630,"y":2500,"wires":[[],[],[]]},{"id":"7ae2fd18.387b74","type":"delay","z":"2fdd8124.05e35e","name":"","pauseType":"delay","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":580,"y":2440,"wires":[["93e5bf34.e3f6a"]]},{"id":"93e5bf34.e3f6a","type":"change","z":"2fdd8124.05e35e","name":"blank","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":2440,"wires":[["282a6d56.cf1e62"]]},{"id":"49eafa.00923508","type":"switch","z":"5a05b8f3.894b88","name":"Lock Type","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"--","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1790,"y":920,"wires":[["57101b18.624394"],["84e70031.58d4f"]],"outputLabels":["2019+","2015-2018"]},{"id":"57101b18.624394","type":"exec","z":"5a05b8f3.894b88","command":"/coachproxy/rv-c/dc_dimmer_pair.pl ","addpay":true,"append":"","useSpawn":"","timer":"","oldrc":false,"name":"dc_dimmer_pair.pl /locks/+pred/","x":2030,"y":900,"wires":[[],[],[]]},{"id":"84c29343.d700a","type":"mqtt in","z":"2fdd8124.05e35e","name":"","topic":"NETWORK/#","qos":"0","broker":"c1170463.5c7f8","x":110,"y":420,"wires":[["ded540a8.bef63"]]},{"id":"19cb1b48.a85c05","type":"ui_template","z":"2fdd8124.05e35e","group":"cd05e210.dac658","name":"WiFi Network Info","order":1,"width":"6","height":"6","format":"<div layout=\"column\" layout-align=\"space-between\">\n    <div>{{msg.message}}</div>&nbsp;\n    <div>&nbsp;</div>\n    <div style=\"text-align: center; font-weight: bold\">Your WiFi Network</div>&nbsp;\n    <div layout=\"row\" layout-align=\"space-between\"><span>Network:</span>{{msg.data.WPA.SSID}}</div>&nbsp;\n    <div layout=\"row\" layout-align=\"space-between\"><span>IP Address:</span><a href='http://{{msg.data.WPA.IP}}'>{{msg.data.WPA.IP}}</a></div>&nbsp;\n    <div layout=\"row\" layout-align=\"space-between\"><span>HW Address:</span>{{msg.data.WPA.MAC}}</div>&nbsp;\n    <div layout=\"row\" layout-align=\"space-between\"><span>Connection Status:</span>{{msg.data.WPA.STATE}}</div>&nbsp;\n    <div layout=\"row\" layout-align=\"space-between\"><span>Connection Quality:</span>{{msg.data.WPA.QUALITY}}%</div>&nbsp;\n    <p>&nbsp;</p>\n</div>\n","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":890,"y":420,"wires":[[]]},{"id":"326735d2.c640ba","type":"rbe","z":"2fdd8124.05e35e","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":510,"y":420,"wires":[["998a248b.358218"]]},{"id":"ded540a8.bef63","type":"file function","z":"2fdd8124.05e35e","name":"network_info.js","filename":".node-red/js/network_info.js","reloadfile":false,"outputs":1,"x":320,"y":420,"wires":[["326735d2.c640ba"]]},{"id":"8a3a4af9.460768","type":"file function","z":"2fdd8124.05e35e","name":"initialize_global_context.js","filename":".node-red/js/initialize_global_context.js","reloadfile":true,"outputs":1,"x":470,"y":80,"wires":[["1f37898c.ab8036","59ca8f91.7aff9","6cb7aeff.ab5aa"]]},{"id":"9fc555ef.65b448","type":"json","z":"2fdd8124.05e35e","name":"","property":"payload","action":"","pretty":false,"x":750,"y":2260,"wires":[["2408673.a578d98","a58d813b.ec697"]]},{"id":"a4d6128e.0b4f6","type":"file in","z":"2fdd8124.05e35e","name":"ha-bridge/device.db","filename":"/coachproxy/ha-bridge/device.db","format":"utf8","chunk":false,"sendError":false,"x":570,"y":2260,"wires":[["9fc555ef.65b448"]]},{"id":"2408673.a578d98","type":"function","z":"2fdd8124.05e35e","name":"Create Voice Command List","func":"var template = '<div layout=\"column\" layout-align=\"space-between\">';\ntemplate += '<p>Voice Integration supports ' + (msg.payload).length + ' voice command devices for your coach, listed below.</p>\\n';\ntemplate += '<p>Each device responds to \"turn on\", \"turn off\", \"brighten\" and \"dim\" voice commands. Only devices listed with a plus sign (<b>+</b>) in front of them respond to \"brighten\" or dim\" commands.</p>\\n';\ntemplate += '<p>Some example commands include: \"Alexa, turn on the Sink Lights\", or \"Alexa, brighten the Center Ceiling Light\", or \"Alexa set the Dinette Light to 50 percent\", or \"Alexa dim the Dinette Light to 25\".</p>\\n';\ntemplate += '<hr>\\n';\n\ntemplate += '<p>';\nfor (let i = 0; i < (msg.payload).length; i++) {\n    let name = msg.payload[i].name.trim();\n    let dim = msg.payload[i].dimUrl;\n    let bullet = dim ? '+' : '-';\n    template += bullet + ' ' + name + '<br>\\n';\n}\ntemplate += '</p>';\n\ntemplate += '</div>';\nmsg.template = template;\n\nreturn msg;","outputs":1,"noerr":0,"x":960,"y":2260,"wires":[["82837448.a8e478"]]},{"id":"82837448.a8e478","type":"ui_template","z":"2fdd8124.05e35e","group":"7dcb24f9.ce47cc","name":"Voice Command List","order":1,"width":"0","height":"0","format":"","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1220,"y":2260,"wires":[[]]},{"id":"d41e8eef.726dd","type":"inject","z":"2fdd8124.05e35e","name":"inject at start","props":[{"p":"payload","v":"","vt":"date"},{"p":"topic","v":"","vt":"string"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":170,"y":2260,"wires":[["a1065790.929ad8","82216071.55df1"]]},{"id":"30869709.57ea08","type":"comment","z":"2fdd8124.05e35e","name":"Voice Integration Settings","info":"","x":210,"y":2100,"wires":[]},{"id":"f5adb9ac.093858","type":"change","z":"5a05b8f3.894b88","name":"Set Chart Label","rules":[{"t":"set","p":"topic","pt":"msg","to":"$replace(msg.topic, /.*\\//, '')","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":4300,"wires":[["3d0470ed.386b4"]]},{"id":"406f7d8e.c9e964","type":"mqtt in","z":"477cac19.6a9e64","name":"","topic":"RVC/TANK_STATUS/#","qos":"2","broker":"c1170463.5c7f8","x":140,"y":80,"wires":[["cd187e10.f8322"]]},{"id":"cd187e10.f8322","type":"json","z":"477cac19.6a9e64","name":"","property":"payload","action":"","pretty":false,"x":410,"y":80,"wires":[["f5e5995e.fe3888"]]},{"id":"b253067e.9633c8","type":"mqtt out","z":"477cac19.6a9e64","name":"CP/TANK_STATUS/TankName","topic":"","qos":"","retain":"","broker":"c1170463.5c7f8","x":890,"y":80,"wires":[]},{"id":"16624199.59e1ee","type":"comment","z":"477cac19.6a9e64","name":"Determine parking brake and ignition status and republish it","info":"","x":260,"y":160,"wires":[]},{"id":"d04e0e71.972ce","type":"mqtt in","z":"477cac19.6a9e64","name":"","topic":"RVC/CHASSIS_MOBILITY_STATUS","qos":"2","broker":"c1170463.5c7f8","x":180,"y":200,"wires":[["947840a5.14609"]]},{"id":"947840a5.14609","type":"json","z":"477cac19.6a9e64","name":"","property":"payload","action":"","pretty":false,"x":410,"y":200,"wires":[["d4932ecd.c9281"]]},{"id":"3f6d5ecb.388b62","type":"mqtt out","z":"477cac19.6a9e64","name":"CP/IGNITION or CP/PARKBRAKE","topic":"","qos":"","retain":"","broker":"c1170463.5c7f8","x":900,"y":200,"wires":[]},{"id":"660b012f.2bc5b","type":"comment","z":"477cac19.6a9e64","name":"Calculate holding tank percent full and republish it","info":"","x":230,"y":40,"wires":[]},{"id":"eff55b53.b6f288","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/GENERIC_INDICATOR_COMMAND/255","qos":"2","datatype":"json","broker":"c1170463.5c7f8","x":1330,"y":80,"wires":[["5da87095.951df"]]},{"id":"a0c0d1db.0ba1e","type":"change","z":"5a05b8f3.894b88","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.brightness > 0 ? 100 : 0","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":1960,"y":60,"wires":[["9ee193c3.f6d9f8"]]},{"id":"90b01324.960d5","type":"change","z":"5a05b8f3.894b88","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.brightness","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1960,"y":100,"wires":[["4251713d.675418"]]},{"id":"10e80e93.5f0211","type":"template","z":"5a05b8f3.894b88","name":"Add group id","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"126 {{payload}}","output":"str","x":2390,"y":80,"wires":[["f9363c14.d66b"]]},{"id":"8a3a667e.b770d8","type":"mqtt in","z":"477cac19.6a9e64","name":"","topic":"RVC/GENERATOR_STATUS_1","qos":"2","broker":"c1170463.5c7f8","x":160,"y":320,"wires":[["bb3a5438.3970d8"]]},{"id":"bb3a5438.3970d8","type":"json","z":"477cac19.6a9e64","name":"","property":"payload","action":"","pretty":false,"x":410,"y":320,"wires":[["4c155211.73165c"]]},{"id":"f0779982.feef28","type":"mqtt out","z":"477cac19.6a9e64","name":"","topic":"CP/GENERATOR","qos":"","retain":"","broker":"c1170463.5c7f8","x":910,"y":320,"wires":[]},{"id":"45e1761e.135ae8","type":"comment","z":"477cac19.6a9e64","name":"Republish generator status in simple form","info":"","x":200,"y":280,"wires":[]},{"id":"cd976c85.83861","type":"change","z":"5a05b8f3.894b88","name":"","rules":[{"t":"set","p":"type","pt":"msg","to":"generator","tot":"str"},{"t":"set","p":"pkttime","pt":"msg","to":"$substringAfter(payload, ',')","tot":"jsonata"},{"t":"set","p":"payload","pt":"msg","to":"$substringBefore(payload, ',')","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":4660,"wires":[["5b0c641c.f195ec"]]},{"id":"6b2a8e3c.7dae6","type":"change","z":"5a05b8f3.894b88","d":true,"name":"","rules":[{"t":"set","p":"brightness","pt":"msg","to":"payload['operating status (brightness)']","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"brightness > 0 ? 'on' : 'off'","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":3580,"wires":[["b363f64.81e8f08"]]},{"id":"5da87095.951df","type":"switch","z":"5a05b8f3.894b88","name":"Pass Group 126","property":"payload.group","propertyType":"msg","rules":[{"t":"eq","v":"01111110","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1600,"y":80,"wires":[["76dcb995.a69628"]]},{"id":"d4932ecd.c9281","type":"file function","z":"477cac19.6a9e64","name":"decode_chassis_mobility","filename":".node-red/js/decode_chassis_mobility.js","reloadfile":false,"outputs":1,"x":610,"y":200,"wires":[["3f6d5ecb.388b62"]]},{"id":"f5e5995e.fe3888","type":"file function","z":"477cac19.6a9e64","name":"decode_tank","filename":".node-red/js/decode_tank.js","reloadfile":false,"outputs":1,"x":570,"y":80,"wires":[["b253067e.9633c8"]]},{"id":"ea5d3dfc.eb98","type":"http request","z":"2fdd8124.05e35e","name":"ngrok tunnel info","method":"GET","ret":"txt","url":"http://localhost:4040/api/tunnels/coachproxy","tls":"","x":480,"y":840,"wires":[["5040b9f8.e68ee8"]]},{"id":"abd2f48d.eed968","type":"inject","z":"2fdd8124.05e35e","name":"","repeat":"1","crontab":"","once":true,"onceDelay":"1","topic":"","payload":"true","payloadType":"bool","x":280,"y":840,"wires":[["ea5d3dfc.eb98"]]},{"id":"7897c8d.05a0a38","type":"json","z":"2fdd8124.05e35e","name":"","property":"payload","action":"","pretty":false,"x":840,"y":820,"wires":[["87e5b74a.480508"]]},{"id":"5040b9f8.e68ee8","type":"switch","z":"2fdd8124.05e35e","name":"Status Code","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":680,"y":840,"wires":[["7897c8d.05a0a38"],["7342ea49.a2c6a4"]]},{"id":"7342ea49.a2c6a4","type":"change","z":"2fdd8124.05e35e","name":"Offline","rules":[{"t":"set","p":"payload","pt":"msg","to":"Offline","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":980,"y":860,"wires":[["861fe173.d8f1d"]]},{"id":"87e5b74a.480508","type":"change","z":"2fdd8124.05e35e","name":"Link URL","rules":[{"t":"set","p":"payload","pt":"msg","to":"\"<a target='_tunnel' href='\" & payload.public_url & \"/ui'>\" & payload.public_url & \"/ui</a>\"","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":990,"y":820,"wires":[["861fe173.d8f1d"]]},{"id":"bb6ebc9f.d7c91","type":"ui_text","z":"2fdd8124.05e35e","group":"23adf1d9.326cae","order":1,"width":0,"height":0,"name":"","label":"Remote Access URL:","format":"{{msg.payload}}","layout":"col-center","x":1330,"y":860,"wires":[]},{"id":"ca31e3a1.1f1d8","type":"comment","z":"2fdd8124.05e35e","name":"Remote Access Settings","info":"","x":310,"y":720,"wires":[]},{"id":"d396acc4.86d79","type":"ui_switch","z":"2fdd8124.05e35e","name":"","label":"Enable Remote Access","group":"23adf1d9.326cae","order":3,"width":0,"height":0,"passthru":false,"decouple":"false","topic":"remote_access","style":"","onvalue":"true","onvalueType":"str","onicon":"","oncolor":"","offvalue":"false","offvalueType":"str","officon":"","offcolor":"","x":680,"y":940,"wires":[["3a3cc1a1.4ee1ee","21546672.c4f77a"]]},{"id":"21546672.c4f77a","type":"exec","z":"2fdd8124.05e35e","command":"/coachproxy/bin/apply_remote_access_settings.sh","addpay":false,"append":"","useSpawn":"","timer":"","oldrc":false,"name":"apply_remote_access_settings.sh","x":1230,"y":1040,"wires":[["fa4267ba.859788"],[],["6d1d1ade.5487f4"]]},{"id":"8534daf0.679d88","type":"ui_text_input","z":"2fdd8124.05e35e","name":"ngrok Authtoken","label":"Enter your ngrok Authtoken","group":"23adf1d9.326cae","order":4,"width":"0","height":"0","passthru":false,"mode":"text","delay":"300","topic":"ngrok_auth","x":700,"y":980,"wires":[["3ac17815.cc7f48"]]},{"id":"cbbddadf.eeaac8","type":"ui_text_input","z":"2fdd8124.05e35e","name":"Remote Username","label":"Choose a Remote Access username","group":"23adf1d9.326cae","order":5,"width":"0","height":"0","passthru":false,"mode":"text","delay":"300","topic":"remote_username","x":700,"y":1020,"wires":[["3ac17815.cc7f48"]]},{"id":"34c110f5.5bae5","type":"ui_text_input","z":"2fdd8124.05e35e","name":"Remote Password","label":"Choose a Remote Access password","group":"23adf1d9.326cae","order":6,"width":"0","height":"0","passthru":false,"mode":"text","delay":"300","topic":"remote_password","x":700,"y":1060,"wires":[["3ac17815.cc7f48"]]},{"id":"c51c7274.fc736","type":"ui_button","z":"2fdd8124.05e35e","name":"","group":"23adf1d9.326cae","order":9,"width":"4","height":"1","passthru":false,"label":"Save","color":"","bgcolor":"","icon":"fa-check","payload":"save","payloadType":"str","topic":"","x":740,"y":1140,"wires":[["17ca583.8f6a7a8","21546672.c4f77a"]]},{"id":"253b33aa.a718ac","type":"ui_button","z":"2fdd8124.05e35e","name":"","group":"23adf1d9.326cae","order":10,"width":"2","height":"1","passthru":false,"label":"Undo","color":"","bgcolor":"#8D4040","icon":"fa-undo","payload":"delete","payloadType":"str","topic":"","x":200,"y":1140,"wires":[["99101545.c299f8","14042d19.bd9f63","2e7cb20.e483c4e","b0d20900.53b148"]]},{"id":"cf43085e.f93028","type":"ui_template","z":"2fdd8124.05e35e","group":"23adf1d9.326cae","name":"Remote Access Settings","order":2,"width":"6","height":"3","format":"<div layout=\"column\" layout-align=\"space-between\">\n<p>\nBefore using Remote Access, please read the\n<a target='_blank' href='http://coachproxy.com/remote-access-setup-new'>instructions\non how to set up and configure it.</a>\n</p>\n<p>\nEnter your ngrok Authtoken below, and choose a username and\npassword for your Remote Access service.\n</p>\n</div>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":680,"y":900,"wires":[[]]},{"id":"3a3cc1a1.4ee1ee","type":"link out","z":"2fdd8124.05e35e","name":"Remote access settings changed","links":["e357c5ad.eaba18"],"x":1105,"y":940,"wires":[]},{"id":"cab70e7f.c6c35","type":"link in","z":"2fdd8124.05e35e","name":"Set remote access fields","links":["b8e34e9a.dc367"],"x":165,"y":1000,"wires":[["faf5ce15.01fda","99101545.c299f8","14042d19.bd9f63","2e7cb20.e483c4e","b0d20900.53b148"]]},{"id":"faf5ce15.01fda","type":"change","z":"2fdd8124.05e35e","name":"settings2.remote_access","rules":[{"t":"set","p":"payload","pt":"msg","to":"$globalContext('settings2.remote_access')","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":940,"wires":[["d396acc4.86d79"]]},{"id":"3ac17815.cc7f48","type":"file function","z":"2fdd8124.05e35e","name":"form_field_save.js","filename":".node-red/js/form_field_save.js","reloadfile":false,"outputs":1,"x":940,"y":1040,"wires":[[]]},{"id":"17ca583.8f6a7a8","type":"function","z":"2fdd8124.05e35e","name":"Save Remote Settings","func":"const topics = ['ngrok_auth', 'remote_username', 'remote_password', 'remote_subdomain'];\nvar msgs = [];\n\ntopics.forEach(function(topic) {\n  const value = global.get('form')[topic] || '';\n  const newmsg = { topic: topic, payload: value };\n  msgs.push(newmsg);\n});\n\nreturn [ msgs ];\n","outputs":1,"noerr":0,"x":950,"y":1140,"wires":[["3a3cc1a1.4ee1ee"]]},{"id":"99101545.c299f8","type":"change","z":"2fdd8124.05e35e","name":"settings2.ngrok_auth","rules":[{"t":"set","p":"payload","pt":"msg","to":"$globalContext('settings2.ngrok_auth')","tot":"jsonata"},{"t":"set","p":"form.ngrok_auth","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":980,"wires":[["8534daf0.679d88"]]},{"id":"14042d19.bd9f63","type":"change","z":"2fdd8124.05e35e","name":"settings2.remote_username","rules":[{"t":"set","p":"payload","pt":"msg","to":"$globalContext('settings2.remote_username')","tot":"jsonata"},{"t":"set","p":"form.remote_username","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":1020,"wires":[["cbbddadf.eeaac8"]]},{"id":"2e7cb20.e483c4e","type":"change","z":"2fdd8124.05e35e","name":"settings2.remote_password","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"},{"t":"set","p":"form.remote_password","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":1060,"wires":[["34c110f5.5bae5"]]},{"id":"5c225f1a.7e815","type":"catch","z":"2fdd8124.05e35e","name":"Catch ECONNREFUSED","scope":["ea5d3dfc.eb98"],"x":310,"y":780,"wires":[[]]},{"id":"6cf20fc6.84827","type":"ui_text_input","z":"2fdd8124.05e35e","name":"Remote Subdomain","label":"Custom subdomain (paid plan)","group":"23adf1d9.326cae","order":7,"width":"0","height":"0","passthru":false,"mode":"text","delay":"300","topic":"remote_subdomain","x":690,"y":1100,"wires":[["3ac17815.cc7f48"]]},{"id":"b0d20900.53b148","type":"change","z":"2fdd8124.05e35e","name":"settings2.remote_subdomain","rules":[{"t":"set","p":"payload","pt":"msg","to":"$globalContext('settings2.remote_subdomain')","tot":"jsonata"},{"t":"set","p":"form.remote_subdomain","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":1100,"wires":[["6cf20fc6.84827"]]},{"id":"54538fd2.68515","type":"mqtt in","z":"2fdd8124.05e35e","name":"","topic":"CP/MESSAGE/REMOTEACCESS","qos":"0","broker":"c1170463.5c7f8","x":180,"y":1180,"wires":[["9e9b422.b80bbc","de6c0a1.abc44f8"]]},{"id":"9e9b422.b80bbc","type":"trigger","z":"2fdd8124.05e35e","name":"15 Second Reset","op1":"","op2":" ","op1type":"nul","op2type":"str","duration":"15","extend":true,"units":"s","reset":"","bytopic":"all","outputs":1,"x":440,"y":1160,"wires":[["de6c0a1.abc44f8"]]},{"id":"de6c0a1.abc44f8","type":"ui_text","z":"2fdd8124.05e35e","group":"23adf1d9.326cae","order":8,"width":0,"height":0,"name":"Remote Access Feedback","label":"","format":"{{msg.payload}}","layout":"col-center","x":690,"y":1180,"wires":[]},{"id":"fa4267ba.859788","type":"switch","z":"2fdd8124.05e35e","name":"","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"ERR_NGROK_108","vt":"str"},{"t":"cont","v":"ERR_NGROK_313","vt":"str"},{"t":"cont","v":"ERR_NGROK_320","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":1460,"y":1040,"wires":[["71ac1e37.e3b71","41dceeff.d7424"],["97a6afdb.4a884","41dceeff.d7424"],["e9293d09.b25e3","41dceeff.d7424"]]},{"id":"97a6afdb.4a884","type":"change","z":"2fdd8124.05e35e","name":"ERR: Requires paid account","rules":[{"t":"set","p":"payload","pt":"msg","to":"ERROR: Custom subdomains require a paid ngrok account.","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1670,"y":1040,"wires":[["c6f9b571.2537f8"]]},{"id":"e9293d09.b25e3","type":"change","z":"2fdd8124.05e35e","name":"ERR: Subdomain not reserved","rules":[{"t":"set","p":"payload","pt":"msg","to":"ERROR: Custom subdomain not available. Reserve at <a target='blank' href=\"https://dashboard.ngrok.com/reserved\">dashboard.ngrok.com/reserved</a>","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1680,"y":1080,"wires":[["c6f9b571.2537f8"]]},{"id":"c6f9b571.2537f8","type":"mqtt out","z":"2fdd8124.05e35e","name":"","topic":"CP/MESSAGE/REMOTEACCESS","qos":"","retain":"","broker":"c1170463.5c7f8","x":1990,"y":1040,"wires":[]},{"id":"71ac1e37.e3b71","type":"change","z":"2fdd8124.05e35e","name":"ERR: Authtoken in use","rules":[{"t":"set","p":"payload","pt":"msg","to":"ERROR: A tunnel is already in use with this Authtoken.","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1650,"y":1000,"wires":[["c6f9b571.2537f8"]]},{"id":"5014d075.e57f3","type":"link in","z":"2fdd8124.05e35e","name":"Load settings2 from sqlite","links":["794a5640.1d6578"],"x":535,"y":160,"wires":[["59ca8f91.7aff9"]]},{"id":"794a5640.1d6578","type":"link out","z":"2fdd8124.05e35e","name":"Remote access settings applied","links":["5014d075.e57f3"],"x":1585,"y":1120,"wires":[]},{"id":"6d1d1ade.5487f4","type":"delay","z":"2fdd8124.05e35e","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1470,"y":1120,"wires":[["794a5640.1d6578"]]},{"id":"41dceeff.d7424","type":"change","z":"2fdd8124.05e35e","name":"Disable RA","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"remote_access","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1620,"y":940,"wires":[["3a3cc1a1.4ee1ee"]]},{"id":"9e8ccc55.4f957","type":"ui_switch","z":"f6c367c2.63b9b8","d":true,"name":"Interior Shades","label":"Move Window Shades to \"Interior\" Page","tooltip":"","group":"f4d0f875.b5dda8","order":11,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"shades_interior","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":780,"y":1360,"wires":[["4f256116.a0922"]]},{"id":"4eb415af.b6f65c","type":"change","z":"f6c367c2.63b9b8","name":"Set Saved Interior Shades","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.shades_interior = 'true'","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":1360,"wires":[["9e8ccc55.4f957"]]},{"id":"b54d8c76.440fd","type":"file in","z":"f6c367c2.63b9b8","name":"features.json","filename":"/coachproxy/configurator/features.json","format":"utf8","chunk":false,"sendError":false,"x":430,"y":200,"wires":[["697d0cce.bc0fa4"]]},{"id":"697d0cce.bc0fa4","type":"json","z":"f6c367c2.63b9b8","name":"","property":"payload","action":"","pretty":false,"x":590,"y":200,"wires":[["4c3c9b2.e18a464"]]},{"id":"4c3c9b2.e18a464","type":"change","z":"f6c367c2.63b9b8","name":"","rules":[{"t":"set","p":"features","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":770,"y":200,"wires":[["bfb2c3a4.58ad4"]]},{"id":"bfb2c3a4.58ad4","type":"function","z":"f6c367c2.63b9b8","name":"Year Option List","func":"// Populate the \"Year\" menu with appropriate options based\n// on the features.json file.\n\nlet years = global.get('features');\nyears = Object.keys(years).filter(year => year[0] == 2).reverse();\n\nconst yearmsg = { options: years, payload: null, topic: null };\nconst blankmsg = { options: [], payload: null, topic: null }\n\nreturn [yearmsg, blankmsg];","outputs":2,"noerr":0,"x":980,"y":200,"wires":[["6303f680.65dfe8"],["25d3ff72.475b8","21735e3b.c9fa92"]]},{"id":"42d5d825.d7a988","type":"ui_ui_control","z":"f6c367c2.63b9b8","name":"Update when tab is displayed","x":1150,"y":1460,"wires":[["b9c3efcf.5b28"]]},{"id":"e166715c.d96cc","type":"function","z":"f6c367c2.63b9b8","name":"Model Option List","func":"// Populate the \"Floor Plan\" menu with appropriate options based\n// on the user's choice of year and model.\n\nconst years = global.get('features');\n\n// User's choice of year\nconst year = flow.get('year');\n\nif (year && years[year]) {\n  const models = Object.keys(years[year]).filter(model => model != '_comment');\n\n  const modelmsg = { options: models, payload: null, topic: null };\n  const blankmsg = { options: [], payload: null, topic: null }\n\n  return [modelmsg, blankmsg];\n}\n","outputs":2,"noerr":0,"x":1210,"y":360,"wires":[["25d3ff72.475b8"],["21735e3b.c9fa92"]]},{"id":"4c222ef8.3b6f2","type":"function","z":"f6c367c2.63b9b8","name":"Floor Plan Option List","func":"// Populate the \"Floor Plan\" menu with appropriate options based\n// on the user's choice of year and model.\n\nconst years = global.get('features');\n\n// User's choice of year and model\nconst year = flow.get('year');\nconst model = flow.get('model');\n\nif (year && model && years[year][model]) {\n  const floors = Object.keys(years[year][model]).filter(floor => floor != 'Default');\n\n  const floormsg = { options: floors, payload: null, topic: null };\n\n  return [floormsg];\n}\n","outputs":1,"noerr":0,"x":1220,"y":420,"wires":[["21735e3b.c9fa92"]]},{"id":"f900b347.058da","type":"delay","z":"f6c367c2.63b9b8","name":"","pauseType":"delay","timeout":"250","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":290,"y":360,"wires":[["8466b73c.6d83f8"]]},{"id":"b363f64.81e8f08","type":"rbe","z":"5a05b8f3.894b88","d":true,"name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":590,"y":3580,"wires":[["637f5dcf.b94644"]]},{"id":"861fe173.d8f1d","type":"rbe","z":"2fdd8124.05e35e","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1140,"y":860,"wires":[["bb6ebc9f.d7c91"]]},{"id":"998a248b.358218","type":"throttle","z":"2fdd8124.05e35e","name":"","throttleType":"time","timeLimit":"1","timeLimitType":"seconds","countLimit":0,"blockSize":0,"locked":false,"x":680,"y":420,"wires":[["19cb1b48.a85c05"]]},{"id":"cf4a966e.f868f8","type":"ui_dropdown","z":"2fdd8124.05e35e","name":"Item Type","label":"","place":"Select item","group":"7f355d52.ee5a24","order":2,"width":"3","height":"1","passthru":true,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"notif_type","x":2800,"y":800,"wires":[["f660ee71.1ff5","aa67186c.ca8078"]]},{"id":"5c6e93d8.c5933c","type":"ui_dropdown","z":"2fdd8124.05e35e","name":"Test Type","label":"","place":"Select option","group":"7f355d52.ee5a24","order":3,"width":"3","height":"1","passthru":true,"options":[{"label":"","value":"is above","type":"str"},{"label":"","value":"is below","type":"str"}],"payload":"","topic":"notif_test","x":2800,"y":920,"wires":[["f660ee71.1ff5"]]},{"id":"5e908b9c.0afec4","type":"ui_text_input","z":"2fdd8124.05e35e","name":"Value","label":"Value","group":"7f355d52.ee5a24","order":4,"width":"2","height":"1","passthru":true,"mode":"text","delay":300,"topic":"notif_value","x":2790,"y":840,"wires":[["f660ee71.1ff5"]]},{"id":"f2cf45e0.6fea48","type":"ui_button","z":"2fdd8124.05e35e","name":"Add","group":"7f355d52.ee5a24","order":6,"width":"2","height":"1","passthru":false,"label":"Add","color":"","bgcolor":"","icon":"fa-plus","payload":"","payloadType":"str","topic":"","x":2790,"y":960,"wires":[["9e269e56.8db"]]},{"id":"7961b1ab.02f1d","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":5,"width":"2","height":"1","name":"Unit","label":"","format":"{{msg.payload}}","layout":"row-left","x":2790,"y":880,"wires":[]},{"id":"f660ee71.1ff5","type":"file function","z":"2fdd8124.05e35e","name":"form_field_save.js","filename":".node-red/js/form_field_save.js","reloadfile":false,"outputs":1,"x":3010,"y":840,"wires":[[]]},{"id":"bc50fc72.5c00a","type":"link out","z":"2fdd8124.05e35e","name":"Notification list changed","links":["e357c5ad.eaba18"],"x":3435,"y":960,"wires":[]},{"id":"2d3813c5.7ca87c","type":"ui_ui_control","z":"2fdd8124.05e35e","name":"Tab Selected","x":2270,"y":820,"wires":[["534dbf84.f6e35","cb62cfa5.8c3ef","1f5437da.a92028"]]},{"id":"534dbf84.f6e35","type":"change","z":"2fdd8124.05e35e","name":"Blank","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2590,"y":820,"wires":[["cf4a966e.f868f8","5c6e93d8.c5933c","5e908b9c.0afec4"]]},{"id":"cb62cfa5.8c3ef","type":"function","z":"2fdd8124.05e35e","name":"Notification List","func":"const max_rules = 12;\n\nconst tests = { 'is below': '<', 'is above': '>', 'changes': 'changes' };\nlet notifs = global.get('settings2')['notify_rules'] || [];\n\nnotifs.sort((a,b) => a.notif_type.localeCompare(b.notif_type));\n\nfor (let notif in notifs) {\n    let n = notifs[notif];\n    n.notif_testval = tests[n.notif_test] + ' ' + n.notif_value + n.notif_unit;\n}\n\nreturn [{ payload: notifs }, { enabled: notifs.length < max_rules } ];\n","outputs":2,"noerr":0,"x":2580,"y":1240,"wires":[["2dab49fe.24e916","7bdc4b3a.af9fc4","73e7dc86.68de44","a6c3ff40.3ce2","8de79367.4f83b","80e3152b.1bb128","947e5874.8df9e8","2bc76923.3ecd26","1c1264e0.d3313b","341146e1.0f1a8a","56d0a29.9dd775c","c634ebcd.21fac8","c9ed7542.c74ad8","d6837164.277f7","5d1e530f.7e208c","c17cd721.637cf8","f576e5b3.65c158","10dde211.08883e","4557abd2.2ef3a4","8d2762ea.f3f7f","c99a187.ebca2e8","841132c6.23c0a","b96d0dac.2894f","41ee666a.983e78"],["f2cf45e0.6fea48"]]},{"id":"2dab49fe.24e916","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":11,"width":"3","height":"1","name":"Type1","label":"{{msg.payload[1].notif_type}}","format":"","layout":"row-left","x":2790,"y":1120,"wires":[]},{"id":"7bdc4b3a.af9fc4","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":12,"width":"2","height":"1","name":"Test1","label":"{{msg.payload[1].notif_testval}}","format":"","layout":"row-left","x":2910,"y":1120,"wires":[]},{"id":"4ad5ec39.fab5c4","type":"ui_button","z":"2fdd8124.05e35e","name":"Delete1","group":"7f355d52.ee5a24","order":13,"width":"1","height":"1","passthru":false,"label":"","color":"#8D0000","bgcolor":"#ffffff","icon":"fa-trash fa-lg","payload":"delete","payloadType":"str","topic":"1","x":3040,"y":1120,"wires":[["a14cd88f.1a8788"]]},{"id":"73e7dc86.68de44","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":14,"width":"3","height":"1","name":"Type2","label":"{{msg.payload[2].notif_type}}","format":"","layout":"row-left","x":2790,"y":1160,"wires":[]},{"id":"a6c3ff40.3ce2","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":15,"width":"2","height":"1","name":"Test2","label":"{{msg.payload[2].notif_testval}}","format":"","layout":"row-left","x":2910,"y":1160,"wires":[]},{"id":"984ac69b.44d468","type":"ui_button","z":"2fdd8124.05e35e","name":"Delete2","group":"7f355d52.ee5a24","order":16,"width":"1","height":"1","passthru":false,"label":"","color":"#8D0000","bgcolor":"#ffffff","icon":"fa-trash fa-lg","payload":"delete","payloadType":"str","topic":"2","x":3040,"y":1160,"wires":[["a14cd88f.1a8788"]]},{"id":"8de79367.4f83b","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":17,"width":"3","height":"1","name":"Type3","label":"{{msg.payload[3].notif_type}}","format":"","layout":"row-left","x":2790,"y":1200,"wires":[]},{"id":"80e3152b.1bb128","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":18,"width":"2","height":"1","name":"Test3","label":"{{msg.payload[3].notif_testval}}","format":"","layout":"row-left","x":2910,"y":1200,"wires":[]},{"id":"2e8c2647.e2c12a","type":"ui_button","z":"2fdd8124.05e35e","name":"Delete3","group":"7f355d52.ee5a24","order":19,"width":"1","height":"1","passthru":false,"label":"","color":"#8D0000","bgcolor":"#ffffff","icon":"fa-trash fa-lg","payload":"delete","payloadType":"str","topic":"3","x":3040,"y":1200,"wires":[["a14cd88f.1a8788"]]},{"id":"947e5874.8df9e8","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":20,"width":"3","height":"1","name":"Type4","label":"{{msg.payload[4].notif_type}}","format":"","layout":"row-left","x":2790,"y":1240,"wires":[]},{"id":"2bc76923.3ecd26","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":21,"width":"2","height":"1","name":"Test4","label":"{{msg.payload[4].notif_testval}}","format":"","layout":"row-left","x":2910,"y":1240,"wires":[]},{"id":"582295cf.dfd3fc","type":"ui_button","z":"2fdd8124.05e35e","name":"Delete4","group":"7f355d52.ee5a24","order":22,"width":"1","height":"1","passthru":false,"label":"","color":"#8D0000","bgcolor":"#ffffff","icon":"fa-trash fa-lg","payload":"delete","payloadType":"str","topic":"4","x":3040,"y":1240,"wires":[["a14cd88f.1a8788"]]},{"id":"1c1264e0.d3313b","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":23,"width":"3","height":"1","name":"Type5","label":"{{msg.payload[5].notif_type}}","format":"","layout":"row-left","x":2790,"y":1280,"wires":[]},{"id":"341146e1.0f1a8a","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":24,"width":"2","height":"1","name":"Test5","label":"{{msg.payload[5].notif_testval}}","format":"","layout":"row-left","x":2910,"y":1280,"wires":[]},{"id":"252de61b.38726a","type":"ui_button","z":"2fdd8124.05e35e","name":"Delete5","group":"7f355d52.ee5a24","order":25,"width":"1","height":"1","passthru":false,"label":"","color":"#8D0000","bgcolor":"#ffffff","icon":"fa-trash fa-lg","payload":"delete","payloadType":"str","topic":"5","x":3040,"y":1280,"wires":[["a14cd88f.1a8788"]]},{"id":"56d0a29.9dd775c","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":26,"width":"3","height":"1","name":"Type6","label":"{{msg.payload[6].notif_type}}","format":"","layout":"row-left","x":2790,"y":1320,"wires":[]},{"id":"c634ebcd.21fac8","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":27,"width":"2","height":"1","name":"Test6","label":"{{msg.payload[6].notif_testval}}","format":"","layout":"row-left","x":2910,"y":1320,"wires":[]},{"id":"ae9136db.e2dc08","type":"ui_button","z":"2fdd8124.05e35e","name":"Delete6","group":"7f355d52.ee5a24","order":28,"width":"1","height":"1","passthru":false,"label":"","color":"#8D0000","bgcolor":"#ffffff","icon":"fa-trash fa-lg","payload":"delete","payloadType":"str","topic":"6","x":3040,"y":1320,"wires":[["a14cd88f.1a8788"]]},{"id":"c9ed7542.c74ad8","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":29,"width":"3","height":"1","name":"Type7","label":"{{msg.payload[7].notif_type}}","format":"","layout":"row-left","x":2790,"y":1360,"wires":[]},{"id":"d6837164.277f7","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":30,"width":"2","height":"1","name":"Test7","label":"{{msg.payload[7].notif_testval}}","format":"","layout":"row-left","x":2910,"y":1360,"wires":[]},{"id":"cf0d028.30c63","type":"ui_button","z":"2fdd8124.05e35e","name":"Delete7","group":"7f355d52.ee5a24","order":31,"width":"1","height":"1","passthru":false,"label":"","color":"#8D0000","bgcolor":"#ffffff","icon":"fa-trash fa-lg","payload":"delete","payloadType":"str","topic":"7","x":3040,"y":1360,"wires":[["a14cd88f.1a8788"]]},{"id":"5d1e530f.7e208c","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":32,"width":"3","height":"1","name":"Type8","label":"{{msg.payload[8].notif_type}}","format":"","layout":"row-left","x":2790,"y":1400,"wires":[]},{"id":"c17cd721.637cf8","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":33,"width":"2","height":"1","name":"Test8","label":"{{msg.payload[8].notif_testval}}","format":"","layout":"row-left","x":2910,"y":1400,"wires":[]},{"id":"eda7b8e3.9d3dd8","type":"ui_button","z":"2fdd8124.05e35e","name":"Delete8","group":"7f355d52.ee5a24","order":34,"width":"1","height":"1","passthru":false,"label":"","color":"#8D0000","bgcolor":"#ffffff","icon":"fa-trash fa-lg","payload":"delete","payloadType":"str","topic":"8","x":3040,"y":1400,"wires":[["a14cd88f.1a8788"]]},{"id":"f576e5b3.65c158","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":35,"width":"3","height":"1","name":"Type9","label":"{{msg.payload[9].notif_type}}","format":"","layout":"row-left","x":2790,"y":1440,"wires":[]},{"id":"10dde211.08883e","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":36,"width":"2","height":"1","name":"Test9","label":"{{msg.payload[9].notif_testval}}","format":"","layout":"row-left","x":2910,"y":1440,"wires":[]},{"id":"bd303ab1.796f48","type":"ui_button","z":"2fdd8124.05e35e","name":"Delete9","group":"7f355d52.ee5a24","order":37,"width":"1","height":"1","passthru":false,"label":"","color":"#8D0000","bgcolor":"#ffffff","icon":"fa-trash fa-lg","payload":"delete","payloadType":"str","topic":"9","x":3040,"y":1440,"wires":[["a14cd88f.1a8788"]]},{"id":"4557abd2.2ef3a4","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":8,"width":"3","height":"1","name":"Type0","label":"{{msg.payload[0].notif_type}}","format":"","layout":"row-left","x":2790,"y":1080,"wires":[]},{"id":"8d2762ea.f3f7f","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":9,"width":"2","height":"1","name":"Test0","label":"{{msg.payload[0].notif_testval}}","format":"","layout":"row-left","x":2910,"y":1080,"wires":[]},{"id":"6b362347.21e69c","type":"ui_button","z":"2fdd8124.05e35e","name":"Delete0","group":"7f355d52.ee5a24","order":10,"width":"1","height":"1","passthru":false,"label":"","color":"#8D0000","bgcolor":"#ffffff","icon":"fa-trash fa-lg","payload":"delete","payloadType":"str","topic":"0","x":3040,"y":1080,"wires":[["a14cd88f.1a8788"]]},{"id":"a14cd88f.1a8788","type":"function","z":"2fdd8124.05e35e","name":"Delete Notification","func":"// Remove a notification rule, update the settings on disk,\n// and refresh the list.\n\nlet notifs = global.get('settings2')['notify_rules'] || [];\nnotifs.splice(msg.topic, 1);  // This changes in global context\n\nreturn { topic: 'notify_rules', payload: JSON.stringify(notifs) };","outputs":1,"noerr":0,"x":3270,"y":1160,"wires":[["bc50fc72.5c00a","cb62cfa5.8c3ef"]]},{"id":"a21456d1.3b7bb8","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":7,"width":"0","height":"0","name":"Your notification rules:","label":"","format":"Your notification rules:","layout":"row-center","x":2840,"y":1040,"wires":[]},{"id":"72269b85.831204","type":"link in","z":"2fdd8124.05e35e","name":"Set remote access fields","links":["b8e34e9a.dc367"],"x":2375,"y":180,"wires":[["a41f2c1.cca1ad","9a43afe.4e3335","17af52d.10478ad","b028ecd6.261778","74511b5e.c45cf4","327053dc.38f1ec","6c4a8998.9efa5"]]},{"id":"77c64da5.a00b14","type":"ui_template","z":"2fdd8124.05e35e","group":"d0c7f134.375fd","name":"Notification Intro","order":1,"width":"","height":"","format":"<div layout=\"column\" layout-align=\"space-between\">\n<p><b>Internet Connection Requirement:</b></p>\n<p>Notifications require an active Internet connection. See 'Network Information' in the 'System' tab to check your network status.</p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":2820,"y":100,"wires":[[]]},{"id":"a41f2c1.cca1ad","type":"change","z":"2fdd8124.05e35e","name":"settings2.pushover_key","rules":[{"t":"set","p":"payload","pt":"msg","to":"$globalContext('settings2.pushover_key')","tot":"jsonata"},{"t":"set","p":"form.pushover_key","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2570,"y":180,"wires":[[]]},{"id":"be01f371.8350a","type":"http request","z":"2fdd8124.05e35e","name":"Post to Pushover","method":"POST","ret":"txt","url":"https://api.pushover.net/1/messages.json","x":3330,"y":220,"wires":[[]]},{"id":"e6cb6cf.8a4b99","type":"function","z":"2fdd8124.05e35e","name":"Test Notification Message","func":"let message = \"Hi! This is a test notification from eRVin to Pushover.\\n\\n\";\nmessage = message + \"You can control your notification sounds, quiet hours, and other \";\nmessage = message + \"options in the Pushover app on your phone or tablet.\";\n\nmsg.headers = {\n    \"content-type\": \"application/x-www-form-urlencoded\"\n};\n\nmsg.payload = { \n    user: global.get('settings2')['pushover_key'],\n    token: 'afvtrcguexvtutk7orsc41m1fcw42i',\n    title: 'eRVin Test Notification',\n    message: message,\n};\n\nreturn msg;","outputs":1,"noerr":0,"x":3090,"y":220,"wires":[["be01f371.8350a"]]},{"id":"42a33c7d.d713f4","type":"sqlite","z":"2fdd8124.05e35e","mydb":"b2130e68.3a338","name":"CoachProxy","x":890,"y":120,"wires":[["fdb3c34f.12887"]]},{"id":"6cb7aeff.ab5aa","type":"template","z":"2fdd8124.05e35e","name":"Load configs","field":"topic","fieldType":"msg","format":"handlebars","syntax":"plain","template":"select * from configs;","output":"str","x":690,"y":120,"wires":[["42a33c7d.d713f4"]]},{"id":"fdb3c34f.12887","type":"function","z":"2fdd8124.05e35e","name":"Store configs","func":"for (var i = 0; i < (msg.payload).length; i++) {\n    var key = msg.payload[i].key;\n    var value = msg.payload[i].value;\n    global.set('configs.' + key, value);\n}\n\n// Returning NULL would terminate the flow, but other\n// nodes want to know when settings have been loaded.\nreturn {};","outputs":1,"noerr":0,"x":1070,"y":120,"wires":[[]]},{"id":"87e329fa.cd01d8","type":"ui_template","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","name":"Notification Rule Info","order":1,"width":"","height":"","format":"<div>\n<p>Create customized rules below to be notified when values change:</p>\n<p>&nbsp;</p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":2840,"y":760,"wires":[[]]},{"id":"4d673358.e0d70c","type":"http request","z":"2fdd8124.05e35e","name":"Post to Pushover","method":"POST","ret":"txt","url":"https://api.pushover.net/1/messages.json","tls":"","x":3390,"y":1700,"wires":[[]]},{"id":"93012ad8.0aea38","type":"mqtt out","z":"2fdd8124.05e35e","name":"","topic":"GLOBAL/MESSAGE","qos":"","retain":"","broker":"c1170463.5c7f8","x":3400,"y":1660,"wires":[]},{"id":"4c421b2d.532294","type":"json","z":"477cac19.6a9e64","name":"","property":"payload","action":"","pretty":false,"x":450,"y":460,"wires":[["f3f48ab4.40e4c8"]]},{"id":"c72fb0d.22e175","type":"mqtt in","z":"477cac19.6a9e64","name":"","topic":"RVC/DC_SOURCE_STATUS_SPYDER/#","qos":"2","broker":"c1170463.5c7f8","x":190,"y":480,"wires":[["4c421b2d.532294"]]},{"id":"a59c49cb.b37798","type":"mqtt out","z":"477cac19.6a9e64","name":"CP/BATTERY_VOLTS/BatteryName","topic":"","qos":"","retain":"","broker":"c1170463.5c7f8","x":900,"y":460,"wires":[]},{"id":"f3f48ab4.40e4c8","type":"function","z":"477cac19.6a9e64","name":"decode battery","func":"// Newer coaches send DC_SOURCE_STATUS_SPYDER in addition to the\n// normal DC_SOURCE_STATUS. In these cases, ignore the legacy values.\n\nlet newmsg = {};\n\nconst labels = ['N/A', 'House', 'Chassis', 'House2'];\nnewmsg.topic = 'CP/BATTERY_VOLTS/' + labels[msg.payload.instance];\nnewmsg.payload = msg.payload['dc voltage'];\n\nif ((msg.topic).includes('SPYDER')) {\n    // Remember to only parse _SPYDER messages from now on\n    context.set('use_spyder', true);\n} else {\n    // If _SPYDER messages are used, ignore legacy messages\n    if (context.get('use_spyder')) {\n        newmsg = null;\n    }\n}\n\nmsg.topic = null;  // Overwrite incoming msg topic\nreturn newmsg;\n","outputs":1,"noerr":0,"x":620,"y":460,"wires":[["a59c49cb.b37798"]]},{"id":"94a20186.0131e","type":"mqtt in","z":"477cac19.6a9e64","name":"","topic":"RVC/DC_SOURCE_STATUS/#","qos":"2","broker":"c1170463.5c7f8","x":220,"y":440,"wires":[["4c421b2d.532294"]]},{"id":"75cc5225.c008dc","type":"mqtt in","z":"477cac19.6a9e64","name":"","topic":"RVC/THERMOSTAT_AMBIENT_STATUS/#","qos":"0","broker":"c1170463.5c7f8","x":200,"y":600,"wires":[["aa466896.a650c8"]]},{"id":"aa466896.a650c8","type":"json","z":"477cac19.6a9e64","name":"","x":450,"y":600,"wires":[["e077ae80.1b7e9"]]},{"id":"e077ae80.1b7e9","type":"function","z":"477cac19.6a9e64","name":"decode ambient temp","func":"const first_zone = global.get('settings2').tstat_first_zone || 0;\nconst zone_names = {\n  0: 'Front',\n  1: 'Mid',\n  2: 'Rear',\n  4: 'Wet Bay',\n  5: 'Generator Bay'\n};\n\nconst zone = parseInt(msg.payload.instance) - first_zone;\n\nlet newmsg = {};\nif (zone in zone_names) {\n  newmsg.topic = 'CP/THERMISTOR_TEMP/' + zone_names[zone];\n  newmsg.payload = msg.payload['ambient temp F'];\n\n  return newmsg;\n}\n","outputs":1,"noerr":0,"x":640,"y":600,"wires":[["3e5bd4e9.96126c"]]},{"id":"3e5bd4e9.96126c","type":"mqtt out","z":"477cac19.6a9e64","name":"CP/THERMISTOR_TEMP/ZoneName","topic":"","qos":"","retain":"","broker":"c1170463.5c7f8","x":930,"y":600,"wires":[]},{"id":"80d680be.7453e","type":"comment","z":"477cac19.6a9e64","name":"Republish battery status in simple form","info":"","x":190,"y":400,"wires":[]},{"id":"1f5437da.a92028","type":"file function","z":"2fdd8124.05e35e","name":"notification_menu_options.js","filename":".node-red/js/notification_menu_options.js","reloadfile":false,"outputs":1,"x":2540,"y":780,"wires":[["cf4a966e.f868f8"]]},{"id":"aa67186c.ca8078","type":"file function","z":"2fdd8124.05e35e","name":"notification_submenu_options.js","filename":".node-red/js/notification_submenu_options.js","reloadfile":false,"outputs":3,"x":2530,"y":880,"wires":[["5e908b9c.0afec4"],["7961b1ab.02f1d","f660ee71.1ff5"],["5c6e93d8.c5933c"]]},{"id":"9e269e56.8db","type":"file function","z":"2fdd8124.05e35e","name":"notification_save.js","filename":".node-red/js/notification_save.js","reloadfile":false,"outputs":1,"x":3010,"y":960,"wires":[["bc50fc72.5c00a","cb62cfa5.8c3ef"]]},{"id":"2ad4a4a5.c0435c","type":"link out","z":"2fdd8124.05e35e","name":"Notification list changed","links":["e357c5ad.eaba18"],"x":3255,"y":520,"wires":[]},{"id":"841132c6.23c0a","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":38,"width":"3","height":"1","name":"Type10","label":"{{msg.payload[10].notif_type}}","format":"","layout":"row-left","x":2800,"y":1480,"wires":[]},{"id":"c99a187.ebca2e8","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":39,"width":"2","height":"1","name":"Test10","label":"{{msg.payload[10].notif_testval}}","format":"","layout":"row-left","x":2930,"y":1480,"wires":[]},{"id":"12e77b35.cc70e5","type":"ui_button","z":"2fdd8124.05e35e","name":"Delete10","group":"7f355d52.ee5a24","order":40,"width":"1","height":"1","passthru":false,"label":"","color":"#8D0000","bgcolor":"#ffffff","icon":"fa-trash fa-lg","payload":"delete","payloadType":"str","topic":"10","x":3060,"y":1480,"wires":[["a14cd88f.1a8788"]]},{"id":"b96d0dac.2894f","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":41,"width":"3","height":"1","name":"Type11","label":"{{msg.payload[11].notif_type}}","format":"","layout":"row-left","x":2800,"y":1520,"wires":[]},{"id":"41ee666a.983e78","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":42,"width":"2","height":"1","name":"Test11","label":"{{msg.payload[11].notif_testval}}","format":"","layout":"row-left","x":2930,"y":1520,"wires":[]},{"id":"961b28dd.9a6368","type":"ui_button","z":"2fdd8124.05e35e","name":"Delete11","group":"7f355d52.ee5a24","order":43,"width":"1","height":"1","passthru":false,"label":"","color":"#8D0000","bgcolor":"#ffffff","icon":"fa-trash fa-lg","payload":"delete","payloadType":"str","topic":"11","x":3060,"y":1520,"wires":[["a14cd88f.1a8788"]]},{"id":"4c155211.73165c","type":"change","z":"477cac19.6a9e64","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload['status definition']","tot":"msg"},{"t":"set","p":"status.power.generator_state","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":320,"wires":[["f0779982.feef28","f36c20e2.5fa84"]]},{"id":"9ed0f068.bea57","type":"mqtt in","z":"2fdd8124.05e35e","name":"","topic":"CP/TANK_STATUS/#","qos":"2","broker":"c1170463.5c7f8","x":2610,"y":1600,"wires":[["a588a38c.08e74"]]},{"id":"bb30fcde.3966a","type":"mqtt in","z":"2fdd8124.05e35e","name":"","topic":"CP/IGNITION","qos":"2","broker":"c1170463.5c7f8","x":2630,"y":1740,"wires":[["aa0e517d.843a4"]]},{"id":"c1cc6bc8.971ed8","type":"mqtt in","z":"2fdd8124.05e35e","name":"","topic":"CP/PARKBRAKE","qos":"2","broker":"c1170463.5c7f8","x":2620,"y":1780,"wires":[["aa0e517d.843a4"]]},{"id":"a193cfb7.3d38","type":"mqtt in","z":"2fdd8124.05e35e","name":"","topic":"CP/GENERATOR","qos":"2","broker":"c1170463.5c7f8","x":2620,"y":1820,"wires":[["aa0e517d.843a4"]]},{"id":"a588a38c.08e74","type":"file function","z":"2fdd8124.05e35e","name":"notification_value_monitor.js","filename":".node-red/js/notification_value_monitor.js","reloadfile":false,"outputs":1,"x":2880,"y":1640,"wires":[["b2a6e1f.56d592"]]},{"id":"b2a6e1f.56d592","type":"file function","z":"2fdd8124.05e35e","name":"notification_deliver.js","filename":".node-red/js/notification_deliver.js","reloadfile":false,"outputs":3,"x":3160,"y":1700,"wires":[["93012ad8.0aea38"],[],["b1b6ffec.c0e758"]]},{"id":"1fb31163.03642f","type":"mqtt in","z":"2fdd8124.05e35e","name":"","topic":"CP/THERMISTOR_TEMP/#","qos":"2","broker":"c1170463.5c7f8","x":2590,"y":1640,"wires":[["a588a38c.08e74"]]},{"id":"aa0e517d.843a4","type":"file function","z":"2fdd8124.05e35e","name":"notification_state_monitor.js","filename":".node-red/js/notification_state_monitor.js","reloadfile":false,"outputs":1,"x":2880,"y":1780,"wires":[["b2a6e1f.56d592"]]},{"id":"40b105ea.d78cfc","type":"mqtt in","z":"2fdd8124.05e35e","name":"","topic":"CP/BATTERY_VOLTS/#","qos":"2","broker":"c1170463.5c7f8","x":2600,"y":1680,"wires":[["a588a38c.08e74"]]},{"id":"447f35ec.e5ed8c","type":"comment","z":"477cac19.6a9e64","name":"Republish thermister status in simple form","info":"","x":200,"y":560,"wires":[]},{"id":"1839ea35.17c7f6","type":"mqtt in","z":"2fdd8124.05e35e","name":"","topic":"CP/AC_SOURCE","qos":"2","broker":"c1170463.5c7f8","x":2620,"y":1860,"wires":[["aa0e517d.843a4"]]},{"id":"6b55576d.e2cef8","type":"mqtt in","z":"477cac19.6a9e64","name":"","topic":"RVC/ATS_AC_STATUS_1/#","qos":"2","broker":"c1170463.5c7f8","x":150,"y":720,"wires":[["d65bb72.5733f48"]]},{"id":"d65bb72.5733f48","type":"json","z":"477cac19.6a9e64","name":"","x":450,"y":720,"wires":[["caa1f759.57aeb8"]]},{"id":"caa1f759.57aeb8","type":"function","z":"477cac19.6a9e64","name":"decode power status","func":"// Output 1: name of current ATS power source\n\nconst genset_status = global.get('status').power.generator_state || 'stopped';\n\n// If the rmsc value is not numeric (e.g. 'n/a'), then\n// the ATS is not receiving any external power.\nif (isNaN(parseFloat(msg.payload['rms current']))) {\n    msg.payload = 'None';\n} else if (genset_status == 'running') {\n    msg.payload = 'Generator';\n} else {\n    msg.payload = 'Shore';\n}\n\nglobal.set('status.power.ac_source', msg.payload);\n\nmsg.type = 'acsource';\nreturn msg;\n","outputs":1,"noerr":0,"x":640,"y":720,"wires":[["12c2cbaa.fb05d4"]]},{"id":"12c2cbaa.fb05d4","type":"mqtt out","z":"477cac19.6a9e64","name":"","topic":"CP/AC_SOURCE","qos":"","retain":"","broker":"c1170463.5c7f8","x":870,"y":720,"wires":[]},{"id":"c1547432.acf568","type":"comment","z":"477cac19.6a9e64","name":"Republish shore power status in simple form","info":"","x":210,"y":680,"wires":[]},{"id":"9a43afe.4e3335","type":"change","z":"2fdd8124.05e35e","name":"settings2.notify_email1","rules":[{"t":"set","p":"payload","pt":"msg","to":"$globalContext('settings2.notify_email1')","tot":"jsonata"},{"t":"set","p":"form.notify_email1","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2560,"y":320,"wires":[["373fb080.8bb7d"]]},{"id":"17af52d.10478ad","type":"change","z":"2fdd8124.05e35e","name":"settings2.notify_email2","rules":[{"t":"set","p":"payload","pt":"msg","to":"$globalContext('settings2.notify_email2')","tot":"jsonata"},{"t":"set","p":"form.notify_email2","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2560,"y":360,"wires":[["d8776ddc.8befd"]]},{"id":"373fb080.8bb7d","type":"ui_text_input","z":"2fdd8124.05e35e","name":"Email Address 1","label":"Email Address 1","group":"9ed66528.add608","order":2,"width":"","height":"","passthru":true,"mode":"email","delay":"300","topic":"notify_email1","x":2820,"y":320,"wires":[["1da8be4f.944f22"]]},{"id":"d8776ddc.8befd","type":"ui_text_input","z":"2fdd8124.05e35e","name":"Email Address 2","label":"Email Address 2","group":"9ed66528.add608","order":3,"width":"","height":"","passthru":true,"mode":"email","delay":"300","topic":"notify_email2","x":2820,"y":360,"wires":[["1da8be4f.944f22"]]},{"id":"27078391.774bbc","type":"ui_button","z":"2fdd8124.05e35e","name":"","group":"9ed66528.add608","order":4,"width":"3","height":"1","label":"Save","color":"","icon":"fa-check","payload":"save","payloadType":"str","topic":"commit","x":2790,"y":400,"wires":[["cfc33f37.56acf"]]},{"id":"967644d2.773408","type":"ui_button","z":"2fdd8124.05e35e","name":"","group":"9ed66528.add608","order":5,"width":"3","height":"1","label":"Undo","color":"","icon":"fa-times","payload":"undo","payloadType":"str","topic":"commit","x":2330,"y":340,"wires":[["9a43afe.4e3335","17af52d.10478ad"]]},{"id":"ac861c3c.4281a","type":"ui_template","z":"2fdd8124.05e35e","group":"9ed66528.add608","name":"Email Info","order":1,"width":"0","height":"0","format":"<div layout=\"column\" layout-align=\"space-between\">\n<p><b>E-mail Notification Setup:</b></p>\n<p>Enter up to two addresses to deliver notifications to:</p>\n<br>\n<p><b>To Receive Notifications via Text:</b></p>\n<p style=\"font-size:80%;\"><b>Verizon:</b> phone#@vtext.com<br>\n<b>AT&T:</b> phone#@txt.att<br>\n<b>TMobile:</b> phone#@tmomail.net<br>\n<b>Sprint:</b> phone#@messaging.sprintpcs.com\n</p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":2800,"y":280,"wires":[[]]},{"id":"1da8be4f.944f22","type":"file function","z":"2fdd8124.05e35e","name":"form_field_save.js","filename":".node-red/js/form_field_save.js","reloadfile":false,"outputs":1,"x":3070,"y":340,"wires":[[]]},{"id":"cfc33f37.56acf","type":"function","z":"2fdd8124.05e35e","name":"Save Email Settings","func":"const topics = ['notify_email1', 'notify_email2'];\nvar msgs = [];\n\ntopics.forEach(function(topic) {\n  const value = global.get('form')[topic] || '';\n  const newmsg = { topic: topic, payload: value };\n  msgs.push(newmsg);\n});\n\nreturn [ msgs ];\n","outputs":1,"noerr":0,"x":3080,"y":400,"wires":[["2ad4a4a5.c0435c"]]},{"id":"73d80bb.31573f4","type":"comment","z":"2fdd8124.05e35e","name":"INSERT PUSHOVER NODES HERE","info":"","x":2860,"y":180,"wires":[]},{"id":"eacf2d96.2dff4","type":"mqtt out","z":"477cac19.6a9e64","name":"","topic":"CP/GENERATOR_STATUS","qos":"","retain":"","broker":"c1170463.5c7f8","x":940,"y":360,"wires":[]},{"id":"f36c20e2.5fa84","type":"change","z":"477cac19.6a9e64","name":"Generator Status with Timestamp","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload & \",\" & ($floor($millis() / 1000))","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":360,"wires":[["eacf2d96.2dff4"]]},{"id":"bb67848e.4759b8","type":"ui_template","z":"f6c367c2.63b9b8","group":"e4fd4ed4.a377f","name":"Copyright","order":3,"width":"0","height":"0","format":"<div layout='column' layout-align='space-between'>\n  <p>eRVin  2020</p>\n  <p>CoachProxyOS  2019</p>\n  <p>CoachProxyOS/eRVin comes with ABSOLUTELY NO WARRANTY.\n  This is free software, and you are welcome to redistribute it\n  under certain conditions.</p>\n  <p>See <a href=\"https://www.gnu.org/licenses/gpl-3.0.html\">https://www.gnu.org/licenses/gpl-3.0.html</a>\n  for complete details.</p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":700,"y":80,"wires":[[]]},{"id":"b028ecd6.261778","type":"change","z":"2fdd8124.05e35e","name":"settings2.smtp_host","rules":[{"t":"set","p":"payload","pt":"msg","to":"$globalContext('settings2.smtp_host')","tot":"jsonata"},{"t":"set","p":"form.smtp_host","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2560,"y":500,"wires":[["2beb48cd.bc9f1"]]},{"id":"74511b5e.c45cf4","type":"change","z":"2fdd8124.05e35e","name":"settings2.smtp_port","rules":[{"t":"set","p":"payload","pt":"msg","to":"$globalContext('settings2.smtp_port')","tot":"jsonata"},{"t":"set","p":"form.smtp_port","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2560,"y":540,"wires":[["4e1f595b.06eef"]]},{"id":"327053dc.38f1ec","type":"change","z":"2fdd8124.05e35e","name":"settings2.smtp_user","rules":[{"t":"set","p":"payload","pt":"msg","to":"$globalContext('settings2.smtp_user')","tot":"jsonata"},{"t":"set","p":"form.smtp_user","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2560,"y":580,"wires":[["3a108da8.621912"]]},{"id":"6c4a8998.9efa5","type":"change","z":"2fdd8124.05e35e","name":"settings2.smtp_password","rules":[{"t":"set","p":"payload","pt":"msg","to":"$globalContext('settings2.smtp_password')","tot":"jsonata"},{"t":"set","p":"form.smtp_password","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2570,"y":620,"wires":[["a98ddc00.839c1"]]},{"id":"2beb48cd.bc9f1","type":"ui_text_input","z":"2fdd8124.05e35e","name":"SMTP Server","label":"SMTP Server Name","tooltip":"e.g. smtp.gmail.com","group":"b043acd4.87089","order":2,"width":"","height":"","passthru":true,"mode":"text","delay":"300","topic":"smtp_host","x":2810,"y":500,"wires":[["4275c6af.b94258"]]},{"id":"4e1f595b.06eef","type":"ui_text_input","z":"2fdd8124.05e35e","name":"SMTP Port","label":"SMTP Server Port","tooltip":"e.g. 587","group":"b043acd4.87089","order":3,"width":"","height":"","passthru":true,"mode":"text","delay":"300","topic":"smtp_port","x":2810,"y":540,"wires":[["4275c6af.b94258"]]},{"id":"657e579.184f228","type":"ui_button","z":"2fdd8124.05e35e","name":"","group":"b043acd4.87089","order":6,"width":"3","height":"1","label":"Save","color":"","icon":"fa-check","payload":"save","payloadType":"str","topic":"commit","x":2790,"y":660,"wires":[["9767a76d.1419a"]]},{"id":"13ab390c.eaec7f","type":"ui_template","z":"2fdd8124.05e35e","group":"b043acd4.87089","name":"SMTP Info","order":1,"width":"6","height":"2","format":"<div layout=\"column\" layout-align=\"space-between\">\n<p><b>E-mail Server Setup:</b></p>\n<p>Enter your E-mail SMTP Server information:</p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":2810,"y":460,"wires":[[]]},{"id":"3a108da8.621912","type":"ui_text_input","z":"2fdd8124.05e35e","name":"SMTP Username","label":"SMTP Username","tooltip":"","group":"b043acd4.87089","order":4,"width":"","height":"","passthru":true,"mode":"text","delay":"300","topic":"smtp_user","x":2830,"y":580,"wires":[["4275c6af.b94258"]]},{"id":"a98ddc00.839c1","type":"ui_text_input","z":"2fdd8124.05e35e","name":"SMTP Password","label":"SMTP Password","tooltip":"","group":"b043acd4.87089","order":5,"width":"","height":"","passthru":true,"mode":"text","delay":"300","topic":"smtp_password","x":2830,"y":620,"wires":[["4275c6af.b94258"]]},{"id":"4275c6af.b94258","type":"file function","z":"2fdd8124.05e35e","name":"form_field_save.js","filename":".node-red/js/form_field_save.js","reloadfile":false,"outputs":1,"x":3070,"y":560,"wires":[[]]},{"id":"9767a76d.1419a","type":"function","z":"2fdd8124.05e35e","name":"Save SMTP Settings","func":"const topics = ['smtp_host', 'smtp_port', 'smtp_user', 'smtp_password'];\nvar msgs = [];\n\ntopics.forEach(function(topic) {\n  const value = global.get('form')[topic] || '';\n  const newmsg = { topic: topic, payload: value };\n  msgs.push(newmsg);\n});\n\nreturn [ msgs ];\n","outputs":1,"noerr":0,"x":3080,"y":660,"wires":[["2ad4a4a5.c0435c"]]},{"id":"effffbd9.b9af7","type":"ui_button","z":"2fdd8124.05e35e","name":"","group":"b043acd4.87089","order":7,"width":"3","height":"1","label":"Undo","color":"","icon":"fa-times","payload":"undo","payloadType":"str","topic":"commit","x":2290,"y":560,"wires":[["b028ecd6.261778","74511b5e.c45cf4","327053dc.38f1ec","6c4a8998.9efa5"]]},{"id":"b1b6ffec.c0e758","type":"simple-sendmail","z":"2fdd8124.05e35e","name":"simple sendmail","x":3380,"y":1740,"wires":[["188160bb.3534f7"]]},{"id":"188160bb.3534f7","type":"ui_text","z":"2fdd8124.05e35e","group":"d0c7f134.375fd","order":0,"width":"6","height":"1","name":"Mail Notification Status","label":"Succeeded: {{msg.payload.accepted.length}}","format":"","layout":"col-center","x":3630,"y":1740,"wires":[]},{"id":"9ab94ac.b9e2b38","type":"ui_button","z":"2fdd8124.05e35e","name":"","group":"d0c7f134.375fd","order":2,"width":"6","height":"1","passthru":false,"label":"Send Test Message","tooltip":"","color":"","bgcolor":"green","icon":"fa-envelope-o","payload":"test","payloadType":"str","topic":"commit","x":2610,"y":1920,"wires":[["b4cc8482.ebf358"]]},{"id":"b4cc8482.ebf358","type":"change","z":"2fdd8124.05e35e","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"This is a test notification from eRVin","tot":"str"},{"t":"set","p":"subject","pt":"msg","to":"eRVin Alert!","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2920,"y":1920,"wires":[["bceb7ebc.6c1f9","b2a6e1f.56d592"]]},{"id":"bceb7ebc.6c1f9","type":"change","z":"2fdd8124.05e35e","name":"Clear output","rules":[{"t":"set","p":"payload","pt":"msg","to":"{'accepted': []}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":3130,"y":1920,"wires":[["188160bb.3534f7"]]},{"id":"5901ce60.cee528","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/33","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":2560,"wires":[["4e1c26c3.d0f148"]]},{"id":"c6a6dd7b.9bb1e","type":"ui_text","z":"5a05b8f3.894b88","group":"fb4c3e00.5737a","order":3,"width":"3","height":"1","name":"House Battery /battery-house/battery-basic/+pred/","label":"House Battery","format":"{{msg.payload}} Volts","layout":"col-center","x":1130,"y":3780,"wires":[]},{"id":"1612089d.392067","type":"ui_text","z":"5a05b8f3.894b88","group":"fb4c3e00.5737a","order":4,"width":"3","height":"1","name":"Chassis Battery  /battery-chassis/battery-basic/+pred/","label":"Chassis Battery","format":"{{msg.payload}} Volts","layout":"col-center","x":1140,"y":3820,"wires":[]},{"id":"c0c7b1bf.52b3b","type":"rbe","z":"5a05b8f3.894b88","name":"","func":"rbe","gap":"","start":"","inout":"out","x":830,"y":3780,"wires":[["c6a6dd7b.9bb1e"]]},{"id":"27651f43.050f8","type":"change","z":"5a05b8f3.894b88","name":"","rules":[{"t":"set","p":"status.power.house_battery_volts","pt":"global","to":"payload['dc voltage']","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"payload['dc voltage']","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":3780,"wires":[["c0c7b1bf.52b3b"]]},{"id":"94cff01e.0194d","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_SOURCE_STATUS_1/1","qos":"2","broker":"c1170463.5c7f8","x":210,"y":3780,"wires":[["1315d6c3.68c019"]]},{"id":"1315d6c3.68c019","type":"json","z":"5a05b8f3.894b88","name":"","property":"payload","action":"","pretty":false,"x":450,"y":3780,"wires":[["27651f43.050f8"]]},{"id":"52e8712f.1941","type":"rbe","z":"5a05b8f3.894b88","name":"","func":"rbe","gap":"","start":"","inout":"out","x":830,"y":3820,"wires":[["1612089d.392067"]]},{"id":"41e1419b.d342b","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_SOURCE_STATUS_1/2","qos":"2","broker":"c1170463.5c7f8","x":210,"y":3820,"wires":[["a1cd97fb.4726f8"]]},{"id":"a1cd97fb.4726f8","type":"json","z":"5a05b8f3.894b88","name":"","property":"payload","action":"","pretty":false,"x":450,"y":3820,"wires":[["b36d7f2e.00774"]]},{"id":"b36d7f2e.00774","type":"change","z":"5a05b8f3.894b88","name":"","rules":[{"t":"set","p":"status.power.chassis_battery_volts","pt":"global","to":"payload['dc voltage']","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"payload['dc voltage']","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":3820,"wires":[["52e8712f.1941"]]},{"id":"808ffb36.d1e2a8","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/40","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":3060,"wires":[["1bfae7f5.b28668"]]},{"id":"43df7d4d.dddce4","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":960,"wires":[["8918319e.52f4"],["e3a07cfd.ff85a"]],"outputLabels":["on/off value","brightness value"]},{"id":"ba8aebb.ea06618","type":"file function","z":"5a05b8f3.894b88","name":"command_dc_dimmer_ervin.js","filename":".node-red/js/command_dc_dimmer_ervin.js","reloadfile":false,"outputs":1,"x":1350,"y":1360,"wires":[["4f494263.b11554"]]},{"id":"ebc324f0.c073f8","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/15","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":1120,"wires":[[]]},{"id":"256ec7cf.fab038","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/34","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":2640,"wires":[["2aa05fba.2bbcd"]]},{"id":"7f15e03d.6be2","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/35","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":2720,"wires":[["e71ec827.ff7198"]]},{"id":"383d36c5.543aea","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/36","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":2800,"wires":[["de8dcc10.e3813"]]},{"id":"29290cdc.daca64","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/37","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":2880,"wires":[["a677f07b.1b2a2"]]},{"id":"7e842612.9b3ed8","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/38","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":2940,"wires":[["340c59d6.8c75c6"]]},{"id":"c59b01cb.b7f39","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/39","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":3000,"wires":[["14b7f090.bf64ff"]]},{"id":"dc875c1c.d2f56","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/114","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":3240,"wires":[["b2dc26bb.36db38"]]},{"id":"f48e3a33.d50438","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/111","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":3120,"wires":[["60232257.2aa5ec"]]},{"id":"f30307b6.21e838","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/11","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":840,"wires":[["92405b43.8f4958"]]},{"id":"fc6a3df7.d19cd","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/10","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":780,"wires":[["3fa601fc.eb96de"]]},{"id":"6ab87ecc.37cd8","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/9","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":150,"y":720,"wires":[["9376002c.7114d"]]},{"id":"bb2ed260.6accf","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":1040,"wires":[["b7651bea.41be5"],["bde18df6.2960f"]],"outputLabels":["on/off value","brightness value"]},{"id":"81a2736.51b639","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":1360,"wires":[["443d87c4.3023d"],["9ff3b254.0a9e"]],"outputLabels":["on/off value","brightness value"]},{"id":"409db98b.807d48","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":1280,"wires":[["77238d9f.d85fac"],["b5f5aa62.b1b8c"]],"outputLabels":["on/off value","brightness value"]},{"id":"6c5178e1.6a4be8","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":1200,"wires":[["f766527c.b54708"],["32fb20fc.33fb1"]],"outputLabels":["on/off value","brightness value"]},{"id":"4c177e88.ea6a7","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":1440,"wires":[["de5083f5.8f342"],["255e8300.e6f6dc"]],"outputLabels":["on/off value","brightness value"]},{"id":"6118c705.2e90e8","type":"ui_switch","z":"5a05b8f3.894b88","name":"25_Main_Ceiling","label":"Ceiling","tooltip":"","group":"2e0a52f8.6acbee","order":1,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"25_state_Center Ceiling","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":910,"y":1900,"wires":[["ba8aebb.ea06618"]]},{"id":"48383a73.2bcfe4","type":"ui_slider","z":"5a05b8f3.894b88","name":"25_Main_Ceiling_brightness","label":"","tooltip":"","group":"2e0a52f8.6acbee","order":2,"width":3,"height":1,"passthru":false,"outs":"end","topic":"25_brightness","min":"1","max":"100","step":"","x":880,"y":1940,"wires":[["ba8aebb.ea06618"]]},{"id":"c5570c19.8d4cb","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":1920,"wires":[["6118c705.2e90e8"],["48383a73.2bcfe4"]],"outputLabels":["on/off value","brightness value"]},{"id":"39e3a0d6.9519f","type":"ui_switch","z":"5a05b8f3.894b88","name":"26_Main_CeilingAccent","label":"Ceiling Accent","tooltip":"","group":"2e0a52f8.6acbee","order":3,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"26_state_Ceiling Accent","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":890,"y":1980,"wires":[["ba8aebb.ea06618"]]},{"id":"1a56b96c.b314d7","type":"ui_slider","z":"5a05b8f3.894b88","name":"26_Main_CeilingAccent_brightness","label":"","tooltip":"","group":"2e0a52f8.6acbee","order":4,"width":3,"height":1,"passthru":false,"outs":"end","topic":"26_brightness","min":"1","max":"100","step":"","x":860,"y":2020,"wires":[["ba8aebb.ea06618"]]},{"id":"65666472.9397ac","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":2000,"wires":[["39e3a0d6.9519f"],["1a56b96c.b314d7"]],"outputLabels":["on/off value","brightness value"]},{"id":"e89c3394.84f89","type":"ui_switch","z":"5a05b8f3.894b88","name":"27_Main_Base_Accent","label":"Base Accent","tooltip":"","group":"2e0a52f8.6acbee","order":11,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"27_state_Living Room Base Accent","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":890,"y":2060,"wires":[["ba8aebb.ea06618"]]},{"id":"c502ea92.2cf478","type":"ui_slider","z":"5a05b8f3.894b88","name":"27_Main_Base_Accent_brightness","label":"","tooltip":"","group":"2e0a52f8.6acbee","order":12,"width":3,"height":1,"passthru":false,"outs":"end","topic":"27_brightness","min":"1","max":"100","step":"","x":860,"y":2100,"wires":[["ba8aebb.ea06618"]]},{"id":"49ba1cd7.bebbc4","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":2080,"wires":[["e89c3394.84f89"],["c502ea92.2cf478"]],"outputLabels":["on/off value","brightness value"]},{"id":"338b9c61.dc6634","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/25","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":1920,"wires":[["c5570c19.8d4cb"]]},{"id":"d66f735e.cee55","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/26","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":2000,"wires":[["65666472.9397ac"]]},{"id":"34eff10e.8918ae","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/27","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":2080,"wires":[["49ba1cd7.bebbc4"]]},{"id":"1e139ab8.f3f9f5","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/28","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":2160,"wires":[["eaebc1ce.365fe"]]},{"id":"13603f49.df2f81","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/31","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":2400,"wires":[["d806861.3ec9a78"]]},{"id":"cbe0f2a7.72eb8","type":"ui_switch","z":"5a05b8f3.894b88","name":"29_Main_DinetteSconce","label":"Dinette Sconce","tooltip":"","group":"2e0a52f8.6acbee","order":7,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"29_state_Dinette Sconce","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":890,"y":2220,"wires":[["ba8aebb.ea06618"]]},{"id":"1a95d4e5.d6806b","type":"ui_slider","z":"5a05b8f3.894b88","name":"29_Main_DinetteSconce_brightness","label":"","tooltip":"","group":"2e0a52f8.6acbee","order":8,"width":3,"height":1,"passthru":false,"outs":"end","topic":"29_brightness","min":"1","max":"100","step":"","x":850,"y":2260,"wires":[["ba8aebb.ea06618"]]},{"id":"80f322b4.4ba49","type":"ui_switch","z":"5a05b8f3.894b88","name":"30_Kitchen","label":"Kitchen","tooltip":"","group":"2e0a52f8.6acbee","order":5,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"30_state_Kitchen","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":930,"y":2300,"wires":[["ba8aebb.ea06618"]]},{"id":"e567e124.33155","type":"ui_slider","z":"5a05b8f3.894b88","name":"30_Kitchen_brightness","label":"","tooltip":"","group":"2e0a52f8.6acbee","order":6,"width":3,"height":1,"passthru":false,"outs":"end","topic":"30_brightness","min":"1","max":"100","step":"","x":900,"y":2340,"wires":[["ba8aebb.ea06618"]]},{"id":"56c43894.eca948","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":2320,"wires":[["80f322b4.4ba49"],["e567e124.33155"]],"outputLabels":["on/off value","brightness value"]},{"id":"3c636927.0e6b06","type":"ui_switch","z":"5a05b8f3.894b88","name":"31_Sofa Sconce","label":"Sofa Sconce","tooltip":"","group":"2e0a52f8.6acbee","order":23,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"31_state_Sofa Sconce","onvalue":"options.sofasconcemode","onvalueType":"global","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":920,"y":2380,"wires":[["ba8aebb.ea06618"]]},{"id":"a7d2239b.42bcc","type":"ui_slider","z":"5a05b8f3.894b88","name":"31_Sofa_Sconce_brightness","label":"","tooltip":"","group":"2e0a52f8.6acbee","order":24,"width":3,"height":1,"passthru":false,"outs":"end","topic":"31_brightness","min":"1","max":"100","step":"","x":880,"y":2420,"wires":[["ba8aebb.ea06618"]]},{"id":"d806861.3ec9a78","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":2400,"wires":[["3c636927.0e6b06"],["befc9017.0fda8"]],"outputLabels":["on/off value","brightness value"]},{"id":"58367bf3.bc1ba4","type":"ui_switch","z":"5a05b8f3.894b88","name":"32_DS_Slide","label":"DS Slide","tooltip":"","group":"2e0a52f8.6acbee","order":9,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"32_state_Small Dinette Lights","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":930,"y":2460,"wires":[["ba8aebb.ea06618"]]},{"id":"91311fb.29e1be","type":"ui_slider","z":"5a05b8f3.894b88","name":"32_DS_Slide_brightness","label":"","tooltip":"","group":"2e0a52f8.6acbee","order":10,"width":3,"height":1,"passthru":false,"outs":"end","topic":"32_brightness","min":"1","max":"100","step":"","x":890,"y":2500,"wires":[["ba8aebb.ea06618"]]},{"id":"3a5d5d6f.be61b2","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":2480,"wires":[["58367bf3.bc1ba4"],["91311fb.29e1be"]],"outputLabels":["on/off value","brightness value"]},{"id":"75708b96.ca4844","type":"ui_switch","z":"5a05b8f3.894b88","name":"33_Main_Dinette","label":"Dinette","tooltip":"","group":"2e0a52f8.6acbee","order":15,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"33_state_Dinette Light","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":910,"y":2540,"wires":[["ba8aebb.ea06618"]]},{"id":"d1d27f3e.2d4a1","type":"ui_slider","z":"5a05b8f3.894b88","name":"33_Main_Dinette_brightness","label":"","tooltip":"","group":"2e0a52f8.6acbee","order":16,"width":3,"height":1,"passthru":false,"outs":"end","topic":"33_brightness","min":"1","max":"100","step":"","x":880,"y":2580,"wires":[["ba8aebb.ea06618"]]},{"id":"4e1c26c3.d0f148","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":2560,"wires":[["75708b96.ca4844"],["d1d27f3e.2d4a1"]],"outputLabels":["on/off value","brightness value"]},{"id":"651b8383.05e42c","type":"ui_switch","z":"5a05b8f3.894b88","name":"34_Main_Sink","label":"Sink","tooltip":"","group":"2e0a52f8.6acbee","order":17,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"34_state_Sink Lights","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":920,"y":2620,"wires":[["ba8aebb.ea06618"]]},{"id":"13a3533a.009bad","type":"ui_slider","z":"5a05b8f3.894b88","name":"34_Main_Sink_brightness","label":"","tooltip":"","group":"2e0a52f8.6acbee","order":18,"width":3,"height":1,"passthru":false,"outs":"end","topic":"34_brightness","min":"1","max":"100","step":"","x":890,"y":2660,"wires":[["ba8aebb.ea06618"]]},{"id":"2aa05fba.2bbcd","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":2640,"wires":[["651b8383.05e42c"],["13a3533a.009bad"]],"outputLabels":["on/off value","brightness value"]},{"id":"ae27b2c2.b17ff","type":"ui_switch","z":"5a05b8f3.894b88","name":"35_Main_Midship","label":"Hall","tooltip":"","group":"2e0a52f8.6acbee","order":19,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"35_state_Hall Lights","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":910,"y":2700,"wires":[["ba8aebb.ea06618"]]},{"id":"ef7aa0d8.0aa4e","type":"ui_slider","z":"5a05b8f3.894b88","name":"35_Main_Midship_brightness","label":"","tooltip":"","group":"2e0a52f8.6acbee","order":20,"width":3,"height":1,"passthru":false,"outs":"end","topic":"35_brightness","min":"1","max":"100","step":"","x":880,"y":2740,"wires":[["ba8aebb.ea06618"]]},{"id":"e71ec827.ff7198","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":2720,"wires":[["ae27b2c2.b17ff"],["ef7aa0d8.0aa4e"]],"outputLabels":["on/off value","brightness value"]},{"id":"283713ce.743e8c","type":"ui_switch","z":"5a05b8f3.894b88","name":"6_AH_Burner","label":"Burner","tooltip":"","group":"cf9b6bb9.e5ef38","order":1,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"6_state_Aquahot Burner","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":920,"y":540,"wires":[["ba8aebb.ea06618"]]},{"id":"2d1351ee.4840fe","type":"ui_switch","z":"5a05b8f3.894b88","name":"38_Ext_UnderSlideout","label":"Under Slideout","tooltip":"","group":"4e2af34d.8f765c","order":3,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"38_state_Under Slideout Lights","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":900,"y":2940,"wires":[["ba8aebb.ea06618"]]},{"id":"1aa674fc.20761b","type":"ui_switch","z":"5a05b8f3.894b88","name":"39_Ext_DS Awning","label":"DS Awning","tooltip":"","group":"4e2af34d.8f765c","order":8,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"39_state_Driver Side Awning Lights","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":910,"y":3000,"wires":[["ba8aebb.ea06618"]]},{"id":"3e30dd2.93adb22","type":"ui_switch","z":"5a05b8f3.894b88","name":"40_Ext_PS_Awning","label":"PS Awning","tooltip":"","group":"4e2af34d.8f765c","order":7,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"40_state_Passenger Side Awning Lights","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":900,"y":3060,"wires":[["ba8aebb.ea06618"]]},{"id":"ce87987b.237e58","type":"ui_switch","z":"5a05b8f3.894b88","name":"114_Ext_Porch","label":"Porch","tooltip":"","group":"4e2af34d.8f765c","order":2,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"114_state_Porch Lights","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":920,"y":3240,"wires":[["ba8aebb.ea06618"]]},{"id":"e304b78f.b9b158","type":"ui_switch","z":"5a05b8f3.894b88","name":"111_Ext_Cargo","label":"Cargo","tooltip":"","group":"4e2af34d.8f765c","order":1,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"111_state_Cargo Lights","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":920,"y":3120,"wires":[["ba8aebb.ea06618"]]},{"id":"da5e484.8fa6eb8","type":"ui_switch","z":"5a05b8f3.894b88","name":"11_Ext_DS_Security","label":"DS Security","tooltip":"","group":"4e2af34d.8f765c","order":6,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"11_state_Driver Side Security Light","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":900,"y":840,"wires":[["ba8aebb.ea06618"]]},{"id":"c2bb6384.df68e","type":"ui_switch","z":"5a05b8f3.894b88","name":"10_Ext_PS_Security","label":"PS Security","tooltip":"","group":"4e2af34d.8f765c","order":5,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"10_state_Passenger Side Security Light","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":900,"y":780,"wires":[["ba8aebb.ea06618"]]},{"id":"8529e370.f1b51","type":"ui_switch","z":"5a05b8f3.894b88","name":"9_Ext_Motion","label":"Motion","tooltip":"","group":"4e2af34d.8f765c","order":4,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"9_state_Motion Lights","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":920,"y":720,"wires":[["ba8aebb.ea06618"]]},{"id":"3fc40c7d.9870b4","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":2240,"wires":[["cbe0f2a7.72eb8"],["1a95d4e5.d6806b"]],"outputLabels":["on/off value","brightness value"]},{"id":"d9b07668.1d2958","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/29","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":2240,"wires":[["3fc40c7d.9870b4"]]},{"id":"74b88157.a4e5","type":"ui_button","z":"2fdd8124.05e35e","name":"","group":"7dcb24f9.ce47cc","order":1,"width":0,"height":0,"passthru":false,"label":"Reload Alexa Voice Command List","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"date","topic":"","x":260,"y":2160,"wires":[["a4d6128e.0b4f6"]]},{"id":"8e840475.8962e8","type":"comment","z":"5a05b8f3.894b88","name":"/coachproxy/rv-c/panel_lights.pl ","info":"/coachproxy/rv-c/panel_lights.pl ","x":1290,"y":40,"wires":[]},{"id":"12b12ccf.246393","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/ATS_AC_STATUS_1/#","qos":"2","broker":"c1170463.5c7f8","x":200,"y":4060,"wires":[["6d47c1df.6d46f"]]},{"id":"6d47c1df.6d46f","type":"json","z":"5a05b8f3.894b88","name":"","x":420,"y":4060,"wires":[["9f7d5bc1.779508","ad12b1e6.1b44c"]]},{"id":"9f7d5bc1.779508","type":"switch","z":"5a05b8f3.894b88","name":"Leg Switch","property":"payload.leg","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"},{"t":"eq","v":"1","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":600,"y":4060,"wires":[["84435356.8eaa6","afb816.162057e8"],["8e678678.da6c68","5f590da3.c39044"]]},{"id":"45b00f6f.d0288","type":"ui_text","z":"5a05b8f3.894b88","group":"fb4c3e00.5737a","order":7,"width":"3","height":"1","name":"ATS Current Leg 1 /ats/+pred/","label":"Leg 1:","format":"{{msg.payload}} A","layout":"row-spread","x":1240,"y":4000,"wires":[]},{"id":"435bab33.e9ca24","type":"ui_text","z":"5a05b8f3.894b88","group":"fb4c3e00.5737a","order":9,"width":"3","height":"1","name":"ATS Current Leg 2 /ats/+pred/","label":"Leg 2:","format":"{{msg.payload}} A","layout":"row-spread","x":1240,"y":4080,"wires":[]},{"id":"5ea222b1.3468ec","type":"ui_template","z":"5a05b8f3.894b88","group":"fb4c3e00.5737a","name":"120V Power Source /ats/+pred/","order":6,"width":"6","height":"1","format":"<!DOCTYPE html>\n<div style=\"height: 10px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 10px; border-bottom: 1px solid black; text-align: left\">\n  <span style=\"font-size: 16px; background-color: #FEFEFE; padding: 0 10px; margin-left: 10px;\">\n    120V Power: <b>{{msg.payload}}</b>\n  </span>\n</div>\n<div style=\"height: 8px;\">&nbsp;</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1240,"y":3960,"wires":[[]]},{"id":"29808e69.c89172","type":"ui_text","z":"5a05b8f3.894b88","group":"fb4c3e00.5737a","order":8,"width":"3","height":"1","name":"ATS Voltage Leg 1 /ats/+pred/","label":"","format":"{{msg.payload}} V","layout":"row-left","x":1240,"y":4040,"wires":[]},{"id":"1d9f5ad6.5dfbc5","type":"ui_text","z":"5a05b8f3.894b88","group":"fb4c3e00.5737a","order":10,"width":"3","height":"1","name":"ATS Voltage Leg 2 /ats/+pred/","label":"","format":"{{msg.payload}} V","layout":"row-left","x":1240,"y":4120,"wires":[]},{"id":"29e74c3c.c71dc4","type":"rbe","z":"5a05b8f3.894b88","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1020,"y":4040,"wires":[["29808e69.c89172"]]},{"id":"97d1c7b.00a4238","type":"rbe","z":"5a05b8f3.894b88","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1020,"y":4080,"wires":[["435bab33.e9ca24"]]},{"id":"26f7f20d.b46c0e","type":"rbe","z":"5a05b8f3.894b88","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1020,"y":4000,"wires":[["45b00f6f.d0288"]]},{"id":"c013cbdf.7250f8","type":"rbe","z":"5a05b8f3.894b88","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1020,"y":4120,"wires":[["1d9f5ad6.5dfbc5"]]},{"id":"195ad800.63dff8","type":"rbe","z":"5a05b8f3.894b88","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1020,"y":3960,"wires":[["5ea222b1.3468ec"]]},{"id":"3610e5df.7d19ca","type":"comment","z":"5a05b8f3.894b88","name":"120V ATS Power Display (2018+)","info":"","x":210,"y":3960,"wires":[]},{"id":"84435356.8eaa6","type":"change","z":"5a05b8f3.894b88","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"$round(payload.\"rms current\")","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":850,"y":4000,"wires":[["26f7f20d.b46c0e"]]},{"id":"8e678678.da6c68","type":"change","z":"5a05b8f3.894b88","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"$round(payload.\"rms current\")","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":850,"y":4080,"wires":[["97d1c7b.00a4238"]]},{"id":"afb816.162057e8","type":"change","z":"5a05b8f3.894b88","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"$round(payload.\"rms voltage\")","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":850,"y":4040,"wires":[["29e74c3c.c71dc4"]]},{"id":"5f590da3.c39044","type":"change","z":"5a05b8f3.894b88","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"$round(payload.\"rms voltage\")","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":850,"y":4120,"wires":[["c013cbdf.7250f8"]]},{"id":"ad12b1e6.1b44c","type":"file function","z":"5a05b8f3.894b88","name":"ats_source_decode","filename":".node-red/js/ats_source_decode.js","reloadfile":false,"outputs":1,"x":620,"y":3960,"wires":[["195ad800.63dff8"]]},{"id":"11a31399.380fbc","type":"ui_template","z":"5a05b8f3.894b88","group":"5d7e55cd.f34c2c","name":"Awning Note /awning-message/","order":1,"width":"6","height":"2","format":"<div>\n<p>\n    Press a button to start the awning movement.\n    Optionally press the same button again to\n    stop awning movement early.\n</p>\n</div>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":4570,"y":1240,"wires":[[]]},{"id":"9114a169.3f84f","type":"comment","z":"5a05b8f3.894b88","name":"Window Shades Entegra","info":"","x":3450,"y":400,"wires":[]},{"id":"5707fa53.80cf84","type":"ui_button","z":"5a05b8f3.894b88","name":"/awning_0_retract/","group":"5d7e55cd.f34c2c","order":4,"width":"3","height":"1","passthru":false,"label":"Retract","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-left fa-2x","payload":"2019 day up 110 --duration=22","payloadType":"str","topic":"0 d","x":4530,"y":1320,"wires":[["992c2dc8.5bc56","f655e209.c54c2"]]},{"id":"74955b79.b49a24","type":"ui_button","z":"5a05b8f3.894b88","name":"/awning_0_extend/","group":"5d7e55cd.f34c2c","order":5,"width":"3","height":"1","passthru":false,"label":"Extend","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-right fa-2x","payload":"2019 day down 109 --duration=22","payloadType":"str","topic":"0 d","x":4530,"y":1360,"wires":[["992c2dc8.5bc56","f655e209.c54c2"]]},{"id":"19049876.134c78","type":"ui_template","z":"5a05b8f3.894b88","group":"5d7e55cd.f34c2c","name":"Entry Door /awning_0_label/","order":3,"width":"6","height":"1","format":"<div style=\"height: 16px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 8px; border-bottom: 1px solid black; text-align: center\">\n  <span style=\"font-size: 16px; background-color: #FEFEFE; padding: 0 10px; margin-left: 10px;\">\n    Entry Door\n  </span>\n</div>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":4530,"y":1280,"wires":[[]]},{"id":"fb32292d.4c87a8","type":"comment","z":"5a05b8f3.894b88","name":"Awnings","info":"","x":4500,"y":1200,"wires":[]},{"id":"c441ee4d.2a1a7","type":"ui_switch","z":"5a05b8f3.894b88","name":"/awning-enabler/","label":"Enable Awning Controls:","group":"5d7e55cd.f34c2c","order":2,"width":"6","height":"1","passthru":false,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":4250,"y":1240,"wires":[["eac2adab.7827d","913b3d7f.df988"]]},{"id":"eac2adab.7827d","type":"trigger","z":"5a05b8f3.894b88","name":"","op1":"true","op2":"false","op1type":"bool","op2type":"bool","duration":"61","extend":true,"units":"s","reset":"false","bytopic":"all","outputs":1,"x":4290,"y":1300,"wires":[["913b3d7f.df988","c441ee4d.2a1a7"]]},{"id":"913b3d7f.df988","type":"change","z":"5a05b8f3.894b88","name":"","rules":[{"t":"set","p":"enabled","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4250,"y":1360,"wires":[["5707fa53.80cf84","74955b79.b49a24"]]},{"id":"ebed5520.3e02f8","type":"inject","z":"5a05b8f3.894b88","name":"","props":[{"p":"payload","v":"false","vt":"bool"},{"p":"topic","v":"","vt":"string"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"false","payloadType":"bool","x":4050,"y":1300,"wires":[["913b3d7f.df988","c441ee4d.2a1a7"]]},{"id":"992c2dc8.5bc56","type":"link out","z":"5a05b8f3.894b88","name":"Awning button pressed","links":["2a11ecb2.774834"],"x":4735,"y":1340,"wires":[]},{"id":"2a11ecb2.774834","type":"link in","z":"5a05b8f3.894b88","name":"Reset awning timer","links":["992c2dc8.5bc56"],"x":4155,"y":1300,"wires":[["eac2adab.7827d","65c06dd4.0cde44"]]},{"id":"a668882b.03b908","type":"ui_text","z":"5a05b8f3.894b88","group":"5d7e55cd.f34c2c","order":3,"width":"6","height":"1","name":"Awning Status","label":"","format":"{{msg.payload}}","layout":"row-center","x":4240,"y":1560,"wires":[]},{"id":"65c06dd4.0cde44","type":"change","z":"5a05b8f3.894b88","name":"","rules":[{"t":"set","p":"duration","pt":"msg","to":"$substringAfter(payload, \"duration=\")","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":4250,"y":1440,"wires":[["535f9b22.9ade84"]]},{"id":"535f9b22.9ade84","type":"function","z":"5a05b8f3.894b88","name":"Countdown Message","func":"let duration = msg.duration;\n\nif (msg.duration >= 0) {\n    if (msg.duration === 0) {\n        msg.payload = '';\n    } else {\n        msg.payload = \"Awning active for \" + duration + \" sec.\";\n    }\n\n    msg.duration--;\n\n    return msg;\n}","outputs":1,"noerr":0,"x":4240,"y":1480,"wires":[["a668882b.03b908","43d6a4eb.4ebbdc"]]},{"id":"43d6a4eb.4ebbdc","type":"delay","z":"5a05b8f3.894b88","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":4240,"y":1520,"wires":[["535f9b22.9ade84"]]},{"id":"77b13605.4a3f98","type":"ui_template","z":"5a05b8f3.894b88","group":"ae3b3824.48abe8","name":"ds_/windshield_2/","order":1,"width":"6","height":"1","format":"<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>DS Windshield</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":3430,"y":1560,"wires":[[]]},{"id":"48c2ce4b.accd5","type":"ui_button","z":"5a05b8f3.894b88","name":"/ds_windshield_2_night_up/","group":"ae3b3824.48abe8","order":3,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"2","x":3460,"y":1680,"wires":[["5a45bd75.3ba2b4"]]},{"id":"a8cdf72f.d35398","type":"ui_button","z":"5a05b8f3.894b88","name":"/ds_windshield_2_night_down/","group":"ae3b3824.48abe8","order":5,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"2","x":3470,"y":1720,"wires":[["5a45bd75.3ba2b4"]]},{"id":"5a45bd75.3ba2b4","type":"template","z":"5a05b8f3.894b88","name":"shade_template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"2016 {{payload}} {{topic}}","output":"str","x":4020,"y":2140,"wires":[["f655e209.c54c2"]]},{"id":"f655e209.c54c2","type":"exec","z":"5a05b8f3.894b88","command":"/coachproxy/rv-c/window_shade_entegra.pl","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":4470,"y":2140,"wires":[[],[],[]]},{"id":"a10e021a.9b08a","type":"ui_button","z":"5a05b8f3.894b88","name":"/ds_windshield_2_day_up/","group":"ae3b3824.48abe8","order":2,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"2","x":3460,"y":1600,"wires":[["5a45bd75.3ba2b4"]]},{"id":"50fbb40f.f0037c","type":"ui_button","z":"5a05b8f3.894b88","name":"/ds_windshield_2_day_down/","group":"ae3b3824.48abe8","order":4,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"2","x":3460,"y":1640,"wires":[["5a45bd75.3ba2b4"]]},{"id":"dd8d3259.146c1","type":"ui_template","z":"5a05b8f3.894b88","group":"5725fb8d.051db4","name":"/all_shades/","order":1,"width":"6","height":"1","format":"<!DOCTYPE html>\n<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>All Shades</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":3410,"y":460,"wires":[[]]},{"id":"2e7ed346.e1a85c","type":"ui_button","z":"5a05b8f3.894b88","name":"/all_shades_night_up/","group":"5725fb8d.051db4","order":3,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"1 2 3 4 5 6 7 8 9 10 11 12 17","x":3440,"y":540,"wires":[["5a45bd75.3ba2b4"]]},{"id":"b8f35696.48a998","type":"ui_button","z":"5a05b8f3.894b88","name":"/all_shades_night_down/","group":"5725fb8d.051db4","order":5,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"1 2 3 4 5 6 7 8 9 10 11 12 17","x":3450,"y":620,"wires":[["5a45bd75.3ba2b4"]]},{"id":"494657c0.4deba8","type":"ui_button","z":"5a05b8f3.894b88","name":"/all_shades_day_up/","group":"5725fb8d.051db4","order":2,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"1 2 3 4 5 6 7 8 9 10 11 12 17","x":3440,"y":500,"wires":[["5a45bd75.3ba2b4"]]},{"id":"eb7fdc35.a9cbc","type":"ui_button","z":"5a05b8f3.894b88","name":"/all_shades_day_down/","group":"5725fb8d.051db4","order":4,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"1 2 3 4 5 6 7 8 9 10 11 12 17","x":3450,"y":580,"wires":[["5a45bd75.3ba2b4"]]},{"id":"98e93956.c0ab48","type":"ui_button","z":"5a05b8f3.894b88","name":"/ps_windshield_3_night_up/","group":"ae3b3824.48abe8","order":8,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"3","x":3460,"y":1860,"wires":[["5a45bd75.3ba2b4"]]},{"id":"90a045a2.5633c8","type":"ui_button","z":"5a05b8f3.894b88","name":"/ps_windshield_3_night_down/","group":"ae3b3824.48abe8","order":10,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"3","x":3470,"y":1940,"wires":[["5a45bd75.3ba2b4"]]},{"id":"5be44ea5.e3559","type":"ui_button","z":"5a05b8f3.894b88","name":"/ps_windshield_3_day_up/","group":"ae3b3824.48abe8","order":7,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"3","x":3460,"y":1820,"wires":[["5a45bd75.3ba2b4"]]},{"id":"ac7f1ee4.02722","type":"ui_button","z":"5a05b8f3.894b88","name":"/ps_windshield_3_day_down/","group":"ae3b3824.48abe8","order":9,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"3","x":3460,"y":1900,"wires":[["5a45bd75.3ba2b4"]]},{"id":"e2b5442a.7a29c8","type":"ui_template","z":"5a05b8f3.894b88","group":"ae3b3824.48abe8","name":"/ps_windshield_3/","order":6,"width":"6","height":"1","format":"<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>PS Windshield</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":3430,"y":1780,"wires":[[]]},{"id":"dc37a726.1f7db8","type":"ui_button","z":"5a05b8f3.894b88","name":"/entry_4_night_up/","group":"ae3b3824.48abe8","order":18,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"4","x":3430,"y":2080,"wires":[["5a45bd75.3ba2b4"]]},{"id":"d74e63d3.c1f0f","type":"ui_button","z":"5a05b8f3.894b88","name":"/entry_4_night_down/","group":"ae3b3824.48abe8","order":20,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"4","x":3440,"y":2160,"wires":[["5a45bd75.3ba2b4"]]},{"id":"ee36d7ca.aff688","type":"ui_button","z":"5a05b8f3.894b88","name":"/entry_4_day_up/","group":"ae3b3824.48abe8","order":17,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"4","x":3430,"y":2040,"wires":[["5a45bd75.3ba2b4"]]},{"id":"5ea21cd0.56c684","type":"ui_button","z":"5a05b8f3.894b88","name":"/entry_4_day_down/","group":"ae3b3824.48abe8","order":19,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"4","x":3440,"y":2120,"wires":[["5a45bd75.3ba2b4"]]},{"id":"bb152417.485968","type":"ui_template","z":"5a05b8f3.894b88","group":"ae3b3824.48abe8","name":"/entry_4/","order":16,"width":"6","height":"1","format":"<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>Entry</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":3400,"y":2000,"wires":[[]]},{"id":"87b626c4.7b23a8","type":"ui_button","z":"5a05b8f3.894b88","name":"/toll_1_night_up/","group":"ae3b3824.48abe8","order":13,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"1","x":3420,"y":1420,"wires":[["5a45bd75.3ba2b4"]]},{"id":"be112b05.a65e18","type":"ui_button","z":"5a05b8f3.894b88","name":"/toll_1_night_down/","group":"ae3b3824.48abe8","order":15,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"1","x":3430,"y":1500,"wires":[["5a45bd75.3ba2b4"]]},{"id":"1de16049.6f018","type":"ui_button","z":"5a05b8f3.894b88","name":"/toll_1_day_up/","group":"ae3b3824.48abe8","order":12,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"1","x":3420,"y":1380,"wires":[["5a45bd75.3ba2b4"]]},{"id":"c477dccf.4b151","type":"ui_button","z":"5a05b8f3.894b88","name":"/toll_1_day_down/","group":"ae3b3824.48abe8","order":14,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"1","x":3430,"y":1460,"wires":[["5a45bd75.3ba2b4"]]},{"id":"1173c392.b8b40c","type":"ui_template","z":"5a05b8f3.894b88","group":"ae3b3824.48abe8","name":"/toll_1/","order":11,"width":"6","height":"1","format":"<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>Toll</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":3390,"y":1340,"wires":[[]]},{"id":"ae61032c.7ed5f","type":"ui_button","z":"5a05b8f3.894b88","name":"/dinette_7_night_up/","group":"5a6f1f47.88d1c","order":8,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"7","x":3440,"y":2740,"wires":[["5a45bd75.3ba2b4"]]},{"id":"2bf36062.f8d7","type":"ui_button","z":"5a05b8f3.894b88","name":"/dinette_7_night_down/","group":"5a6f1f47.88d1c","order":10,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"7","x":3450,"y":2820,"wires":[["5a45bd75.3ba2b4"]]},{"id":"decb10b6.d3976","type":"ui_button","z":"5a05b8f3.894b88","name":"/dinette_7_day_up/","group":"5a6f1f47.88d1c","order":7,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"7","x":3430,"y":2700,"wires":[["5a45bd75.3ba2b4"]]},{"id":"204463ab.d88f3c","type":"ui_button","z":"5a05b8f3.894b88","name":"/dinette_7_day_down/","group":"5a6f1f47.88d1c","order":9,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"7","x":3440,"y":2780,"wires":[["5a45bd75.3ba2b4"]]},{"id":"e1394c3f.8b478","type":"ui_template","z":"5a05b8f3.894b88","group":"5a6f1f47.88d1c","name":"/dinette_7/","order":6,"width":"6","height":"1","format":"<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>Dinette</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":3410,"y":2660,"wires":[[]]},{"id":"4c40c0a4.1d043","type":"ui_button","z":"5a05b8f3.894b88","name":"/sofa_8_night_up/","group":"5a6f1f47.88d1c","order":3,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"8","x":3430,"y":3180,"wires":[["5a45bd75.3ba2b4"]]},{"id":"74d65a97.ec0c54","type":"ui_button","z":"5a05b8f3.894b88","name":"/sofa_8_night_down/","group":"5a6f1f47.88d1c","order":5,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"8","x":3440,"y":3260,"wires":[["5a45bd75.3ba2b4"]]},{"id":"7e9cc68c.95e508","type":"ui_button","z":"5a05b8f3.894b88","name":"/sofa_8_day_up/","group":"5a6f1f47.88d1c","order":2,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"8","x":3420,"y":3140,"wires":[["5a45bd75.3ba2b4"]]},{"id":"180d3825.7734c8","type":"ui_button","z":"5a05b8f3.894b88","name":"/sofa_8_day_down/","group":"5a6f1f47.88d1c","order":4,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"8","x":3430,"y":3220,"wires":[["5a45bd75.3ba2b4"]]},{"id":"2d947296.ddea6e","type":"ui_template","z":"5a05b8f3.894b88","group":"5a6f1f47.88d1c","name":"/sofa_8/","order":1,"width":"6","height":"1","format":"<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>Sofa</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":3400,"y":3100,"wires":[[]]},{"id":"b5ccdd00.f54e","type":"ui_button","z":"5a05b8f3.894b88","name":"/bed_9_night_up/","group":"3806de6b.607142","order":3,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"9","x":3430,"y":3400,"wires":[["5a45bd75.3ba2b4"]]},{"id":"751bafdb.117ce","type":"ui_button","z":"5a05b8f3.894b88","name":"/bed_9_night_down/","group":"3806de6b.607142","order":5,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"9","x":3440,"y":3480,"wires":[["5a45bd75.3ba2b4"]]},{"id":"6b2a8d58.901564","type":"ui_button","z":"5a05b8f3.894b88","name":"/bed_9_day_up/","group":"3806de6b.607142","order":2,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"9","x":3420,"y":3360,"wires":[["5a45bd75.3ba2b4"]]},{"id":"33f88c5c.5f4b14","type":"ui_button","z":"5a05b8f3.894b88","name":"/bed_9_day_down/","group":"3806de6b.607142","order":4,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"9","x":3430,"y":3440,"wires":[["5a45bd75.3ba2b4"]]},{"id":"e63d8ae.5587a78","type":"ui_template","z":"5a05b8f3.894b88","group":"3806de6b.607142","name":"/bed_9/","order":1,"width":"6","height":"1","format":"<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>Bed</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":3400,"y":3320,"wires":[[]]},{"id":"baab6b0e.a596f8","type":"ui_button","z":"5a05b8f3.894b88","name":"/vanity_10_night_up/","group":"3806de6b.607142","order":8,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"10","x":3440,"y":3620,"wires":[["5a45bd75.3ba2b4"]]},{"id":"b257ea0d.8bafd8","type":"ui_button","z":"5a05b8f3.894b88","name":"/vanity_10_night_down/","group":"3806de6b.607142","order":10,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"10","x":3450,"y":3700,"wires":[["5a45bd75.3ba2b4"]]},{"id":"58ee4ea0.cca99","type":"ui_button","z":"5a05b8f3.894b88","name":"/vanity_10_day_up/","group":"3806de6b.607142","order":7,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"10","x":3430,"y":3580,"wires":[["5a45bd75.3ba2b4"]]},{"id":"e669d5.be89f628","type":"ui_button","z":"5a05b8f3.894b88","name":"/vanity_10_day_down/","group":"3806de6b.607142","order":9,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"10","x":3440,"y":3660,"wires":[["5a45bd75.3ba2b4"]]},{"id":"88a5a9a1.d29ff8","type":"ui_template","z":"5a05b8f3.894b88","group":"3806de6b.607142","name":"/vanity_10/","order":6,"width":"6","height":"1","format":"<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>Vanity</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":3410,"y":3540,"wires":[[]]},{"id":"99f83623.dd6c68","type":"ui_button","z":"5a05b8f3.894b88","name":"/stool_11_night_up/","group":"6fd8f21b.f22b1c","order":3,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"11","x":3430,"y":3840,"wires":[["5a45bd75.3ba2b4"]]},{"id":"e751c3ec.3158","type":"ui_button","z":"5a05b8f3.894b88","name":"/stool_11_night_down/","group":"6fd8f21b.f22b1c","order":5,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"11","x":3440,"y":3920,"wires":[["5a45bd75.3ba2b4"]]},{"id":"3663cfc.9c8673","type":"ui_button","z":"5a05b8f3.894b88","name":"/stool_11_day_up/","group":"6fd8f21b.f22b1c","order":2,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"11","x":3430,"y":3800,"wires":[["5a45bd75.3ba2b4"]]},{"id":"616beb0b.576014","type":"ui_button","z":"5a05b8f3.894b88","name":"/stool_11_day_down/","group":"6fd8f21b.f22b1c","order":4,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"11","x":3440,"y":3880,"wires":[["5a45bd75.3ba2b4"]]},{"id":"7b447033.17e94","type":"ui_template","z":"5a05b8f3.894b88","group":"6fd8f21b.f22b1c","name":"/stool_11/","order":1,"width":"6","height":"1","format":"<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>Stool</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":3400,"y":3760,"wires":[[]]},{"id":"4a3c64a0.dda8bc","type":"ui_button","z":"5a05b8f3.894b88","name":"/bath_12_night_up/","group":"6fd8f21b.f22b1c","order":8,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"12","x":3430,"y":4060,"wires":[["5a45bd75.3ba2b4"]]},{"id":"c4d8abeb.7c76f8","type":"ui_button","z":"5a05b8f3.894b88","name":"/bath_12_night_down/","group":"6fd8f21b.f22b1c","order":10,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"12","x":3440,"y":4140,"wires":[["5a45bd75.3ba2b4"]]},{"id":"95ff0a36.a10568","type":"ui_button","z":"5a05b8f3.894b88","name":"/bath_12_day_up/","group":"6fd8f21b.f22b1c","order":7,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"12","x":3430,"y":4020,"wires":[["5a45bd75.3ba2b4"]]},{"id":"caaa5737.511258","type":"ui_button","z":"5a05b8f3.894b88","name":"/bath_12_day_down/","group":"6fd8f21b.f22b1c","order":9,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"12","x":3440,"y":4100,"wires":[["5a45bd75.3ba2b4"]]},{"id":"762dc253.7b33cc","type":"ui_template","z":"5a05b8f3.894b88","group":"6fd8f21b.f22b1c","name":"/bath_12/","order":6,"width":"6","height":"1","format":"<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>Bath</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":3400,"y":3980,"wires":[[]]},{"id":"ccf1905a.52a16","type":"split","z":"2fdd8124.05e35e","name":"split version","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"topic","x":490,"y":1340,"wires":[["248271cb.62ddae"]]},{"id":"248271cb.62ddae","type":"switch","z":"2fdd8124.05e35e","name":"Switch Versions","property":"topic","propertyType":"msg","rules":[{"t":"cont","v":"CoachProxy","vt":"str"},{"t":"cont","v":"eRVin","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":680,"y":1340,"wires":[["215362d2.a415de"],["ed8f62b5.c7ed48"]]},{"id":"215362d2.a415de","type":"ui_text","z":"2fdd8124.05e35e","d":true,"group":"f961f048.b0646","order":2,"width":"","height":"","name":"CoachProxy Version","label":"CoachProxy Version","format":"{{msg.payload}}","layout":"","x":960,"y":1320,"wires":[]},{"id":"589bd084.7b41d","type":"ui_template","z":"f6c367c2.63b9b8","group":"39ecc94c.7e22c6","name":"eRVin Welcome Message","order":2,"width":"0","height":"0","format":"<div style=\"height: 130px;\">\n<p>\n    <b>Welcome to eRVin!</b>\n</p>\n<p style=\"font-size:90%;\"> \n    <b>E</b>nhancing <b>RV</b> <b>I</b>ntegrated <b>N</b>etworks\n</p>\n<br>\n<p>\n    Email: <a href=\"mailto: info@myervin.com\">info@myervin.com</a>\n</p>\n    <p style=\"font-size:100%;\">Web: <a href=\"http://myervin.com\">http://myervin.com</a></p>\n</div>","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"local","x":710,"y":260,"wires":[[]]},{"id":"9bb36106.dac15","type":"ui_template","z":"f6c367c2.63b9b8","group":"ca514016.47102","name":"About","order":1,"width":"0","height":"0","format":"<div style=\"height: 130px;\">\n<p>\n    eRVin is based on CoachProxy (for Tiffin products), but modified here for other RV models. The goal of eRVin is to expand beyond basic control and integrate enhanced automation capabilities. It is a work in progress and needs input from other automation enthusiasts. \n</p>\n<br>\n<p> Many thanks to the hard work of the CoachProxy developers who have made their product open source and free to the world.\n</p>\n</div>\n","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"local","x":450,"y":300,"wires":[[]]},{"id":"7d70e9cf.ba1618","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":7,"width":3,"height":1,"passthru":false,"label":"All Inside On","color":"","bgcolor":"","icon":"","payload":"All Inside On","payloadType":"str","topic":"","x":2090,"y":3440,"wires":[["e93ee5ce.3132d8"]]},{"id":"f1d0a5c9.d85468","type":"file","z":"5a05b8f3.894b88","name":"Write Scene","filename":"","appendNewline":true,"createDir":false,"overwriteFile":"false","x":3030,"y":4420,"wires":[[]]},{"id":"ed0207ae.e3a458","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":3,"width":3,"height":1,"passthru":true,"label":"Kitchen","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Kitchen","payloadType":"str","topic":"","x":2080,"y":3280,"wires":[["e93ee5ce.3132d8"]]},{"id":"6bf229e4.03b218","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":4,"width":3,"height":1,"passthru":true,"label":"Dinnertime","color":"","bgcolor":"","icon":"","payload":"Dinnertime","payloadType":"str","topic":"","x":2090,"y":3320,"wires":[["e93ee5ce.3132d8"]]},{"id":"3d4f568a.5c735a","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":6,"width":3,"height":1,"passthru":true,"label":"Bedtime","color":"","bgcolor":"","icon":"","payload":"Bedtime","payloadType":"str","topic":"","x":2080,"y":3400,"wires":[["e93ee5ce.3132d8"]]},{"id":"fd30c357.1dfe1","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":5,"width":3,"height":1,"passthru":true,"label":"TV Time","tooltip":"","color":"","bgcolor":"","icon":"","payload":"TV Time","payloadType":"str","topic":"","x":2080,"y":3360,"wires":[["e93ee5ce.3132d8"]]},{"id":"c5376c0a.cbfc3","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":1,"width":3,"height":1,"passthru":true,"label":"Good Morning","color":"","bgcolor":"","icon":"","payload":"Good Morning","payloadType":"str","topic":"","x":2100,"y":3200,"wires":[["e93ee5ce.3132d8"]]},{"id":"f0b74b91.713aa8","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":2,"width":3,"height":1,"passthru":true,"label":"Good Evening","color":"","bgcolor":"","icon":"","payload":"Good Evening","payloadType":"str","topic":"","x":2100,"y":3240,"wires":[["e93ee5ce.3132d8"]]},{"id":"526eecd0.8b3464","type":"comment","z":"5a05b8f3.894b88","name":"Play a Scene","info":"","x":2090,"y":3140,"wires":[]},{"id":"5033166a.adae58","type":"file in","z":"5a05b8f3.894b88","name":"Get Scene File","filename":"","format":"lines","chunk":false,"sendError":false,"x":2420,"y":3560,"wires":[["a1e78f3f.d1f35"]]},{"id":"e93ee5ce.3132d8","type":"function","z":"5a05b8f3.894b88","name":"Play Scene","func":"// Author: Rob Picchione 20180727 v1.1\n//\n// Fill out the Label and Payload fields of a dashboard Button that is input\n// to this function with the name of the Scene file to be executed.\n//\n// Prerequisite: A Scene file of the same exact name must already have been created\n// using the Scene Builder function.\n//\n// This function gets the Scene file name passed from the Payload field of the dashboard \n// button node.\n//\n// The directory path of the scene file is hard coded below in the path variable to avoid\n// having to enter it as a topic in every scene button. If your path is different change it below.\n//\n// The fuction outputs the concatenated path + filename as msg.filename for the Get File node.\n\nlet scenename = msg.payload;\nlet path = global.get ('scenepath');\n\nmsg = {\n    filename:path+scenename,\n}\nreturn msg;","outputs":1,"noerr":0,"x":2410,"y":3500,"wires":[["5033166a.adae58","25027f54.3ee4d"]]},{"id":"2b47bd25.68dcb2","type":"catch","z":"5a05b8f3.894b88","name":"Play Scene Error","scope":["5033166a.adae58","e93ee5ce.3132d8"],"uncaught":false,"x":2360,"y":3300,"wires":[["48fed0d3.21de3"]]},{"id":"a8c1392.dfc87c8","type":"ui_toast","z":"5a05b8f3.894b88","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"Scene File Does Not Exist","name":"Scene FIle Does Not Exist","x":2660,"y":3300,"wires":[[]]},{"id":"48fed0d3.21de3","type":"change","z":"5a05b8f3.894b88","name":"","rules":[{"t":"move","p":"error","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"First Create a Scene with Scene Builder","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2480,"y":3360,"wires":[["a8c1392.dfc87c8"]]},{"id":"452a68d.3c37198","type":"comment","z":"5a05b8f3.894b88","name":"Build a Scene","info":"","x":2090,"y":3940,"wires":[]},{"id":"21b0502c.39d06","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":8,"width":3,"height":1,"passthru":false,"label":"All Inside Off","tooltip":"","color":"","bgcolor":"","icon":"","payload":"All Inside Off","payloadType":"str","topic":"","x":2090,"y":3480,"wires":[["e93ee5ce.3132d8"]]},{"id":"e91d1aee.595d78","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":9,"width":3,"height":1,"passthru":true,"label":"All Outside On","tooltip":"","color":"","bgcolor":"","icon":"","payload":"All Outside On","payloadType":"str","topic":"","x":2100,"y":3520,"wires":[["e93ee5ce.3132d8"]]},{"id":"60c627d2.b86f08","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":10,"width":3,"height":1,"passthru":true,"label":"All Outside Off","tooltip":"","color":"","bgcolor":"","icon":"","payload":"All Outside Off","payloadType":"str","topic":"","x":2100,"y":3560,"wires":[["e93ee5ce.3132d8"]]},{"id":"a40ca2ef.9935e","type":"link in","z":"5a05b8f3.894b88","name":"Scenes","links":["8386d844.59d9b8"],"x":1615,"y":1480,"wires":[["4f494263.b11554"]]},{"id":"8386d844.59d9b8","type":"link out","z":"5a05b8f3.894b88","name":"Scenes","links":["a40ca2ef.9935e"],"x":2775,"y":3540,"wires":[]},{"id":"b2dc26bb.36db38","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":3240,"wires":[["ce87987b.237e58"],[]],"outputLabels":["on/off value","brightness value"]},{"id":"60232257.2aa5ec","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":3120,"wires":[["e304b78f.b9b158"],[]],"outputLabels":["on/off value","brightness value"]},{"id":"92405b43.8f4958","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":840,"wires":[["da5e484.8fa6eb8"],[]],"outputLabels":["on/off value","brightness value"]},{"id":"3fa601fc.eb96de","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":780,"wires":[["c2bb6384.df68e"],[]],"outputLabels":["on/off value","brightness value"]},{"id":"9376002c.7114d","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":720,"wires":[["8529e370.f1b51"],[]],"outputLabels":["on/off value","brightness value"]},{"id":"de8dcc10.e3813","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":2800,"wires":[["93f03e27.b1bfb"],["20b19c12.3d3b14"]],"outputLabels":["on/off value","brightness value"]},{"id":"a677f07b.1b2a2","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":2880,"wires":[["902d1fc4.eed6b"],[]],"outputLabels":["on/off value","brightness value"]},{"id":"14b7f090.bf64ff","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":3000,"wires":[["1aa674fc.20761b"],[]],"outputLabels":["on/off value","brightness value"]},{"id":"1bfae7f5.b28668","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":3060,"wires":[["3e30dd2.93adb22"],[]],"outputLabels":["on/off value","brightness value"]},{"id":"eaebc1ce.365fe","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":2160,"wires":[["be654208.4cb09"],["f908aab5.1110d8"]],"outputLabels":["on/off value","brightness value"]},{"id":"a7564371.a01b7","type":"ui_list","z":"5a05b8f3.894b88","group":"ec9d7f42.8db13","name":"Exclusion List","order":3,"width":"6","height":"6","lineType":"one","actionType":"check","allowHTML":true,"outputs":1,"topic":"/coachproxy/node-red/scenes","x":2800,"y":4260,"wires":[["29002784.452a08"]]},{"id":"414316ff.b86dc8","type":"ui_switch","z":"5a05b8f3.894b88","name":"onmode","label":"Full Brightness w/Light ON","tooltip":"","group":"abfd1685.b229d8","order":2,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"onmode","style":"","onvalue":"100","onvalueType":"num","onicon":"","oncolor":"","offvalue":"125","offvalueType":"num","officon":"","offcolor":"","x":1620,"y":460,"wires":[["a11fdd41.eac12"]]},{"id":"649c120.879dcf","type":"ui_template","z":"5a05b8f3.894b88","group":"abfd1685.b229d8","name":"Lights On Mode","order":1,"width":"6","height":"2","format":"<div>\n<p>\n    By default when turning a dimmable light ON it will revert to the previous brightness level. To force the light to full brightness instead turn this switch ON.\n</p>\n</div>\n","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":1640,"y":420,"wires":[[]]},{"id":"c8e76a34.bcd338","type":"comment","z":"5a05b8f3.894b88","name":"Lights On Mode Option","info":"Lights On Mode Option\nWhen dimmable lights are turned ON, the default brightness will be the previous brightness value. With the switch on the light will revert to full brightness when turned on regardless of the previous brightness level.\nGlobal variable \"onmode\" set to 125 (previous dim level) by default or with switch off. With switch on it will be set to 100 (full brightness).\nThe code for this is located in the `command_dc_dimmer_ervin.js` file","x":1660,"y":380,"wires":[]},{"id":"a58d813b.ec697","type":"split","z":"2fdd8124.05e35e","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"instance","x":750,"y":2200,"wires":[["c206ada0.58542"]],"info":"This section takes the ha-bridge device.db splits it into a stream and in the change node changes the device name and id to the messages required by the ui-list node.\n\npayload.name --> payload.title\npayload.id --> payload.description"},{"id":"f267bbe7.888218","type":"join","z":"2fdd8124.05e35e","name":"","mode":"custom","build":"object","property":"payload","propertyType":"msg","key":"payload.description","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"0.1","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1110,"y":2200,"wires":[["bed0fea6.6dc72"]]},{"id":"8443d370.8f6fc","type":"link in","z":"5a05b8f3.894b88","name":"Scene Builder","links":["bed0fea6.6dc72"],"x":2495,"y":4260,"wires":[["70c55bbc.bc93a4","5c4d16b4.127e88"]]},{"id":"bed0fea6.6dc72","type":"link out","z":"2fdd8124.05e35e","name":"Scene Builder","links":["8443d370.8f6fc"],"x":1215,"y":2200,"wires":[]},{"id":"418d3362.46c6cc","type":"ui_dropdown","z":"5a05b8f3.894b88","name":"","label":"<b>Select Scene</b>","tooltip":"","place":"Select Scene","group":"ec9d7f42.8db13","order":1,"width":0,"height":0,"passthru":true,"options":[{"label":"","value":"Good Morning","type":"str"},{"label":"","value":"Good Evening","type":"str"},{"label":"","value":"Dinnertime","type":"str"},{"label":"","value":"Kitchen","type":"str"},{"label":"","value":"TV Time","type":"str"},{"label":"","value":"Bedtime","type":"str"},{"label":"","value":"All Inside On","type":"str"},{"label":"","value":"All Inside Off","type":"str"},{"label":"","value":"All inside Off","type":"str"},{"label":"","value":"All Outside On","type":"str"},{"label":"","value":"All Outside Off","type":"str"},{"label":"","value":"Scene A","type":"str"},{"label":"","value":"Scene B","type":"str"},{"label":"","value":"Scene C","type":"str"},{"label":"","value":"Scene D","type":"str"},{"label":"","value":"Scene E","type":"str"},{"label":"","value":"Scene F","type":"str"}],"payload":"","topic":"","x":2120,"y":4000,"wires":[["80d55d0d.dbca4","4de22dcf.49a0b4","70618434.bbc80c"]]},{"id":"50b6073a.0b0888","type":"function","z":"5a05b8f3.894b88","name":"Write Scene File","func":"// // (c) 2020 eRVin project Rob Picchione\n//\n// The for loop sends the file path + name and writes the command string for each device to a file\n// on a separate line in format is for use with dc_dimmer.pl. Devices marked as null by the checklist \n// node are not written to the file. The file can be called and played back by a regular dashboard button.\n\nvar scenelist = global.get('scenelist');\nvar file = msg.payload;\nvar description;\n\nfor(let key in scenelist) {\n    if (scenelist[key].command !== null )  {\n        node.send ({filename:file , \n        payload:scenelist[key].description + ' ' + scenelist[key].command + ' ' + scenelist[key].brightness}) ;\n    }\n}\nnode.done();\nreturn;","outputs":1,"noerr":0,"x":2800,"y":4420,"wires":[["f1d0a5c9.d85468"]]},{"id":"c206ada0.58542","type":"function","z":"2fdd8124.05e35e","name":"Updates","func":"// (c) 2020 eRVin project Rob Picchione\n//\n// This function takes the Split output (lights, shades, etc.) from the ha_bridge database \n// and renames the Alexa 'id' to 'description' and Alexa friendly 'name' to 'title'\n// as requiured by the ui_list node.\n// In addition, using the 'description' as a key (also known as 'instance'\n// elsewhere in these flows), it extracts the 'state' (on, off, dim) and 'brightness' \n// values from global context, converts them in to the numeric values needed for \n// dc_dimmer.pl then packages those 4 items up in a new msg.payload where\n// they are joined into a new object by the next node.\n//\n// Note that the delay node prior to the ha-bridge node is required to allow the mqtt message\n// broker enough time to gather the RV-C network status and populate the global context\n// 'status' with actual values.\n\n\nvar description = msg.payload.id;\nvar title = msg.payload.name;\nvar brightness = global.get('status').lights[description].brightness;\nvar state = global.get('status').lights[description].state;\nvar command = (brightness == 100) ? 2 : (brightness > 0) ? 0 : 3;\n\n// alternate code for above to get 'brightness' and 'state' global context variables\n// var lightlist = global.get ('status').lights;\n// var brightness = lightlist[description].brightness;\n// var state = lightlist[description].state;\n\n// Add to the global context data the friendly name associated with the device instance\nglobal.set('status.lights[' + description + '].instancename', title);\n\nmsg.payload = { title, description, command, brightness};\nvar newmsg = { payload: msg.payload};\n\nreturn newmsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":920,"y":2200,"wires":[["f267bbe7.888218"]]},{"id":"a1065790.929ad8","type":"delay","z":"2fdd8124.05e35e","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":340,"y":2260,"wires":[["a4d6128e.0b4f6"]]},{"id":"6c19b8a0.f914a8","type":"change","z":"5a05b8f3.894b88","name":"Reset Scenename","rules":[{"t":"set","p":"payload","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2450,"y":4120,"wires":[["418d3362.46c6cc"]]},{"id":"70c55bbc.bc93a4","type":"change","z":"5a05b8f3.894b88","name":"Define Global Scene Info","rules":[{"t":"move","p":"payload","pt":"msg","to":"scenelist","tot":"global"},{"t":"set","p":"scenepath","pt":"global","to":"/coachproxy/node-red/scenes/","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2670,"y":4300,"wires":[[]]},{"id":"29002784.452a08","type":"function","z":"5a05b8f3.894b88","name":"Build Scene","func":"// (c) 2020 eRVin project Rob Picchione\n//\n// This function loads the scene data for all devices from the 'scenelist' global context\n// then modifies it via a user checklist to EXCLUDE the checked device by adding a null\n// to one or more of the device values. If the same device is subsequently unchecked the \n// device data is written back. builds the scene data. When the user is done excluding devices\n// from the scene clicking the Build Scene button will write command the values to a file\n// formatted for use by dc_dimmer.pl\n\nvar title = msg.payload.title;\nvar description = msg.payload.description;\nvar command = msg.payload.command;\nvar brightness = msg.payload.brightness;\nvar ischecked = (msg.payload.isChecked === true)  ?  'checked'  :  'notchecked'\n\nif (ischecked == 'checked')\n{\n    global.set ('scenelist[' + description + '].command', null);\n    global.set ('scenelist[' + description + '].description', null);\n    global.set ('scenelist[' + description + '].brightness', null);\n    payload = \"data cleared\";\n} else {\n    global.set ('scenelist[' + description + '].command', command);\n    global.set ('scenelist[' + description + '].description', description);\n    global.set ('scenelist[' + description + '].brightness', brightness);\n    payload = \"data restored\";\n    // payload = description + ' ' + command + ' ' + brightness + ' ' + ischecked\n}\n\nmsg = null;\nreturn msg;","outputs":1,"noerr":0,"x":2990,"y":4260,"wires":[[]]},{"id":"a3a97374.24202","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"ec9d7f42.8db13","order":5,"width":5,"height":1,"passthru":false,"label":"Build Scene","tooltip":"","color":"","bgcolor":"","icon":"","payload":"build","payloadType":"str","topic":"","x":2070,"y":4440,"wires":[["acc8efa1.c41fc"]]},{"id":"acc8efa1.c41fc","type":"function","z":"5a05b8f3.894b88","name":"Delete Scene File","func":"// (c) 2020 eRVin project Rob Picchione\n//\n// Define path and delete scene file to prepare for new scene definition\n// Output msg1 adds a delay to ensure sucessful deletion of the scene file\n// before new data is written.\n\n\nif (typeof global.get ('scenename') !== 'object')\n{\n    var file = global.get ('scenepath') + global.get ('scenename') ;\n    var msg1 = { 'payload': file } ;\n    var msg2 = { 'filename': file } ;\n    return [msg1, msg2];\n}\n\nthrow \"Please Choose a Scene Name First\";\n","outputs":2,"noerr":0,"x":2270,"y":4440,"wires":[["ddc69a59.5d2ee8"],["68879880.704998"]]},{"id":"ddc69a59.5d2ee8","type":"delay","z":"5a05b8f3.894b88","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2480,"y":4420,"wires":[["50b6073a.0b0888","eea2aa7d.6f9418"]]},{"id":"68879880.704998","type":"file","z":"5a05b8f3.894b88","name":"Delete Existing Scene File","filename":"","appendNewline":true,"createDir":false,"overwriteFile":"delete","x":2540,"y":4460,"wires":[[]]},{"id":"a0f71aca.fd6aa8","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":11,"width":3,"height":1,"passthru":true,"label":"Scene A","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Scene A","payloadType":"str","topic":"","x":2080,"y":3600,"wires":[["e93ee5ce.3132d8"]]},{"id":"3aa84df4.02acd2","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":12,"width":3,"height":1,"passthru":true,"label":"Scene B","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Scene B","payloadType":"str","topic":"","x":2080,"y":3640,"wires":[["e93ee5ce.3132d8"]]},{"id":"627ccff0.e52f","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":13,"width":3,"height":1,"passthru":true,"label":"Scene C","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Scene C","payloadType":"str","topic":"","x":2080,"y":3680,"wires":[["e93ee5ce.3132d8"]]},{"id":"61c5082f.060b68","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":14,"width":3,"height":1,"passthru":true,"label":"Scene D","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Scene D","payloadType":"str","topic":"","x":2080,"y":3720,"wires":[["e93ee5ce.3132d8"]]},{"id":"bcc95793.5019d8","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":15,"width":3,"height":1,"passthru":true,"label":"Scene E","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Scene E","payloadType":"str","topic":"","x":2080,"y":3760,"wires":[["e93ee5ce.3132d8"]]},{"id":"c3e7fe11.212e","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":16,"width":3,"height":1,"passthru":true,"label":"Scene F","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Scene F","payloadType":"str","topic":"","x":2080,"y":3800,"wires":[["e93ee5ce.3132d8"]]},{"id":"25027f54.3ee4d","type":"ui_toast","z":"5a05b8f3.894b88","position":"top right","displayTime":"5","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"Scene Active","name":"Scene Active","x":2650,"y":3500,"wires":[]},{"id":"79113d89.152874","type":"ui_template","z":"5a05b8f3.894b88","group":"fe130cc1.4b7f6","name":" How to use Scene Builder","order":1,"width":6,"height":6,"format":"<div>\n\nA \"Scene\" is the learned status of a group of lights that can be \"re-played\" with a single button press. The lights in a scene can be either on or off, or on at a particular dim level. A scene can set your desired status of every light all at once, but sometimes it is undesireable for certain lights to be in a particular scene, so there is an Exclusion option which means no action is taken for that light. For example, a scene for <i>All Inside Lights On</i> should exclude doing anything to the outside lights.\n<ol>\n    <li>Scene Builder will automatically capture the current state (on, off, dim level) of all your lights from the network, so first create your scene manually by setting your lights to the desired on, off, or dim state. This can be done either via eRVin, your wall switches, or a combination of both.</li>\n    <li>In <b>Scene Builder</b>, if the list of lights is not displayed below <b>Exclusion List</b>, refresh the browser or select another tab and then reselect the Scenes tab until the checkboxes are visible.</li>\n    <li>Now from the <b>Select Scene</b> dropdown, select the name of the scene you want to use. Remember you must have set your lights to the desired values <i>before</i> selecting a scene name. This kicks off a timeout allowing three minutes to complete the Exclusion List and click Build Scene. </li>\n    <li>In the <b>Exclusion Checklist</b> check the box for all devices you do NOT want to be controlled by the scene. For example, for <i>All Inside Lights On</i> you would check the boxes for all of the outside lights because for this scene you don't want them to be changed from whatever state they may be in.</li>\n    <li>Click the <b>Build Scene</b> button at the bottom of the Exclusion List, the scene  will now be created.</li>\n    <li>Now the corresponding button in <b>Scene Control</b> will activate the scene.</li>\n</ol>\n\n</div>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":2450,"y":3620,"wires":[[]]},{"id":"b7f99bc8.144898","type":"ui_template","z":"5a05b8f3.894b88","group":"ec9d7f42.8db13","name":"Exclusion List Title","order":2,"width":0,"height":0,"format":"<div>\n    <p>\n    <br><b>Exclusion List:</b>\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":2430,"y":3660,"wires":[[]]},{"id":"ba59c5e2.859b28","type":"ui_toast","z":"5a05b8f3.894b88","position":"top right","displayTime":"3","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"Building Scene","name":"Building Scene","x":3040,"y":4480,"wires":[]},{"id":"5c4d16b4.127e88","type":"delay","z":"5a05b8f3.894b88","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2620,"y":4260,"wires":[["a7564371.a01b7"]]},{"id":"80d55d0d.dbca4","type":"link out","z":"5a05b8f3.894b88","name":"Trigger Scenelist","links":["ec305532.271878"],"x":2335,"y":4040,"wires":[]},{"id":"ec305532.271878","type":"link in","z":"2fdd8124.05e35e","name":"Trigger Scenelist","links":["80d55d0d.dbca4"],"x":355,"y":2200,"wires":[["a4d6128e.0b4f6"]]},{"id":"eea2aa7d.6f9418","type":"change","z":"5a05b8f3.894b88","name":"Clear Scene Selection & Reload Scene List","rules":[{"t":"set","p":"payload","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2250,"y":4220,"wires":[["418d3362.46c6cc"]]},{"id":"e0c6668f.500e68","type":"catch","z":"5a05b8f3.894b88","name":"Build Scene Error","scope":["acc8efa1.c41fc"],"uncaught":false,"x":2080,"y":4540,"wires":[["73540a33.522fe4"]]},{"id":"8af09880.0024e8","type":"ui_toast","z":"5a05b8f3.894b88","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"Build Scene Error","name":"Please Choose a Scene Name First","x":2400,"y":4540,"wires":[[]]},{"id":"73540a33.522fe4","type":"change","z":"5a05b8f3.894b88","name":"","rules":[{"t":"move","p":"error","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"Please Choose a Scene Name First","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2200,"y":4600,"wires":[["8af09880.0024e8"]]},{"id":"ea3cc224.82ac8","type":"complete","z":"5a05b8f3.894b88","name":"Scene Build Complete","scope":["50b6073a.0b0888"],"uncaught":false,"x":2820,"y":4480,"wires":[["ba59c5e2.859b28"]]},{"id":"4de22dcf.49a0b4","type":"function","z":"5a05b8f3.894b88","name":"Timeout","func":"// (c) 2020 eRVin project Rob Picchione\n// \n// This function performs a timeout reset of the scenename. If a scenename is selected but the Build Scene\n// button is not activated it can create a situation where the incorrect scenename is saved\n// in the global variable. After the sceneame is selected, if the Build Scene button is not activated\n// the scenename is reset to 'empty' and the dashboard button is also reset.\n\nvar scenename = msg.payload\n// var frominput = msg._frominput\n\nif (msg._fromInput === true)\n{\n    msg = {'reset':true} \n    global.set ('scenename', [])\n    return msg;\n} else \n{\n    global.set ('scenename', msg.payload)\n    msg = { 'payload': scenename } ;\n    return msg;\n}\n","outputs":1,"noerr":0,"x":2380,"y":4000,"wires":[["a2eeaddb.f342e"]]},{"id":"a2eeaddb.f342e","type":"delay","z":"5a05b8f3.894b88","name":"","pauseType":"delayv","timeout":"4","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":2540,"y":4000,"wires":[["6c19b8a0.f914a8","e7e89320.0851e"]]},{"id":"82216071.55df1","type":"change","z":"2fdd8124.05e35e","name":"Init Scenename","rules":[{"t":"set","p":"scenename","pt":"global","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":360,"y":2300,"wires":[[]]},{"id":"d27961fd.c7a35","type":"ui_ui_control","z":"5a05b8f3.894b88","name":"","events":"change","x":2580,"y":2460,"wires":[[]]},{"id":"9b0f7310.0bf71","type":"ui_switch","z":"5a05b8f3.894b88","name":"Aquahot","label":"Aquahot","tooltip":"","group":"dd035f6c.5d73e","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"tabs\":{\"hide\":\"Aquahot\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"tabs\":{\"show\":\"Aquahot\"}}","offvalueType":"json","officon":"","offcolor":"","x":2100,"y":2220,"wires":[["d27961fd.c7a35","41f0225f.29879c"]]},{"id":"e0684432.74ca78","type":"ui_switch","z":"5a05b8f3.894b88","name":"Alexa","label":"Alexa","tooltip":"","group":"dd035f6c.5d73e","order":7,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"tabs\":{\"hide\":\"Alexa\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"tabs\":{\"show\":\"Alexa\"}}","offvalueType":"json","officon":"","offcolor":"","x":2090,"y":2380,"wires":[["d27961fd.c7a35","41f0225f.29879c"]]},{"id":"ed2a5854.b69aa8","type":"ui_switch","z":"5a05b8f3.894b88","name":"Status","label":"Status","tooltip":"","group":"dd035f6c.5d73e","order":6,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"tabs\":{\"hide\":\"Status\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"tabs\":{\"show\":\"Status\"}}","offvalueType":"json","officon":"","offcolor":"","x":2090,"y":2300,"wires":[["d27961fd.c7a35","41f0225f.29879c"]]},{"id":"9181d539.f61da8","type":"ui_switch","z":"5a05b8f3.894b88","name":"Locks","label":"Locks","tooltip":"","group":"dd035f6c.5d73e","order":5,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"tabs\":{\"hide\":\"Locks\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"tabs\":{\"show\":\"Locks\"}}","offvalueType":"json","officon":"","offcolor":"","x":2090,"y":2260,"wires":[["d27961fd.c7a35","41f0225f.29879c"]]},{"id":"92a2e3dc.7ffea","type":"ui_switch","z":"5a05b8f3.894b88","name":"Shades","label":"Shades","tooltip":"","group":"dd035f6c.5d73e","order":3,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"tabs\":{\"hide\":\"Shades\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"tabs\":{\"show\":\"Shades\"}}","offvalueType":"json","officon":"","offcolor":"","x":2100,"y":2180,"wires":[["d27961fd.c7a35","41f0225f.29879c"]]},{"id":"92c98fb6.69326","type":"ui_switch","z":"5a05b8f3.894b88","name":"Notifications","label":"Notifications","tooltip":"","group":"dd035f6c.5d73e","order":8,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"tabs\":{\"hide\":\"Notifications\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"tabs\":{\"show\":\"Notifications\"}}","offvalueType":"json","officon":"","offcolor":"","x":2110,"y":2420,"wires":[["d27961fd.c7a35","41f0225f.29879c"]]},{"id":"a3987d3d.13a64","type":"ui_switch","z":"5a05b8f3.894b88","name":"System","label":"System","tooltip":"","group":"dd035f6c.5d73e","order":9,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"tabs\":{\"hide\":\"System\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"tabs\":{\"show\":\"System\"}}","offvalueType":"json","officon":"","offcolor":"","x":2100,"y":2460,"wires":[["d27961fd.c7a35","41f0225f.29879c"]]},{"id":"94ee6a6d.53ccc8","type":"ui_template","z":"5a05b8f3.894b88","group":"dd035f6c.5d73e","name":"Show/Hide Tabs","order":1,"width":"6","height":"1","format":"<div><p>Hide unneeded main menu tabs. Turn the switch on to hide the tab.</p></div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":2600,"y":2500,"wires":[[]]},{"id":"d624cecb.3fa02","type":"ui_switch","z":"5a05b8f3.894b88","name":"Exterior/Awnings","label":"Exterior/Awnings","tooltip":"","group":"c2caa18b.132cd","order":5,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"group\":{\"hide\":\"Exterior_Awnings\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"group\":{\"show\":\"Exterior_Awnings\"}}","offvalueType":"json","officon":"","offcolor":"","x":2130,"y":2560,"wires":[["d27961fd.c7a35","8a643317.4b405"]]},{"id":"9a0635ed.3d9788","type":"ui_switch","z":"5a05b8f3.894b88","name":"Aquahot/Water Pump","label":"Aquahot/Water Pump","tooltip":"","group":"c2caa18b.132cd","order":6,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"group\":{\"hide\":\"Aquahot_Water_Pump\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"group\":{\"show\":\"Aquahot_Water_Pump\"}}","offvalueType":"json","officon":"","offcolor":"","x":2140,"y":2600,"wires":[["d27961fd.c7a35","8a643317.4b405"]]},{"id":"68ca12a6.017f7c","type":"ui_template","z":"5a05b8f3.894b88","group":"c2caa18b.132cd","name":"Show/Hide Groups","order":1,"width":"6","height":"1","format":"<div><p>Hide unneeded sub panels (groups). Turn the switch on to hide the group.</p></div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":2610,"y":2540,"wires":[[]]},{"id":"d5eefffc.a2669","type":"ui_switch","z":"5a05b8f3.894b88","name":"Scenes","label":"Scenes","tooltip":"","group":"dd035f6c.5d73e","order":2,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"tabs\":{\"hide\":\"Scenes\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"tabs\":{\"show\":\"Scenes\"}}","offvalueType":"json","officon":"","offcolor":"","x":2100,"y":2140,"wires":[["d27961fd.c7a35","41f0225f.29879c"]]},{"id":"6ff1784.4905788","type":"exec","z":"2fdd8124.05e35e","command":"vcgencmd measure_temp","addpay":false,"append":"","useSpawn":"","timer":"","name":"RPi Temp.","x":390,"y":2640,"wires":[["a8306e37.1aea1"],[],[]]},{"id":"b5aead74.45e12","type":"inject","z":"2fdd8124.05e35e","name":"","props":[{"p":"payload","v":"","vt":"date"},{"p":"topic","v":"","vt":"string"}],"repeat":"5","crontab":"","once":false,"topic":"","payload":"","payloadType":"date","x":190,"y":2680,"wires":[["6ff1784.4905788","72ad22de.f531cc"]]},{"id":"a8306e37.1aea1","type":"function","z":"2fdd8124.05e35e","name":"","func":"str = msg.payload\nmsg.payload = str.substring(5,9);\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":2640,"wires":[["673d497b.d99438"]]},{"id":"72ad22de.f531cc","type":"exec","z":"2fdd8124.05e35e","command":"top -d 0.5 -b -n2 | grep \"Cpu(s)\"|tail -n 1 | awk '{print $2 + $4}'","addpay":false,"append":"","useSpawn":"","timer":"","name":"CPU Load","x":390,"y":2720,"wires":[["7ca1d2d2.e6c56c"],[],[]]},{"id":"673d497b.d99438","type":"ui_text","z":"2fdd8124.05e35e","group":"97b9ad54.9933e","order":2,"width":0,"height":0,"name":"","label":"CPU Temp C","format":"{{msg.payload}}","layout":"row-spread","x":720,"y":2640,"wires":[]},{"id":"7ca1d2d2.e6c56c","type":"ui_text","z":"2fdd8124.05e35e","group":"97b9ad54.9933e","order":3,"width":0,"height":0,"name":"","label":"CPU Load %","format":"{{msg.payload}}","layout":"row-spread","x":710,"y":2720,"wires":[]},{"id":"abe22ccd.3d812","type":"file in","z":"2fdd8124.05e35e","name":"Get RPi Model","filename":"/proc/device-tree/model","format":"lines","chunk":false,"sendError":false,"x":400,"y":2800,"wires":[["23928d8.3251672"]]},{"id":"c24175b1.66b958","type":"inject","z":"2fdd8124.05e35e","name":"","props":[{"p":"payload","v":"","vt":"date"},{"p":"topic","v":"","vt":"string"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.6","topic":"","payload":"","payloadType":"date","x":190,"y":2820,"wires":[["abe22ccd.3d812","7bb0179a.03d168"]]},{"id":"23928d8.3251672","type":"ui_text","z":"2fdd8124.05e35e","group":"97b9ad54.9933e","order":1,"width":0,"height":0,"name":"RPi Model","label":"","format":"{{msg.payload}}","layout":"row-left","x":710,"y":2800,"wires":[]},{"id":"a04336c0.d5d3f8","type":"comment","z":"2fdd8124.05e35e","name":"Get Add'l Raspberry Pi Info","info":"","x":230,"y":2580,"wires":[]},{"id":"caa02104.da274","type":"ui_switch","z":"5a05b8f3.894b88","name":"Scenes/How to use Scene Builder","label":"Scenes/How to use Scene Builder","tooltip":"","group":"c2caa18b.132cd","order":3,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"group\":{\"hide\":\"Scenes_How_to_use_Scene_Builder\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"group\":{\"show\":\"Scenes_How_to_use_Scene_Builder\"}}","offvalueType":"json","officon":"","offcolor":"","x":2180,"y":2680,"wires":[["d27961fd.c7a35","8a643317.4b405"]]},{"id":"70feaae0.b7a494","type":"ui_switch","z":"5a05b8f3.894b88","name":"Scenes/Scene Builder","label":"Scenes/Scene Builder","tooltip":"","group":"c2caa18b.132cd","order":2,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"group\":{\"hide\":\"Scenes_Scene_Builder\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"group\":{\"show\":\"Scenes_Scene_Builder\"}}","offvalueType":"json","officon":"","offcolor":"","x":2140,"y":2640,"wires":[["d27961fd.c7a35","8a643317.4b405"]]},{"id":"7e50e4e6.c8f7fc","type":"comment","z":"5a05b8f3.894b88","name":"Show/Hide Tabs","info":"","x":2120,"y":2100,"wires":[]},{"id":"c0364c1.48224b","type":"comment","z":"5a05b8f3.894b88","name":"Light Master","info":"turn lights off with mem off and state will be remembered. turn on with mem on and lights are restored to previous value. All on turns on everything.","x":1630,"y":160,"wires":[]},{"id":"2904a8af.2151e8","type":"ui_switch","z":"5a05b8f3.894b88","name":"Interior/Memory Master","label":"Interior/Memory Master","tooltip":"","group":"c2caa18b.132cd","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"group\":{\"hide\":\"Interior_Memory_Master\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"group\":{\"show\":\"Interior_Memory_Master\"}}","offvalueType":"json","officon":"","offcolor":"","x":2150,"y":2720,"wires":[["d27961fd.c7a35","8a643317.4b405"]]},{"id":"e7e89320.0851e","type":"function","z":"5a05b8f3.894b88","name":"Timeout Msg","func":"throw \"Timeout - After choosing a Scene Name, please complete the scene by clicking Build Scene\";","outputs":1,"noerr":0,"x":2770,"y":4000,"wires":[[]]},{"id":"ec95a453.b6f588","type":"catch","z":"5a05b8f3.894b88","name":"Timeout Msg","scope":["e7e89320.0851e"],"uncaught":false,"x":2650,"y":4080,"wires":[["9374ab7c.fe0718"]]},{"id":"c1a9a460.612d68","type":"ui_toast","z":"5a05b8f3.894b88","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"Scene Name Timeout","name":"Scene Name Timeout","x":2950,"y":4080,"wires":[[]]},{"id":"9374ab7c.fe0718","type":"change","z":"5a05b8f3.894b88","name":"","rules":[{"t":"move","p":"error","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"After choosing a Scene Name, please complete the scene by clicking the Build Scene button.","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2780,"y":4140,"wires":[["c1a9a460.612d68"]]},{"id":"d47d5a9b.12cdd8","type":"ui_button","z":"5a05b8f3.894b88","name":"Cancel","group":"ec9d7f42.8db13","order":4,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"#8D4040","icon":"replay","payload":"cancel","payloadType":"str","topic":"","x":2060,"y":4400,"wires":[["322841bd.7c628e"]]},{"id":"322841bd.7c628e","type":"change","z":"5a05b8f3.894b88","name":"","rules":[{"t":"move","p":"payload","pt":"msg","to":"reset","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2100,"y":4180,"wires":[["418d3362.46c6cc"]]},{"id":"a1e78f3f.d1f35","type":"function","z":"5a05b8f3.894b88","name":"Redirect","func":"//Splits the output into flow1 for lights and flow2 for panel backlights.\n//\npayload = msg.payload;\nvar instance = msg.payload.split(' ')[0];\n\nif (instance <= 60)\n{\n    var msg1 = {payload: msg.payload};\n    return [msg1, null];\n}\n\nvar state = 126 //figure out a way to get this value from instance #\nvar brightness = msg.payload.split(' ')[2];\n\nvar msg2 = {'payload': state + ' ' + brightness}\nreturn [null, msg2];","outputs":2,"noerr":0,"x":2620,"y":3560,"wires":[["8386d844.59d9b8"],["60d2fba3.9e8cd4"]]},{"id":"2959b7ca.912418","type":"link in","z":"5a05b8f3.894b88","name":"Scene Panel Lights","links":["60d2fba3.9e8cd4"],"x":2535,"y":160,"wires":[["f9363c14.d66b"]]},{"id":"60d2fba3.9e8cd4","type":"link out","z":"5a05b8f3.894b88","name":"Scene Panel Lights","links":["2959b7ca.912418"],"x":2775,"y":3580,"wires":[]},{"id":"76dcb995.a69628","type":"function","z":"5a05b8f3.894b88","name":"","func":"\nvar command = 126;\nvar instance = 100;\nvar brightness = msg.payload.brightness;\nvar instancename = global.get('status').lights[instance].instancename;\n\n\n//figure out a way to get the instance from the instancename\n//var scenelist = global.get('scenelist');\n\nglobal.set('status.lights[' + instance + '].state', command);\nglobal.set('status.lights[' + instance + '].brightness', brightness);\nglobal.set('status.lights[' + instance + '].instancename', instancename);\n\nreturn msg;\n\n\n/*\nObject.prototype.getKey = function(value){\n  for(var key in scenelist.title){\n    if(scenelist.title[key] == value){\n      return key;\n    }\n  }\n  return 'null';\n};\n\n//var key = languageCodes.getKey('Greek');\nvar key = [scenelist].getKey('Panel Lights');\n*/","outputs":1,"noerr":0,"x":1770,"y":80,"wires":[["a0c0d1db.0ba1e","90b01324.960d5"]]},{"id":"7e3eca66.93ae34","type":"ui_switch","z":"5a05b8f3.894b88","name":"Status/Power","label":"Status/Power","tooltip":"","group":"c2caa18b.132cd","order":7,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"group\":{\"hide\":\"Status_Power\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"group\":{\"show\":\"Status_Power\"}}","offvalueType":"json","officon":"","offcolor":"","x":2120,"y":2760,"wires":[["d27961fd.c7a35","8a643317.4b405"]]},{"id":"70ddbd93.392054","type":"ui_switch","z":"5a05b8f3.894b88","name":"Status/Generator","label":"Status/Generator","tooltip":"","group":"c2caa18b.132cd","order":8,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"group\":{\"hide\":\"Status_Generator\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"group\":{\"show\":\"Status_Generator\"}}","offvalueType":"json","officon":"","offcolor":"","x":2130,"y":2800,"wires":[["d27961fd.c7a35","8a643317.4b405"]]},{"id":"3debed08.8278b2","type":"comment","z":"5a05b8f3.894b88","name":"Show/Hide Groups","info":"","x":2130,"y":2520,"wires":[]},{"id":"7bb0179a.03d168","type":"exec","z":"2fdd8124.05e35e","command":"lsb_release -a","addpay":false,"append":"","useSpawn":"","timer":"","name":"RPi Release","x":390,"y":2860,"wires":[["4c30c495.24846c"],[],[]]},{"id":"7db88a8b.6a59b4","type":"ui_text","z":"2fdd8124.05e35e","group":"97b9ad54.9933e","order":1,"width":0,"height":0,"name":"Raspian Version","label":"","format":"{{msg.payload}}","layout":"row-left","x":820,"y":2860,"wires":[]},{"id":"4c30c495.24846c","type":"csv","z":"2fdd8124.05e35e","name":"","sep":"\\t","hdrin":"","hdrout":"","multi":"mult","ret":"\\n","temp":"","skip":"1","strings":true,"x":570,"y":2920,"wires":[["f64cef8f.93259"]]},{"id":"f64cef8f.93259","type":"change","z":"2fdd8124.05e35e","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.0.col2","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":2860,"wires":[["7db88a8b.6a59b4"]]},{"id":"c5b4b8df.138d88","type":"link in","z":"5a05b8f3.894b88","name":"GPS","links":["d282e6c3.8f6788"],"x":1615,"y":1240,"wires":[["4f494263.b11554"]]},{"id":"be654208.4cb09","type":"ui_switch","z":"5a05b8f3.894b88","name":"28_Main_EdgeAccent","label":"Edge Accent","tooltip":"","group":"2e0a52f8.6acbee","order":13,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"28_state_Living Room Edge Accent","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":900,"y":2140,"wires":[["ba8aebb.ea06618"]]},{"id":"f908aab5.1110d8","type":"ui_slider","z":"5a05b8f3.894b88","name":"28_Main_EdgeAccent_brightness","label":"","tooltip":"","group":"2e0a52f8.6acbee","order":14,"width":3,"height":1,"passthru":false,"outs":"end","topic":"28_brightness","min":"1","max":"100","step":"","x":860,"y":2180,"wires":[["ba8aebb.ea06618"]]},{"id":"20b19c12.3d3b14","type":"ui_slider","z":"5a05b8f3.894b88","name":"36_Main_Hutch_brightness","label":"","tooltip":"","group":"2e0a52f8.6acbee","order":22,"width":3,"height":1,"passthru":false,"outs":"end","topic":"36_brightness","min":"1","max":"100","step":"","x":880,"y":2820,"wires":[["ba8aebb.ea06618"]]},{"id":"93f03e27.b1bfb","type":"ui_switch","z":"5a05b8f3.894b88","name":"36_Main_Hutch","label":"Hutch","tooltip":"","group":"2e0a52f8.6acbee","order":21,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"36_state_Hutch Lights","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":920,"y":2780,"wires":[["ba8aebb.ea06618"]]},{"id":"340c59d6.8c75c6","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":2940,"wires":[["2d1351ee.4840fe"],[]],"outputLabels":["on/off value","brightness value"]},{"id":"bc502eba.b0b12","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":1760,"wires":[["21309d67.8efe4a"],["36b5f55f.b2f8d2"]],"outputLabels":["on/off value","brightness value"]},{"id":"c1d41b37.eaf988","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":3180,"wires":[["6462abc1.33600c"],[]],"outputLabels":["on/off value","brightness value"]},{"id":"3c2b2f01.70441","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/12","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":900,"wires":[[]]},{"id":"477b2241.4c1adc","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/6","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":150,"y":540,"wires":[["d5706edb.8349a"]]},{"id":"d5706edb.8349a","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":540,"wires":[["283713ce.743e8c"],[]],"outputLabels":["on/off value","brightness value"]},{"id":"ce5574b8.ee8ca8","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/8","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":150,"y":660,"wires":[["e0c625f7.e59e38"]]},{"id":"e0c625f7.e59e38","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":660,"wires":[["280d22e0.94620e"],[]],"outputLabels":["on/off value","brightness value"]},{"id":"280d22e0.94620e","type":"ui_switch","z":"5a05b8f3.894b88","name":"8_AH_Preheat","label":"Preheat","tooltip":"","group":"cf9b6bb9.e5ef38","order":3,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"8_state_Aquahot Preheat","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":920,"y":660,"wires":[["ba8aebb.ea06618"]]},{"id":"f980807a.83c5f","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":2,"x":540,"y":600,"wires":[["598a18fa.e0ba78"],[]],"outputLabels":["on/off value","brightness value"]},{"id":"354c94bb.c9748c","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/7","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":150,"y":600,"wires":[["f980807a.83c5f"]]},{"id":"a340439.86709c","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/24","qos":"0","datatype":"json","broker":"c1170463.5c7f8","x":160,"y":1840,"wires":[[]]},{"id":"598a18fa.e0ba78","type":"ui_switch","z":"5a05b8f3.894b88","name":"7_AH_Electric","label":"Electric","tooltip":"","group":"cf9b6bb9.e5ef38","order":1,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"7_state_Aquahot Burner","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":920,"y":600,"wires":[["ba8aebb.ea06618"]]},{"id":"49eb607b.43a27","type":"ui_switch","z":"5a05b8f3.894b88","name":"Location","label":"Location","tooltip":"","group":"dd035f6c.5d73e","order":6,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"tabs\":{\"hide\":\"Location\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"tabs\":{\"show\":\"Location\"}}","offvalueType":"json","officon":"","offcolor":"","x":2100,"y":2340,"wires":[["d27961fd.c7a35","41f0225f.29879c"]]},{"id":"902d1fc4.eed6b","type":"ui_switch","z":"5a05b8f3.894b88","name":"38_Ext_Water Pump","label":"Water Pump","tooltip":"","group":"cae5b35a.e3024","order":2,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"37_state_Water Pump","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":900,"y":2880,"wires":[["ba8aebb.ea06618"]]},{"id":"8d944c36.f329b","type":"ui_button","z":"5a05b8f3.894b88","d":true,"name":"/ds_slide_end_5_night_up/","group":"5a6f1f47.88d1c","order":18,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"5","x":3460,"y":2520,"wires":[["5a45bd75.3ba2b4"]]},{"id":"a7df515f.690b5","type":"ui_button","z":"5a05b8f3.894b88","d":true,"name":"/ds_slide_end_5_night_down/","group":"5a6f1f47.88d1c","order":20,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"5","x":3470,"y":2600,"wires":[["5a45bd75.3ba2b4"]]},{"id":"9b9f9164.0d927","type":"ui_button","z":"5a05b8f3.894b88","d":true,"name":"/ds_slide_end_5_day_up/","group":"5a6f1f47.88d1c","order":17,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"5","x":3450,"y":2480,"wires":[["5a45bd75.3ba2b4"]]},{"id":"58330ec9.8f6ed","type":"ui_button","z":"5a05b8f3.894b88","d":true,"name":"/ds_slide_end_5_day_down/","group":"5a6f1f47.88d1c","order":19,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"5","x":3460,"y":2560,"wires":[["5a45bd75.3ba2b4"]]},{"id":"875e8c8a.5d873","type":"ui_template","z":"5a05b8f3.894b88","d":true,"group":"5a6f1f47.88d1c","name":"/ds_slide_end_5/","order":16,"width":"6","height":"1","format":"<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>DS Slide End</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":3430,"y":2440,"wires":[[]]},{"id":"7dc8b4aa.78a1cc","type":"ui_button","z":"5a05b8f3.894b88","name":"/ent_center_6_night_up/","group":"5a6f1f47.88d1c","order":13,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"6","x":3450,"y":2960,"wires":[["5a45bd75.3ba2b4"]]},{"id":"b4f24073.1361a","type":"ui_button","z":"5a05b8f3.894b88","name":"/ent_center_6_night_down/","group":"5a6f1f47.88d1c","order":15,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"6","x":3460,"y":3040,"wires":[["5a45bd75.3ba2b4"]]},{"id":"ca62de06.e639f","type":"ui_button","z":"5a05b8f3.894b88","name":"/ent_center_6_day_up/","group":"5a6f1f47.88d1c","order":12,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"6","x":3440,"y":2920,"wires":[["5a45bd75.3ba2b4"]]},{"id":"1691f00.f216c1","type":"ui_button","z":"5a05b8f3.894b88","name":"/ent_center_6_day_down/","group":"5a6f1f47.88d1c","order":14,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"6","x":3450,"y":3000,"wires":[["5a45bd75.3ba2b4"]]},{"id":"cdaea80d.7c6c38","type":"ui_template","z":"5a05b8f3.894b88","group":"5a6f1f47.88d1c","name":"/ent_center_6/","order":11,"width":"6","height":"1","format":"<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>Ent Center</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":3420,"y":2880,"wires":[[]]},{"id":"57d055b7.fc4aac","type":"ui_button","z":"5a05b8f3.894b88","name":"/pseat_window_17_night_up/","group":"ae3b3824.48abe8","order":23,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"17","x":3460,"y":2300,"wires":[["5a45bd75.3ba2b4"]]},{"id":"badc2697.b24f88","type":"ui_button","z":"5a05b8f3.894b88","name":"/pseat_window_17_night_down/","group":"ae3b3824.48abe8","order":25,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"17","x":3470,"y":2380,"wires":[["5a45bd75.3ba2b4"]]},{"id":"f534772d.5a9228","type":"ui_button","z":"5a05b8f3.894b88","name":"/pseat_window_17_day_up/","group":"ae3b3824.48abe8","order":22,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"17","x":3460,"y":2260,"wires":[["5a45bd75.3ba2b4"]]},{"id":"2beb92c8.dbddde","type":"ui_button","z":"5a05b8f3.894b88","name":"/pseat_window_17_day_down/","group":"ae3b3824.48abe8","order":24,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"17","x":3470,"y":2340,"wires":[["5a45bd75.3ba2b4"]]},{"id":"4bcd5f2a.d9ddf","type":"ui_template","z":"5a05b8f3.894b88","group":"ae3b3824.48abe8","name":"/pseat_window_17/","order":21,"width":"6","height":"1","format":"<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>Passenger Seat</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":3430,"y":2220,"wires":[[]]},{"id":"625a2a8.f46b9d4","type":"ui_template","z":"5a05b8f3.894b88","group":"5725fb8d.051db4","name":"/cab_master/","order":6,"width":"6","height":"1","format":"<!DOCTYPE html>\n<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>Cab Master</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":3410,"y":680,"wires":[[]]},{"id":"107e7b31.7589c5","type":"ui_button","z":"5a05b8f3.894b88","name":"/cab_master_night_up/","group":"5725fb8d.051db4","order":8,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"1 2 3 4 17","x":3440,"y":760,"wires":[["5a45bd75.3ba2b4"]]},{"id":"68517efc.ad07","type":"ui_button","z":"5a05b8f3.894b88","name":"/cab_master_night_down/","group":"5725fb8d.051db4","order":10,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"1 2 3 4 17","x":3450,"y":840,"wires":[["5a45bd75.3ba2b4"]]},{"id":"66734e3d.527ca","type":"ui_button","z":"5a05b8f3.894b88","name":"/cab_master_day_up/","group":"5725fb8d.051db4","order":7,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"1 2 3 4 17","x":3440,"y":720,"wires":[["5a45bd75.3ba2b4"]]},{"id":"d332f7ba.4e4de8","type":"ui_button","z":"5a05b8f3.894b88","name":"/cab_master_day_down/","group":"5725fb8d.051db4","order":9,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"1 2 3 4 17","x":3450,"y":800,"wires":[["5a45bd75.3ba2b4"]]},{"id":"d4ee8ec3.89ed1","type":"ui_template","z":"5a05b8f3.894b88","group":"5725fb8d.051db4","name":"/lr_master/","order":11,"width":"6","height":"1","format":"<!DOCTYPE html>\n<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>Living Room Master</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":3410,"y":900,"wires":[[]]},{"id":"2418ae48.659112","type":"ui_button","z":"5a05b8f3.894b88","name":"/lr_master_night_up/","group":"5725fb8d.051db4","order":13,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"5 6 7 8","x":3440,"y":980,"wires":[["5a45bd75.3ba2b4"]]},{"id":"2a5149b6.23d136","type":"ui_button","z":"5a05b8f3.894b88","name":"/lr_master_night_down/","group":"5725fb8d.051db4","order":15,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"5 6 7 8","x":3450,"y":1060,"wires":[["5a45bd75.3ba2b4"]]},{"id":"bc1bbb64.e89bb8","type":"ui_button","z":"5a05b8f3.894b88","name":"/lr_master_day_up/","group":"5725fb8d.051db4","order":12,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"5 6 7 8","x":3430,"y":940,"wires":[["5a45bd75.3ba2b4"]]},{"id":"c61072a0.ef868","type":"ui_button","z":"5a05b8f3.894b88","name":"/lr_master_day_down/","group":"5725fb8d.051db4","order":14,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"5 6 7 8","x":3440,"y":1020,"wires":[["5a45bd75.3ba2b4"]]},{"id":"3c29a9c4.551016","type":"ui_template","z":"5a05b8f3.894b88","group":"5725fb8d.051db4","name":"/bed_master/","order":16,"width":"6","height":"1","format":"<!DOCTYPE html>\n<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>Bedroom Master</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":3410,"y":1120,"wires":[[]]},{"id":"b1596a5d.09a098","type":"ui_button","z":"5a05b8f3.894b88","name":"/bed_master_night_up/","group":"5725fb8d.051db4","order":18,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"9 10","x":3440,"y":1200,"wires":[["5a45bd75.3ba2b4"]]},{"id":"38e04b6b.e8bc74","type":"ui_button","z":"5a05b8f3.894b88","name":"/bed_master_night_down/","group":"5725fb8d.051db4","order":20,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"9 10","x":3450,"y":1280,"wires":[["5a45bd75.3ba2b4"]]},{"id":"dd2da6a9.4c58e8","type":"ui_button","z":"5a05b8f3.894b88","name":"/bed_master_day_up/","group":"5725fb8d.051db4","order":17,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"9 10","x":3440,"y":1160,"wires":[["5a45bd75.3ba2b4"]]},{"id":"e1156209.d0e4d","type":"ui_button","z":"5a05b8f3.894b88","name":"/bed_master_day_down/","group":"5725fb8d.051db4","order":19,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"9 10","x":3450,"y":1240,"wires":[["5a45bd75.3ba2b4"]]},{"id":"69df32bd.da144c","type":"comment","z":"f6c367c2.63b9b8","name":"Old Coachproxy Configurator","info":"","x":170,"y":60,"wires":[]},{"id":"295ce0fe.8eb4a","type":"inject","z":"f6c367c2.63b9b8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.5","topic":"","payload":"","payloadType":"date","x":250,"y":1960,"wires":[["3d9a5063.d365"]]},{"id":"7544e81a.afed08","type":"change","z":"2fdd8124.05e35e","name":"Light List","rules":[{"t":"set","p":"lights","pt":"msg","to":"[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":260,"y":80,"wires":[["8a3a4af9.460768"]]},{"id":"83613dd1.8729","type":"comment","z":"5a05b8f3.894b88","name":"Locks","info":"","x":1540,"y":720,"wires":[]},{"id":"aaab3715.944c68","type":"ui_switch","z":"5a05b8f3.894b88","name":"sofasconcemode","label":"Make Sofa/Sconce Dimmable","tooltip":"","group":"f91d30ee.81533","order":2,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"sofasconcemode","style":"","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"on","offvalueType":"str","officon":"","offcolor":"","x":1650,"y":600,"wires":[["eacad62c.301c28"]]},{"id":"e2ae75ba.f30548","type":"ui_template","z":"5a05b8f3.894b88","group":"f91d30ee.81533","name":"Sofa/Sconce Mode","order":1,"width":"0","height":"0","format":"<div>\n<p>\n    Entegra combines the sofa overhead task lighting with the sofa sconce mood lighting. The overhead task lights are touch activated pucks and therefore non-dimmable so the entire circuit remains non-dimmable including the sconces. Replace the overhead task pucks with no-touch dimmable versions and this circuit can be made dimmable. To make the Sofa/Sconce circuit dimmable turn this switch ON.\n</p>\n</div>\n","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":1650,"y":560,"wires":[[]]},{"id":"84a72133.e8c38","type":"comment","z":"5a05b8f3.894b88","name":"Sofa/Sconce Dim Mode Option","info":"Sofa/Sconce Dim Mode Option\nThe Sofa/Sconce light circuit on 2017 and newer Entegra coaches is a dimmable circuit, however annoyingly it contains non-dimmable task lighting (overhead pucks) AND dimmable mood lighting (sconces). These SHOULD be on separate circuits.\nThe wall switch is programmed to NOT allow dimming.\nThe overhead pucks are touch activated and for that reason do not work properly when dimmed. If those pucks are replaced with non-touch dimmable versions, the entire circuit can be dimmed.\nThis option provides for that setting.\nThe code for this is located in the main node at the output of the brightness dashboard node.","x":1690,"y":520,"wires":[]},{"id":"ebb198dc.6a1718","type":"inject","z":"5a05b8f3.894b88","name":"Init at start","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.3","topic":"","payload":"","payloadType":"date","x":1150,"y":520,"wires":[["617f1205.f5203c","85d8cd27.cac9a","34faac01.43f524","9e426ec2.bde2b"]]},{"id":"a11fdd41.eac12","type":"change","z":"5a05b8f3.894b88","name":"set onmode","rules":[{"t":"set","p":"options.onmode","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1850,"y":460,"wires":[[]]},{"id":"eacad62c.301c28","type":"change","z":"5a05b8f3.894b88","name":"set sofasconcemode","rules":[{"t":"set","p":"options.sofasconcemode","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1880,"y":600,"wires":[[]]},{"id":"befc9017.0fda8","type":"function","z":"5a05b8f3.894b88","name":"Dimmable?","func":"// 2019 1126  Rob Picchione myERVIN.com\n//\n// Special light that has an option (Option Tab) to disable or\n// enable dimming due to the type of light fixture installed.\n// If dimming is disabled this script disables (greys out)\n// the slider for the dimmer and sets it value to 100.\n\nvar sofasconcemode = global.get('options.sofasconcemode')\nvar payload = msg.payload\n\n\nif (sofasconcemode === 'on') {\n    msg.payload = 100;\n    msg.enabled = false;\n} else if (sofasconcemode === 'dim') {\n    msg.enabled = true\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":610,"y":2440,"wires":[["a7d2239b.42bcc"]]},{"id":"617f1205.f5203c","type":"link out","z":"5a05b8f3.894b88","name":"Initialize","links":["e67569b6.e632f8","48fe2626.9ea438"],"x":1395,"y":660,"wires":[]},{"id":"61fe328c.5c91cc","type":"function","z":"2fdd8124.05e35e","name":"Init eRVin Global Context","func":"//  20201212  Rob Picchione myERVIN.com\n// \n// Checks for global variable for lat, lon, zipcode and sunset\n// If they don't exist they are initialized to default Middlebury, IN\n// If they do exist they are left alone.\n// \n// This is to support systems that do not have a GPS receiver.\n// If a GPS receiver is present and has a valid fix it will override \n// the context lat/lon with actual values (see function in Automations tab)\n\n\nif (typeof global.get('enteredzip') === 'undefined' || global.get('enteredzip') === null) {\n    global.set('enteredzip', \"46540\")\n}\n\nif (typeof global.get('lon') === 'undefined' || global.get('lon') === null) {\n    global.set('lon', -85.698192)\n}\n\nif (typeof global.get('lat') === 'undefined' || global.get('lat') === null) {\n    global.set('lat', 41.680015)\n}\n\nif (typeof global.get('sunset') === 'undefined' || global.get('sunset') === null) {\n    global.set(\"sunset.lights\", {})\n}\n\n// global.set(\"sunset.lights\", {});\n// global.set(\"sunset.lights\",[]); //array\n// global.set(\"sunset.lights\", {}); //object\n\n\nreturn null;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":160,"wires":[[]]},{"id":"85d8cd27.cac9a","type":"function","z":"5a05b8f3.894b88","name":"Init eRVin Global Context","func":"//  20201212  Rob Picchione myERVIN.com\n// \n// Checks for global context variables\n// If they don't exist they are initialized to default or empty object.\n// If they do exist they are left alone.\n// \n// predefine enteredzip\n// This is to support systems that do not have a GPS receiver. If no zip is\n// entered the default will be set to Middlebury, IN.\n// If a GPS receiver is present and has a valid fix it will override \n// the context lat/lon with actual values (see function in Automations tab)\n\nif (typeof global.get('enteredzip') === 'undefined' || global.get('enteredzip') === null) {\n    global.set('enteredzip', \"46540\")\n}\n\n// predefine lon\n// default logitude for Middlebury, IN\nif (typeof global.get('lon') === 'undefined' || global.get('lon') === null) {\n    global.set('lon', -85.698192)\n}\n\n// predefine lat\n// default latitude for Middlebury, IN\nif (typeof global.get('lat') === 'undefined' || global.get('lat') === null) {\n    global.set('lat', 41.680015)\n}\n\n// predefine sunset\n// sets up an empty object in global context for capturing which devices\n// have been selected for actions at sunset. See Automation tab.\n// Note difference between defining and empty object vs an empty array\n// global.set(\"sunset.lights\",[]); //array\n// global.set(\"sunset.lights\", {}); //object\nif (typeof global.get('sunset') === 'undefined' || global.get('sunset') === null) {\n    global.set(\"sunset.lights\", {})\n    global.set(\"sunset.scenes\", {})\n}\n\n// predefine onmode\n// check to see if onmode exists in global context.\n// if not create it and set the value to default 125\n// which will return lights to theeir previous dim value\n// when turned on. If the onmode global already exists get\n// the value. Send the value to the switch node to ensure\n// it is positioned properly\n\nif (typeof global.get('options.onmode') === 'undefined' || global.get('options.onmode') === null) {\n    global.set('options.onmode', 125)\n}\n//var onmode = global.get('options.onmode');\n//var msg1 = {'payload' : onmode};\n//var msg1 = {'payload' : [global.get('onmode')]};\n\n// predefine sofasconcemode\n// Entegra combines the sofa overhead task lighting with the sofa sconce mood \n// lighting. The overhead task lights are touch activated pucks and therefore \n// non-dimmable so the entire circuit remains non-dimmable including the sconces. \n// Replace the overhead task pucks with no-touch dimmable versions and this circuit \n// can be made dimmable. Values are 'on' or 'dim'.\nif (typeof global.get('options.sofasconcemode') === 'undefined' || global.get('options.sofasconcemode') === null) {\n    global.set('options.sofasconcemode', 'on')\n}\n//var sofasconcemode = global.get('sofasconcemode');\n//var msg2 = {'payload' : sofasconcemode};\n//var msg2 = {'payload' : [global.get('sofasconcemode')]};\n\n//return [msg1, msg2];\nreturn null\n\n","outputs":2,"noerr":0,"initialize":"","finalize":"","x":1410,"y":520,"wires":[[],[]]},{"id":"d7bfba76.7169e8","type":"comment","z":"5a05b8f3.894b88","name":"Initialize eRVin Global Context","info":"","x":1180,"y":380,"wires":[]},{"id":"4688e265.08aeec","type":"sunriseinput","z":"b437d470.625068","name":"","lat":"0","lon":"0","start":"sunrise","end":"sunset","x":2010,"y":200,"wires":[["b8e0823d.a3acb"],["af136c7c.ada68","b197fd92.b0d7b"]]},{"id":"d7b59a4a.3df488","type":"e-mail","z":"b437d470.625068","d":true,"server":"","port":"465","secure":true,"tls":false,"name":"","dname":"email","x":2450,"y":300,"wires":[]},{"id":"af136c7c.ada68","type":"change","z":"b437d470.625068","name":"","rules":[{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"The sun has risen!","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"The sun has set!","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2260,"y":300,"wires":[["d7b59a4a.3df488"]]},{"id":"b197fd92.b0d7b","type":"change","z":"b437d470.625068","d":true,"name":"Underslide Lights","rules":[{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"37 2","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"37 3","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2270,"y":200,"wires":[["d63af16b.5a018"]]},{"id":"17d96a13.a40fb6","type":"ui_gauge","z":"b437d470.625068","name":"","group":"4ba9cfc2.1a222","order":0,"width":0,"height":0,"gtype":"donut","title":"Moon_Phase","label":"Full","format":"{{value * 100}}%","min":0,"max":"1","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":2470,"y":260,"wires":[]},{"id":"b8e0823d.a3acb","type":"change","z":"b437d470.625068","name":"Change to Moon","rules":[{"t":"move","p":"moon","pt":"msg","to":"payload","tot":"msg"},{"t":"change","p":"topic","pt":"msg","from":"sun","fromt":"str","to":"moon","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2260,"y":260,"wires":[["17d96a13.a40fb6"]]},{"id":"e4a23a97.5267d8","type":"gpsd","z":"b437d470.625068","name":"","hostname":"localhost","port":"2947","tpv":true,"sky":false,"info":false,"device":false,"gst":false,"att":false,"x":130,"y":140,"wires":[["29a881.96af078","c77f483b.48f4c8","a7b99c0f.29dba","15bd4633.3407fa","369f114.c8f0cee","5d6a260.de1e1dc","ce36681a.bef348","9431fd45.eb305","4a99907d.1ce51"]]},{"id":"27acbef8.b4a3c2","type":"function","z":"b437d470.625068","name":"Lat/Lon","func":"// 20190328  Rob Picchione myERVIN.com\n//\n//Using the 'node-red-contrib-gpsd' node.\n//\n//First tests to see if there is a fix (mode >=2) AND tests to see if\n//there is movement (speed >= 3). If so, reformats lat and lon from\n//the 'node-red-contrib-gpsd' node into the required input for the\n//'node-red-contrib-suncalcinput' node' and sends to output 1.\n//\n//When the above conditions are met, in addition, the original payload\n//from the 'node-red-contrib-gpsd' node is passed thru and the raw data \n//written to a json file and comma delimited data written to a text file\n//for future processing.\n//\n//In suncalcinput configure the lat & lon fields to 0. \n\nlet lat = msg.payload.lat;\nlet lon = msg.payload.lon;\nlet mode = msg.payload.mode;\nlet speed = msg.payload.speed;\n\n\n    if (mode >= 2 & speed >= 5) {\n\n    var msg1 = {\n      'lat': lat,\n      'lon': lon,\n     };\n     \n     var msg2 = {\n        'payload' : msg.payload,\n    };\n\n  return [ msg1, msg2 ];\n} \n\n","outputs":2,"noerr":0,"x":1100,"y":1100,"wires":[[],[]]},{"id":"b2ebe4e4.171628","type":"file","z":"b437d470.625068","name":"gpsd_output","filename":"/coachproxy/gps/gpsd.json","appendNewline":true,"createDir":false,"overwriteFile":"false","x":1010,"y":140,"wires":[[]]},{"id":"56436386.b2a2cc","type":"csv","z":"b437d470.625068","name":"gpsd-csv","sep":",","hdrin":"","hdrout":false,"multi":"one","ret":"\\n","temp":"class,tag,device,mode,time,ept,lat,lon,alt,epx,epy,epv,track,speed,climb,eps,epc","skip":0,"strings":true,"x":1000,"y":180,"wires":[["c383a24e.932b3"]]},{"id":"c383a24e.932b3","type":"file","z":"b437d470.625068","name":"gpsd-csv-file","filename":"/coachproxy/gps/gpsd.csv","appendNewline":true,"createDir":false,"overwriteFile":"false","x":1170,"y":180,"wires":[[]]},{"id":"1994dd19.8f1723","type":"ui_text","z":"b437d470.625068","d":true,"group":"fc3455d4.45be98","order":2,"width":"6","height":"3","name":"Location","label":"","format":"Time: {{msg.payload.time}} <br> Lat:      {{msg.payload.lat}} <br> Lon: {{msg.payload.lon}} <br> Altitude: {{msg.payload.alt}}<br> Speed: {{msg.payload.speed}} <br>","layout":"row-left","x":1000,"y":220,"wires":[]},{"id":"f1415e56.bb56b","type":"comment","z":"b437d470.625068","name":"GPS","info":"no gps antenna no output\n\nwith antenna but no fix there will be output with mode less than 2","x":130,"y":80,"wires":[]},{"id":"92e380f4.da0c5","type":"comment","z":"b437d470.625068","name":"Sunrise/Sunset Preliminary","info":"","x":1670,"y":120,"wires":[]},{"id":"d63af16b.5a018","type":"link out","z":"b437d470.625068","name":"GPS","links":["c5b4b8df.138d88"],"x":2455,"y":200,"wires":[]},{"id":"29a881.96af078","type":"change","z":"b437d470.625068","name":"change","rules":[{"t":"change","p":"payload.mode","pt":"msg","from":"3","fromt":"num","to":"<font color=\"green\">3D Fix","tot":"str"},{"t":"change","p":"payload.mode","pt":"msg","from":"2","fromt":"num","to":"<font color=\"orange\">2D Fix","tot":"str"},{"t":"change","p":"payload.mode","pt":"msg","from":"1","fromt":"num","to":"<font color=\"red\">No Fix","tot":"str"},{"t":"change","p":"payload.mode","pt":"msg","from":"0","fromt":"num","to":"<font color=\"black\">No GPS","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":140,"y":480,"wires":[["a0f8ae6d.71b83"]]},{"id":"a0f8ae6d.71b83","type":"ui_text","z":"b437d470.625068","group":"fc3455d4.45be98","order":1,"width":0,"height":0,"name":"","label":"GPS Signal:","format":"{{msg.payload.mode}}","layout":"row-spread","x":450,"y":480,"wires":[]},{"id":"a7b99c0f.29dba","type":"ui_text","z":"b437d470.625068","group":"fc3455d4.45be98","order":3,"width":"0","height":"0","name":"Time","label":"Time:","format":"{{msg.payload.time}}","layout":"row-spread","x":430,"y":400,"wires":[]},{"id":"d9baa16.a79c46","type":"ui_text","z":"b437d470.625068","group":"fc3455d4.45be98","order":4,"width":"0","height":"0","name":"Latitude","label":"Latitude:","format":"{{msg.payload.lat}}","layout":"row-spread","x":440,"y":580,"wires":[]},{"id":"7f9455c.ae535ac","type":"ui_text","z":"b437d470.625068","group":"fc3455d4.45be98","order":5,"width":"0","height":"0","name":"Longitude","label":"Longitude:","format":"{{msg.payload.lon}}","layout":"row-spread","x":440,"y":660,"wires":[]},{"id":"675da0db.1737a","type":"ui_text","z":"b437d470.625068","group":"fc3455d4.45be98","order":6,"width":"0","height":"0","name":"Altitude","label":"Altitude:","format":"{{msg.payload.alt}}","layout":"row-spread","x":440,"y":700,"wires":[]},{"id":"bdaabfba.5f2a2","type":"ui_text","z":"b437d470.625068","group":"fc3455d4.45be98","order":7,"width":"0","height":"0","name":"Speed","label":"Speed:","format":"{{payload}}","layout":"row-spread","x":430,"y":440,"wires":[]},{"id":"c77f483b.48f4c8","type":"smooth","z":"b437d470.625068","name":"","property":"payload.lat","action":"mean","count":"60","round":"9","mult":"single","reduce":true,"x":140,"y":580,"wires":[["d9baa16.a79c46","9ccd3ec1.40d97"]]},{"id":"ed58052f.2e47d8","type":"owntracks","z":"b437d470.625068","d":true,"x":130,"y":1060,"wires":[["be5a217b.e0669","d9b2eff6.720f5"]]},{"id":"5d6a260.de1e1dc","type":"mqtt out","z":"b437d470.625068","name":"","topic":"CP/GPSDATA","qos":"","retain":"","broker":"c1170463.5c7f8","x":420,"y":200,"wires":[]},{"id":"41963f52.f0428","type":"worldmap","z":"b437d470.625068","name":"","lat":"","lon":"","zoom":"","layer":"OSM","cluster":"","maxage":"","usermenu":"show","layers":"show","panit":"false","panlock":"false","zoomlock":"false","hiderightclick":"false","coords":"none","showgrid":"false","path":"/worldmap","x":1100,"y":880,"wires":[]},{"id":"9173e1aa.d5494","type":"worldmap in","z":"b437d470.625068","name":"","path":"/worldmap","events":"all","x":1100,"y":820,"wires":[[]]},{"id":"3e9f53dd.b72b8c","type":"worldmap-tracks","z":"b437d470.625068","name":"","depth":20,"layer":"combined","x":610,"y":1100,"wires":[["41963f52.f0428","a23a9f6a.3a0ba"]]},{"id":"4f99d7c1.9acab8","type":"webhookrelay","z":"b437d470.625068","d":true,"buckets":"owntracks","x":140,"y":1260,"wires":[["416cf261.9330dc"]]},{"id":"416cf261.9330dc","type":"function","z":"b437d470.625068","name":"Extract Body","func":"return {\n    payload: msg.payload.body\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":330,"y":1260,"wires":[[]]},{"id":"42f9b298.d626ec","type":"comment","z":"b437d470.625068","name":"Webhookrelay/Owntracks","info":"","x":160,"y":920,"wires":[]},{"id":"be5a217b.e0669","type":"function","z":"b437d470.625068","name":"Format JSON","func":"return {\n    payload: {\n        tid: msg.payload.tid,\n        deviceid: msg.req.rawHeaders[21],\n        name: msg.req.rawHeaders[19],\n        lat: msg.payload.lat,\n        lon: msg.payload.lon,\n        battery: msg.payload.batt,\n        speed: msg.payload.vel,\n        altitude: msg.payload.alt,\n        icon: 'user-circle-o'\n    }\n};\n\n","outputs":1,"noerr":0,"x":400,"y":1060,"wires":[["41963f52.f0428","3e9f53dd.b72b8c","a23a9f6a.3a0ba"]]},{"id":"9ccd3ec1.40d97","type":"function","z":"b437d470.625068","name":"Format JSON","func":"//  20201130  Rob Picchione myERVIN.com\n// \n// Using the output of the 'node-red-contrib-gpsd' node.\n//\n// Checks to see if there is a fix (mode >=2) and if so\n// sets 'lat' and 'lon' values in global context. \n// mode = 2 is a 2D fix, mode = 3 is a 3D fix\n// \n// Aditionally formats and outputs lat, lon, name, speed and icon\n// values formatted for the worldmap node.\n\nlet mode = msg.payload.mode;\n\nif (mode >= 2 ) {\n    global.set('lat', msg.payload.lat);\n    global.set('lon', msg.payload.lon);\n}\n\n// global.set('lat',msg.payload.lat);\n// global.set('lon',msg.payload.lon);\n\nreturn {\n    payload: {\n        name: \"eRVin\",\n        lat: msg.payload.lat,\n        lon: msg.payload.lon,\n        speed: msg.payload.speed,\n        icon: 'fa-bus'\n    }\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":820,"wires":[["3e9f53dd.b72b8c","41963f52.f0428","a23a9f6a.3a0ba"]]},{"id":"d9b2eff6.720f5","type":"geofence","z":"b437d470.625068","name":"Home","mode":"circle","inside":"true","rad":0,"points":[],"centre":{"latitude":0,"longitude":0},"x":370,"y":1120,"wires":[[]]},{"id":"8d5c5670.b1b1b8","type":"mqtt in","z":"b437d470.625068","name":"owntracks","topic":"owntracks/+/+","qos":"2","datatype":"auto","broker":"c1170463.5c7f8","x":120,"y":1180,"wires":[[]]},{"id":"9f32df03.ecc4c","type":"function","z":"b437d470.625068","name":"","func":"\n\n    //sample HTML/JS script that will publish/subscribe to topics in the Google Chrome Console\n    //by Matthew Bordignon @bordignon on twitter.\n    //dataplacity and SSL update by Madhan Sundaram @madhansundaram\n\n    var wsbroker = \"<yourId>.dataplicity.io\";  //mqtt websocket enabled broker\n    var wsport = 443 // port for above\n\n    var client = new Paho.MQTT.Client(wsbroker, wsport,\n        \"myclientid_\" + parseInt(Math.random() * 100, 10));\n\n    client.onConnectionLost = function (responseObject) {\n      console.log(\"connection lost: \" + responseObject.errorMessage);\n    };\n\n    client.onMessageArrived = function (message) {\n      console.log(message.destinationName, ' -- ', message.payloadString);\n    };\n\n    var options = {\n      useSSL : true,\n      userName : \"user name\", //Mosquitto server username\n      password : \"password\", //Mosquitto server password\n      timeout: 3,\n      onSuccess: function () {\n        console.log(\"mqtt connected\");\n        // Connection succeeded; subscribe to our topic, you can add multile lines of these\n        client.subscribe('/World', {qos: 1});\n\n\n        //use the below if you want to publish to a topic on connect\n        message = new Paho.MQTT.Message(\"Old message\");\n        message.destinationName = \"/World\";\n        client.send(message);\n\n      },\n      onFailure: function (message) {\n        console.log(\"Connection failed: \" + message.errorMessage);\n      }\n    };\n\n  function init() {\n      client.connect(options);\n  }\n\n   \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":1300,"wires":[[]]},{"id":"15bd4633.3407fa","type":"smooth","z":"b437d470.625068","name":"","property":"payload.lon","action":"mean","count":"60","round":"9","mult":"single","reduce":true,"x":140,"y":660,"wires":[["7f9455c.ae535ac"]]},{"id":"369f114.c8f0cee","type":"smooth","z":"b437d470.625068","name":"","property":"payload.alt","action":"mean","count":"60","round":"2","mult":"single","reduce":true,"x":140,"y":700,"wires":[["675da0db.1737a"]]},{"id":"a23a9f6a.3a0ba","type":"ui_worldmap","z":"b437d470.625068","group":"b7dc85ae.2ad0a8","order":1,"width":0,"height":0,"name":"","lat":"","lon":"","zoom":"","layer":"OSM","cluster":"","maxage":"","usermenu":"show","layers":"show","panit":"true","panlock":"false","zoomlock":"false","hiderightclick":"true","coords":"none","showgrid":"false","path":"/worldmap","x":1100,"y":940,"wires":[]},{"id":"6b5f9d94.ade734","type":"http in","z":"b437d470.625068","d":true,"name":"owntracks","url":"/owntracks","method":"post","upload":false,"swaggerDoc":"","x":120,"y":980,"wires":[["a82f00c2.ec9e2","ed58052f.2e47d8"]]},{"id":"a82f00c2.ec9e2","type":"http response","z":"b437d470.625068","name":"","statusCode":"","headers":{},"x":290,"y":980,"wires":[]},{"id":"ce36681a.bef348","type":"rbe","z":"b437d470.625068","name":"","func":"deadband","gap":"1","start":"","inout":"in","property":"payload.speed","x":140,"y":440,"wires":[["8bdd223.66197e"]]},{"id":"d7bcdd63.73502","type":"function","z":"b437d470.625068","name":"Lat/Lon Start","func":"// 20190328  Rob Picchione myERVIN.com\n//\n//Using the 'node-red-contrib-gpsd' node.\n//\n//A startup version of the Lat/Lon function.\n//On startup after a gps fix is achieved, sends lat/lon info a few times.\n//If this is not done and the rig is stationary lat/lon will not be\n//updated and the sunset times will be wrong.\n//\n//First, waits to see if there is a fix \n//(mode >=2) AND tests to see if limit for sending more lat/lon info\n//has been reached. If so, reformats lat and lon from\n//the 'node-red-contrib-gpsd' node into the required input for the\n//'node-red-contrib-suncalcinput' node' and sends to output 1.\n//\n//After the count value is exceeded stops sending the lat/lon and lets\n//the Lat/Lon function send updates out only when the speed is above\n//the threshold in the Lat/Lon function.\n//\n//In suncalcinput, configure the lat & lon fields to 0. \n\nlet lat = msg.payload.lat;\nlet lon = msg.payload.lon;\nlet mode = msg.payload.mode;\nlet speed = msg.payload.speed;\n\n// count how many times the function has been run\nvar count = context.get('count')||0;\ncount += 1;\n// store the count value back to context\ncontext.set('count',count);\n\nlet msg1 = {\n      'lat': lat,\n      'lon': lon,\n      'count': context.get ('count'),\n     };\n\nif (mode >= 2 & context.get ('count') <= 10) {\n\n    return [ msg1 ];\n \n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1110,"y":1140,"wires":[[]]},{"id":"8bdd223.66197e","type":"function","z":"b437d470.625068","name":"Noise","func":"let speed = msg.payload.speed;\n\nif (speed <=2) {\n    speed = 0;\n}\n\nreturn {payload: speed };\n\n","outputs":1,"noerr":0,"x":290,"y":440,"wires":[["bdaabfba.5f2a2"]]},{"id":"7c17c746.b13738","type":"function","z":"b437d470.625068","name":"old GPS Fix?","func":"\n//  20201130  Rob Picchione myERVIN.com\n// \n// Using th output of the 'node-red-contrib-gpsd' node.\n//\n// Tests to see if there is a gps fix. If so, reformats lat and lon from\n// the 'node-red-contrib-gpsd' node into the required input for the\n// 'node-red-contrib-suncalcinput' node' and sends to the output.\n//\n// If no gps fix, reads lat/lon from the manual entry field and passes\n// that info instead.\n//\n// mode = 2 is a 2D fix, mode = 3 is a 3D fix\n//\n// In suncalcinput configure the lat & lon fields to 0. \n\nvar mode = msg.payload.mode;\nvar speed = msg.payload.speed;\nvar lat = msg.payload.lat;\nvar lon = msg.payload.lon;\n\nif (typeof lat === 'undefined' || global.set('lat') === 0) {\n    // variable is undefined or zero\n}\nif (typeof lon === 'undefined' || global.set('lon') === 0) {\n    // variable is undefined or zero\n}\n\nvar lastlat = global.get('lat');\nvar lastlon = global.get('lon');\n\nif (mode < 2 ) {\n    lat = global.get(\"manlat\");\n    lon = global.get(\"manlon\");\n}\n    msg.payload = {\n      'lat': lat,\n      'lon': lon,\n     };\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1110,"y":1180,"wires":[[]]},{"id":"4a99907d.1ce51","type":"function","z":"b437d470.625068","d":true,"name":"Moving?","func":"// checks to see if speed is high enough to indicate a moving vehicle\n// if so passes gps data on, if not supresses gps data\n\nlet speed = msg.payload.speed;\n\nif (speed >= 3) {\n     \n     var msg1 = {\n        'payload' : msg.payload,\n    };\n\n  return [ msg1 ];\n} ","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":140,"wires":[["b2ebe4e4.171628","56436386.b2a2cc"]]},{"id":"9431fd45.eb305","type":"debug","z":"b437d470.625068","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":310,"y":100,"wires":[]},{"id":"101c619e.58ab3e","type":"ui_template","z":"b437d470.625068","group":"9ee7e038.56def","name":"","order":1,"width":"6","height":"2","format":"<div>\n<p>\n    If not using a GPS receiver enter a 5 digit Zip Code below which will provide approximate lat/lon to ensure accurate sunrise/sunset info.\n</p>\n</div>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1140,"y":340,"wires":[[]]},{"id":"d89bf2b9.93bcf","type":"file in","z":"b437d470.625068","name":"zip2latlon.txt","filename":"/coachproxy/home/pi/.node-red/location/zip2latlon.txt","format":"lines","chunk":false,"sendError":false,"encoding":"none","x":1510,"y":420,"wires":[["a3b392d6.c5177"]]},{"id":"a3b392d6.c5177","type":"csv","z":"b437d470.625068","name":"","sep":",","hdrin":true,"hdrout":"none","multi":"one","ret":"\\n","temp":"","skip":"0","strings":false,"x":1670,"y":420,"wires":[["247262f1.290cee"]]},{"id":"3d6f128d.512f9e","type":"ui_form","z":"b437d470.625068","name":"Enter Zip","label":"","group":"9ee7e038.56def","order":2,"width":"0","height":"0","options":[{"label":"Zip Code","value":"enteredzip","type":"text","required":true,"rows":null}],"formValue":{"enteredzip":""},"payload":"","submit":"submit","cancel":"cancel","topic":"","x":1140,"y":380,"wires":[["72556068.79229","3c8844fd.22971c"]]},{"id":"88ab0f1b.4f313","type":"change","z":"b437d470.625068","name":"Format man lat/lon","rules":[{"t":"set","p":"payload.lat","pt":"msg","to":"$number(payload.lat)","tot":"jsonata"},{"t":"set","p":"payload.lon","pt":"msg","to":"$number(payload.lon)","tot":"jsonata"},{"t":"set","p":"payload.name","pt":"msg","to":"eRVin","tot":"str"},{"t":"set","p":"payload.icon","pt":"msg","to":"fa-bus","tot":"str"},{"t":"set","p":"lat","pt":"global","to":"payload.lat","tot":"msg"},{"t":"set","p":"lon","pt":"global","to":"payload.lon","tot":"msg"},{"t":"set","p":"topic","pt":"msg","to":"manloc","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":540,"wires":[["41963f52.f0428","a23a9f6a.3a0ba","d9baa16.a79c46","7f9455c.ae535ac"]]},{"id":"72556068.79229","type":"change","z":"b437d470.625068","name":"","rules":[{"t":"set","p":"enteredzip","pt":"global","to":"payload.enteredzip","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"payload.enteredzip","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1320,"y":380,"wires":[["d89bf2b9.93bcf"]]},{"id":"c9606c67.739c8","type":"function","z":"b437d470.625068","name":"PrePop","func":"//  20201212  Rob Picchione myERVIN.com\n// \n// prepopulates previously entered zipcode\n//\n//NOT SURE IF THIS FUNCTION IS NEEDED\n\nvar zip = global.get('enteredzip');\n\n// on msg1 output the format required by the form node to \n// prepopulate the entry field.\n// output format for form node: {\"enteredzip\":\"32043\"}\n\nvar msg1 = {payload : {'enteredzip': zip}}\n\n// on msg2 output the enteredzip value as a numeric.\nvar msg2 = {payload : zip}\n\nreturn [ msg1, msg2 ];\n","outputs":2,"noerr":0,"initialize":"","finalize":"","x":960,"y":400,"wires":[["3d6f128d.512f9e"],["d89bf2b9.93bcf"]]},{"id":"3d5d3b71.49eca4","type":"change","z":"b437d470.625068","name":"","rules":[{"t":"set","p":"lat","pt":"msg","to":"lat","tot":"global"},{"t":"set","p":"lon","pt":"msg","to":"lon","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1800,"y":200,"wires":[["4688e265.08aeec"]]},{"id":"7578d746.6dd9e8","type":"inject","z":"b437d470.625068","name":"","props":[{"p":"time","v":"","vt":"date"},{"p":"topic","vt":"str"}],"repeat":"1800","crontab":"","once":true,"onceDelay":"5","topic":"","payloadType":"str","x":1630,"y":200,"wires":[["3d5d3b71.49eca4"]]},{"id":"60c8dd4d.6aa824","type":"comment","z":"b437d470.625068","name":"Write GPS data to file","info":"","x":840,"y":80,"wires":[]},{"id":"80a094a7.fb4278","type":"comment","z":"b437d470.625068","name":"Enter Zip Code if no GPS","info":"If there is no GPS or there is no valid GPS signal the zip code can be entereed manually to approximate location. This will allow the sunset and other location based routines to be accurate.\n\nAt startup if there is a value for the zip code saved in global context (enteredzip) it is used to populate the zip code field in the form entry.\n\nThe zip code is compared to a csv file containing zip, lat and lon. If there is a hit, the zip code is entered in the global context and the gate is closed. If there is no hit the gate never closes and the end of file is reached with non0existant zip of 99999 which triggers an error pop up.","x":850,"y":320,"wires":[]},{"id":"227b5d85.044d92","type":"comment","z":"b437d470.625068","name":"Worldmap","info":"","x":1100,"y":760,"wires":[]},{"id":"60dcb784.ad82c8","type":"inject","z":"b437d470.625068","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"","payloadType":"date","x":810,"y":400,"wires":[["c9606c67.739c8"]]},{"id":"3c8844fd.22971c","type":"change","z":"b437d470.625068","name":"open gate","rules":[{"t":"set","p":"payload","pt":"msg","to":"open","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"control","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1300,"y":440,"wires":[["ed82df4e.d6771"]]},{"id":"247262f1.290cee","type":"switch","z":"b437d470.625068","name":"Find Zip","property":"payload.zip","propertyType":"msg","rules":[{"t":"eq","v":"enteredzip","vt":"global"},{"t":"eq","v":"99999","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1820,"y":420,"wires":[["88ab0f1b.4f313","a2afca04.e16f68"],["ed82df4e.d6771"]]},{"id":"78c4c4d.176033c","type":"ui_toast","z":"b437d470.625068","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"ZipCode Not Valid","name":"ZipCode Not Valid","x":2190,"y":540,"wires":[[]]},{"id":"4d6f4a9e.d73054","type":"change","z":"b437d470.625068","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"enteredzip","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":2180,"y":480,"wires":[["78c4c4d.176033c"]]},{"id":"ed82df4e.d6771","type":"gate","z":"b437d470.625068","name":"","controlTopic":"control","defaultState":"open","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","defaultCmd":"default","persist":false,"x":2010,"y":480,"wires":[["4d6f4a9e.d73054"]]},{"id":"a2afca04.e16f68","type":"change","z":"b437d470.625068","name":"close gate","rules":[{"t":"set","p":"payload","pt":"msg","to":"close","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"control","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2030,"y":400,"wires":[["ed82df4e.d6771"]]},{"id":"a81b45ce.c4d328","type":"ui_list","z":"b437d470.625068","d":true,"group":"fcc7d16a.5f2a2","name":"Sunset Actions","order":1,"width":"6","height":"6","lineType":"two","actionType":"check","allowHTML":true,"outputs":1,"topic":"/coachproxy/node-red/sunset","x":2620,"y":420,"wires":[["cff157a3.c6edb8"]]},{"id":"f94340b.31e92c","type":"link in","z":"b437d470.625068","name":"Sunset List","links":["bed0fea6.6dc72"],"x":2485,"y":420,"wires":[["a81b45ce.c4d328"]]},{"id":"3777da24.24a8c6","type":"change","z":"b437d470.625068","d":true,"name":"","rules":[{"t":"set","p":"sunset,[key]","pt":"global","to":"payload.description","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2860,"y":340,"wires":[[]]},{"id":"cff157a3.c6edb8","type":"function","z":"b437d470.625068","d":true,"name":"","func":"// (c) 2020 eRVin project Rob Picchion\n\n// var instance = msg.payload.description;\n// var title = msg.payload.title;\n// var brightness = msg.payload.brightness;\n\nvar state = msg.payload.isChecked;\nvar description = msg.payload.description\n\n\nglobal.set('sunset.lights[' + description + '].suntrig', state);\n\nvar suntrig = global.get('sunset.lights');\n\nmsg.payload = suntrig\n\n\n// global.set('sunset[' + description + ']', description);\n\n// global.set ('sunset[' + instance + '].instance', instance);\n\n//var brightness = global.get('status').lights[description].brightness;\n//var state = global.get('status').lights[description].state;\n//var command = (brightness == 100) ? 2 : (brightness > 0) ? 0 : 3;\n\n// alternate code for above to get 'brightness' and 'state' global context variables\n// var lightlist = global.get ('status').lights;\n// var brightness = lightlist[description].brightness;\n// var state = lightlist[description].state;\n\n// Add to the global context data the friendly name associated with the device instance\n// global.set('status.lights[' + description + '].instancename', title);\n\n\n//msg.payload = { title, description, command, brightness};\n//var newmsg = { payload: msg.payload};\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2860,"y":400,"wires":[[]]},{"id":"5209c603.a2b818","type":"inject","z":"b437d470.625068","d":true,"name":"Day of Week","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"[{\"title\":\"Porch Light\",\"isChecked\":true}]","payloadType":"json","x":2550,"y":500,"wires":[["a81b45ce.c4d328"]]},{"id":"fcef2e64.cbc0c","type":"function","z":"b437d470.625068","d":true,"name":"","func":"global.set(\"sunset.lights\", {});\nreturn msg;\n//global.set(\"RangeTemperaturesA\",[]); //array\n// global.set('status.lights', {}); //object","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2870,"y":540,"wires":[[]]},{"id":"12c9a779.4b66f9","type":"inject","z":"b437d470.625068","d":true,"name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2710,"y":600,"wires":[["fcef2e64.cbc0c"]]},{"id":"70618434.bbc80c","type":"function","z":"5a05b8f3.894b88","name":"","func":"var scenename = msg.payload\n//global.set('sunset.scenes', scenename);\n//global.set('sunset.scenes', {scenename});\n//global.set('sunset.scenes [+scenename+]', scenename);\nglobal.set('sunset.scenes[' + scenename + '].suntrig', false);\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2380,"y":3960,"wires":[[]]},{"id":"3d9a5063.d365","type":"fs-ops-dir","z":"f6c367c2.63b9b8","name":"","path":"/coachproxy/home/pi/.node-red/flows/","pathType":"str","filter":"v","filterType":"str","dir":"options","dirType":"msg","x":140,"y":2040,"wires":[["5436f6f4.881b18"]]},{"id":"8591d488.898fc8","type":"fs-ops-copy","z":"f6c367c2.63b9b8","name":"Write Flow File","sourcePath":"/coachproxy/home/pi/.node-red/flows","sourcePathType":"str","sourceFilename":"payload","sourceFilenameType":"msg","destPath":"/coachproxy/home/pi/.node-red","destPathType":"str","destFilename":"flows_coachproxy.json","destFilenameType":"str","link":false,"overwrite":true,"x":1060,"y":2180,"wires":[["ba208130.48bca"]]},{"id":"5436f6f4.881b18","type":"ui_dropdown","z":"f6c367c2.63b9b8","name":"Select RV Flow File","label":"","tooltip":"","place":"Select RV Model","group":"9c7e0074.77f72","order":2,"width":"6","height":"2","passthru":false,"multiple":false,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":330,"y":2040,"wires":[["b4705b61.b27a88"]]},{"id":"b4705b61.b27a88","type":"change","z":"f6c367c2.63b9b8","name":"Set Global","rules":[{"t":"set","p":"RVflow","pt":"global","to":"payload","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"Are you sure you want to reset the RV Info? This will restart eRVin. Please allow 5 minutes for the new configuration to load.","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":570,"y":2040,"wires":[[]]},{"id":"9c309597.9806a8","type":"ui_template","z":"f6c367c2.63b9b8","group":"9c7e0074.77f72","name":"Install Configuration Instructions","order":1,"width":"6","height":"2","format":"<div>\n    <p>\n    <br><b>To reconfigure eRVin for your RV, please select your RV model from the dropdown list below, then click the INSTALL CONFIGURATION button below.</b>\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":190,"y":2140,"wires":[[]]},{"id":"f3d62b65.5b7668","type":"ui_toast","z":"f6c367c2.63b9b8","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"Restart","cancel":"Cancel","raw":false,"topic":"","name":"","x":470,"y":2180,"wires":[["232d1d6d.ae99f2"]]},{"id":"7cd1f904.4a2ac8","type":"change","z":"f6c367c2.63b9b8","name":"Get Flow Name","rules":[{"t":"change","p":"payload","pt":"msg","from":"Restart","fromt":"str","to":"RVflow","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":2180,"wires":[["bbad237b.08e49","8591d488.898fc8"]]},{"id":"232d1d6d.ae99f2","type":"switch","z":"f6c367c2.63b9b8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Restart","vt":"str"},{"t":"eq","v":"Cancel","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":630,"y":2180,"wires":[["7cd1f904.4a2ac8"],["3d9a5063.d365"]]},{"id":"9dfb70b.e4a089","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.tabs","tot":"msg"},{"t":"set","p":"payload.tabs","pt":"msg","to":"options.tabs.locks","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1910,"y":2260,"wires":[["9181d539.f61da8"]]},{"id":"41f0225f.29879c","type":"function","z":"5a05b8f3.894b88","name":"","func":"//  20210124  Rob Picchione myERVIN.com\n//\n// This function simply writes the status of the show/hide tabes\n// to globel context so state can be reloaded after a restart.\n\nswitch (msg.payload.tabs.hide || msg.payload.tabs.show) {\n    //Enter a case block like the below for each option:\n    case \"Scenes\":\n    global.set('options.tabs.scenes', msg.payload.tabs);\n    break;\n    //Enter a case block like the above for each option:\n    \n    case \"Shades\":\n    global.set('options.tabs.shades', msg.payload.tabs);\n    break;\n    \n    case \"Aquahot\":\n    global.set('options.tabs.aquahot', msg.payload.tabs);\n    break;\n    \n    case \"Locks\":\n    global.set('options.tabs.locks', msg.payload.tabs);\n    break;\n    \n    case \"Status\":\n    global.set('options.tabs.status', msg.payload.tabs);\n    break;\n    \n    case \"Location\":\n    global.set('options.tabs.location', msg.payload.tabs);\n    break;\n    \n    case \"Alexa\":\n    global.set('options.tabs.alexa', msg.payload.tabs);\n    break;\n    \n    case \"Notifications\":\n    global.set('options.tabs.notifications', msg.payload.tabs);\n    break;\n    \n    case \"System\":\n    global.set('options.tabs.system', msg.payload.tabs);\n    break;\n    \n}\n\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2500,"y":2320,"wires":[[]]},{"id":"1acef3f8.a3a2cc","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.tabs","tot":"msg"},{"t":"set","p":"payload.tabs","pt":"msg","to":"options.tabs.aquahot","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1910,"y":2220,"wires":[["9b0f7310.0bf71"]]},{"id":"bcb2bcdd.20469","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.tabs","tot":"msg"},{"t":"set","p":"payload.tabs","pt":"msg","to":"options.tabs.shades","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1910,"y":2180,"wires":[["92a2e3dc.7ffea"]]},{"id":"1bfe417b.e8bc3f","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.tabs","tot":"msg"},{"t":"set","p":"payload.tabs","pt":"msg","to":"options.tabs.scenes","tot":"global"},{"t":"set","p":"topic","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1910,"y":2140,"wires":[["d5eefffc.a2669"]]},{"id":"a9ffc61d.bcd068","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.tabs","tot":"msg"},{"t":"set","p":"payload.tabs","pt":"msg","to":"options.tabs.status","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1910,"y":2300,"wires":[["ed2a5854.b69aa8"]]},{"id":"e6a7827b.7a07","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.tabs","tot":"msg"},{"t":"set","p":"payload.tabs","pt":"msg","to":"options.tabs.location","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1910,"y":2340,"wires":[["49eb607b.43a27"]]},{"id":"f8bc8247.933ad","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.tabs","tot":"msg"},{"t":"set","p":"payload.tabs","pt":"msg","to":"options.tabs.alexa","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1910,"y":2380,"wires":[["e0684432.74ca78"]]},{"id":"217d707f.ab817","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.tabs","tot":"msg"},{"t":"set","p":"payload.tabs","pt":"msg","to":"options.tabs.notifications","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1910,"y":2420,"wires":[["92c98fb6.69326"]]},{"id":"79377f76.6225d","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.tabs","tot":"msg"},{"t":"set","p":"payload.tabs","pt":"msg","to":"options.tabs.system","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1910,"y":2460,"wires":[["a3987d3d.13a64"]]},{"id":"8a643317.4b405","type":"function","z":"5a05b8f3.894b88","name":"","func":"//  20210124  Rob Picchione myERVIN.com\n//\n// This function simply writes the status of the show/hide tabes\n// to global context so state can be reloaded after a restart.\n\nswitch (msg.payload.group.hide || msg.payload.group.show ) {\n    //Enter a case block like the below for each option:\n    case \"Exterior_Awnings\":\n    global.set('options.group.Exterior_Awnings', msg.payload.group);\n    break;\n    //Enter a case block like the above for each option:\n    \n    case \"Aquahot_Water_Pump\":\n    global.set('options.group.Aquahot_Water_Pump', msg.payload.group);\n    break;\n    \n    case \"Scenes_Scene_Builder\":\n    global.set('options.group.Scenes_Scene_Builder', msg.payload.group);\n    break;\n    \n    case \"Scenes_How_to_use_Scene_Builder\":\n    global.set('options.group.Scenes_How_to_use_Scene_Builder', msg.payload.group);\n    break;\n    \n    case \"Interior_Memory_Master\":\n    global.set('options.group.Interior_Memory_Master', msg.payload.group);\n    break;\n    \n    case \"Status_Power\":\n    global.set('options.group.Status_Power', msg.payload.group);\n    break;\n    \n    case \"Status_Generator\":\n    global.set('options.group.Status_Generator', msg.payload.group);\n    break;\n    \n    case \"System_Remote Access - Dataplicity\":\n    global.set('options.group.System_Remote_Access_-_Dataplicity', msg.payload.group);\n    break;\n    \n    case \"System_Remote_Access_-_ngrok\":\n    global.set('options.group.System_Remote_Access_-_ngrok', msg.payload.group);\n    break;\n    \n    case \"System_Update_Configuration_Files\":\n    global.set('options.group.System_Update_Configuration_Files', msg.payload.group);\n    break;\n    \n    case \"System_Install_Configuration_File\":\n    global.set('options.group.System_Install_Configuration_File', msg.payload.group);\n    break;\n    \n    case \"System_Change_System_Password\":\n    global.set('options.group.System_Change_System_Password', msg.payload.group);\n    break;\n\n}\n\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2580,"y":2660,"wires":[[]]},{"id":"81979d38.3544b","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.group","tot":"msg"},{"t":"set","p":"payload.group","pt":"msg","to":"options.group.Exterior_Awnings","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1910,"y":2560,"wires":[["d624cecb.3fa02"]]},{"id":"92c7162.c635be8","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.group","tot":"msg"},{"t":"set","p":"payload.group","pt":"msg","to":"options.group.Aquahot_Water_Pump","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1910,"y":2600,"wires":[["9a0635ed.3d9788"]]},{"id":"ef8d0533.d2f5d8","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.group","tot":"msg"},{"t":"set","p":"payload.group","pt":"msg","to":"options.group.Scenes_Scene_Builder","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1910,"y":2640,"wires":[["70feaae0.b7a494"]]},{"id":"9f5f8920.3a8b48","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.group","tot":"msg"},{"t":"set","p":"payload.group","pt":"msg","to":"options.group.Scenes_How_to_use_Scene_Builder","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1910,"y":2680,"wires":[["caa02104.da274"]]},{"id":"867e9c8c.ced0e","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.group","tot":"msg"},{"t":"set","p":"payload.group","pt":"msg","to":"options.group.Interior_Memory_Master","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1910,"y":2720,"wires":[["2904a8af.2151e8"]]},{"id":"452cd0b8.d6666","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.group","tot":"msg"},{"t":"set","p":"payload.group","pt":"msg","to":"options.group.Status_Power","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1910,"y":2760,"wires":[["7e3eca66.93ae34"]]},{"id":"a38b7ac2.0f2318","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.group","tot":"msg"},{"t":"set","p":"payload.group","pt":"msg","to":"options.group.Status_Generator","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1910,"y":2800,"wires":[["70ddbd93.392054"]]},{"id":"9e426ec2.bde2b","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"set","p":"payload","pt":"msg","to":"options.onmode","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1450,"y":460,"wires":[["414316ff.b86dc8"]]},{"id":"34faac01.43f524","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"set","p":"payload","pt":"msg","to":"options.sofasconcemode","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1450,"y":600,"wires":[["aaab3715.944c68"]]},{"id":"48fe2626.9ea438","type":"link in","z":"5a05b8f3.894b88","name":"","links":["617f1205.f5203c"],"x":1615,"y":2500,"wires":[["1bfe417b.e8bc3f","bcb2bcdd.20469","1acef3f8.a3a2cc","9dfb70b.e4a089","a9ffc61d.bcd068","e6a7827b.7a07","f8bc8247.933ad","217d707f.ab817","79377f76.6225d","81979d38.3544b","92c7162.c635be8","ef8d0533.d2f5d8","9f5f8920.3a8b48","867e9c8c.ced0e","452cd0b8.d6666","a38b7ac2.0f2318","882ee0dc.d5be9","1465fe9e.ef8601","fe428d5d.ce95d","5d5976.bd20668c","ffd6c7d2.6d5d58"]]},{"id":"20a0a995.f8edc6","type":"fs-ops-copy","z":"f6c367c2.63b9b8","name":"Write HABridge File","sourcePath":"/coachproxy/home/pi/.node-red/flows","sourcePathType":"str","sourceFilename":"payload","sourceFilenameType":"msg","destPath":"/coachproxy/ha-bridge","destPathType":"str","destFilename":"device.db","destFilenameType":"str","link":false,"overwrite":true,"x":990,"y":2300,"wires":[["bf98be97.7e158","c4cb45b5.069948"]]},{"id":"ba208130.48bca","type":"change","z":"f6c367c2.63b9b8","name":"Reset","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1250,"y":2180,"wires":[["3d9a5063.d365"]]},{"id":"d4502958.2b9688","type":"link in","z":"2fdd8124.05e35e","name":"Reboot","links":["2fcc3be9.512344"],"x":435,"y":1840,"wires":[["4c3ea3a.8a313dc"]]},{"id":"8c8769c6.7d4678","type":"fs-ops-copy","z":"f6c367c2.63b9b8","name":"Backup HAbridge","sourcePath":"/coachproxy/ha-bridge","sourcePathType":"str","sourceFilename":"device.db","sourceFilenameType":"str","destPath":"/coachproxy/ha-bridge","destPathType":"str","destFilename":"device.db.bk.ervin","destFilenameType":"str","link":false,"overwrite":true,"x":990,"y":2240,"wires":[["20a0a995.f8edc6"]]},{"id":"2fcc3be9.512344","type":"link out","z":"f6c367c2.63b9b8","name":"Reboot","links":["d4502958.2b9688"],"x":1375,"y":2300,"wires":[]},{"id":"bf98be97.7e158","type":"ui_toast","z":"f6c367c2.63b9b8","position":"top right","displayTime":"5","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"Restarting eRVin now - Please allow a few minutes for the new configuration to load...","name":"Restart eRVin","x":1240,"y":2340,"wires":[]},{"id":"c4cb45b5.069948","type":"delay","z":"f6c367c2.63b9b8","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1220,"y":2300,"wires":[["2fcc3be9.512344"]]},{"id":"bbad237b.08e49","type":"string","z":"f6c367c2.63b9b8","name":"","methods":[{"name":"delRightMost","params":[{"type":"str","value":"_v"}]},{"name":"append","params":[{"type":"str","value":".db"}]}],"prop":"payload","propout":"payload","object":"msg","objectout":"msg","x":770,"y":2240,"wires":[["8c8769c6.7d4678"]]},{"id":"d76c205.043c2e","type":"fs-ops-copy","z":"5a05b8f3.894b88","name":"","sourcePath":"/coachproxy/home/pi/.node-red","sourcePathType":"str","sourceFilename":"flows_coachproxy.json","sourceFilenameType":"str","destPath":"/coachproxy/home/pi/.node-red/flows","destPathType":"str","destFilename":"RVinfo","destFilenameType":"global","link":false,"overwrite":true,"x":400,"y":120,"wires":[[]]},{"id":"f92dc32f.e21c","type":"inject","z":"5a05b8f3.894b88","name":"Save This Flow - Deploy First!","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":170,"y":120,"wires":[["d76c205.043c2e"]]},{"id":"3619a07.66d096","type":"exec","z":"f6c367c2.63b9b8","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"Change PW","x":910,"y":2720,"wires":[[],["588f10b3.9736d"],[]]},{"id":"a0212bd6.1eb478","type":"inject","z":"f6c367c2.63b9b8","name":"Clear PW Fields","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.4","topic":"","payload":"{\"opw\":\"\",\"epw\":\"\",\"cpw\":\"\"}","payloadType":"json","x":180,"y":2760,"wires":[["e3e9d958.66bc28"]]},{"id":"e3e9d958.66bc28","type":"ui_form","z":"f6c367c2.63b9b8","name":"Change Password","label":"","group":"7706781c.a53ca8","order":2,"width":"6","height":"3","options":[{"label":"Current Password","value":"opw","type":"password","required":true,"rows":null},{"label":"Enter New Password","value":"epw","type":"password","required":true,"rows":null},{"label":"Confirm New Password","value":"cpw","type":"password","required":true,"rows":null}],"formValue":{"opw":"","epw":"","cpw":""},"payload":"","submit":"submit","cancel":"clear","topic":"","x":170,"y":2820,"wires":[["18675f27.26e691"]]},{"id":"18675f27.26e691","type":"function","z":"f6c367c2.63b9b8","name":"PW Match?","func":"\n\nif (msg.payload.epw !== msg.payload.cpw) {\n    msg.status = \"Passwords do not match, try again...\"\n}\nelse {\n    msg.status = \"match\";\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":2820,"wires":[["549989fe.a18108"]]},{"id":"549989fe.a18108","type":"switch","z":"f6c367c2.63b9b8","name":"Match or Error?","property":"status","propertyType":"msg","rules":[{"t":"eq","v":"match","vt":"str"},{"t":"eq","v":"Passwords do not match, try again...","vt":"str"}],"checkall":"false","repair":true,"outputs":2,"x":560,"y":2820,"wires":[["e2deef77.6b867"],["cec1194b.dac778"]]},{"id":"91c1a436.fe0cb8","type":"ui_toast","z":"f6c367c2.63b9b8","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"","name":"Show Error","x":910,"y":2820,"wires":[["c02caa35.d4bf98"]]},{"id":"c02caa35.d4bf98","type":"change","z":"f6c367c2.63b9b8","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"opw\":\"\",\"epw\":\"\",\"cpw\":\"\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1260,"y":2820,"wires":[["e3e9d958.66bc28"]]},{"id":"cec1194b.dac778","type":"change","z":"f6c367c2.63b9b8","name":"No Match","rules":[{"t":"set","p":"payload","pt":"msg","to":"status","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":2820,"wires":[["91c1a436.fe0cb8"]]},{"id":"81a5b5a8.c4b588","type":"string","z":"f6c367c2.63b9b8","name":"Inject PW","methods":[{"name":"replaceAll","params":[{"type":"str","value":"opw"},{"type":"msg","value":"payload.opw"}]},{"name":"replaceAll","params":[{"type":"str","value":"epw"},{"type":"msg","value":"payload.epw"}]}],"prop":"command","propout":"payload","object":"msg","objectout":"msg","x":900,"y":2780,"wires":[["3619a07.66d096"]]},{"id":"e2deef77.6b867","type":"change","z":"f6c367c2.63b9b8","name":"Format Exec","rules":[{"t":"set","p":"command","pt":"msg","to":"echo -e \"opw\\nepw\\nepw\" | passwd pi","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":750,"y":2780,"wires":[["81a5b5a8.c4b588"]]},{"id":"4cc8e728.f47738","type":"ui_toast","z":"f6c367c2.63b9b8","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"","name":"Show Success","x":1260,"y":2620,"wires":[["c02caa35.d4bf98"]]},{"id":"588f10b3.9736d","type":"string","z":"f6c367c2.63b9b8","name":"Format System Response","methods":[{"name":"delLeftMost","params":[{"type":"str","value":"passwd: "}]}],"prop":"payload","propout":"payload","object":"msg","objectout":"msg","x":950,"y":2660,"wires":[["510b7ab0.64df64"]]},{"id":"bf9b8786.fbf868","type":"comment","z":"f6c367c2.63b9b8","name":"Change Raspberry Pi System Password","info":"","x":230,"y":2580,"wires":[]},{"id":"510b7ab0.64df64","type":"switch","z":"f6c367c2.63b9b8","name":"Succeed?","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"password unchanged","vt":"str"},{"t":"cont","v":"password updated successfully","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":900,"y":2600,"wires":[["12cc0926.ca8497"],["4cc8e728.f47738"]]},{"id":"183426a1.418a59","type":"ui_toast","z":"f6c367c2.63b9b8","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"","name":"Show Error","x":1270,"y":2580,"wires":[["c02caa35.d4bf98"]]},{"id":"12cc0926.ca8497","type":"change","z":"f6c367c2.63b9b8","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Current password incorrect, try again...","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1080,"y":2580,"wires":[["183426a1.418a59"]]},{"id":"6480dafb.3b65c4","type":"ui_template","z":"f6c367c2.63b9b8","group":"7706781c.a53ca8","name":"Change Password Instructions","order":1,"width":0,"height":0,"format":"<div>\n    <p>\n    <br><b>eRVin runs on a Raspberry Pi microcomputer, for best security the Pi password should be changed from the default. If the password has never been changed the Current Password will be \"ervin2020\".</b>\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":210,"y":2700,"wires":[[]]},{"id":"fc272ff6.395b3","type":"fs-ops-copy","z":"f6c367c2.63b9b8","name":"icon64x64.png","sourcePath":"/coachproxy/home/pi/.node-red/icons","sourcePathType":"str","sourceFilename":"ervin_icon64x64.png","sourceFilenameType":"str","destPath":"/coachproxy/home/pi/.node-red/node_modules/node-red-dashboard/dist","destPathType":"str","destFilename":"icon64x64.png","destFilenameType":"str","link":false,"overwrite":true,"x":540,"y":2960,"wires":[[]]},{"id":"88cd1ea3.47b59","type":"fs-ops-copy","z":"f6c367c2.63b9b8","name":"icon120x120.png","sourcePath":"/coachproxy/home/pi/.node-red/icons","sourcePathType":"str","sourceFilename":"ervin_icon120x120.png","sourceFilenameType":"str","destPath":"/coachproxy/home/pi/.node-red/node_modules/node-red-dashboard/dist","destPathType":"str","destFilename":"icon120x120.png","destFilenameType":"str","link":false,"overwrite":true,"x":550,"y":3000,"wires":[[]]},{"id":"b91770be.5e38c","type":"fs-ops-copy","z":"f6c367c2.63b9b8","name":"icon192x192.png","sourcePath":"/coachproxy/home/pi/.node-red/icons","sourcePathType":"str","sourceFilename":"ervin_icon192x192.png","sourceFilenameType":"str","destPath":"/coachproxy/home/pi/.node-red/node_modules/node-red-dashboard/dist","destPathType":"str","destFilename":"icon192x192.png","destFilenameType":"str","link":false,"overwrite":true,"x":550,"y":3040,"wires":[[]]},{"id":"932d068a.4424c8","type":"fs-ops-copy","z":"f6c367c2.63b9b8","name":"icon407x407.png","sourcePath":"/coachproxy/home/pi/.node-red/icons","sourcePathType":"str","sourceFilename":"ervin_icon407x407.png","sourceFilenameType":"str","destPath":"/coachproxy/home/pi/.node-red/node_modules/node-red-dashboard/dist","destPathType":"str","destFilename":"icon407x407.png","destFilenameType":"str","link":false,"overwrite":true,"x":550,"y":3080,"wires":[[]]},{"id":"7b0400a3.01c35","type":"fs-ops-copy","z":"f6c367c2.63b9b8","name":"ervin_logo.jpg","sourcePath":"/coachproxy/home/pi/.node-red/icons","sourcePathType":"str","sourceFilename":"ervin_logo.jpg","sourceFilenameType":"str","destPath":"/coachproxy/home/pi/.node-red/node_modules/node-red-dashboard/dist","destPathType":"str","destFilename":"ervin_logo.jpg","destFilenameType":"str","link":false,"overwrite":true,"x":540,"y":3120,"wires":[[]]},{"id":"854f1131.40a74","type":"inject","z":"f6c367c2.63b9b8","name":"Update Favicons after Dashboard Update","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":240,"y":3040,"wires":[["7b0400a3.01c35","fc272ff6.395b3","88cd1ea3.47b59","b91770be.5e38c","932d068a.4424c8"]]},{"id":"a794d2cf.5e6d","type":"comment","z":"f6c367c2.63b9b8","name":"Update Favicons after Dashboard Update","info":"When the Dashboard contrib in Node-Red is updated it overwrites the following directory: /coachproxy/home/pi/.node-red/node_modules/node-red-dashboard/dist\n\nThis reverts the favicon icons to default amd also deletes the large eRVin logo.\n\nThis small flow simply copies backup ervin favicons and logo loacated at /coachproxy/home/pi/.node-red/icons\nto /coachproxy/home/pi/.node-red/node_modules/node-red-dashboard/dist\n\nFor a more permanent solution see this link.\n\nhttps://gist.github.com/mohnen/6923d5eb2e4547bb7e5bd90546d2ee80","x":230,"y":2980,"wires":[]},{"id":"f43ba533.bdbcc8","type":"exec","z":"f6c367c2.63b9b8","command":"sudo /coachproxy/configurator/remove_dataplicity.sh","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"Remove Dataplicity","x":670,"y":3320,"wires":[[],[],["a1463f73.55326"]]},{"id":"97acfae3.e798a8","type":"ui_button","z":"f6c367c2.63b9b8","name":"","group":"7d76c12c.bccc4","order":3,"width":"0","height":"0","passthru":false,"label":"Remove Dataplicity","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Do you really want to remove Dataplicity?","payloadType":"str","topic":"Are you sure?","x":170,"y":3320,"wires":[["407a4c84.f7e224"]]},{"id":"407a4c84.f7e224","type":"ui_toast","z":"f6c367c2.63b9b8","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"Cancel","raw":false,"topic":"","name":"r u sure?","x":340,"y":3320,"wires":[["2187ede2.1e1c32"]]},{"id":"c9142614.3d54a8","type":"ui_template","z":"f6c367c2.63b9b8","group":"7d76c12c.bccc4","name":"Dataplicity","order":1,"width":"6","height":"3","format":"\n<div layout=\"column\" layout-align=\"space-between\">\n<p>\nDataplicity provides remote access to eRVin from anywhere there is internet access. To install Dataplicity, please follow these \n<a target='_blank' href='https://myervin.com/how-to-install-dataplicity-for-remote-access-to-ervin'>instructions.</a>\n</p>\n<p>\nIf you need to reset your Dataplicity link or want to remove Dataplicity, click the Remove Dataplicity button below:\n</p>\n</div>\n","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":150,"y":3280,"wires":[[]]},{"id":"88950e74.74d73","type":"comment","z":"f6c367c2.63b9b8","name":"Dataplicity Installation and Removal","info":"","x":220,"y":3220,"wires":[]},{"id":"388e2849.6fbed8","type":"ui_toast","z":"f6c367c2.63b9b8","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"","name":"Removed","x":1040,"y":3320,"wires":[[]]},{"id":"766bdd56.7b0ec4","type":"ui_button","z":"f6c367c2.63b9b8","name":"","group":"9c7e0074.77f72","order":16,"width":0,"height":0,"passthru":false,"label":"Install Configuration","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Are you sure you want to replace the configuration file? This will reset your settings to default and restart eRVin. Please allow up to 5 minutes for the new configuration to load.","payloadType":"str","topic":"","x":160,"y":2180,"wires":[["f3d62b65.5b7668"]]},{"id":"a1463f73.55326","type":"function","z":"f6c367c2.63b9b8","name":"","func":"msg.topic = \"\"\n//code = msg.payload.code\n\nif (msg.payload.code !== 0) {\n    msg.topic = 'Error #'\n    msg.payload = msg.payload.code\n} else {\n    msg.payload = \"Dataplicity Sucessfully Removed\"\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":880,"y":3320,"wires":[["388e2849.6fbed8"]]},{"id":"2187ede2.1e1c32","type":"switch","z":"f6c367c2.63b9b8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"OK","vt":"str"},{"t":"eq","v":"Cancel","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":490,"y":3320,"wires":[["f43ba533.bdbcc8"],[]]},{"id":"74da87e2.f6f698","type":"ui_switch","z":"5a05b8f3.894b88","name":"System/Remote Access - Dataplicity","label":"System/Remote Access - Dataplicity","tooltip":"","group":"c2caa18b.132cd","order":9,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"group\":{\"hide\":\"System_Remote_Access_-_Dataplicity\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"group\":{\"show\":\"System_Remote_Access_-_Dataplicity\"}}","offvalueType":"json","officon":"","offcolor":"","x":2190,"y":2840,"wires":[["8a643317.4b405","d27961fd.c7a35"]]},{"id":"132b269d.499359","type":"ui_switch","z":"5a05b8f3.894b88","name":"System/Remote Access - ngrok","label":"System/Remote Access - ngrok","tooltip":"","group":"c2caa18b.132cd","order":10,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"group\":{\"hide\":\"System_Remote_Access_-_ngrok\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"group\":{\"show\":\"System_Remote_Access_-_ngrok\"}}","offvalueType":"json","officon":"","offcolor":"","x":2170,"y":2880,"wires":[["8a643317.4b405","d27961fd.c7a35"]]},{"id":"b0eb7f14.8e3d","type":"ui_switch","z":"5a05b8f3.894b88","name":"System/Install Configuration File","label":"System/Install Configuration File","tooltip":"","group":"c2caa18b.132cd","order":12,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"group\":{\"hide\":\"System_Install_Configuration_File\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"group\":{\"show\":\"System_Install_Configuration_File\"}}","offvalueType":"json","officon":"","offcolor":"","x":2170,"y":2960,"wires":[["8a643317.4b405","d27961fd.c7a35"]]},{"id":"adc4fa81.556ac8","type":"ui_switch","z":"5a05b8f3.894b88","name":"System/Change System Password","label":"System/Change System Password","tooltip":"","group":"c2caa18b.132cd","order":13,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"group\":{\"hide\":\"System_Change_System_Password\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"group\":{\"show\":\"System_Change_System_Password\"}}","offvalueType":"json","officon":"","offcolor":"","x":2180,"y":3000,"wires":[["8a643317.4b405","d27961fd.c7a35"]]},{"id":"882ee0dc.d5be9","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.group","tot":"msg"},{"t":"set","p":"payload.group","pt":"msg","to":"options.group.System_Remote_Access_-_Dataplicity","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1910,"y":2840,"wires":[["74da87e2.f6f698"]]},{"id":"1465fe9e.ef8601","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.group","tot":"msg"},{"t":"set","p":"payload.group","pt":"msg","to":"options.group.System_Remote_Access_-_ngrok","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1910,"y":2880,"wires":[["132b269d.499359"]]},{"id":"fe428d5d.ce95d","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.group","tot":"msg"},{"t":"set","p":"payload.group","pt":"msg","to":"options.group.System_Install_Configuration_Files","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1910,"y":2960,"wires":[["b0eb7f14.8e3d"]]},{"id":"5d5976.bd20668c","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.group","tot":"msg"},{"t":"set","p":"payload.group","pt":"msg","to":"options.group.System_Change_System_Password","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1910,"y":3000,"wires":[["adc4fa81.556ac8"]]},{"id":"8f5b6b00.461478","type":"ui_text","z":"2fdd8124.05e35e","group":"f961f048.b0646","order":4,"width":"0","height":"0","name":"RV Year","label":"RV Year","format":"{{msg.payload}}","layout":"","x":820,"y":3040,"wires":[]},{"id":"f203ea15.b39b98","type":"ui_text","z":"2fdd8124.05e35e","group":"f961f048.b0646","order":6,"width":"","height":"","name":"RV Model","label":"RV Model","format":"{{msg.payload}}","layout":"","x":820,"y":3120,"wires":[]},{"id":"af2265a5.469548","type":"ui_text","z":"2fdd8124.05e35e","group":"f961f048.b0646","order":7,"width":"","height":"","name":"RV Floorplan","label":"RV Floorplan","format":"{{msg.payload}}","layout":"","x":840,"y":3160,"wires":[]},{"id":"c5e87b31.cdcbf8","type":"ui_text","z":"2fdd8124.05e35e","group":"f961f048.b0646","order":5,"width":"0","height":"0","name":"RV Brand","label":"RV Brand","format":"{{msg.payload}}","layout":"","x":820,"y":3080,"wires":[]},{"id":"eaa8d500.db54a8","type":"ui_text","z":"2fdd8124.05e35e","group":"f961f048.b0646","order":3,"width":"","height":"","name":"Flow Version","label":"eRVin Flow Version","format":"{{msg.payload}}","layout":"","x":840,"y":3200,"wires":[]},{"id":"a3826d19.e226f","type":"mqtt out","z":"2fdd8124.05e35e","name":"","topic":"GLOBAL/RVINFO","qos":"","retain":"","broker":"c1170463.5c7f8","x":430,"y":3180,"wires":[]},{"id":"6ee29250.213b3c","type":"inject","z":"2fdd8124.05e35e","name":"RIVINFO","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.5","topic":"eRVin","payload":"2018_Entegra_Anthem-CS_DEQ_v_0.50","payloadType":"str","x":200,"y":3120,"wires":[["87f96e95.abf56","a3826d19.e226f","10c0af14.d78f81","bb6dbb4.2e4b948"]],"info":"Enter the RV Info for this flow\nFormat to be 5 parameters as follows with spaces between:\n\nYear Brand Model Floorplan Flow_Version"},{"id":"87f96e95.abf56","type":"split","z":"2fdd8124.05e35e","name":"","splt":"_","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":380,"y":3120,"wires":[["29e04182.cdb39e"]]},{"id":"29e04182.cdb39e","type":"switch","z":"2fdd8124.05e35e","name":"","property":"parts.index","propertyType":"msg","rules":[{"t":"cont","v":"0","vt":"str"},{"t":"cont","v":"1","vt":"str"},{"t":"cont","v":"2","vt":"str"},{"t":"cont","v":"3","vt":"str"},{"t":"cont","v":"5","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":600,"y":3120,"wires":[["8f5b6b00.461478"],["c5e87b31.cdcbf8"],["f203ea15.b39b98"],["af2265a5.469548"],["eaa8d500.db54a8"]]},{"id":"b0d48a3d.eb0fc8","type":"comment","z":"2fdd8124.05e35e","name":"Enter RV Info Below","info":"Enter the RV Info for this flow\n\nFormat to be 5 parameters as follows with underbar between:\n\nYear_Brand_Model_Floorplan_v_Version","x":205,"y":3056.08349609375,"wires":[]},{"id":"10c0af14.d78f81","type":"change","z":"2fdd8124.05e35e","name":"","rules":[{"t":"set","p":"RVinfo","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":3240,"wires":[[]]},{"id":"ae64ed30.c937c","type":"ui_switch","z":"5a05b8f3.894b88","name":"System/Update Configuration Files","label":"System/Update Configuration Files","tooltip":"","group":"c2caa18b.132cd","order":11,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"group\":{\"hide\":\"System_Update_Configuration_Files\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"group\":{\"show\":\"System_Update_Configuration_Files\"}}","offvalueType":"json","officon":"","offcolor":"","x":2180,"y":2920,"wires":[["8a643317.4b405","d27961fd.c7a35"]]},{"id":"ffd6c7d2.6d5d58","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.group","tot":"msg"},{"t":"set","p":"payload.group","pt":"msg","to":"options.group.System_Update_Configuration_Files","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1910,"y":2920,"wires":[["ae64ed30.c937c"]]},{"id":"805f6d85.bdbf8","type":"comment","z":"f6c367c2.63b9b8","name":"Install eRVin Configuration File","info":"This flow will copy a file with a descriptive filename from /coachproxy/home/pi/.node-red/flows write it to the node red flows file at /coachproxy/home/pi/.node-red with the filename flows_coachproxy.json. This is the default flow node-red will use when it starts up.\n\nThis flow also copies the appropriate HAbridge file located at /coachproxy/home/pi/.node-red/flows to the following path /coachproxy/ha-bridge\n\nThe HAbridge file is relatively static so initially it is manually saved to /coachproxy/home/pi/.node-red/flows. The HAbridge filename must be identical to the flows file name but without the version (_v_nnn) and a \".db\" extension. When copied to /coachproxy/ha-bridge the name is changed to device.db ","x":190,"y":1900,"wires":[]},{"id":"d8d5c35c.b0eaf","type":"link in","z":"f6c367c2.63b9b8","name":"Refresh File List","links":["a2637dd4.1984e","b3de5cf3.53752"],"x":95,"y":1960,"wires":[["3d9a5063.d365"]]},{"id":"bb6dbb4.2e4b948","type":"string","z":"2fdd8124.05e35e","name":"","methods":[{"name":"delRightMost","params":[{"type":"str","value":"_v"}]},{"name":"append","params":[{"type":"str","value":".db"}]}],"prop":"payload","propout":"payload","object":"msg","objectout":"msg","x":370,"y":3280,"wires":[["b3db228d.e92df"]]},{"id":"b3db228d.e92df","type":"change","z":"2fdd8124.05e35e","name":"","rules":[{"t":"set","p":"RVhabridge","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":3280,"wires":[[]]},{"id":"2dd694f6.8899ac","type":"comment","z":"5a05b8f3.894b88","name":"Save this flow to the Flows file on the Raspberry Pi","info":"This tool should be run after a Deploy to ensure the flow is written to a file with a descriptive filename at /coachproxy/home/pi/.node-red/flows.\n\nThe Load eRVin Configuration flow above will copy a file with a descriptive filename from /coachproxy/home/pi/.node-red/flows and write it to the node red flows file at /coachproxy/home/pi/.node-red with the filename flows_coachproxy.json. This is the default flow node-red will use when it starts up.\n\nThe Load eRVin Configuration flow also copies the appropriate HAbridge file located at /coachproxy/home/pi/.node-red/flows to the following path /coachproxy/ha-bridge\n\nThe HAbridge file is relatively static for each floorplan so initially it is manually saved to /coachproxy/home/pi/.node-red/flows. The HAbridge filename must be identical to the flows file name but without the version (_v_nnn) and a \".db\" extension. When copied to /coachproxy/ha-bridge the name is changed to device.db ","x":210,"y":80,"wires":[]},{"id":"be087378.ae179","type":"comment","z":"f6c367c2.63b9b8","name":"Get updated config (flow) files from flows.myervin.com","info":"This flow accesses the ervin server at flows.myervin.com to download updated or new flows to /coachproxy/home/pi/.node-red/flows.\n\nIn addition, the habridge database file of the same name is also downloaded but from habridge.myervin.com to /coachproxy/home/pi/.node-red/flows\n\nIf a flows and habridge file of the exact same name and version is already installed on the ervin raspberry pi at /coachproxy/home/pi/.node-red/flows, a confirmation dialog is presented to confirm overwrite. If yes, the existing flow and habridge files in the above folder are deleted first (because wget does not overwrite existing files but instead creates a new one with a modified name).\n\n","x":260,"y":3420,"wires":[]},{"id":"242c88f9.694608","type":"http request","z":"f6c367c2.63b9b8","name":"get filenames","method":"GET","ret":"txt","paytoqs":"ignore","url":"https://flows.myervin.com","tls":"","persist":false,"proxy":"","authType":"","x":460,"y":3480,"wires":[["6f06bb86.1f1474"]]},{"id":"89ed6828.09d008","type":"ui_list","z":"f6c367c2.63b9b8","group":"43a9d023.b2434","name":"list","order":3,"width":"6","height":"4","lineType":"one","actionType":"check","allowHTML":false,"outputs":1,"topic":"","x":450,"y":3560,"wires":[["af12c5de.6d21f8"]]},{"id":"6f06bb86.1f1474","type":"html","z":"f6c367c2.63b9b8","name":"clean up","property":"payload","outproperty":"payload","tag":"a[href*=\"_\"]","ret":"text","as":"multi","x":620,"y":3480,"wires":[["b3d245f0.16c578"]]},{"id":"2b31979c.893d08","type":"join","z":"f6c367c2.63b9b8","name":"make obj","mode":"custom","build":"object","property":"payload","propertyType":"msg","key":"parts.index","joiner":"\\n","joinerType":"str","accumulate":true,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"num","reduceFixup":"","x":1120,"y":3480,"wires":[["89ed6828.09d008"]]},{"id":"b3d245f0.16c578","type":"change","z":"f6c367c2.63b9b8","name":"payload.title","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.title","tot":"msg"},{"t":"set","p":"filecount","pt":"flow","to":"parts.count","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":3480,"wires":[["2b31979c.893d08"]]},{"id":"a193e073.3f68d","type":"exec","z":"f6c367c2.63b9b8","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":990,"y":3760,"wires":[[],[],["d3b47f1a.defb"]]},{"id":"3137c047.bba1e","type":"function","z":"f6c367c2.63b9b8","name":"","func":"// Copyright 20201 Rob Picchione\n// Formats wget for exec node to download selected file\n\nif (msg.payload.isChecked === false ) {\n    return null\n}\n\n\nflowfiles = \"wget \" + \"https://flows.myervin.com/\" + msg.payload.title + \" -P \" + \"/coachproxy/home/pi/.node-red/flows\"\nhabridgefiles = \"wget \" + \"https://habridge.myervin.com/\" + msg.payload.habridge +'.db' + \" -P \" + \"/coachproxy/home/pi/.node-red/flows\"\nvar msg3 = { 'enabled': false };\nvar msg2 = { 'payload': habridgefiles};\nvar msg1 = { 'payload': flowfiles};\n\nreturn [ msg1, msg2, msg3 ];\n","outputs":3,"noerr":0,"initialize":"","finalize":"","x":580,"y":3780,"wires":[["a193e073.3f68d","3b48b7b5.871bf8"],["103cd2e1.941d0d"],["89ed6828.09d008"]]},{"id":"ab249877.56bb98","type":"ui_toast","z":"f6c367c2.63b9b8","position":"top right","displayTime":"3","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"Successful","x":450,"y":3900,"wires":[]},{"id":"a6e69e7a.44303","type":"change","z":"f6c367c2.63b9b8","name":"","rules":[{"t":"change","p":"payload.code","pt":"msg","from":"0","fromt":"num","to":"true","tot":"str"},{"t":"move","p":"payload.code","pt":"msg","to":"enabled","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"File Sucessfully Downloaded","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":220,"y":3900,"wires":[["89ed6828.09d008","f80b99eb.9b26b8","ab249877.56bb98","b3de5cf3.53752"]]},{"id":"f80b99eb.9b26b8","type":"ui_button","z":"f6c367c2.63b9b8","name":"","group":"43a9d023.b2434","order":2,"width":0,"height":0,"passthru":true,"label":"List Online Config Files","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":210,"y":3480,"wires":[["242c88f9.694608"]]},{"id":"d3b47f1a.defb","type":"switch","z":"f6c367c2.63b9b8","name":"error?","property":"payload.code","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"neq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1170,"y":3820,"wires":[["a6e69e7a.44303"],["277d4b28.2a3854"]]},{"id":"6761b49a.552d4c","type":"ui_toast","z":"f6c367c2.63b9b8","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"","name":"Error","x":1070,"y":3920,"wires":[[]]},{"id":"277d4b28.2a3854","type":"change","z":"f6c367c2.63b9b8","name":"","rules":[{"t":"move","p":"payload.code","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"topic","pt":"msg","to":"Error #","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":900,"y":3920,"wires":[["6761b49a.552d4c"]]},{"id":"af12c5de.6d21f8","type":"fs-ops-access","z":"f6c367c2.63b9b8","name":"file exists?","path":"/coachproxy/home/pi/.node-red/flows","pathType":"str","filename":"payload.title","filenameType":"msg","read":true,"write":false,"throwerror":false,"x":610,"y":3560,"wires":[["52b72bb6.5f0b74"],["f11527a7.eeee28"]]},{"id":"52b72bb6.5f0b74","type":"change","z":"f6c367c2.63b9b8","name":"","rules":[{"t":"move","p":"payload","pt":"msg","to":"payloadtoo","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"The configuration file selected already exists on eRVin, are you sure you want to overwrite it?","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":820,"y":3560,"wires":[["16b4773d.2efbb9"]]},{"id":"32d9e59f.c6107a","type":"ui_template","z":"f6c367c2.63b9b8","group":"43a9d023.b2434","name":"Configuration Files","order":1,"width":"6","height":"3","format":"\n<div layout=\"column\" layout-align=\"space-between\">\n<p>\n - This feature will allow you to download new and/or updated configuration files from the eRVin server online and copy them to your eRVin system.\n <br>- First click the <b>List Online Config Files</b> button below, then click the checkbox for the file you want.\n <br>- Once downloaded, use the <b>Install Configuration File</b> section below to update eRVin.\n <br>- This feature requires that eRVin have an internet connection. \n</p>\n</div>\n","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":230,"y":3540,"wires":[[]]},{"id":"103cd2e1.941d0d","type":"exec","z":"f6c367c2.63b9b8","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":990,"y":3820,"wires":[[],[],["d3b47f1a.defb"]]},{"id":"f11527a7.eeee28","type":"string","z":"f6c367c2.63b9b8","name":"","methods":[{"name":"delRightMost","params":[{"type":"str","value":"_v"}]}],"prop":"payload.title","propout":"payload.habridge","object":"msg","objectout":"msg","x":450,"y":3780,"wires":[["3137c047.bba1e"]]},{"id":"3b48b7b5.871bf8","type":"ui_toast","z":"f6c367c2.63b9b8","position":"top right","displayTime":"3","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"File Download in Progress","name":"Downloading","x":830,"y":3720,"wires":[]},{"id":"b3de5cf3.53752","type":"link out","z":"f6c367c2.63b9b8","name":"Send Refresh","links":["d8d5c35c.b0eaf"],"x":395,"y":3940,"wires":[]},{"id":"16b4773d.2efbb9","type":"ui_toast","z":"f6c367c2.63b9b8","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"Overwrite","cancel":"Cancel","raw":false,"topic":"","name":"","x":1010,"y":3560,"wires":[["7d3919b1.298878"]]},{"id":"7d3919b1.298878","type":"switch","z":"f6c367c2.63b9b8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Overwrite","vt":"str"},{"t":"eq","v":"Cancel","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1170,"y":3560,"wires":[["93be55f0.d25ee8"],["f80b99eb.9b26b8"]]},{"id":"93be55f0.d25ee8","type":"change","z":"f6c367c2.63b9b8","name":"","rules":[{"t":"move","p":"payloadtoo","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1380,"y":3500,"wires":[["e10ad61f.3acf98"]]},{"id":"e10ad61f.3acf98","type":"fs-ops-delete","z":"f6c367c2.63b9b8","name":"del flows file","path":"/coachproxy/home/pi/.node-red/flows","pathType":"str","filename":"payload.title","filenameType":"msg","x":1390,"y":3560,"wires":[["c2053c2c.2590c","f11527a7.eeee28"]]},{"id":"e0b5e7d0.0e5ff8","type":"fs-ops-delete","z":"f6c367c2.63b9b8","name":"del habridge file","path":"/coachproxy/home/pi/.node-red/flows","pathType":"str","filename":"payload.title","filenameType":"msg","x":1420,"y":3680,"wires":[[]]},{"id":"c2053c2c.2590c","type":"string","z":"f6c367c2.63b9b8","name":"","methods":[{"name":"delRightMost","params":[{"type":"str","value":"_v"}]},{"name":"append","params":[{"type":"str","value":".db"}]}],"prop":"payload.title","propout":"payload.title","object":"msg","objectout":"msg","x":1250,"y":3680,"wires":[["e0b5e7d0.0e5ff8"]]},{"id":"1b58dcc8.b224b3","type":"catch","z":"f6c367c2.63b9b8","name":"Missing HAbridge File","scope":["20a0a995.f8edc6","8591d488.898fc8"],"uncaught":false,"x":160,"y":2240,"wires":[["50367296.f8099c"]]},{"id":"1291777.4d50689","type":"ui_toast","z":"f6c367c2.63b9b8","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"Error","name":"Error","x":610,"y":2240,"wires":[[]]},{"id":"50367296.f8099c","type":"change","z":"f6c367c2.63b9b8","name":"","rules":[{"t":"move","p":"error.message","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":2240,"wires":[["1291777.4d50689"]]},{"id":"fc13abe8.5b7bd8","type":"fs-ops-copy","z":"f6c367c2.63b9b8","name":"","sourcePath":"/coachproxy/home/pi/.node-red","sourcePathType":"str","sourceFilename":"flows_coachproxy.json","sourceFilenameType":"str","destPath":"/coachproxy/home/pi/.node-red/flows","destPathType":"str","destFilename":"RVinfo","destFilenameType":"global","link":false,"overwrite":true,"x":560,"y":4060,"wires":[[]]},{"id":"67b13987.d1f268","type":"inject","z":"f6c367c2.63b9b8","name":"Copy This Flow - Deploy First!","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":190,"y":4060,"wires":[["fc13abe8.5b7bd8"]]},{"id":"2623c77b.dc0de8","type":"comment","z":"f6c367c2.63b9b8","name":"Save this flow to the Flows file on the Raspberry Pi","info":"This tool should be run after a Deploy to ensure the flow is written to a file with a descriptive filename at /coachproxy/home/pi/.node-red/flows.\n\nThe Load eRVin Configuration flow above will copy a file with a descriptive filename from /coachproxy/home/pi/.node-red/flows and write it to the node red flows file at /coachproxy/home/pi/.node-red with the filename flows_coachproxy.json. This is the default flow node-red will use when it starts up.\n\nThe Load eRVin Configuration flow also copies the appropriate HAbridge file located at /coachproxy/home/pi/.node-red/flows to the following path /coachproxy/ha-bridge\n\nThe HAbridge file is relatively static for each floorplan so initially it is manually saved to /coachproxy/home/pi/.node-red/flows. The HAbridge filename must be identical to the flows file name but without the version (_v_nnn) and a \".db\" extension. When copied to /coachproxy/ha-bridge the name is changed to device.db ","x":250,"y":4020,"wires":[]},{"id":"b9955953.ac37e8","type":"fs-ops-copy","z":"f6c367c2.63b9b8","name":"","sourcePath":"/coachproxy/ha-bridge","sourcePathType":"str","sourceFilename":"device.db","sourceFilenameType":"str","destPath":"/coachproxy/home/pi/.node-red/flows","destPathType":"str","destFilename":"RVhabridge","destFilenameType":"global","link":false,"overwrite":true,"x":560,"y":4100,"wires":[[]]},{"id":"7a0c66bd.3b88a8","type":"inject","z":"f6c367c2.63b9b8","name":"Copy the HAbridge device.db - Deploy First!","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":240,"y":4100,"wires":[["b9955953.ac37e8"]]}]