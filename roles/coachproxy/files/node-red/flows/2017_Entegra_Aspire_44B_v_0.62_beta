[{"id":"5a05b8f3.894b88","type":"tab","label":"Main","disabled":false},{"id":"23312cd9.0451a4","type":"tab","label":"Alexa-Virtual","disabled":false,"info":""},{"id":"2fdd8124.05e35e","type":"tab","label":"Notify / System","disabled":false,"info":""},{"id":"477cac19.6a9e64","type":"tab","label":"Logic","disabled":false,"info":""},{"id":"f6c367c2.63b9b8","type":"tab","label":"Configuration","disabled":false,"info":""},{"id":"84f0327e.4d899","type":"tab","label":"Automations","disabled":false,"info":""},{"id":"ceeb844e7eb3d728","type":"tab","label":"CAN Tools","disabled":false,"info":"","env":[]},{"id":"5900d0c.97552b","type":"ui_tab","z":"5a05b8f3.894b88","name":"Status","icon":"visibility","order":7},{"id":"c1170463.5c7f8","type":"mqtt-broker","broker":"localhost","port":"1883","clientid":"","usetls":false,"verifyservercert":true,"compatmode":true,"keepalive":"15","cleansession":true,"birthTopic":"","birthQos":"0","birthRetain":"true","birthPayload":"","willTopic":"","willQos":"0","willRetain":"true","willPayload":""},{"id":"221dd600.02338a","type":"ui_tab","z":"5a05b8f3.894b88","name":"Exterior","icon":"directions_bus","order":3},{"id":"ca7e3f9c.a33c","type":"ui_tab","z":"5a05b8f3.894b88","name":"Interior","icon":"home","order":2},{"id":"b515d680.664548","type":"ui_group","z":"5a05b8f3.894b88","name":"Mid Bath","tab":"ca7e3f9c.a33c","order":4,"disp":true,"width":"6","collapse":true},{"id":"4da57d95.96a5cc","type":"ui_tab","name":"Notifications","icon":"notifications_active","order":11,"disabled":false,"hidden":false},{"id":"b2130e68.3a338","type":"sqlitedb","z":"2fdd8124.05e35e","db":"/coachproxy/node-red/coachproxy.sqlite"},{"id":"2e0a52f8.6acbee","type":"ui_group","z":"5a05b8f3.894b88","name":"Main","tab":"ca7e3f9c.a33c","order":2,"disp":true,"width":"6","collapse":true},{"id":"cae5b35a.e3024","type":"ui_group","z":"5a05b8f3.894b88","name":"Water Pump","tab":"803d3461.22e8e8","order":2,"disp":true,"width":"6","collapse":true},{"id":"517030c5.11f8b8","type":"ui_group","z":"5a05b8f3.894b88","name":"Bedroom","tab":"ca7e3f9c.a33c","order":5,"disp":true,"width":"6","collapse":true},{"id":"f92ef285.8be6b","type":"ui_group","z":"5a05b8f3.894b88","name":"Bath","tab":"ca7e3f9c.a33c","order":3,"disp":true,"width":"6","collapse":true},{"id":"4e2af34d.8f765c","type":"ui_group","z":"5a05b8f3.894b88","name":"Exterior Lights","tab":"221dd600.02338a","order":1,"disp":true,"width":"6","collapse":true},{"id":"f6ae28b7.041968","type":"ui_group","name":"Locks","tab":"b4dcab90.f67fb8","order":2,"disp":true,"width":"6","collapse":true},{"id":"87ed7eaa.ab8fe","type":"ui_group","name":"Readings","tab":"5900d0c.97552b","order":1,"disp":true,"width":"6","collapse":true},{"id":"a4a573ee.d6bdf","type":"ui_group","name":"Generator","tab":"5900d0c.97552b","order":3,"disp":true,"width":"6","collapse":true},{"id":"d944623c.5b46b8","type":"ui_group","name":"Memory Master","tab":"ca7e3f9c.a33c","order":1,"disp":true,"width":"6","collapse":true},{"id":"f961f048.b0646","type":"ui_group","name":"Software Information","tab":"10cd091e.2c38a7","order":1,"disp":true,"width":"6","collapse":true},{"id":"cd05e210.dac658","type":"ui_group","name":"Network Information","tab":"10cd091e.2c38a7","order":3,"disp":true,"width":"6","collapse":true},{"id":"b29ba418.731d88","type":"ui_base","theme":{"name":"theme-custom","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#169dd3","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"default":"#4B7930","baseColor":"#3d89be","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","reset":false,"name":"eRVin"},"themeState":{"base-color":{"default":"#3d89be","value":"#3d89be","edited":false},"page-titlebar-backgroundColor":{"value":"#3d89be","edited":true},"page-backgroundColor":{"value":"#e8e8e8","edited":true},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#75acd3","edited":true},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#3d89be","edited":true},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"eRVin","hideToolbar":"false","allowSwipe":"false","dateFormat":"YYYY/MM/DD","sizes":{"sx":48,"sy":48,"gx":14,"gy":14,"cx":6,"cy":6,"px":4,"py":6},"lockMenu":"false","allowTempTheme":"true"}},{"id":"5d7e55cd.f34c2c","type":"ui_group","name":"Awnings","tab":"221dd600.02338a","order":2,"disp":true,"width":"6","collapse":true},{"id":"39ecc94c.7e22c6","type":"ui_group","name":"Welcome","tab":"2b742e36.100002","order":1,"disp":true,"width":"6","collapse":false},{"id":"dd373808.7ec1d8","type":"ui_group","d":true,"name":"Coach Options","tab":"2b742e36.100002","order":4,"disp":true,"width":"6","collapse":false},{"id":"e1a5049d.4cee88","type":"ui_group","d":true,"name":"Save and Install","tab":"2b742e36.100002","order":6,"disp":true,"width":"6","collapse":false},{"id":"b9bfcd9c.3c935","type":"sqlitedb","db":"/coachproxy/node-red/coachproxy.sqlite"},{"id":"2b742e36.100002","type":"ui_tab","name":"About","icon":"info","order":14,"disabled":false,"hidden":false},{"id":"10cd091e.2c38a7","type":"ui_tab","name":"System","icon":"settings","order":12},{"id":"fb4c3e00.5737a","type":"ui_group","name":"Power","tab":"5900d0c.97552b","order":2,"disp":true,"width":"6","collapse":true},{"id":"23adf1d9.326cae","type":"ui_group","name":"Remote Access - ngrok","tab":"10cd091e.2c38a7","order":5,"disp":true,"width":"6","collapse":true},{"id":"7dcb24f9.ce47cc","type":"ui_group","name":"Alexa Commands","tab":"","order":2,"disp":true,"width":"6","collapse":true},{"id":"a027aa68.277858","type":"ui_group","name":"Restart Alexa Integration","tab":"","order":1,"disp":true,"width":"6","collapse":true},{"id":"f4d0f875.b5dda8","type":"ui_group","d":true,"name":"User Interface Options","tab":"2b742e36.100002","order":5,"disp":true,"width":"6","collapse":false},{"id":"7f355d52.ee5a24","type":"ui_group","name":"Notification Rules","tab":"4da57d95.96a5cc","order":4,"disp":true,"width":"6","collapse":true},{"id":"d0c7f134.375fd","type":"ui_group","name":"Notification Settings","tab":"4da57d95.96a5cc","order":1,"disp":true,"width":"6","collapse":true},{"id":"9ed66528.add608","type":"ui_group","name":"Notification Email Address","tab":"4da57d95.96a5cc","order":2,"disp":true,"width":"6","collapse":true},{"id":"e4fd4ed4.a377f","type":"ui_group","name":"Copyright","tab":"2b742e36.100002","order":3,"disp":true,"width":"6","collapse":false},{"id":"b043acd4.87089","type":"ui_group","name":"Notification SMTP Server","tab":"4da57d95.96a5cc","order":3,"disp":true,"width":"6","collapse":true},{"id":"d361ec81.7d08a","type":"ui_group","name":"Switch Panels","tab":"ca7e3f9c.a33c","order":6,"disp":true,"width":"6","collapse":true},{"id":"803d3461.22e8e8","type":"ui_tab","name":"Aquahot","icon":"whatshot","order":5,"disabled":false,"hidden":false},{"id":"cf9b6bb9.e5ef38","type":"ui_group","name":"Controls","tab":"803d3461.22e8e8","order":1,"disp":true,"width":"6","collapse":true},{"id":"ae3b3824.48abe8","type":"ui_group","name":"Cockpit Shades","tab":"1a09069c.93f929","order":3,"disp":true,"width":"6","collapse":true},{"id":"5725fb8d.051db4","type":"ui_group","name":"General Shades","tab":"1a09069c.93f929","order":1,"disp":true,"width":"6","collapse":true},{"id":"5a6f1f47.88d1c","type":"ui_group","name":"Living Room Shades","tab":"1a09069c.93f929","order":4,"disp":true,"width":"6","collapse":true},{"id":"3806de6b.607142","type":"ui_group","name":"Bedroom Shades","tab":"1a09069c.93f929","order":5,"disp":true,"width":"6","collapse":true},{"id":"6fd8f21b.f22b1c","type":"ui_group","name":"Bathroom Shades","tab":"1a09069c.93f929","order":6,"disp":true,"width":"6","collapse":true},{"id":"1a09069c.93f929","type":"ui_tab","name":"Shades","icon":"wb_cloudy","order":4,"disabled":false,"hidden":false},{"id":"ca514016.47102","type":"ui_group","name":"Info","tab":"2b742e36.100002","order":2,"disp":true,"width":"6","collapse":false},{"id":"5cbd9089.f3b65","type":"ui_group","d":true,"name":"Old Welcome","tab":"2b742e36.100002","order":7,"disp":true,"width":"6","collapse":false},{"id":"7ef807d5.1ca3b8","type":"ui_group","name":"Scene Control","tab":"b77c5ec5.c13b5","order":1,"disp":true,"width":"6","collapse":true},{"id":"b77c5ec5.c13b5","type":"ui_tab","name":"Scenes","icon":"photo","order":1,"disabled":false,"hidden":false},{"id":"abfd1685.b229d8","type":"ui_group","name":"Lights On Mode","tab":"e0c750f3.500ed","order":1,"disp":true,"width":"6","collapse":true},{"id":"ec9d7f42.8db13","type":"ui_group","name":"Scene Builder","tab":"b77c5ec5.c13b5","order":2,"disp":true,"width":"6","collapse":true},{"id":"fe130cc1.4b7f6","type":"ui_group","name":"How to use Scene Builder","tab":"b77c5ec5.c13b5","order":3,"disp":true,"width":"6","collapse":true},{"id":"e0c750f3.500ed","type":"ui_tab","name":"Options","icon":"check_box","order":9,"disabled":false,"hidden":false},{"id":"dd035f6c.5d73e","type":"ui_group","name":"Show/Hide Tabs","tab":"e0c750f3.500ed","order":3,"disp":true,"width":"6","collapse":true},{"id":"b4dcab90.f67fb8","type":"ui_tab","name":"Locks","icon":"lock","order":6,"disabled":false,"hidden":false},{"id":"c2caa18b.132cd","type":"ui_group","name":"Show/Hide Groups","tab":"e0c750f3.500ed","order":4,"disp":true,"width":"6","collapse":true},{"id":"97b9ad54.9933e","type":"ui_group","name":"System Information","tab":"10cd091e.2c38a7","order":2,"disp":true,"width":"6","collapse":true},{"id":"1098dc18.d96274","type":"ui_tab","name":"Location","icon":"location_on","order":8,"disabled":false,"hidden":false},{"id":"4ba9cfc2.1a222","type":"ui_group","name":"Moon Phase","tab":"1098dc18.d96274","order":2,"disp":true,"width":"6","collapse":true},{"id":"fc3455d4.45be98","type":"ui_group","name":"GPS Status","tab":"1098dc18.d96274","order":1,"disp":true,"width":"6","collapse":true},{"id":"b7dc85ae.2ad0a8","type":"ui_group","name":"Map","tab":"1098dc18.d96274","order":5,"disp":true,"width":"6","collapse":true},{"id":"9c7e0074.77f72","type":"ui_group","name":"Install Configuration File","tab":"10cd091e.2c38a7","order":7,"disp":true,"width":"6","collapse":true},{"id":"9108c0fb.ca8ee","type":"ui_spacer","name":"spacer","group":"d944623c.5b46b8","order":3,"width":1,"height":1},{"id":"62846913.637978","type":"ui_spacer","name":"spacer","group":"d944623c.5b46b8","order":5,"width":3,"height":1},{"id":"f91d30ee.81533","type":"ui_group","name":"Sofa/Sconce Mode","tab":"e0c750f3.500ed","order":2,"disp":true,"width":"6","collapse":true},{"id":"9ee7e038.56def","type":"ui_group","name":"Manual Lat/Lon","tab":"1098dc18.d96274","order":3,"disp":true,"width":"6","collapse":true},{"id":"fcc7d16a.5f2a2","type":"ui_group","name":"Sunset/Sunrise","tab":"1098dc18.d96274","order":4,"disp":true,"width":"6","collapse":true},{"id":"7706781c.a53ca8","type":"ui_group","name":"Change System Password","tab":"10cd091e.2c38a7","order":8,"disp":true,"width":"6","collapse":true},{"id":"e02cbcfc.c48c2","type":"ui_spacer","name":"spacer","group":"f961f048.b0646","order":1,"width":1,"height":1},{"id":"7d76c12c.bccc4","type":"ui_group","name":"Remote Access - Dataplicity","tab":"10cd091e.2c38a7","order":4,"disp":true,"width":"6","collapse":true},{"id":"43a9d023.b2434","type":"ui_group","name":"Download Configuration Files","tab":"10cd091e.2c38a7","order":6,"disp":true,"width":"6","collapse":true,"className":""},{"id":"14b5b6dc.5ab249","type":"ui_group","name":"Install OS Files","tab":"10cd091e.2c38a7","order":8,"disp":true,"width":"6","collapse":true},{"id":"b2855d5b.1215c8","type":"socketcan-config","interface":"can0"},{"id":"4a4ad95f11329591","type":"ui_group","name":"Instance Scanner","tab":"e0c750f3.500ed","order":5,"disp":true,"width":"6","collapse":true,"className":""},{"id":"8918319e.52f4","type":"ui_switch","z":"5a05b8f3.894b88","name":"13_Bath_Ceiling","label":"Ceiling","tooltip":"","group":"f92ef285.8be6b","order":1,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"13_state_Bath Ceiling","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1180,"y":720,"wires":[["ba8aebb.ea06618"]]},{"id":"e3a07cfd.ff85a","type":"ui_slider","z":"5a05b8f3.894b88","name":"13_Bath_Ceiling_brightness","label":"","tooltip":"","group":"f92ef285.8be6b","order":2,"width":3,"height":1,"passthru":false,"outs":"end","topic":"13_brightness","min":"1","max":"100","step":"","x":1140,"y":760,"wires":[["ba8aebb.ea06618"]]},{"id":"b7651bea.41be5","type":"ui_switch","z":"5a05b8f3.894b88","name":"14_Bath_Lav","label":"Lav","tooltip":"","group":"f92ef285.8be6b","order":3,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"14_state_Bath Lav","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1190,"y":800,"wires":[["ba8aebb.ea06618"]]},{"id":"bde18df6.2960f","type":"ui_slider","z":"5a05b8f3.894b88","name":"14_Bath_Lav_brightness","label":"","tooltip":"","group":"f92ef285.8be6b","order":4,"width":3,"height":1,"passthru":false,"outs":"end","topic":"14_brightness","min":"1","max":"100","step":"","x":1150,"y":840,"wires":[["ba8aebb.ea06618"]]},{"id":"f766527c.b54708","type":"ui_switch","z":"5a05b8f3.894b88","name":"16_Bath_Edge_accent","label":"Accent","tooltip":"","group":"f92ef285.8be6b","order":5,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"16_state_Bath Edge Accent","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1160,"y":960,"wires":[["ba8aebb.ea06618"]]},{"id":"32fb20fc.33fb1","type":"ui_slider","z":"5a05b8f3.894b88","name":"16_Bath_Edge_Accent_brightness","label":"","tooltip":"","group":"f92ef285.8be6b","order":6,"width":3,"height":1,"passthru":false,"outs":"end","topic":"16_brightness","min":"1","max":"100","step":"","x":1120,"y":1000,"wires":[["ba8aebb.ea06618"]]},{"id":"77238d9f.d85fac","type":"ui_switch","z":"5a05b8f3.894b88","name":"17_BR_Ceiling","label":"Ceiling","tooltip":"","group":"517030c5.11f8b8","order":1,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"17_state_Bedroom Ceiling","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1180,"y":1040,"wires":[["ba8aebb.ea06618"]]},{"id":"b5f5aa62.b1b8c","type":"ui_slider","z":"5a05b8f3.894b88","name":"17_BR_Ceiling_brightness","label":"","tooltip":"","group":"517030c5.11f8b8","order":2,"width":3,"height":1,"passthru":false,"outs":"end","topic":"17_brightness","min":"1","max":"100","step":"","x":1140,"y":1080,"wires":[["ba8aebb.ea06618"]]},{"id":"4f494263.b11554","type":"exec","z":"5a05b8f3.894b88","command":"/coachproxy/rv-c/dc_dimmer.pl ","addpay":true,"append":"","useSpawn":"","name":"","x":2150,"y":2220,"wires":[[],[],[]]},{"id":"e291aabb.d74588","type":"ui_switch","z":"5a05b8f3.894b88","name":"20_BR_Vanity","label":"Vanity","tooltip":"","group":"517030c5.11f8b8","order":7,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"20_state_Bedroom Vanity","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1180,"y":1280,"wires":[["ba8aebb.ea06618"]]},{"id":"d573ae50.c4dc38","type":"ui_slider","z":"5a05b8f3.894b88","name":"20_BR_Vanity_brightness","label":"","tooltip":"","group":"517030c5.11f8b8","order":8,"width":3,"height":1,"passthru":false,"outs":"end","topic":"20_brightness","min":"1","max":"100","step":"","x":1150,"y":1320,"wires":[["ba8aebb.ea06618"]]},{"id":"93ad9c5a.823bf8","type":"ui_switch","z":"5a05b8f3.894b88","name":"21_BR_Courtesy","label":"Courtesy","tooltip":"","group":"517030c5.11f8b8","order":9,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"21_state_Bedroom Courtesy","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1170,"y":1360,"wires":[["ba8aebb.ea06618"]]},{"id":"a6532b96.f6876","type":"ui_slider","z":"5a05b8f3.894b88","name":"21_BR_Courtesy_brightness","label":"","tooltip":"","group":"517030c5.11f8b8","order":10,"width":3,"height":1,"passthru":false,"outs":"end","topic":"21_brightness","min":"1","max":"100","step":"","x":1140,"y":1400,"wires":[["ba8aebb.ea06618"]]},{"id":"de5083f5.8f342","type":"ui_switch","z":"5a05b8f3.894b88","name":"19_BR_Accent","label":"Accent","tooltip":"","group":"517030c5.11f8b8","order":5,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"19_state_Bedroom Accent","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1180,"y":1200,"wires":[["ba8aebb.ea06618"]]},{"id":"255e8300.e6f6dc","type":"ui_slider","z":"5a05b8f3.894b88","name":"19_BR_Accent_brightness","label":"","tooltip":"","group":"517030c5.11f8b8","order":6,"width":3,"height":1,"passthru":false,"outs":"end","topic":"19_brightness","min":"1","max":"100","step":"","x":1140,"y":1240,"wires":[["ba8aebb.ea06618"]]},{"id":"443d87c4.3023d","type":"ui_switch","z":"5a05b8f3.894b88","name":"18_BR_Reading","label":"Reading","tooltip":"","group":"517030c5.11f8b8","order":3,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"18_state_Bedroom Reading","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1180,"y":1120,"wires":[["ba8aebb.ea06618"]]},{"id":"9ff3b254.0a9e","type":"ui_slider","z":"5a05b8f3.894b88","name":"18_BR_Reading_brightness","label":"","tooltip":"","group":"517030c5.11f8b8","order":4,"width":3,"height":1,"passthru":false,"outs":"end","topic":"18_brightness","min":"1","max":"100","step":"","x":1140,"y":1160,"wires":[["ba8aebb.ea06618"]]},{"id":"6462abc1.33600c","type":"ui_switch","z":"5a05b8f3.894b88","name":"42_Ext_Porch_Light","label":"Porch","tooltip":"","group":"4e2af34d.8f765c","order":2,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"42_state_Porch Light","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1160,"y":2920,"wires":[["ba8aebb.ea06618"]]},{"id":"21309d67.8efe4a","type":"ui_switch","z":"5a05b8f3.894b88","name":"23_MB_Accent","label":"Accent","tooltip":"","group":"b515d680.664548","order":3,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"23_state_Mid Bath Accent","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1180,"y":1520,"wires":[["ba8aebb.ea06618"]]},{"id":"36b5f55f.b2f8d2","type":"ui_slider","z":"5a05b8f3.894b88","name":"23_MB_Accent_brightness","label":"","tooltip":"","group":"b515d680.664548","order":4,"width":3,"height":1,"passthru":false,"outs":"end","topic":"23_brightness","min":"1","max":"100","step":"","x":1140,"y":1560,"wires":[["ba8aebb.ea06618"]]},{"id":"f1ceb03a.ba774","type":"ui_switch","z":"5a05b8f3.894b88","name":"22_Mid-Bath_Ceiling","label":"Ceiling","tooltip":"","group":"b515d680.664548","order":1,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"22_state_Mid-Bath Ceiling","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1160,"y":1440,"wires":[["ba8aebb.ea06618"]]},{"id":"285ed135.2d577e","type":"ui_slider","z":"5a05b8f3.894b88","name":"22_Mid-Bath_Ceiling_brightness","label":"","tooltip":"","group":"b515d680.664548","order":2,"width":3,"height":1,"passthru":false,"outs":"end","topic":"22_brightness","min":"1","max":"100","step":"","x":1130,"y":1480,"wires":[["ba8aebb.ea06618"]]},{"id":"637f5dcf.b94644","type":"ui_switch","z":"5a05b8f3.894b88","d":true,"name":"Water Pump /pump_out/","label":"Pump","tooltip":"","group":"cae5b35a.e3024","order":1,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"93_state","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":970,"y":3660,"wires":[["ba8aebb.ea06618"]]},{"id":"94997def.bc00f","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/16","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":980,"wires":[["6c5178e1.6a4be8"]]},{"id":"dcd1dd69.6b88e8","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/17","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":1060,"wires":[["409db98b.807d48"]]},{"id":"bcbe9f30.8997b8","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/18","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":1140,"wires":[["81a2736.51b639"]]},{"id":"be4844ec.4d88e8","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/19","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":1220,"wires":[["4c177e88.ea6a7"]]},{"id":"fcc9e896.4ff07","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/20","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":1300,"wires":[["ede65af9.7b44e8"]]},{"id":"cdd86688.7e2b4","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/21","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":1380,"wires":[["55a2f976.8a3eb8"]]},{"id":"4352ebec.6c8734","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/22","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":1460,"wires":[["38e39d9a.7e7722"]]},{"id":"c4f28dec.12421","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/23","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":1540,"wires":[["bc502eba.b0b12"]]},{"id":"ef7c89aa.d895e8","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/42","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":2960,"wires":[["c1d41b37.eaf988"]]},{"id":"e58035a7.f3d3f","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/30","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":2100,"wires":[["56c43894.eca948"]]},{"id":"f9ad487e.96c1f","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/32","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":2260,"wires":[["3a5d5d6f.be61b2"]]},{"id":"cd54bb31.376898","type":"mqtt in","z":"5a05b8f3.894b88","d":true,"name":"/pump_in/","topic":"RVC/DC_DIMMER_STATUS_3/37","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":160,"y":3660,"wires":[["6b2a8e3c.7dae6"]]},{"id":"d9f0c30b.5a865","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"CP/TANK_STATUS/Fresh","qos":"2","broker":"c1170463.5c7f8","inputs":0,"x":210,"y":4440,"wires":[["f350bf6f.91161"]]},{"id":"72a77d4d.b70dbc","type":"ui_text","z":"5a05b8f3.894b88","group":"87ed7eaa.ab8fe","order":2,"width":"2","height":"1","name":"Fresh:","label":"Fresh","format":"{{msg.payload}}%","layout":"col-center","x":630,"y":4440,"wires":[]},{"id":"44c283a8.34eebc","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"CP/TANK_STATUS/Grey","qos":"2","broker":"c1170463.5c7f8","inputs":0,"x":210,"y":4480,"wires":[["b5d0e09f.8e198"]]},{"id":"418bd951.4eb67","type":"ui_text","z":"5a05b8f3.894b88","group":"87ed7eaa.ab8fe","order":3,"width":"2","height":"1","name":"Grey:","label":"Grey","format":"{{msg.payload}}%","layout":"col-center","x":630,"y":4480,"wires":[]},{"id":"54c15885.cc5ca","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"CP/TANK_STATUS/Black","qos":"2","broker":"c1170463.5c7f8","inputs":0,"x":210,"y":4520,"wires":[["76d3f82c.3278b8"]]},{"id":"a47ac593.4ed008","type":"ui_text","z":"5a05b8f3.894b88","group":"87ed7eaa.ab8fe","order":4,"width":"2","height":"1","name":"Black:","label":"Black","format":"{{msg.payload}}%","layout":"col-center","x":630,"y":4520,"wires":[]},{"id":"4251713d.675418","type":"ui_slider","z":"5a05b8f3.894b88","name":"Panel Brightness","label":"","tooltip":"","group":"d361ec81.7d08a","order":2,"width":3,"height":1,"passthru":false,"outs":"end","topic":"Panel Lights","min":"1","max":"100","step":"","x":2250,"y":140,"wires":[["10e80e93.5f0211"]]},{"id":"f9363c14.d66b","type":"exec","z":"5a05b8f3.894b88","command":"/coachproxy/rv-c/panel_lights_entegra.pl","addpay":true,"append":"","useSpawn":"","timer":"","name":"","x":2860,"y":120,"wires":[[],[],[]]},{"id":"da91aa38.849028","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"CP/IGNITION","qos":"2","broker":"c1170463.5c7f8","inputs":0,"x":170,"y":4620,"wires":[["555e9ef4.cfe45"]]},{"id":"efa73c57.fe0448","type":"ui_text","z":"5a05b8f3.894b88","group":"87ed7eaa.ab8fe","order":8,"width":"3","height":"1","name":"Ignition /ignition/+pred/","label":"Ignition","format":"{{msg.payload}}","layout":"col-center","x":690,"y":4620,"wires":[]},{"id":"9ee193c3.f6d9f8","type":"ui_switch","z":"5a05b8f3.894b88","name":"Panels","label":"Panels","tooltip":"","group":"d361ec81.7d08a","order":1,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"Panel Lights","onvalue":"100","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":2210,"y":100,"wires":[["10e80e93.5f0211"]]},{"id":"d1486c83.b98ce8","type":"ui_button","z":"5a05b8f3.894b88","name":"Mem On","group":"d944623c.5b46b8","order":1,"width":3,"height":1,"passthru":false,"label":"Mem On","tooltip":"","color":"","bgcolor":"","icon":"","payload":"1","payloadType":"str","topic":"master","x":1500,"y":400,"wires":[["a4f9a80d.d8f2a"]]},{"id":"a4f9a80d.d8f2a","type":"exec","z":"5a05b8f3.894b88","command":"/coachproxy/rv-c/master.pl","addpay":true,"append":"13 14 16 17 18 19 20 21 22 23 24 25 26 27 29 30 31 32 33 34 35","useSpawn":"","timer":"","oldrc":false,"name":"","x":1740,"y":400,"wires":[[],[],[]]},{"id":"79af75e.49c4c8c","type":"ui_button","z":"5a05b8f3.894b88","name":"Mem Off","group":"d944623c.5b46b8","order":4,"width":3,"height":1,"passthru":false,"label":"Mem Off","tooltip":"","color":"","bgcolor":"","icon":"","payload":"0","payloadType":"str","topic":"master","x":1501,"y":441,"wires":[["a4f9a80d.d8f2a"]]},{"id":"4b03da62.b8a3d4","type":"ui_template","z":"5a05b8f3.894b88","group":"87ed7eaa.ab8fe","name":"Tanks","order":1,"format":"<!DOCTYPE html>\n<div style=\"height: 8px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 8px; border-bottom: 1px solid black; text-align: left\">\n  <span style=\"font-size: 16px; background-color: #FEFEFE; padding: 0 10px; margin-left: 10px;\">\n    Tanks\n  </span>\n</div>\n<div style=\"height: 11px;\">&nbsp;</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":630,"y":4340,"wires":[[]]},{"id":"f5333ce8.df1fa","type":"ui_template","z":"5a05b8f3.894b88","group":"fb4c3e00.5737a","name":"12 VDC Power Label","order":1,"width":"","height":"","format":"<div style=\"height: 8px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 8px; border-bottom: 1px solid black; text-align: left\">\n  <span style=\"font-size: 16px; background-color: #FEFEFE; padding: 0 10px; margin-left: 10px;\">\n    12 VDC Power\n  </span>\n</div>\n<div style=\"height: 11px;\">&nbsp;</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":460,"y":3740,"wires":[[]]},{"id":"1d7a9c0d.1599ac","type":"ui_button","z":"5a05b8f3.894b88","d":true,"name":"All On","group":"d944623c.5b46b8","order":2,"width":2,"height":1,"passthru":false,"label":"All On","tooltip":"","color":"","bgcolor":"","icon":"","payload":"2","payloadType":"str","topic":"master","x":1490.2857360839844,"y":359.5712890625,"wires":[["a4f9a80d.d8f2a"]]},{"id":"4514ad25.024a8c","type":"ui_text","z":"5a05b8f3.894b88","d":true,"group":"cae5b35a.e3024","order":2,"width":"3","height":"1","name":"water-pump 3 spaces","label":"","format":"{{msg.payload}}","layout":"row-spread","x":980,"y":3700,"wires":[]},{"id":"555e9ef4.cfe45","type":"rbe","z":"5a05b8f3.894b88","name":"","func":"rbe","gap":"","start":"","inout":"out","x":470,"y":4620,"wires":[["efa73c57.fe0448"]]},{"id":"76d3f82c.3278b8","type":"rbe","z":"5a05b8f3.894b88","name":"","func":"rbe","gap":"","start":"","inout":"out","x":470,"y":4520,"wires":[["a47ac593.4ed008","f5adb9ac.093858"]]},{"id":"b5d0e09f.8e198","type":"rbe","z":"5a05b8f3.894b88","name":"","func":"rbe","gap":"","start":"","inout":"out","x":470,"y":4480,"wires":[["418bd951.4eb67","f5adb9ac.093858"]]},{"id":"f350bf6f.91161","type":"rbe","z":"5a05b8f3.894b88","name":"","func":"rbe","gap":"","start":"","inout":"out","x":470,"y":4440,"wires":[["72a77d4d.b70dbc","f5adb9ac.093858"]]},{"id":"1c295a6.055fca6","type":"ui_template","z":"5a05b8f3.894b88","group":"87ed7eaa.ab8fe","name":"Chassis Label /chassislabel/","order":7,"width":"6","height":"1","format":"<!DOCTYPE html>\n<div style=\"height: 10px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 10px; border-bottom: 1px solid black; text-align: left\">\n  <span style=\"font-size: 16px; background-color: #FEFEFE; padding: 0 10px; margin-left: 10px;\">\n    Chassis: <b>{{msg.payload.source}}</b>\n  </span>\n</div>\n<div style=\"height: 8px;\">&nbsp;</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":700,"y":4580,"wires":[[]]},{"id":"9e0f3a97.242428","type":"comment","z":"5a05b8f3.894b88","name":"Save this flow to the Flows file on the Raspberry Pi","info":"This tool should be run after a Deploy to ensure the flow is written to a file with a descriptive filename at /coachproxy/home/pi/.node-red/flows.\n\nThe Load eRVin Configuration flow above will copy a file with a descriptive filename from /coachproxy/home/pi/.node-red/flows and write it to the node red flows file at /coachproxy/home/pi/.node-red with the filename flows_coachproxy.json. This is the default flow node-red will use when it starts up.\n\nThe Load eRVin Configuration flow also copies the appropriate HAbridge file located at /coachproxy/home/pi/.node-red/flows to the following path /coachproxy/ha-bridge\n\nThe HAbridge file is relatively static for each floorplan so initially it is manually saved to /coachproxy/home/pi/.node-red/flows. The HAbridge filename must be identical to the flows file name but without the version (_v_nnn) and a \".db\" extension. When copied to /coachproxy/ha-bridge the name is changed to device.db ","x":210,"y":140,"wires":[]},{"id":"3d0470ed.386b4","type":"ui_chart","z":"5a05b8f3.894b88","name":"Tanks Bar Chart","group":"87ed7eaa.ab8fe","order":6,"width":0,"height":0,"label":"","chartType":"bar","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"No Valid Data","dot":false,"ymin":"0","ymax":"100","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#999999","#424242","#941100","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"x":880,"y":4380,"wires":[[]]},{"id":"e9d02061.5900d","type":"inject","z":"5a05b8f3.894b88","name":"Tank Chart Setup","props":[{"p":"payload","v":"","vt":"date"},{"p":"topic","v":"","vt":"string"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.1","topic":"","payload":"","payloadType":"date","x":190,"y":4380,"wires":[["12a8a80a.7a4e88"]]},{"id":"12a8a80a.7a4e88","type":"function","z":"5a05b8f3.894b88","name":"Tank Chart Setup","func":"var msgs = [\n    {topic: 'Fresh', payload: 0},\n    {topic: 'Grey', payload: 0},\n    {topic: 'Black', payload: 0},\n];\n\nreturn [msgs];","outputs":1,"noerr":0,"x":430,"y":4380,"wires":[["f5adb9ac.093858"]]},{"id":"165202ff.dbfd0d","type":"ui_template","z":"5a05b8f3.894b88","group":"2e0a52f8.6acbee","name":"Custom CSS","order":23,"width":0,"height":0,"format":"<link rel=\"stylesheet\" href=\"css/font-awesome-animation.min.css\">\n<style type=\"text/css\">button { touch-action: manipulation; }</style>\n","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"global","className":"","x":1190,"y":260,"wires":[[]]},{"id":"702c340b.b0efcc","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/13","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":740,"wires":[["43df7d4d.dddce4"]],"info":"To parse the MQTT data to JSON, instead of a separate JSON node on the output, simply set the output of this MQTT node to \"a parsed JSON object\"."},{"id":"2f4d0c99.e23bf4","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/14","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":820,"wires":[["bb2ed260.6accf"]]},{"id":"ede65af9.7b44e8","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":1300,"wires":[["e291aabb.d74588"],["d573ae50.c4dc38"],["82ab32ba.46b1b"]],"outputLabels":["on/off value","brightness value",null]},{"id":"55a2f976.8a3eb8","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":1380,"wires":[["93ad9c5a.823bf8"],["a6532b96.f6876"],["b9f024ce.83cf68"]],"outputLabels":["on/off value","brightness value",null]},{"id":"38e39d9a.7e7722","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":1460,"wires":[["f1ceb03a.ba774"],["285ed135.2d577e"],["aa09b718.231ce8"]],"outputLabels":["on/off value","brightness value",null]},{"id":"99e7d694.1fd918","type":"comment","z":"5a05b8f3.894b88","name":"Basic power display (2015-2017)","info":"","x":210,"y":3740,"wires":[]},{"id":"f5adb9ac.093858","type":"change","z":"5a05b8f3.894b88","name":"Set Chart Label","rules":[{"t":"set","p":"topic","pt":"msg","to":"$replace(msg.topic, /.*\\//, '')","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":660,"y":4380,"wires":[["3d0470ed.386b4"]]},{"id":"eff55b53.b6f288","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/GENERIC_INDICATOR_COMMAND/255","qos":"2","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":1530,"y":120,"wires":[["5da87095.951df"]]},{"id":"a0c0d1db.0ba1e","type":"change","z":"5a05b8f3.894b88","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.brightness > 0 ? 100 : 0","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":2040,"y":100,"wires":[["9ee193c3.f6d9f8","5e150fe7.c2b56"]]},{"id":"90b01324.960d5","type":"change","z":"5a05b8f3.894b88","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.brightness","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2040,"y":140,"wires":[["4251713d.675418"]]},{"id":"10e80e93.5f0211","type":"template","z":"5a05b8f3.894b88","name":"Add group id","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"126 {{payload}}","output":"str","x":2510,"y":120,"wires":[["f9363c14.d66b"]]},{"id":"6b2a8e3c.7dae6","type":"change","z":"5a05b8f3.894b88","d":true,"name":"","rules":[{"t":"set","p":"brightness","pt":"msg","to":"payload['operating status (brightness)']","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"brightness > 0 ? 'on' : 'off'","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":3660,"wires":[["b363f64.81e8f08"]]},{"id":"5da87095.951df","type":"switch","z":"5a05b8f3.894b88","name":"Pass Group 126","property":"payload.group","propertyType":"msg","rules":[{"t":"eq","v":"01111110","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1580,"y":180,"wires":[["76dcb995.a69628"]]},{"id":"b363f64.81e8f08","type":"rbe","z":"5a05b8f3.894b88","d":true,"name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":670,"y":3660,"wires":[["637f5dcf.b94644"]]},{"id":"5901ce60.cee528","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/33","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":2340,"wires":[["4e1c26c3.d0f148"]]},{"id":"c6a6dd7b.9bb1e","type":"ui_text","z":"5a05b8f3.894b88","group":"fb4c3e00.5737a","order":2,"width":"3","height":"1","name":"House Battery /battery-house/battery-basic/+pred/","label":"House Battery","format":"{{msg.payload}} Volts","layout":"col-center","x":1130,"y":3780,"wires":[]},{"id":"1612089d.392067","type":"ui_text","z":"5a05b8f3.894b88","group":"fb4c3e00.5737a","order":3,"width":"3","height":"1","name":"Chassis Battery  /battery-chassis/battery-basic/+pred/","label":"Chassis Battery","format":"{{msg.payload}} Volts","layout":"col-center","x":1140,"y":3820,"wires":[]},{"id":"c0c7b1bf.52b3b","type":"rbe","z":"5a05b8f3.894b88","name":"","func":"rbe","gap":"","start":"","inout":"out","x":830,"y":3780,"wires":[["c6a6dd7b.9bb1e"]]},{"id":"27651f43.050f8","type":"change","z":"5a05b8f3.894b88","name":"","rules":[{"t":"set","p":"status.power.house_battery_volts","pt":"global","to":"payload['dc voltage']","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"payload['dc voltage']","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":3780,"wires":[["c0c7b1bf.52b3b"]]},{"id":"94cff01e.0194d","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_SOURCE_STATUS_1/1","qos":"2","broker":"c1170463.5c7f8","inputs":0,"x":210,"y":3780,"wires":[["1315d6c3.68c019"]]},{"id":"1315d6c3.68c019","type":"json","z":"5a05b8f3.894b88","name":"","property":"payload","action":"","pretty":false,"x":450,"y":3780,"wires":[["27651f43.050f8"]]},{"id":"52e8712f.1941","type":"rbe","z":"5a05b8f3.894b88","name":"","func":"rbe","gap":"","start":"","inout":"out","x":830,"y":3820,"wires":[["1612089d.392067"]]},{"id":"41e1419b.d342b","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_SOURCE_STATUS_1/2","qos":"2","broker":"c1170463.5c7f8","inputs":0,"x":210,"y":3820,"wires":[["a1cd97fb.4726f8"]]},{"id":"a1cd97fb.4726f8","type":"json","z":"5a05b8f3.894b88","name":"","property":"payload","action":"","pretty":false,"x":450,"y":3820,"wires":[["b36d7f2e.00774"]]},{"id":"b36d7f2e.00774","type":"change","z":"5a05b8f3.894b88","name":"","rules":[{"t":"set","p":"status.power.chassis_battery_volts","pt":"global","to":"payload['dc voltage']","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"payload['dc voltage']","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":3820,"wires":[["52e8712f.1941"]]},{"id":"808ffb36.d1e2a8","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/40","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":2840,"wires":[["1bfae7f5.b28668"]]},{"id":"43df7d4d.dddce4","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":740,"wires":[["8918319e.52f4"],["e3a07cfd.ff85a"],["d6e2a045.7e358"]],"outputLabels":["on/off value","brightness value",null]},{"id":"ba8aebb.ea06618","type":"file function","z":"5a05b8f3.894b88","name":"command_dc_dimmer_ervin.js","filename":".node-red/js/command_dc_dimmer_ervin.js","reloadfile":false,"outputs":1,"x":1810,"y":2220,"wires":[["4f494263.b11554"]]},{"id":"ebc324f0.c073f8","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/15","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":900,"wires":[["20c909a2.bd91b6"]]},{"id":"256ec7cf.fab038","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/34","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":2420,"wires":[["2aa05fba.2bbcd"]]},{"id":"7f15e03d.6be2","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/35","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":2500,"wires":[["e71ec827.ff7198"]]},{"id":"383d36c5.543aea","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/36","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":2580,"wires":[["de8dcc10.e3813"]]},{"id":"29290cdc.daca64","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/37","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":2660,"wires":[["a677f07b.1b2a2"]]},{"id":"7e842612.9b3ed8","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/38","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":2720,"wires":[["340c59d6.8c75c6"]]},{"id":"c59b01cb.b7f39","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/39","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":2780,"wires":[["14b7f090.bf64ff"]]},{"id":"dc875c1c.d2f56","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/43","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":3020,"wires":[["b2dc26bb.36db38"]]},{"id":"f48e3a33.d50438","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/41","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":2900,"wires":[["60232257.2aa5ec"]]},{"id":"f30307b6.21e838","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/11","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":620,"wires":[["92405b43.8f4958"]]},{"id":"fc6a3df7.d19cd","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/10","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":560,"wires":[["3fa601fc.eb96de"]]},{"id":"6ab87ecc.37cd8","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/9","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":170,"y":500,"wires":[["9376002c.7114d"]]},{"id":"bb2ed260.6accf","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":820,"wires":[["b7651bea.41be5"],["bde18df6.2960f"],["f8bce69b.995b08"]],"outputLabels":["on/off value","brightness value",null]},{"id":"81a2736.51b639","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":1140,"wires":[["443d87c4.3023d"],["9ff3b254.0a9e"],["c22fe021.cf732"]],"outputLabels":["on/off value","brightness value",null]},{"id":"409db98b.807d48","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":1060,"wires":[["77238d9f.d85fac"],["b5f5aa62.b1b8c"],["10d87f4b.cd7441"]],"outputLabels":["on/off value","brightness value",null]},{"id":"6c5178e1.6a4be8","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":980,"wires":[["f766527c.b54708"],["32fb20fc.33fb1"],["3d7c9499.7df9bc"]],"outputLabels":["on/off value","brightness value",null]},{"id":"4c177e88.ea6a7","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":1220,"wires":[["de5083f5.8f342"],["255e8300.e6f6dc"],["504c6a7f.8ce8c4"]],"outputLabels":["on/off value","brightness value",null]},{"id":"6118c705.2e90e8","type":"ui_switch","z":"5a05b8f3.894b88","name":"25_Main_Ceiling","label":"Ceiling","tooltip":"","group":"2e0a52f8.6acbee","order":1,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"25_state_Center Ceiling","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1170,"y":1680,"wires":[["ba8aebb.ea06618"]]},{"id":"48383a73.2bcfe4","type":"ui_slider","z":"5a05b8f3.894b88","name":"25_Main_Ceiling_brightness","label":"","tooltip":"","group":"2e0a52f8.6acbee","order":2,"width":3,"height":1,"passthru":false,"outs":"end","topic":"25_brightness","min":"1","max":"100","step":"","x":1140,"y":1720,"wires":[["ba8aebb.ea06618"]]},{"id":"c5570c19.8d4cb","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":1700,"wires":[["6118c705.2e90e8"],["48383a73.2bcfe4"],["a1753018.3f292"]],"outputLabels":["on/off value","brightness value",null]},{"id":"39e3a0d6.9519f","type":"ui_switch","z":"5a05b8f3.894b88","name":"26_Main_Ceiling_Accent","label":"Ceiling Accent","tooltip":"","group":"2e0a52f8.6acbee","order":5,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"26_state_Ceiling Accent","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1150,"y":1760,"wires":[["ba8aebb.ea06618"]]},{"id":"1a56b96c.b314d7","type":"ui_slider","z":"5a05b8f3.894b88","name":"26_Main_CeilingAccent_brightness","label":"","tooltip":"","group":"2e0a52f8.6acbee","order":6,"width":3,"height":1,"passthru":false,"outs":"end","topic":"26_brightness","min":"1","max":"100","step":"","x":1120,"y":1800,"wires":[["ba8aebb.ea06618"]]},{"id":"65666472.9397ac","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":1780,"wires":[["39e3a0d6.9519f"],["1a56b96c.b314d7"],["1a89e6d0.a42329"]],"outputLabels":["on/off value","brightness value",null]},{"id":"e89c3394.84f89","type":"ui_switch","z":"5a05b8f3.894b88","name":"27_Main_Accent","label":"Accent","tooltip":"","group":"2e0a52f8.6acbee","order":13,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"27_state_Living Room Accent","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1170,"y":1840,"wires":[["ba8aebb.ea06618"]]},{"id":"c502ea92.2cf478","type":"ui_slider","z":"5a05b8f3.894b88","name":"27_Main_Accent_brightness","label":"","tooltip":"","group":"2e0a52f8.6acbee","order":14,"width":3,"height":1,"passthru":false,"outs":"end","topic":"27_brightness","min":"1","max":"100","step":"","x":1140,"y":1880,"wires":[["ba8aebb.ea06618"]]},{"id":"49ba1cd7.bebbc4","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":1860,"wires":[["e89c3394.84f89"],["c502ea92.2cf478"],["87c13d1d.828f3"]],"outputLabels":["on/off value","brightness value",null]},{"id":"338b9c61.dc6634","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/25","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":1700,"wires":[["c5570c19.8d4cb"]]},{"id":"d66f735e.cee55","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/26","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":1780,"wires":[["65666472.9397ac"]]},{"id":"34eff10e.8918ae","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/27","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":1860,"wires":[["49ba1cd7.bebbc4"]]},{"id":"1e139ab8.f3f9f5","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/28","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":1940,"wires":[["eaebc1ce.365fe"]]},{"id":"13603f49.df2f81","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/29","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":2180,"wires":[["d806861.3ec9a78"]]},{"id":"cbe0f2a7.72eb8","type":"ui_switch","z":"5a05b8f3.894b88","name":"31_Main_PS_Ceiling","label":"PS Ceiling","tooltip":"","group":"2e0a52f8.6acbee","order":9,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"31_state_Passenger Side Ceiling","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1160,"y":1980,"wires":[["ba8aebb.ea06618"]]},{"id":"1a95d4e5.d6806b","type":"ui_slider","z":"5a05b8f3.894b88","name":"31_Main_PS_Ceiling_brightness","label":"","tooltip":"","group":"2e0a52f8.6acbee","order":10,"width":3,"height":1,"passthru":false,"outs":"end","topic":"31_brightness","min":"1","max":"100","step":"","x":1130,"y":2020,"wires":[["ba8aebb.ea06618"]]},{"id":"80f322b4.4ba49","type":"ui_switch","z":"5a05b8f3.894b88","name":"30_Main_DS_Ceiling","label":"DS Ceiling","tooltip":"","group":"2e0a52f8.6acbee","order":7,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"30_state_Driver Side Ceiling","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1160,"y":2060,"wires":[["ba8aebb.ea06618"]]},{"id":"e567e124.33155","type":"ui_slider","z":"5a05b8f3.894b88","name":"30_Main_DS_Ceiling_brightness","label":"","tooltip":"","group":"2e0a52f8.6acbee","order":8,"width":3,"height":1,"passthru":false,"outs":"end","topic":"30_brightness","min":"1","max":"100","step":"","x":1120,"y":2100,"wires":[["ba8aebb.ea06618"]]},{"id":"56c43894.eca948","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":2100,"wires":[["80f322b4.4ba49"],["e567e124.33155"],["af50c992.3824c8"]],"outputLabels":["on/off value","brightness value",null]},{"id":"3c636927.0e6b06","type":"ui_switch","z":"5a05b8f3.894b88","name":"29_Main_Sofa_Sconce","label":"Sofa Sconce","tooltip":"","group":"2e0a52f8.6acbee","order":21,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"29_state_Sofa Sconce","onvalue":"options.sofasconcemode","onvalueType":"global","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1150,"y":2140,"wires":[["ba8aebb.ea06618"]]},{"id":"a7d2239b.42bcc","type":"ui_slider","z":"5a05b8f3.894b88","name":"29_Main_Sofa_Sconce_brightness","label":"","tooltip":"","group":"2e0a52f8.6acbee","order":22,"width":3,"height":1,"passthru":false,"outs":"end","topic":"29_brightness","min":"1","max":"100","step":"","x":1120,"y":2180,"wires":[["ba8aebb.ea06618"]]},{"id":"d806861.3ec9a78","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":2180,"wires":[["3c636927.0e6b06"],["befc9017.0fda8"],["4aa343b9.05a0ac"]],"outputLabels":["on/off value","brightness value",null]},{"id":"58367bf3.bc1ba4","type":"ui_switch","z":"5a05b8f3.894b88","name":"32_Main_DS_Slide","label":"DS Slide","tooltip":"","group":"2e0a52f8.6acbee","order":11,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"32_state_Driver Side Slide","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1170,"y":2220,"wires":[["ba8aebb.ea06618"]]},{"id":"91311fb.29e1be","type":"ui_slider","z":"5a05b8f3.894b88","name":"32_Main_DS_Slide_brightness","label":"","tooltip":"","group":"2e0a52f8.6acbee","order":12,"width":3,"height":1,"passthru":false,"outs":"end","topic":"32_brightness","min":"1","max":"100","step":"","x":1130,"y":2260,"wires":[["ba8aebb.ea06618"]]},{"id":"3a5d5d6f.be61b2","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":2260,"wires":[["58367bf3.bc1ba4"],["91311fb.29e1be"],["cd682278.4ea26"]],"outputLabels":["on/off value","brightness value",null]},{"id":"75708b96.ca4844","type":"ui_switch","z":"5a05b8f3.894b88","name":"33_Main_Dinette","label":"Dinette","tooltip":"","group":"2e0a52f8.6acbee","order":15,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"33_state_Dinette Light","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1170,"y":2300,"wires":[["ba8aebb.ea06618"]]},{"id":"d1d27f3e.2d4a1","type":"ui_slider","z":"5a05b8f3.894b88","name":"33_Main_Dinette_brightness","label":"","tooltip":"","group":"2e0a52f8.6acbee","order":16,"width":3,"height":1,"passthru":false,"outs":"end","topic":"33_brightness","min":"1","max":"100","step":"","x":1140,"y":2340,"wires":[["ba8aebb.ea06618"]]},{"id":"4e1c26c3.d0f148","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":2340,"wires":[["75708b96.ca4844"],["d1d27f3e.2d4a1"],["86bec4e3.edbcb8"]],"outputLabels":["on/off value","brightness value",""]},{"id":"651b8383.05e42c","type":"ui_switch","z":"5a05b8f3.894b88","name":"34_Main_Sink","label":"Sink","tooltip":"","group":"2e0a52f8.6acbee","order":17,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"34_state_Sink Lights","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1180,"y":2380,"wires":[["ba8aebb.ea06618"]]},{"id":"13a3533a.009bad","type":"ui_slider","z":"5a05b8f3.894b88","name":"34_Main_Sink_brightness","label":"","tooltip":"","group":"2e0a52f8.6acbee","order":18,"width":3,"height":1,"passthru":false,"outs":"end","topic":"34_brightness","min":"1","max":"100","step":"","x":1150,"y":2420,"wires":[["ba8aebb.ea06618"]]},{"id":"2aa05fba.2bbcd","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":2420,"wires":[["651b8383.05e42c"],["13a3533a.009bad"],["9647ec41.5edf6"]],"outputLabels":["on/off value","brightness value",null]},{"id":"ae27b2c2.b17ff","type":"ui_switch","z":"5a05b8f3.894b88","name":"35_Main_Midship","label":"Hall","tooltip":"","group":"2e0a52f8.6acbee","order":19,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"35_state_Hall Lights","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1170,"y":2460,"wires":[["ba8aebb.ea06618"]]},{"id":"ef7aa0d8.0aa4e","type":"ui_slider","z":"5a05b8f3.894b88","name":"35_Main_Midship_brightness","label":"","tooltip":"","group":"2e0a52f8.6acbee","order":20,"width":3,"height":1,"passthru":false,"outs":"end","topic":"35_brightness","min":"1","max":"100","step":"","x":1140,"y":2500,"wires":[["ba8aebb.ea06618"]]},{"id":"e71ec827.ff7198","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":2500,"wires":[["ae27b2c2.b17ff"],["ef7aa0d8.0aa4e"],["e4dd64e3.330458"]],"outputLabels":["on/off value","brightness value",null]},{"id":"283713ce.743e8c","type":"ui_switch","z":"5a05b8f3.894b88","d":true,"name":"6_AH_Burner","label":"Burner","tooltip":"","group":"cf9b6bb9.e5ef38","order":1,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"6_state_Aquahot Burner","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1180,"y":300,"wires":[["ba8aebb.ea06618"]]},{"id":"2d1351ee.4840fe","type":"ui_switch","z":"5a05b8f3.894b88","name":"38_Ext_DS_Awning_Lights","label":"DS Awing","tooltip":"","group":"4e2af34d.8f765c","order":10,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"38_state_Driver Side Awning Lights","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1140,"y":2680,"wires":[["ba8aebb.ea06618"]]},{"id":"1aa674fc.20761b","type":"ui_switch","z":"5a05b8f3.894b88","name":"39_Ext_PS_Awning_Lights","label":"PS Awning","tooltip":"","group":"4e2af34d.8f765c","order":9,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"39_state_Passenger Side Awning Lights","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1140,"y":2740,"wires":[["ba8aebb.ea06618"]]},{"id":"3e30dd2.93adb22","type":"ui_switch","z":"5a05b8f3.894b88","d":true,"name":"40_","label":"","tooltip":"","group":"4e2af34d.8f765c","order":13,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"40_state_","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1210,"y":2800,"wires":[["ba8aebb.ea06618"]]},{"id":"ce87987b.237e58","type":"ui_switch","z":"5a05b8f3.894b88","name":"43_Ext_Cargo Lights","label":"Cargo","tooltip":"","group":"4e2af34d.8f765c","order":1,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"43_state_Cargo Lights","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1160,"y":2980,"wires":[["ba8aebb.ea06618"]]},{"id":"e304b78f.b9b158","type":"ui_switch","z":"5a05b8f3.894b88","d":true,"name":"41_","label":"","tooltip":"","group":"4e2af34d.8f765c","order":14,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"41_state_","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1210,"y":2860,"wires":[["ba8aebb.ea06618"]]},{"id":"da5e484.8fa6eb8","type":"ui_switch","z":"5a05b8f3.894b88","d":true,"name":"11_Ext_SecurityDS","label":"Security DS","tooltip":"","group":"4e2af34d.8f765c","order":6,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"11_state_Driver Side Security Light","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1170,"y":600,"wires":[["ba8aebb.ea06618"]]},{"id":"c2bb6384.df68e","type":"ui_switch","z":"5a05b8f3.894b88","d":true,"name":"10_Ext_SecurityPS","label":"Security PS","tooltip":"","group":"4e2af34d.8f765c","order":5,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"10_state_Passenger Side Security Light","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1170,"y":540,"wires":[["ba8aebb.ea06618"]]},{"id":"8529e370.f1b51","type":"ui_switch","z":"5a05b8f3.894b88","d":true,"name":"9_Ext_Motion","label":"Motion","tooltip":"","group":"4e2af34d.8f765c","order":12,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"9_state_Motion Lights","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1180,"y":480,"wires":[["ba8aebb.ea06618"]]},{"id":"3fc40c7d.9870b4","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":2020,"wires":[["cbe0f2a7.72eb8"],["1a95d4e5.d6806b"],["5b7f4b58.21ada4"]],"outputLabels":["on/off value","brightness value",null]},{"id":"d9b07668.1d2958","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/31","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":2020,"wires":[["3fc40c7d.9870b4"]]},{"id":"8e840475.8962e8","type":"comment","z":"5a05b8f3.894b88","name":"Panel Lights w/Alexa Virtual Support v0.60","info":"/coachproxy/rv-c/panel_lights.pl ","x":1520,"y":80,"wires":[]},{"id":"12b12ccf.246393","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/ATS_AC_STATUS_1/#","qos":"2","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":200,"y":4040,"wires":[["ad12b1e6.1b44c","9f7d5bc1.779508","4b785a97.23c184","9998184b.6c3c98","94499c0c.3791d","ab5ffe8.4ce5"]]},{"id":"9f7d5bc1.779508","type":"switch","z":"5a05b8f3.894b88","name":"Leg Switch","property":"payload.leg","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"},{"t":"eq","v":"1","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":530,"y":4220,"wires":[["84435356.8eaa6","afb816.162057e8","892f9d50.4cd24","784a215e.49b2e"],["8e678678.da6c68","5f590da3.c39044","9c386928.520bd8"]]},{"id":"45b00f6f.d0288","type":"ui_text","z":"5a05b8f3.894b88","group":"fb4c3e00.5737a","order":7,"width":"2","height":"1","name":"ATS Current Leg 1","label":"L1:","format":"{{msg.payload}} A","layout":"row-spread","x":1210,"y":4020,"wires":[]},{"id":"435bab33.e9ca24","type":"ui_text","z":"5a05b8f3.894b88","group":"fb4c3e00.5737a","order":10,"width":"2","height":"1","name":"ATS Current Leg 2","label":"L2:","format":"{{msg.payload}} A","layout":"row-spread","x":1210,"y":4140,"wires":[]},{"id":"29808e69.c89172","type":"ui_text","z":"5a05b8f3.894b88","group":"fb4c3e00.5737a","order":8,"width":"2","height":"1","name":"ATS Voltage Leg 1","label":"","format":"{{msg.payload}} V","layout":"row-spread","x":1210,"y":4060,"wires":[]},{"id":"1d9f5ad6.5dfbc5","type":"ui_text","z":"5a05b8f3.894b88","group":"fb4c3e00.5737a","order":11,"width":"2","height":"1","name":"ATS Voltage Leg 2","label":"","format":"{{msg.payload}} V","layout":"row-spread","x":1210,"y":4180,"wires":[]},{"id":"29e74c3c.c71dc4","type":"rbe","z":"5a05b8f3.894b88","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1010,"y":4060,"wires":[["29808e69.c89172"]]},{"id":"97d1c7b.00a4238","type":"rbe","z":"5a05b8f3.894b88","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1010,"y":4140,"wires":[["435bab33.e9ca24"]]},{"id":"26f7f20d.b46c0e","type":"rbe","z":"5a05b8f3.894b88","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1010,"y":4020,"wires":[["45b00f6f.d0288"]]},{"id":"c013cbdf.7250f8","type":"rbe","z":"5a05b8f3.894b88","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1010,"y":4180,"wires":[["1d9f5ad6.5dfbc5"]]},{"id":"195ad800.63dff8","type":"rbe","z":"5a05b8f3.894b88","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1010,"y":3940,"wires":[["b6bb7350.e16cf"]]},{"id":"3610e5df.7d19ca","type":"comment","z":"5a05b8f3.894b88","name":"120V ATS Power Display v061","info":"For basic RMS voltage and current requires data from:\nATS_AC_STATUS_1\n\nFor Faults requires installed equipmnet that supports faults as well as:\nATS_AC_STATUS_1\n\nFor Phase Status (determines if 50A or not) and Waveform requires data from:\nATS_AC_STATUS_3","x":200,"y":3900,"wires":[]},{"id":"84435356.8eaa6","type":"change","z":"5a05b8f3.894b88","name":"L1 rms current","rules":[{"t":"set","p":"payload","pt":"msg","to":"$round(payload.\"rms current\",2)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":4020,"wires":[["26f7f20d.b46c0e"]]},{"id":"8e678678.da6c68","type":"change","z":"5a05b8f3.894b88","name":"L2 rms current","rules":[{"t":"set","p":"payload","pt":"msg","to":"$round(payload.\"rms current\",2)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":4140,"wires":[["97d1c7b.00a4238"]]},{"id":"afb816.162057e8","type":"change","z":"5a05b8f3.894b88","name":"L1 rms voltage","rules":[{"t":"set","p":"payload","pt":"msg","to":"$round(payload.\"rms voltage\",2)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":4060,"wires":[["29e74c3c.c71dc4"]]},{"id":"5f590da3.c39044","type":"change","z":"5a05b8f3.894b88","name":"L2 rms voltage","rules":[{"t":"set","p":"payload","pt":"msg","to":"$round(payload.\"rms voltage\",2)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":4180,"wires":[["c013cbdf.7250f8"]]},{"id":"ad12b1e6.1b44c","type":"file function","z":"5a05b8f3.894b88","name":"ats_source_decode","filename":".node-red/js/ats_source_decode.js","reloadfile":false,"outputs":1,"x":530,"y":3940,"wires":[["195ad800.63dff8"]],"info":"//\r\n// Copyright (C) 2019 Wandertech LLC\r\n//\r\n// This program is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// This program is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\r\n\r\n// Output 1: name of current ATS power source\r\n\r\nconst genset_status = global.get('status').power.generator_state || 'stopped';\r\n\r\n// If the rmsc value is not numeric (e.g. 'n/a'), then\r\n// the ATS is not receiving any external power.\r\nif (isNaN(parseFloat(msg.payload['rms current']))) {\r\n    msg.payload = 'None';\r\n} else if (genset_status == 'running') {\r\n    msg.payload = 'Generator';\r\n} else {\r\n    msg.payload = 'Shore';\r\n}\r\n\r\nmsg.type = 'acsource';\r\nreturn msg;\r\n"},{"id":"9114a169.3f84f","type":"comment","z":"5a05b8f3.894b88","name":"Window Shades Entegra","info":"","x":3450,"y":400,"wires":[]},{"id":"77b13605.4a3f98","type":"ui_template","z":"5a05b8f3.894b88","group":"ae3b3824.48abe8","name":"ds_/windshield_2/","order":1,"width":"6","height":"1","format":"<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>DS Windshield</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":3430,"y":1560,"wires":[[]]},{"id":"48c2ce4b.accd5","type":"ui_button","z":"5a05b8f3.894b88","name":"/ds_windshield_2_night_up/","group":"ae3b3824.48abe8","order":3,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"2","x":3460,"y":1680,"wires":[["5a45bd75.3ba2b4"]]},{"id":"a8cdf72f.d35398","type":"ui_button","z":"5a05b8f3.894b88","name":"/ds_windshield_2_night_down/","group":"ae3b3824.48abe8","order":5,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"2","x":3470,"y":1720,"wires":[["5a45bd75.3ba2b4"]]},{"id":"5a45bd75.3ba2b4","type":"template","z":"5a05b8f3.894b88","name":"shade_template","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"2016 {{payload}} {{topic}}","output":"str","x":4020,"y":2140,"wires":[["f655e209.c54c2"]]},{"id":"f655e209.c54c2","type":"exec","z":"5a05b8f3.894b88","command":"/coachproxy/rv-c/window_shade_entegra.pl","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":4470,"y":2140,"wires":[[],[],[]]},{"id":"a10e021a.9b08a","type":"ui_button","z":"5a05b8f3.894b88","name":"/ds_windshield_2_day_up/","group":"ae3b3824.48abe8","order":2,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"2","x":3460,"y":1600,"wires":[["5a45bd75.3ba2b4"]]},{"id":"50fbb40f.f0037c","type":"ui_button","z":"5a05b8f3.894b88","name":"/ds_windshield_2_day_down/","group":"ae3b3824.48abe8","order":4,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"2","x":3460,"y":1640,"wires":[["5a45bd75.3ba2b4"]]},{"id":"dd8d3259.146c1","type":"ui_template","z":"5a05b8f3.894b88","group":"5725fb8d.051db4","name":"/all_shades/","order":1,"width":"6","height":"1","format":"<!DOCTYPE html>\n<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>All Shades</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":3410,"y":460,"wires":[[]]},{"id":"2e7ed346.e1a85c","type":"ui_button","z":"5a05b8f3.894b88","name":"/all_shades_night_up/","group":"5725fb8d.051db4","order":3,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"1 2 3 4 5 6 7 8 9 10 11 12 17","x":3440,"y":540,"wires":[["5a45bd75.3ba2b4"]]},{"id":"b8f35696.48a998","type":"ui_button","z":"5a05b8f3.894b88","name":"/all_shades_night_down/","group":"5725fb8d.051db4","order":5,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"1 2 3 4 5 6 7 8 9 10 11 12 17","x":3450,"y":620,"wires":[["5a45bd75.3ba2b4"]]},{"id":"494657c0.4deba8","type":"ui_button","z":"5a05b8f3.894b88","name":"/all_shades_day_up/","group":"5725fb8d.051db4","order":2,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"1 2 3 4 5 6 7 8 9 10 11 12 17","x":3440,"y":500,"wires":[["5a45bd75.3ba2b4"]]},{"id":"eb7fdc35.a9cbc","type":"ui_button","z":"5a05b8f3.894b88","name":"/all_shades_day_down/","group":"5725fb8d.051db4","order":4,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"1 2 3 4 5 6 7 8 9 10 11 12 17","x":3450,"y":580,"wires":[["5a45bd75.3ba2b4"]]},{"id":"98e93956.c0ab48","type":"ui_button","z":"5a05b8f3.894b88","name":"/ps_windshield_3_night_up/","group":"ae3b3824.48abe8","order":8,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"3","x":3460,"y":1860,"wires":[["5a45bd75.3ba2b4"]]},{"id":"90a045a2.5633c8","type":"ui_button","z":"5a05b8f3.894b88","name":"/ps_windshield_3_night_down/","group":"ae3b3824.48abe8","order":10,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"3","x":3470,"y":1940,"wires":[["5a45bd75.3ba2b4"]]},{"id":"5be44ea5.e3559","type":"ui_button","z":"5a05b8f3.894b88","name":"/ps_windshield_3_day_up/","group":"ae3b3824.48abe8","order":7,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"3","x":3460,"y":1820,"wires":[["5a45bd75.3ba2b4"]]},{"id":"ac7f1ee4.02722","type":"ui_button","z":"5a05b8f3.894b88","name":"/ps_windshield_3_day_down/","group":"ae3b3824.48abe8","order":9,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"3","x":3460,"y":1900,"wires":[["5a45bd75.3ba2b4"]]},{"id":"e2b5442a.7a29c8","type":"ui_template","z":"5a05b8f3.894b88","group":"ae3b3824.48abe8","name":"/ps_windshield_3/","order":6,"width":"6","height":"1","format":"<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>PS Windshield</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":3430,"y":1780,"wires":[[]]},{"id":"dc37a726.1f7db8","type":"ui_button","z":"5a05b8f3.894b88","name":"/entry_4_night_up/","group":"ae3b3824.48abe8","order":18,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"4","x":3430,"y":2080,"wires":[["5a45bd75.3ba2b4"]]},{"id":"d74e63d3.c1f0f","type":"ui_button","z":"5a05b8f3.894b88","name":"/entry_4_night_down/","group":"ae3b3824.48abe8","order":20,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"4","x":3440,"y":2160,"wires":[["5a45bd75.3ba2b4"]]},{"id":"ee36d7ca.aff688","type":"ui_button","z":"5a05b8f3.894b88","name":"/entry_4_day_up/","group":"ae3b3824.48abe8","order":17,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"4","x":3430,"y":2040,"wires":[["5a45bd75.3ba2b4"]]},{"id":"5ea21cd0.56c684","type":"ui_button","z":"5a05b8f3.894b88","name":"/entry_4_day_down/","group":"ae3b3824.48abe8","order":19,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"4","x":3440,"y":2120,"wires":[["5a45bd75.3ba2b4"]]},{"id":"bb152417.485968","type":"ui_template","z":"5a05b8f3.894b88","group":"ae3b3824.48abe8","name":"/entry_4/","order":16,"width":"6","height":"1","format":"<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>Entry</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":3400,"y":2000,"wires":[[]]},{"id":"87b626c4.7b23a8","type":"ui_button","z":"5a05b8f3.894b88","name":"/toll_1_night_up/","group":"ae3b3824.48abe8","order":13,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"1","x":3420,"y":1420,"wires":[["5a45bd75.3ba2b4"]]},{"id":"be112b05.a65e18","type":"ui_button","z":"5a05b8f3.894b88","name":"/toll_1_night_down/","group":"ae3b3824.48abe8","order":15,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"1","x":3430,"y":1500,"wires":[["5a45bd75.3ba2b4"]]},{"id":"1de16049.6f018","type":"ui_button","z":"5a05b8f3.894b88","name":"/toll_1_day_up/","group":"ae3b3824.48abe8","order":12,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"1","x":3420,"y":1380,"wires":[["5a45bd75.3ba2b4"]]},{"id":"c477dccf.4b151","type":"ui_button","z":"5a05b8f3.894b88","name":"/toll_1_day_down/","group":"ae3b3824.48abe8","order":14,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"1","x":3430,"y":1460,"wires":[["5a45bd75.3ba2b4"]]},{"id":"1173c392.b8b40c","type":"ui_template","z":"5a05b8f3.894b88","group":"ae3b3824.48abe8","name":"/toll_1/","order":11,"width":"6","height":"1","format":"<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>Toll</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":3390,"y":1340,"wires":[[]]},{"id":"ae61032c.7ed5f","type":"ui_button","z":"5a05b8f3.894b88","name":"/dinette_7_night_up/","group":"5a6f1f47.88d1c","order":8,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"7","x":3440,"y":2740,"wires":[["5a45bd75.3ba2b4"]]},{"id":"2bf36062.f8d7","type":"ui_button","z":"5a05b8f3.894b88","name":"/dinette_7_night_down/","group":"5a6f1f47.88d1c","order":10,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"7","x":3450,"y":2820,"wires":[["5a45bd75.3ba2b4"]]},{"id":"decb10b6.d3976","type":"ui_button","z":"5a05b8f3.894b88","name":"/dinette_7_day_up/","group":"5a6f1f47.88d1c","order":7,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"7","x":3430,"y":2700,"wires":[["5a45bd75.3ba2b4"]]},{"id":"204463ab.d88f3c","type":"ui_button","z":"5a05b8f3.894b88","name":"/dinette_7_day_down/","group":"5a6f1f47.88d1c","order":9,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"7","x":3440,"y":2780,"wires":[["5a45bd75.3ba2b4"]]},{"id":"e1394c3f.8b478","type":"ui_template","z":"5a05b8f3.894b88","group":"5a6f1f47.88d1c","name":"/dinette_7/","order":6,"width":"6","height":"1","format":"<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>Dinette</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":3410,"y":2660,"wires":[[]]},{"id":"4c40c0a4.1d043","type":"ui_button","z":"5a05b8f3.894b88","name":"/sofa_8_night_up/","group":"5a6f1f47.88d1c","order":3,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"8","x":3430,"y":3180,"wires":[["5a45bd75.3ba2b4"]]},{"id":"74d65a97.ec0c54","type":"ui_button","z":"5a05b8f3.894b88","name":"/sofa_8_night_down/","group":"5a6f1f47.88d1c","order":5,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"8","x":3440,"y":3260,"wires":[["5a45bd75.3ba2b4"]]},{"id":"7e9cc68c.95e508","type":"ui_button","z":"5a05b8f3.894b88","name":"/sofa_8_day_up/","group":"5a6f1f47.88d1c","order":2,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"8","x":3420,"y":3140,"wires":[["5a45bd75.3ba2b4"]]},{"id":"180d3825.7734c8","type":"ui_button","z":"5a05b8f3.894b88","name":"/sofa_8_day_down/","group":"5a6f1f47.88d1c","order":4,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"8","x":3430,"y":3220,"wires":[["5a45bd75.3ba2b4"]]},{"id":"2d947296.ddea6e","type":"ui_template","z":"5a05b8f3.894b88","group":"5a6f1f47.88d1c","name":"/sofa_8/","order":1,"width":"6","height":"1","format":"<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>Sofa</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":3400,"y":3100,"wires":[[]]},{"id":"b5ccdd00.f54e","type":"ui_button","z":"5a05b8f3.894b88","name":"/bed_9_night_up/","group":"3806de6b.607142","order":3,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"9","x":3430,"y":3400,"wires":[["5a45bd75.3ba2b4"]]},{"id":"751bafdb.117ce","type":"ui_button","z":"5a05b8f3.894b88","name":"/bed_9_night_down/","group":"3806de6b.607142","order":5,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"9","x":3440,"y":3480,"wires":[["5a45bd75.3ba2b4"]]},{"id":"6b2a8d58.901564","type":"ui_button","z":"5a05b8f3.894b88","name":"/bed_9_day_up/","group":"3806de6b.607142","order":2,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"9","x":3420,"y":3360,"wires":[["5a45bd75.3ba2b4"]]},{"id":"33f88c5c.5f4b14","type":"ui_button","z":"5a05b8f3.894b88","name":"/bed_9_day_down/","group":"3806de6b.607142","order":4,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"9","x":3430,"y":3440,"wires":[["5a45bd75.3ba2b4"]]},{"id":"e63d8ae.5587a78","type":"ui_template","z":"5a05b8f3.894b88","group":"3806de6b.607142","name":"/bed_9/","order":1,"width":"6","height":"1","format":"<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>Bed</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":3400,"y":3320,"wires":[[]]},{"id":"baab6b0e.a596f8","type":"ui_button","z":"5a05b8f3.894b88","name":"/vanity_10_night_up/","group":"3806de6b.607142","order":8,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"10","x":3440,"y":3620,"wires":[["5a45bd75.3ba2b4"]]},{"id":"b257ea0d.8bafd8","type":"ui_button","z":"5a05b8f3.894b88","name":"/vanity_10_night_down/","group":"3806de6b.607142","order":10,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"10","x":3450,"y":3700,"wires":[["5a45bd75.3ba2b4"]]},{"id":"58ee4ea0.cca99","type":"ui_button","z":"5a05b8f3.894b88","name":"/vanity_10_day_up/","group":"3806de6b.607142","order":7,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"10","x":3430,"y":3580,"wires":[["5a45bd75.3ba2b4"]]},{"id":"e669d5.be89f628","type":"ui_button","z":"5a05b8f3.894b88","name":"/vanity_10_day_down/","group":"3806de6b.607142","order":9,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"10","x":3440,"y":3660,"wires":[["5a45bd75.3ba2b4"]]},{"id":"88a5a9a1.d29ff8","type":"ui_template","z":"5a05b8f3.894b88","group":"3806de6b.607142","name":"/vanity_10/","order":6,"width":"6","height":"1","format":"<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>Vanity</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":3410,"y":3540,"wires":[[]]},{"id":"99f83623.dd6c68","type":"ui_button","z":"5a05b8f3.894b88","name":"/midbath_11_night_up/","group":"6fd8f21b.f22b1c","order":3,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"11","x":3440,"y":3840,"wires":[["5a45bd75.3ba2b4"]]},{"id":"e751c3ec.3158","type":"ui_button","z":"5a05b8f3.894b88","name":"/midbath_11_night_down/","group":"6fd8f21b.f22b1c","order":5,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"11","x":3450,"y":3920,"wires":[["5a45bd75.3ba2b4"]]},{"id":"3663cfc.9c8673","type":"ui_button","z":"5a05b8f3.894b88","name":"/midbath_11_day_up/","group":"6fd8f21b.f22b1c","order":2,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"11","x":3440,"y":3800,"wires":[["5a45bd75.3ba2b4"]]},{"id":"616beb0b.576014","type":"ui_button","z":"5a05b8f3.894b88","name":"/midbath_11_day_down/","group":"6fd8f21b.f22b1c","order":4,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"11","x":3450,"y":3880,"wires":[["5a45bd75.3ba2b4"]]},{"id":"7b447033.17e94","type":"ui_template","z":"5a05b8f3.894b88","group":"6fd8f21b.f22b1c","name":"/midbath_11/","order":1,"width":"6","height":"1","format":"<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>Mid-Bath</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":3410,"y":3760,"wires":[[]]},{"id":"4a3c64a0.dda8bc","type":"ui_button","z":"5a05b8f3.894b88","name":"/bath_12_night_up/","group":"6fd8f21b.f22b1c","order":8,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"12","x":3430,"y":4060,"wires":[["5a45bd75.3ba2b4"]]},{"id":"c4d8abeb.7c76f8","type":"ui_button","z":"5a05b8f3.894b88","name":"/bath_12_night_down/","group":"6fd8f21b.f22b1c","order":10,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"12","x":3440,"y":4140,"wires":[["5a45bd75.3ba2b4"]]},{"id":"95ff0a36.a10568","type":"ui_button","z":"5a05b8f3.894b88","name":"/bath_12_day_up/","group":"6fd8f21b.f22b1c","order":7,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"12","x":3430,"y":4020,"wires":[["5a45bd75.3ba2b4"]]},{"id":"caaa5737.511258","type":"ui_button","z":"5a05b8f3.894b88","name":"/bath_12_day_down/","group":"6fd8f21b.f22b1c","order":9,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"12","x":3440,"y":4100,"wires":[["5a45bd75.3ba2b4"]]},{"id":"762dc253.7b33cc","type":"ui_template","z":"5a05b8f3.894b88","group":"6fd8f21b.f22b1c","name":"/bath_12/","order":6,"width":"6","height":"1","format":"<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>Bath</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":3400,"y":3980,"wires":[[]]},{"id":"7d70e9cf.ba1618","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":7,"width":3,"height":1,"passthru":false,"label":"All Inside On","color":"","bgcolor":"","icon":"","payload":"All Inside On","payloadType":"str","topic":"","x":2130,"y":3760,"wires":[["e93ee5ce.3132d8"]]},{"id":"f1d0a5c9.d85468","type":"file","z":"5a05b8f3.894b88","name":"Write Scene","filename":"","appendNewline":true,"createDir":false,"overwriteFile":"false","x":3050,"y":4700,"wires":[[]]},{"id":"ed0207ae.e3a458","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":3,"width":3,"height":1,"passthru":true,"label":"Kitchen","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Kitchen","payloadType":"str","topic":"","x":2120,"y":3600,"wires":[["e93ee5ce.3132d8"]]},{"id":"6bf229e4.03b218","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":4,"width":3,"height":1,"passthru":true,"label":"Dinnertime","color":"","bgcolor":"","icon":"","payload":"Dinnertime","payloadType":"str","topic":"","x":2130,"y":3640,"wires":[["e93ee5ce.3132d8"]]},{"id":"3d4f568a.5c735a","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":6,"width":3,"height":1,"passthru":true,"label":"Bedtime","color":"","bgcolor":"","icon":"","payload":"Bedtime","payloadType":"str","topic":"","x":2120,"y":3720,"wires":[["e93ee5ce.3132d8"]]},{"id":"fd30c357.1dfe1","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":5,"width":3,"height":1,"passthru":true,"label":"TV Time","tooltip":"","color":"","bgcolor":"","icon":"","payload":"TV Time","payloadType":"str","topic":"","x":2120,"y":3680,"wires":[["e93ee5ce.3132d8"]]},{"id":"c5376c0a.cbfc3","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":1,"width":3,"height":1,"passthru":true,"label":"Good Morning","color":"","bgcolor":"","icon":"","payload":"Good Morning","payloadType":"str","topic":"","x":2140,"y":3520,"wires":[["e93ee5ce.3132d8"]]},{"id":"f0b74b91.713aa8","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":2,"width":3,"height":1,"passthru":true,"label":"Good Evening","color":"","bgcolor":"","icon":"","payload":"Good Evening","payloadType":"str","topic":"","x":2140,"y":3560,"wires":[["e93ee5ce.3132d8"]]},{"id":"526eecd0.8b3464","type":"comment","z":"5a05b8f3.894b88","name":"Play a Scene","info":"","x":2130,"y":3460,"wires":[]},{"id":"5033166a.adae58","type":"file in","z":"5a05b8f3.894b88","name":"Get Scene File","filename":"","format":"lines","chunk":false,"sendError":false,"x":2460,"y":3880,"wires":[["a1e78f3f.d1f35","2a82e21f.33a77e"]]},{"id":"e93ee5ce.3132d8","type":"function","z":"5a05b8f3.894b88","name":"Play Scene","func":"// Author: Rob Picchione 20180727 v1.1\n//\n// Fill out the Label and Payload fields of a dashboard Button that is input\n// to this function with the name of the Scene file to be executed.\n//\n// Prerequisite: A Scene file of the same exact name must already have been created\n// using the Scene Builder function.\n//\n// This function gets the Scene file name passed from the Payload field of the dashboard \n// button node.\n//\n// The directory path of the scene file is hard coded below in the path variable to avoid\n// having to enter it as a topic in every scene button. If your path is different change it below.\n//\n// The fuction outputs the concatenated path + filename as msg.filename for the Get File node.\n\nlet scenename = msg.payload;\nlet path = global.get ('scenepath');\n\nmsg = {\n    filename:path+scenename,\n}\nreturn msg;","outputs":1,"noerr":0,"x":2450,"y":3820,"wires":[["5033166a.adae58","25027f54.3ee4d"]]},{"id":"2b47bd25.68dcb2","type":"catch","z":"5a05b8f3.894b88","name":"Play Scene Error","scope":["5033166a.adae58","e93ee5ce.3132d8"],"uncaught":false,"x":2400,"y":3620,"wires":[["48fed0d3.21de3"]]},{"id":"a8c1392.dfc87c8","type":"ui_toast","z":"5a05b8f3.894b88","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"Scene File Does Not Exist","name":"Scene FIle Does Not Exist","x":2700,"y":3620,"wires":[[]]},{"id":"48fed0d3.21de3","type":"change","z":"5a05b8f3.894b88","name":"","rules":[{"t":"move","p":"error","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"First Create a Scene with Scene Builder","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2520,"y":3680,"wires":[["a8c1392.dfc87c8"]]},{"id":"452a68d.3c37198","type":"comment","z":"5a05b8f3.894b88","name":"Build a Scene","info":"","x":2110,"y":4220,"wires":[]},{"id":"21b0502c.39d06","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":8,"width":3,"height":1,"passthru":false,"label":"All Inside Off","tooltip":"","color":"","bgcolor":"","icon":"","payload":"All Inside Off","payloadType":"str","topic":"","x":2130,"y":3800,"wires":[["e93ee5ce.3132d8"]]},{"id":"e91d1aee.595d78","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":9,"width":3,"height":1,"passthru":true,"label":"All Outside On","tooltip":"","color":"","bgcolor":"","icon":"","payload":"All Outside On","payloadType":"str","topic":"","x":2140,"y":3840,"wires":[["e93ee5ce.3132d8"]]},{"id":"60c627d2.b86f08","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":10,"width":3,"height":1,"passthru":true,"label":"All Outside Off","tooltip":"","color":"","bgcolor":"","icon":"","payload":"All Outside Off","payloadType":"str","topic":"","x":2140,"y":3880,"wires":[["e93ee5ce.3132d8"]]},{"id":"a40ca2ef.9935e","type":"link in","z":"5a05b8f3.894b88","name":"Scenes","links":["8386d844.59d9b8"],"x":1955,"y":2340,"wires":[["4f494263.b11554"]]},{"id":"8386d844.59d9b8","type":"link out","z":"5a05b8f3.894b88","name":"Scenes","links":["a40ca2ef.9935e"],"x":2915,"y":3860,"wires":[]},{"id":"b2dc26bb.36db38","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":3020,"wires":[["ce87987b.237e58"],[],["df75bd8c.2b2a5"]],"outputLabels":["on/off value","brightness value",null]},{"id":"60232257.2aa5ec","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":2900,"wires":[["e304b78f.b9b158"],[],["f90ea784d45baf53"]],"outputLabels":["on/off value","brightness value",null]},{"id":"92405b43.8f4958","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":620,"wires":[["da5e484.8fa6eb8"],[],["9478b65fee158608"]],"outputLabels":["on/off value","brightness value",null]},{"id":"3fa601fc.eb96de","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":560,"wires":[["c2bb6384.df68e"],[],["06fe89c6a4171a2b"]],"outputLabels":["on/off value","brightness value",null]},{"id":"9376002c.7114d","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":500,"wires":[["8529e370.f1b51"],[],["5c1cc29131f37d9e"]],"outputLabels":["on/off value","brightness value",null]},{"id":"de8dcc10.e3813","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":2580,"wires":[["93f03e27.b1bfb"],[],["fa9957ec.e18c88"]],"outputLabels":["on/off value","brightness value",null]},{"id":"a677f07b.1b2a2","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":2660,"wires":[["902d1fc4.eed6b"],[],["4b4e169d.6f7af8"]],"outputLabels":["on/off value","brightness value",null]},{"id":"14b7f090.bf64ff","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":2780,"wires":[["1aa674fc.20761b"],[],["a9a0ea5e.076e48"]],"outputLabels":["on/off value","brightness value",null]},{"id":"1bfae7f5.b28668","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":2840,"wires":[["3e30dd2.93adb22"],[],["4fd5c522c8aaa7b6"]],"outputLabels":["on/off value","brightness value",null]},{"id":"eaebc1ce.365fe","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":1940,"wires":[["be654208.4cb09"],[],["f8c9d73b.0bb9f8"]],"outputLabels":["on/off value","brightness value",null]},{"id":"a7564371.a01b7","type":"ui_list","z":"5a05b8f3.894b88","group":"ec9d7f42.8db13","name":"Exclusion List","order":3,"width":"0","height":"0","lineType":"one","actionType":"check","allowHTML":true,"outputs":1,"topic":"/coachproxy/node-red/scenes","x":2820,"y":4540,"wires":[["29002784.452a08"]]},{"id":"414316ff.b86dc8","type":"ui_switch","z":"5a05b8f3.894b88","name":"onmode","label":"Full Brightness w/Light ON","tooltip":"","group":"abfd1685.b229d8","order":2,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"onmode","style":"","onvalue":"100","onvalueType":"num","onicon":"","oncolor":"","offvalue":"125","offvalueType":"num","officon":"","offcolor":"","x":4440,"y":3700,"wires":[["a11fdd41.eac12"]]},{"id":"649c120.879dcf","type":"ui_template","z":"5a05b8f3.894b88","group":"abfd1685.b229d8","name":"Lights On Mode","order":1,"width":"0","height":"0","format":"<div>\n<p>\n    By default when turning a dimmable light ON it will revert to the previous brightness level. To force the light to full brightness instead turn this switch ON.\n</p>\n</div>\n","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","className":"","x":4460,"y":3660,"wires":[[]]},{"id":"c8e76a34.bcd338","type":"comment","z":"5a05b8f3.894b88","name":"Lights On Mode Option","info":"Lights On Mode Option\nWhen dimmable lights are turned ON, the default brightness will be the previous brightness value. With the switch on the light will revert to full brightness when turned on regardless of the previous brightness level.\nGlobal variable \"onmode\" set to 125 (previous dim level) by default or with switch off. With switch on it will be set to 100 (full brightness).\nThe code for this is located in the `command_dc_dimmer_ervin.js` file","x":4480,"y":3620,"wires":[]},{"id":"8443d370.8f6fc","type":"link in","z":"5a05b8f3.894b88","name":"Scene Builder","links":["bed0fea6.6dc72","d28dfe3db7c5517b"],"x":2515,"y":4540,"wires":[["70c55bbc.bc93a4","5c4d16b4.127e88"]]},{"id":"418d3362.46c6cc","type":"ui_dropdown","z":"5a05b8f3.894b88","name":"","label":"<b>Select Scene</b>","tooltip":"","place":"Select Scene","group":"ec9d7f42.8db13","order":1,"width":0,"height":0,"passthru":true,"options":[{"label":"","value":"Good Morning","type":"str"},{"label":"","value":"Good Evening","type":"str"},{"label":"","value":"Dinnertime","type":"str"},{"label":"","value":"Kitchen","type":"str"},{"label":"","value":"TV Time","type":"str"},{"label":"","value":"Bedtime","type":"str"},{"label":"","value":"All Inside On","type":"str"},{"label":"","value":"All Inside Off","type":"str"},{"label":"","value":"All inside Off","type":"str"},{"label":"","value":"All Outside On","type":"str"},{"label":"","value":"All Outside Off","type":"str"},{"label":"","value":"Scene A","type":"str"},{"label":"","value":"Scene B","type":"str"},{"label":"","value":"Scene C","type":"str"},{"label":"","value":"Scene D","type":"str"},{"label":"","value":"Scene E","type":"str"},{"label":"","value":"Scene F","type":"str"}],"payload":"","topic":"","x":2140,"y":4280,"wires":[["80d55d0d.dbca4","4de22dcf.49a0b4","70618434.bbc80c"]]},{"id":"50b6073a.0b0888","type":"function","z":"5a05b8f3.894b88","name":"Write Scene File","func":"// // (c) 2020 eRVin project Rob Picchione\n//\n// The for loop sends the file path + name and writes the command string for each device to a file\n// on a separate line in format is for use with dc_dimmer.pl. Devices marked as null by the checklist \n// node are not written to the file. The file can be called and played back by a regular dashboard button.\n\nvar scenelist = global.get('scenelist');\nvar file = msg.payload;\nvar description;\n\nfor(let key in scenelist) {\n    if (scenelist[key].command !== null )  {\n        node.send ({filename:file , \n        payload:scenelist[key].description + ' ' + scenelist[key].command + ' ' + scenelist[key].brightness}) ;\n    }\n}\nnode.done();\nreturn;","outputs":1,"noerr":0,"x":2820,"y":4700,"wires":[["f1d0a5c9.d85468"]]},{"id":"6c19b8a0.f914a8","type":"change","z":"5a05b8f3.894b88","name":"Reset Scenename","rules":[{"t":"set","p":"payload","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2470,"y":4400,"wires":[["418d3362.46c6cc"]]},{"id":"70c55bbc.bc93a4","type":"change","z":"5a05b8f3.894b88","name":"Define Global Scene Info","rules":[{"t":"move","p":"payload","pt":"msg","to":"scenelist","tot":"global"},{"t":"set","p":"scenepath","pt":"global","to":"/coachproxy/node-red/scenes/","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2690,"y":4580,"wires":[[]]},{"id":"29002784.452a08","type":"function","z":"5a05b8f3.894b88","name":"Build Scene","func":"// (c) 2020 eRVin project Rob Picchione\n//\n// This function loads the scene data for all devices from the 'scenelist' global context\n// then modifies it via a user checklist to EXCLUDE the checked device by adding a null\n// to one or more of the device values. If the same device is subsequently unchecked the \n// device data is written back. builds the scene data. When the user is done excluding devices\n// from the scene clicking the Build Scene button will write command the values to a file\n// formatted for use by dc_dimmer.pl\n\nvar title = msg.payload.title;\nvar description = msg.payload.description;\nvar command = msg.payload.command;\nvar brightness = msg.payload.brightness;\nvar ischecked = (msg.payload.isChecked === true)  ?  'checked'  :  'notchecked'\n\nif (ischecked == 'checked')\n{\n    global.set ('scenelist[' + description + '].command', null);\n    global.set ('scenelist[' + description + '].description', null);\n    global.set ('scenelist[' + description + '].brightness', null);\n    payload = \"data cleared\";\n} else {\n    global.set ('scenelist[' + description + '].command', command);\n    global.set ('scenelist[' + description + '].description', description);\n    global.set ('scenelist[' + description + '].brightness', brightness);\n    payload = \"data restored\";\n    // payload = description + ' ' + command + ' ' + brightness + ' ' + ischecked\n}\n\nmsg = null;\nreturn msg;","outputs":1,"noerr":0,"x":3010,"y":4540,"wires":[[]]},{"id":"a3a97374.24202","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"ec9d7f42.8db13","order":5,"width":5,"height":1,"passthru":false,"label":"Build Scene","tooltip":"","color":"","bgcolor":"","icon":"","payload":"build","payloadType":"str","topic":"","x":2090,"y":4720,"wires":[["acc8efa1.c41fc"]]},{"id":"acc8efa1.c41fc","type":"function","z":"5a05b8f3.894b88","name":"Delete Scene File","func":"// (c) 2020 eRVin project Rob Picchione\n//\n// Define path and delete scene file to prepare for new scene definition\n// Output msg1 adds a delay to ensure sucessful deletion of the scene file\n// before new data is written.\n\n\nif (typeof global.get ('scenename') !== 'object')\n{\n    var file = global.get ('scenepath') + global.get ('scenename') ;\n    var msg1 = { 'payload': file } ;\n    var msg2 = { 'filename': file } ;\n    return [msg1, msg2];\n}\n\nthrow \"Please Choose a Scene Name First\";\n","outputs":2,"noerr":0,"x":2290,"y":4720,"wires":[["ddc69a59.5d2ee8"],["68879880.704998"]]},{"id":"ddc69a59.5d2ee8","type":"delay","z":"5a05b8f3.894b88","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":2500,"y":4700,"wires":[["50b6073a.0b0888","eea2aa7d.6f9418"]]},{"id":"68879880.704998","type":"file","z":"5a05b8f3.894b88","name":"Delete Existing Scene File","filename":"","appendNewline":true,"createDir":false,"overwriteFile":"delete","x":2560,"y":4740,"wires":[[]]},{"id":"a0f71aca.fd6aa8","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":11,"width":3,"height":1,"passthru":true,"label":"Scene A","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Scene A","payloadType":"str","topic":"","x":2120,"y":3920,"wires":[["e93ee5ce.3132d8"]]},{"id":"3aa84df4.02acd2","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":12,"width":3,"height":1,"passthru":true,"label":"Scene B","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Scene B","payloadType":"str","topic":"","x":2120,"y":3960,"wires":[["e93ee5ce.3132d8"]]},{"id":"627ccff0.e52f","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":13,"width":3,"height":1,"passthru":true,"label":"Scene C","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Scene C","payloadType":"str","topic":"","x":2120,"y":4000,"wires":[["e93ee5ce.3132d8"]]},{"id":"61c5082f.060b68","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":14,"width":3,"height":1,"passthru":true,"label":"Scene D","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Scene D","payloadType":"str","topic":"","x":2120,"y":4040,"wires":[["e93ee5ce.3132d8"]]},{"id":"bcc95793.5019d8","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":15,"width":3,"height":1,"passthru":true,"label":"Scene E","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Scene E","payloadType":"str","topic":"","x":2120,"y":4080,"wires":[["e93ee5ce.3132d8"]]},{"id":"c3e7fe11.212e","type":"ui_button","z":"5a05b8f3.894b88","name":"","group":"7ef807d5.1ca3b8","order":16,"width":3,"height":1,"passthru":true,"label":"Scene F","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Scene F","payloadType":"str","topic":"","x":2120,"y":4120,"wires":[["e93ee5ce.3132d8"]]},{"id":"25027f54.3ee4d","type":"ui_toast","z":"5a05b8f3.894b88","position":"top right","displayTime":"5","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"Scene Active","name":"Scene Active","x":2690,"y":3820,"wires":[]},{"id":"79113d89.152874","type":"ui_template","z":"5a05b8f3.894b88","group":"fe130cc1.4b7f6","name":" How to use Scene Builder","order":1,"width":6,"height":6,"format":"<div>\n\nA \"Scene\" is the learned status of a group of lights that can be \"re-played\" with a single button press. The lights in a scene can be either on or off, or on at a particular dim level. A scene can set your desired status of every light all at once, but sometimes it is undesireable for certain lights to be in a particular scene, so there is an Exclusion option which means no action is taken for that light. For example, a scene for <i>All Inside Lights On</i> should exclude doing anything to the outside lights.\n<ol>\n    <li>Scene Builder will automatically capture the current state (on, off, dim level) of all your lights from the network, so first create your scene manually by setting your lights to the desired on, off, or dim state. This can be done either via eRVin, your wall switches, or a combination of both.</li>\n    <li>In <b>Scene Builder</b>, if the list of lights is not displayed below <b>Exclusion List</b>, refresh the browser or select another tab and then reselect the Scenes tab until the checkboxes are visible.</li>\n    <li>Now from the <b>Select Scene</b> dropdown, select the name of the scene you want to use. Remember you must have set your lights to the desired values <i>before</i> selecting a scene name. This kicks off a timeout allowing three minutes to complete the Exclusion List and click Build Scene. </li>\n    <li>In the <b>Exclusion Checklist</b> check the box for all devices you do NOT want to be controlled by the scene. For example, for <i>All Inside Lights On</i> you would check the boxes for all of the outside lights because for this scene you don't want them to be changed from whatever state they may be in.</li>\n    <li>Click the <b>Build Scene</b> button at the bottom of the Exclusion List, the scene  will now be created.</li>\n    <li>Now the corresponding button in <b>Scene Control</b> will activate the scene.</li>\n</ol>\n\n</div>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":2490,"y":3940,"wires":[[]]},{"id":"b7f99bc8.144898","type":"ui_template","z":"5a05b8f3.894b88","group":"ec9d7f42.8db13","name":"Exclusion List Title","order":2,"width":0,"height":0,"format":"<div>\n    <p>\n    <br><b>Exclusion List:</b>\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":2470,"y":3980,"wires":[[]]},{"id":"ba59c5e2.859b28","type":"ui_toast","z":"5a05b8f3.894b88","position":"top right","displayTime":"3","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"Building Scene","name":"Building Scene","x":3060,"y":4760,"wires":[]},{"id":"5c4d16b4.127e88","type":"delay","z":"5a05b8f3.894b88","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":2640,"y":4540,"wires":[["a7564371.a01b7"]]},{"id":"80d55d0d.dbca4","type":"link out","z":"5a05b8f3.894b88","name":"Trigger Scenelist","links":["ec305532.271878","4bad20f59157dbad"],"x":2355,"y":4320,"wires":[]},{"id":"eea2aa7d.6f9418","type":"change","z":"5a05b8f3.894b88","name":"Clear Scene Selection & Reload Scene List","rules":[{"t":"set","p":"payload","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2270,"y":4500,"wires":[["418d3362.46c6cc"]]},{"id":"e0c6668f.500e68","type":"catch","z":"5a05b8f3.894b88","name":"Build Scene Error","scope":["acc8efa1.c41fc"],"uncaught":false,"x":2100,"y":4820,"wires":[["73540a33.522fe4"]]},{"id":"8af09880.0024e8","type":"ui_toast","z":"5a05b8f3.894b88","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"Build Scene Error","name":"Please Choose a Scene Name First","x":2420,"y":4820,"wires":[[]]},{"id":"73540a33.522fe4","type":"change","z":"5a05b8f3.894b88","name":"","rules":[{"t":"move","p":"error","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"Please Choose a Scene Name First","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2220,"y":4880,"wires":[["8af09880.0024e8"]]},{"id":"ea3cc224.82ac8","type":"complete","z":"5a05b8f3.894b88","name":"Scene Build Complete","scope":["50b6073a.0b0888"],"uncaught":false,"x":2840,"y":4760,"wires":[["ba59c5e2.859b28"]]},{"id":"4de22dcf.49a0b4","type":"function","z":"5a05b8f3.894b88","name":"Timeout","func":"// (c) 2020 eRVin project Rob Picchione\n// \n// This function performs a timeout reset of the scenename. If a scenename is selected but the Build Scene\n// button is not activated it can create a situation where the incorrect scenename is saved\n// in the global variable. After the sceneame is selected, if the Build Scene button is not activated\n// the scenename is reset to 'empty' and the dashboard button is also reset.\n\nvar scenename = msg.payload\n// var frominput = msg._frominput\n\nif (msg._fromInput === true)\n{\n    msg = {'reset':true} \n    global.set ('scenename', [])\n    return msg;\n} else \n{\n    global.set ('scenename', msg.payload)\n    msg = { 'payload': scenename } ;\n    return msg;\n}\n","outputs":1,"noerr":0,"x":2400,"y":4280,"wires":[["a2eeaddb.f342e"]]},{"id":"a2eeaddb.f342e","type":"delay","z":"5a05b8f3.894b88","name":"","pauseType":"delayv","timeout":"4","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":2560,"y":4280,"wires":[["6c19b8a0.f914a8","e7e89320.0851e"]]},{"id":"d27961fd.c7a35","type":"ui_ui_control","z":"5a05b8f3.894b88","name":"","events":"change","x":4760,"y":4360,"wires":[[]]},{"id":"9b0f7310.0bf71","type":"ui_switch","z":"5a05b8f3.894b88","name":"Aquahot","label":"Aquahot","tooltip":"","group":"dd035f6c.5d73e","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"tabs\":{\"hide\":\"Aquahot\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"tabs\":{\"show\":\"Aquahot\"}}","offvalueType":"json","officon":"","offcolor":"","x":4280,"y":4120,"wires":[["d27961fd.c7a35","41f0225f.29879c"]]},{"id":"e0684432.74ca78","type":"ui_switch","z":"5a05b8f3.894b88","name":"Alexa","label":"Alexa","tooltip":"","group":"dd035f6c.5d73e","order":7,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"tabs\":{\"hide\":\"Alexa\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"tabs\":{\"show\":\"Alexa\"}}","offvalueType":"json","officon":"","offcolor":"","x":4270,"y":4280,"wires":[["d27961fd.c7a35","41f0225f.29879c"]]},{"id":"ed2a5854.b69aa8","type":"ui_switch","z":"5a05b8f3.894b88","name":"Status","label":"Status","tooltip":"","group":"dd035f6c.5d73e","order":6,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"tabs\":{\"hide\":\"Status\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"tabs\":{\"show\":\"Status\"}}","offvalueType":"json","officon":"","offcolor":"","x":4270,"y":4200,"wires":[["d27961fd.c7a35","41f0225f.29879c"]]},{"id":"9181d539.f61da8","type":"ui_switch","z":"5a05b8f3.894b88","name":"Locks","label":"Locks","tooltip":"","group":"dd035f6c.5d73e","order":5,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"tabs\":{\"hide\":\"Locks\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"tabs\":{\"show\":\"Locks\"}}","offvalueType":"json","officon":"","offcolor":"","x":4270,"y":4160,"wires":[["d27961fd.c7a35","41f0225f.29879c"]]},{"id":"92a2e3dc.7ffea","type":"ui_switch","z":"5a05b8f3.894b88","name":"Shades","label":"Shades","tooltip":"","group":"dd035f6c.5d73e","order":3,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"tabs\":{\"hide\":\"Shades\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"tabs\":{\"show\":\"Shades\"}}","offvalueType":"json","officon":"","offcolor":"","x":4280,"y":4080,"wires":[["d27961fd.c7a35","41f0225f.29879c"]]},{"id":"92c98fb6.69326","type":"ui_switch","z":"5a05b8f3.894b88","name":"Notifications","label":"Notifications","tooltip":"","group":"dd035f6c.5d73e","order":8,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"tabs\":{\"hide\":\"Notifications\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"tabs\":{\"show\":\"Notifications\"}}","offvalueType":"json","officon":"","offcolor":"","x":4290,"y":4320,"wires":[["d27961fd.c7a35","41f0225f.29879c"]]},{"id":"a3987d3d.13a64","type":"ui_switch","z":"5a05b8f3.894b88","name":"System","label":"System","tooltip":"","group":"dd035f6c.5d73e","order":9,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"tabs\":{\"hide\":\"System\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"tabs\":{\"show\":\"System\"}}","offvalueType":"json","officon":"","offcolor":"","x":4280,"y":4360,"wires":[["d27961fd.c7a35","41f0225f.29879c"]]},{"id":"94ee6a6d.53ccc8","type":"ui_template","z":"5a05b8f3.894b88","group":"dd035f6c.5d73e","name":"Show/Hide Tabs","order":1,"width":"0","height":"0","format":"<div><p>Hide unneeded main menu tabs. Turn the switch on to hide the tab.</p></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","className":"","x":4780,"y":4400,"wires":[[]]},{"id":"d624cecb.3fa02","type":"ui_switch","z":"5a05b8f3.894b88","name":"Exterior/Awnings","label":"Exterior/Awnings","tooltip":"","group":"c2caa18b.132cd","order":5,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"group\":{\"hide\":\"Exterior_Awnings\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"group\":{\"show\":\"Exterior_Awnings\"}}","offvalueType":"json","officon":"","offcolor":"","x":4310,"y":4460,"wires":[["d27961fd.c7a35","8a643317.4b405"]]},{"id":"9a0635ed.3d9788","type":"ui_switch","z":"5a05b8f3.894b88","name":"Aquahot/Water Pump","label":"Aquahot/Water Pump","tooltip":"","group":"c2caa18b.132cd","order":6,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"group\":{\"hide\":\"Aquahot_Water_Pump\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"group\":{\"show\":\"Aquahot_Water_Pump\"}}","offvalueType":"json","officon":"","offcolor":"","x":4320,"y":4500,"wires":[["d27961fd.c7a35","8a643317.4b405"]]},{"id":"68ca12a6.017f7c","type":"ui_template","z":"5a05b8f3.894b88","group":"c2caa18b.132cd","name":"Show/Hide Groups","order":1,"width":"0","height":"0","format":"<div><p>Hide unneeded sub panels (groups). Turn the switch on to hide the group.</p></div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","className":"","x":4790,"y":4440,"wires":[[]]},{"id":"d5eefffc.a2669","type":"ui_switch","z":"5a05b8f3.894b88","name":"Scenes","label":"Scenes","tooltip":"","group":"dd035f6c.5d73e","order":2,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"tabs\":{\"hide\":\"Scenes\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"tabs\":{\"show\":\"Scenes\"}}","offvalueType":"json","officon":"","offcolor":"","x":4280,"y":4040,"wires":[["d27961fd.c7a35","41f0225f.29879c"]]},{"id":"caa02104.da274","type":"ui_switch","z":"5a05b8f3.894b88","name":"Scenes/How to use Scene Builder","label":"Scenes/How to use Scene Builder","tooltip":"","group":"c2caa18b.132cd","order":3,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"group\":{\"hide\":\"Scenes_How_to_use_Scene_Builder\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"group\":{\"show\":\"Scenes_How_to_use_Scene_Builder\"}}","offvalueType":"json","officon":"","offcolor":"","x":4360,"y":4580,"wires":[["d27961fd.c7a35","8a643317.4b405"]]},{"id":"70feaae0.b7a494","type":"ui_switch","z":"5a05b8f3.894b88","name":"Scenes/Scene Builder","label":"Scenes/Scene Builder","tooltip":"","group":"c2caa18b.132cd","order":2,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"group\":{\"hide\":\"Scenes_Scene_Builder\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"group\":{\"show\":\"Scenes_Scene_Builder\"}}","offvalueType":"json","officon":"","offcolor":"","x":4320,"y":4540,"wires":[["d27961fd.c7a35","8a643317.4b405"]]},{"id":"7e50e4e6.c8f7fc","type":"comment","z":"5a05b8f3.894b88","name":"Show/Hide Tabs","info":"","x":4300,"y":4000,"wires":[]},{"id":"c0364c1.48224b","type":"comment","z":"5a05b8f3.894b88","name":"Light Master","info":"turn lights off with mem off and state will be remembered. turn on with mem on and lights are restored to previous value. All on turns on everything.","x":1510,"y":300,"wires":[]},{"id":"2904a8af.2151e8","type":"ui_switch","z":"5a05b8f3.894b88","name":"Interior/Memory Master","label":"Interior/Memory Master","tooltip":"","group":"c2caa18b.132cd","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"group\":{\"hide\":\"Interior_Memory_Master\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"group\":{\"show\":\"Interior_Memory_Master\"}}","offvalueType":"json","officon":"","offcolor":"","x":4330,"y":4620,"wires":[["d27961fd.c7a35","8a643317.4b405"]]},{"id":"e7e89320.0851e","type":"function","z":"5a05b8f3.894b88","name":"Timeout Msg","func":"throw \"Timeout - After choosing a Scene Name, please complete the scene by clicking Build Scene\";","outputs":1,"noerr":0,"x":2790,"y":4280,"wires":[[]]},{"id":"ec95a453.b6f588","type":"catch","z":"5a05b8f3.894b88","name":"Timeout Msg","scope":["e7e89320.0851e"],"uncaught":false,"x":2670,"y":4360,"wires":[["9374ab7c.fe0718"]]},{"id":"c1a9a460.612d68","type":"ui_toast","z":"5a05b8f3.894b88","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"Scene Name Timeout","name":"Scene Name Timeout","x":2970,"y":4360,"wires":[[]]},{"id":"9374ab7c.fe0718","type":"change","z":"5a05b8f3.894b88","name":"","rules":[{"t":"move","p":"error","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"After choosing a Scene Name, please complete the scene by clicking the Build Scene button.","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2800,"y":4420,"wires":[["c1a9a460.612d68"]]},{"id":"d47d5a9b.12cdd8","type":"ui_button","z":"5a05b8f3.894b88","name":"Cancel","group":"ec9d7f42.8db13","order":4,"width":1,"height":1,"passthru":false,"label":"","tooltip":"","color":"","bgcolor":"#8D4040","icon":"replay","payload":"cancel","payloadType":"str","topic":"","x":2080,"y":4680,"wires":[["322841bd.7c628e"]]},{"id":"322841bd.7c628e","type":"change","z":"5a05b8f3.894b88","name":"","rules":[{"t":"move","p":"payload","pt":"msg","to":"reset","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2120,"y":4460,"wires":[["418d3362.46c6cc"]]},{"id":"a1e78f3f.d1f35","type":"function","z":"5a05b8f3.894b88","name":"Redirect","func":"//Splits the output into flow1 for lights and flow2 for panel backlights.\n//\npayload = msg.payload;\nvar instance = msg.payload.split(' ')[0];\n\nif (instance <= 60)\n{\n    var msg1 = {payload: msg.payload};\n    return [msg1, null];\n}\n\nvar state = 126 //figure out a way to get this value from instance #\nvar brightness = msg.payload.split(' ')[2];\n\nvar msg2 = {'payload': state + ' ' + brightness}\nreturn [null, msg2];","outputs":2,"noerr":0,"x":2760,"y":3880,"wires":[["8386d844.59d9b8"],["60d2fba3.9e8cd4"]]},{"id":"2959b7ca.912418","type":"link in","z":"5a05b8f3.894b88","name":"Scene Panel Lights","links":["60d2fba3.9e8cd4"],"x":2915,"y":200,"wires":[["f9363c14.d66b"]]},{"id":"60d2fba3.9e8cd4","type":"link out","z":"5a05b8f3.894b88","name":"Scene Panel Lights","links":["2959b7ca.912418"],"x":2915,"y":3900,"wires":[]},{"id":"76dcb995.a69628","type":"function","z":"5a05b8f3.894b88","name":"","func":"\nvar command = 126;\nvar instance = 100;\nvar brightness = msg.payload.brightness;\nvar instancename = global.get('status').lights[instance].instancename;\n\n\n//figure out a way to get the instance from the instancename\n//var scenelist = global.get('scenelist');\n\nglobal.set('status.lights[' + instance + '].state', command);\nglobal.set('status.lights[' + instance + '].brightness', brightness);\nglobal.set('status.lights[' + instance + '].instancename', instancename);\n\nreturn msg;\n\n\n/*\nObject.prototype.getKey = function(value){\n  for(var key in scenelist.title){\n    if(scenelist.title[key] == value){\n      return key;\n    }\n  }\n  return 'null';\n};\n\n//var key = languageCodes.getKey('Greek');\nvar key = [scenelist].getKey('Panel Lights');\n*/","outputs":1,"noerr":0,"x":1800,"y":180,"wires":[["a0c0d1db.0ba1e","90b01324.960d5","8b1dfef7.d82b7"]]},{"id":"7e3eca66.93ae34","type":"ui_switch","z":"5a05b8f3.894b88","name":"Status/Power","label":"Status/Power","tooltip":"","group":"c2caa18b.132cd","order":7,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"group\":{\"hide\":\"Status_Power\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"group\":{\"show\":\"Status_Power\"}}","offvalueType":"json","officon":"","offcolor":"","x":4300,"y":4660,"wires":[["d27961fd.c7a35","8a643317.4b405"]]},{"id":"70ddbd93.392054","type":"ui_switch","z":"5a05b8f3.894b88","name":"Status/Generator","label":"Status/Generator","tooltip":"","group":"c2caa18b.132cd","order":8,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"group\":{\"hide\":\"Status_Generator\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"group\":{\"show\":\"Status_Generator\"}}","offvalueType":"json","officon":"","offcolor":"","x":4310,"y":4700,"wires":[["d27961fd.c7a35","8a643317.4b405"]]},{"id":"3debed08.8278b2","type":"comment","z":"5a05b8f3.894b88","name":"Show/Hide Groups","info":"","x":4310,"y":4420,"wires":[]},{"id":"c5b4b8df.138d88","type":"link in","z":"5a05b8f3.894b88","name":"GPS","links":["d282e6c3.8f6788","401e792b.e6cb28"],"x":1955,"y":2100,"wires":[["4f494263.b11554"]]},{"id":"be654208.4cb09","type":"ui_switch","z":"5a05b8f3.894b88","name":"28_Aquahot_Electric","label":"Aquahot Electric","tooltip":"","group":"cf9b6bb9.e5ef38","order":13,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"28_state_Aquahot Electric","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1160,"y":1920,"wires":[["ba8aebb.ea06618"]]},{"id":"93f03e27.b1bfb","type":"ui_switch","z":"5a05b8f3.894b88","name":"36_Aquahot_Burner","label":"Aquahot Burner","tooltip":"","group":"cf9b6bb9.e5ef38","order":21,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"36_state_Aquahot Burner","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1160,"y":2540,"wires":[["ba8aebb.ea06618"]]},{"id":"340c59d6.8c75c6","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":2720,"wires":[["2d1351ee.4840fe"],[],["a2b09dcd.2d1c9"]],"outputLabels":["on/off value","brightness value",null]},{"id":"bc502eba.b0b12","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":1540,"wires":[["21309d67.8efe4a"],["36b5f55f.b2f8d2"],["bf70c94a.c7ef08"]],"outputLabels":["on/off value","brightness value",null]},{"id":"c1d41b37.eaf988","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":2960,"wires":[["6462abc1.33600c"],[],["2aa529f4.33c4a6"]],"outputLabels":["on/off value","brightness value",null]},{"id":"3c2b2f01.70441","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/12","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":680,"wires":[["47d4e9429d4d46f2"]]},{"id":"477b2241.4c1adc","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/6","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":170,"y":320,"wires":[["d5706edb.8349a"]]},{"id":"d5706edb.8349a","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":320,"wires":[["283713ce.743e8c"],[],["7d77f212491812d9"]],"outputLabels":["on/off value","brightness value",null]},{"id":"ce5574b8.ee8ca8","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/8","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":170,"y":440,"wires":[["e0c625f7.e59e38"]]},{"id":"e0c625f7.e59e38","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":440,"wires":[["280d22e0.94620e"],[],["714b4f8758d3392c"]],"outputLabels":["on/off value","brightness value",null]},{"id":"280d22e0.94620e","type":"ui_switch","z":"5a05b8f3.894b88","d":true,"name":"8_AH_Preheat","label":"Preheat","tooltip":"","group":"cf9b6bb9.e5ef38","order":3,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"8_state_Aquahot Preheat","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1180,"y":420,"wires":[["ba8aebb.ea06618"]]},{"id":"f980807a.83c5f","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":380,"wires":[["598a18fa.e0ba78"],[],["e92f0dac376edd3c"]],"outputLabels":["on/off value","brightness value",null]},{"id":"354c94bb.c9748c","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/7","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":170,"y":380,"wires":[["f980807a.83c5f"]]},{"id":"a340439.86709c","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/24","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":1620,"wires":[["4cbf9743.3749e8"]]},{"id":"598a18fa.e0ba78","type":"ui_switch","z":"5a05b8f3.894b88","d":true,"name":"7_AH_Electric","label":"Electric","tooltip":"","group":"cf9b6bb9.e5ef38","order":1,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"7_state_Aquahot Burner","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1180,"y":360,"wires":[["ba8aebb.ea06618"]]},{"id":"49eb607b.43a27","type":"ui_switch","z":"5a05b8f3.894b88","name":"Location","label":"Location","tooltip":"","group":"dd035f6c.5d73e","order":6,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"tabs\":{\"hide\":\"Location\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"tabs\":{\"show\":\"Location\"}}","offvalueType":"json","officon":"","offcolor":"","x":4280,"y":4240,"wires":[["d27961fd.c7a35","41f0225f.29879c"]]},{"id":"902d1fc4.eed6b","type":"ui_switch","z":"5a05b8f3.894b88","name":"37_Ext_Under_Slideout_Lights","label":"Under Slideout","tooltip":"","group":"4e2af34d.8f765c","order":3,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"37_state_Under Slideout Lights","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1130,"y":2620,"wires":[["ba8aebb.ea06618"]]},{"id":"8d944c36.f329b","type":"ui_button","z":"5a05b8f3.894b88","d":true,"name":"/ds_slide_end_5_night_up/","group":"5a6f1f47.88d1c","order":18,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"5","x":3460,"y":2520,"wires":[["5a45bd75.3ba2b4"]]},{"id":"a7df515f.690b5","type":"ui_button","z":"5a05b8f3.894b88","d":true,"name":"/ds_slide_end_5_night_down/","group":"5a6f1f47.88d1c","order":20,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"5","x":3470,"y":2600,"wires":[["5a45bd75.3ba2b4"]]},{"id":"9b9f9164.0d927","type":"ui_button","z":"5a05b8f3.894b88","d":true,"name":"/ds_slide_end_5_day_up/","group":"5a6f1f47.88d1c","order":17,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"5","x":3450,"y":2480,"wires":[["5a45bd75.3ba2b4"]]},{"id":"58330ec9.8f6ed","type":"ui_button","z":"5a05b8f3.894b88","d":true,"name":"/ds_slide_end_5_day_down/","group":"5a6f1f47.88d1c","order":19,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"5","x":3460,"y":2560,"wires":[["5a45bd75.3ba2b4"]]},{"id":"875e8c8a.5d873","type":"ui_template","z":"5a05b8f3.894b88","d":true,"group":"5a6f1f47.88d1c","name":"/ds_slide_end_5/","order":16,"width":"6","height":"1","format":"<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>DS Slide End</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":3430,"y":2440,"wires":[[]]},{"id":"7dc8b4aa.78a1cc","type":"ui_button","z":"5a05b8f3.894b88","d":true,"name":"/ent_center_6_night_up/","group":"5a6f1f47.88d1c","order":13,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"6","x":3450,"y":2960,"wires":[["5a45bd75.3ba2b4"]]},{"id":"b4f24073.1361a","type":"ui_button","z":"5a05b8f3.894b88","d":true,"name":"/ent_center_6_night_down/","group":"5a6f1f47.88d1c","order":15,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"6","x":3460,"y":3040,"wires":[["5a45bd75.3ba2b4"]]},{"id":"ca62de06.e639f","type":"ui_button","z":"5a05b8f3.894b88","d":true,"name":"/ent_center_6_day_up/","group":"5a6f1f47.88d1c","order":12,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"6","x":3440,"y":2920,"wires":[["5a45bd75.3ba2b4"]]},{"id":"1691f00.f216c1","type":"ui_button","z":"5a05b8f3.894b88","d":true,"name":"/ent_center_6_day_down/","group":"5a6f1f47.88d1c","order":14,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"6","x":3450,"y":3000,"wires":[["5a45bd75.3ba2b4"]]},{"id":"cdaea80d.7c6c38","type":"ui_template","z":"5a05b8f3.894b88","d":true,"group":"5a6f1f47.88d1c","name":"/ent_center_6/","order":11,"width":"6","height":"1","format":"<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>Ent Center</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":3420,"y":2880,"wires":[[]]},{"id":"57d055b7.fc4aac","type":"ui_button","z":"5a05b8f3.894b88","d":true,"name":"/pseat_window_17_night_up/","group":"ae3b3824.48abe8","order":23,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"17","x":3460,"y":2300,"wires":[["5a45bd75.3ba2b4"]]},{"id":"badc2697.b24f88","type":"ui_button","z":"5a05b8f3.894b88","d":true,"name":"/pseat_window_17_night_down/","group":"ae3b3824.48abe8","order":25,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"17","x":3470,"y":2380,"wires":[["5a45bd75.3ba2b4"]]},{"id":"f534772d.5a9228","type":"ui_button","z":"5a05b8f3.894b88","d":true,"name":"/pseat_window_17_day_up/","group":"ae3b3824.48abe8","order":22,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"17","x":3460,"y":2260,"wires":[["5a45bd75.3ba2b4"]]},{"id":"2beb92c8.dbddde","type":"ui_button","z":"5a05b8f3.894b88","d":true,"name":"/pseat_window_17_day_down/","group":"ae3b3824.48abe8","order":24,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"17","x":3470,"y":2340,"wires":[["5a45bd75.3ba2b4"]]},{"id":"4bcd5f2a.d9ddf","type":"ui_template","z":"5a05b8f3.894b88","d":true,"group":"ae3b3824.48abe8","name":"/pseat_window_17/","order":21,"width":"6","height":"1","format":"<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>Passenger Seat</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":3430,"y":2220,"wires":[[]]},{"id":"625a2a8.f46b9d4","type":"ui_template","z":"5a05b8f3.894b88","group":"5725fb8d.051db4","name":"/cab_master/","order":6,"width":"6","height":"1","format":"<!DOCTYPE html>\n<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>Cab Master</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":3410,"y":680,"wires":[[]]},{"id":"107e7b31.7589c5","type":"ui_button","z":"5a05b8f3.894b88","name":"/cab_master_night_up/","group":"5725fb8d.051db4","order":8,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"1 2 3 4 17","x":3440,"y":760,"wires":[["5a45bd75.3ba2b4"]]},{"id":"68517efc.ad07","type":"ui_button","z":"5a05b8f3.894b88","name":"/cab_master_night_down/","group":"5725fb8d.051db4","order":10,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"1 2 3 4 17","x":3450,"y":840,"wires":[["5a45bd75.3ba2b4"]]},{"id":"66734e3d.527ca","type":"ui_button","z":"5a05b8f3.894b88","name":"/cab_master_day_up/","group":"5725fb8d.051db4","order":7,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"1 2 3 4 17","x":3440,"y":720,"wires":[["5a45bd75.3ba2b4"]]},{"id":"d332f7ba.4e4de8","type":"ui_button","z":"5a05b8f3.894b88","name":"/cab_master_day_down/","group":"5725fb8d.051db4","order":9,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"1 2 3 4 17","x":3450,"y":800,"wires":[["5a45bd75.3ba2b4"]]},{"id":"d4ee8ec3.89ed1","type":"ui_template","z":"5a05b8f3.894b88","group":"5725fb8d.051db4","name":"/lr_master/","order":11,"width":"6","height":"1","format":"<!DOCTYPE html>\n<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>Living Room Master</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":3410,"y":900,"wires":[[]]},{"id":"2418ae48.659112","type":"ui_button","z":"5a05b8f3.894b88","name":"/lr_master_night_up/","group":"5725fb8d.051db4","order":13,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"5 6 7 8","x":3440,"y":980,"wires":[["5a45bd75.3ba2b4"]]},{"id":"2a5149b6.23d136","type":"ui_button","z":"5a05b8f3.894b88","name":"/lr_master_night_down/","group":"5725fb8d.051db4","order":15,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"5 6 7 8","x":3450,"y":1060,"wires":[["5a45bd75.3ba2b4"]]},{"id":"bc1bbb64.e89bb8","type":"ui_button","z":"5a05b8f3.894b88","name":"/lr_master_day_up/","group":"5725fb8d.051db4","order":12,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"5 6 7 8","x":3430,"y":940,"wires":[["5a45bd75.3ba2b4"]]},{"id":"c61072a0.ef868","type":"ui_button","z":"5a05b8f3.894b88","name":"/lr_master_day_down/","group":"5725fb8d.051db4","order":14,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"5 6 7 8","x":3440,"y":1020,"wires":[["5a45bd75.3ba2b4"]]},{"id":"3c29a9c4.551016","type":"ui_template","z":"5a05b8f3.894b88","group":"5725fb8d.051db4","name":"/bed_master/","order":16,"width":"6","height":"1","format":"<!DOCTYPE html>\n<div style=\"height: 14px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 18px; font-size: 16px; text-align: center\">\n<div style=\"float:left;\"><i class=\"fa fa-fw fa-sun-o\" style=\"margin-left:44px;\"></i></div>\n<span>Bedroom Master</span>\n<div style=\"float:right;\"><i class=\"fa fa-fw fa-moon-o\" style=\"margin-right:44px;\"></i></div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":3410,"y":1120,"wires":[[]]},{"id":"b1596a5d.09a098","type":"ui_button","z":"5a05b8f3.894b88","name":"/bed_master_night_up/","group":"5725fb8d.051db4","order":18,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"night up","payloadType":"str","topic":"9 10","x":3440,"y":1200,"wires":[["5a45bd75.3ba2b4"]]},{"id":"38e04b6b.e8bc74","type":"ui_button","z":"5a05b8f3.894b88","name":"/bed_master_night_down/","group":"5725fb8d.051db4","order":20,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"#000","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"night down","payloadType":"str","topic":"9 10","x":3450,"y":1280,"wires":[["5a45bd75.3ba2b4"]]},{"id":"dd2da6a9.4c58e8","type":"ui_button","z":"5a05b8f3.894b88","name":"/bed_master_day_up/","group":"5725fb8d.051db4","order":17,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-up fa-3x","payload":"day up","payloadType":"str","topic":"9 10","x":3440,"y":1160,"wires":[["5a45bd75.3ba2b4"]]},{"id":"e1156209.d0e4d","type":"ui_button","z":"5a05b8f3.894b88","name":"/bed_master_day_down/","group":"5725fb8d.051db4","order":19,"width":"3","height":"1","passthru":false,"label":"","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-down fa-3x","payload":"day down","payloadType":"str","topic":"9 10","x":3450,"y":1240,"wires":[["5a45bd75.3ba2b4"]]},{"id":"aaab3715.944c68","type":"ui_switch","z":"5a05b8f3.894b88","name":"sofasconcemode","label":"Make Sofa/Sconce Dimmable","tooltip":"","group":"f91d30ee.81533","order":2,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"sofasconcemode","style":"","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"on","offvalueType":"str","officon":"","offcolor":"","x":4470,"y":3840,"wires":[["eacad62c.301c28"]]},{"id":"e2ae75ba.f30548","type":"ui_template","z":"5a05b8f3.894b88","group":"f91d30ee.81533","name":"Sofa/Sconce Mode","order":1,"width":"0","height":"0","format":"<div>\n<p>\n    Entegra combines the sofa overhead task lighting with the sofa sconce mood lighting. The overhead task lights are touch activated pucks and therefore non-dimmable so the entire circuit remains non-dimmable including the sconces. Replace the overhead task pucks with no-touch dimmable versions and this circuit can be made dimmable. To make the Sofa/Sconce circuit dimmable turn this switch ON.\n</p>\n</div>\n","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","className":"","x":4470,"y":3800,"wires":[[]]},{"id":"84a72133.e8c38","type":"comment","z":"5a05b8f3.894b88","name":"Sofa/Sconce Dim Mode Option","info":"Sofa/Sconce Dim Mode Option\nThe Sofa/Sconce light circuit on 2017 and newer Entegra coaches is a dimmable circuit, however annoyingly it contains non-dimmable task lighting (overhead pucks) AND dimmable mood lighting (sconces). These SHOULD be on separate circuits.\nThe wall switch is programmed to NOT allow dimming.\nThe overhead pucks are touch activated and for that reason do not work properly when dimmed. If those pucks are replaced with non-touch dimmable versions, the entire circuit can be dimmed.\nThis option provides for that setting.\nThe code for this is located in the main node at the output of the brightness dashboard node.","x":4510,"y":3760,"wires":[]},{"id":"ebb198dc.6a1718","type":"inject","z":"5a05b8f3.894b88","name":"Init at start","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.3","topic":"","payload":"","payloadType":"date","x":3970,"y":3760,"wires":[["617f1205.f5203c","85d8cd27.cac9a","34faac01.43f524","9e426ec2.bde2b"]]},{"id":"a11fdd41.eac12","type":"change","z":"5a05b8f3.894b88","name":"set onmode","rules":[{"t":"set","p":"options.onmode","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4670,"y":3700,"wires":[[]]},{"id":"eacad62c.301c28","type":"change","z":"5a05b8f3.894b88","name":"set sofasconcemode","rules":[{"t":"set","p":"options.sofasconcemode","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4700,"y":3840,"wires":[[]]},{"id":"befc9017.0fda8","type":"function","z":"5a05b8f3.894b88","name":"Dimmable?","func":"// 2019 1126  Rob Picchione myERVIN.com\n//\n// Special light that has an option (Option Tab) to disable or\n// enable dimming due to the type of light fixture installed.\n// If dimming is disabled this script disables (greys out)\n// the slider for the dimmer and sets it value to 100.\n\nvar sofasconcemode = global.get('options.sofasconcemode')\nvar payload = msg.payload\n\n\nif (sofasconcemode === 'on') {\n    msg.payload = 100;\n    msg.enabled = false;\n} else if (sofasconcemode === 'dim') {\n    msg.enabled = true\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":830,"y":2180,"wires":[["a7d2239b.42bcc"]]},{"id":"617f1205.f5203c","type":"link out","z":"5a05b8f3.894b88","name":"Initialize","links":["e67569b6.e632f8","48fe2626.9ea438"],"x":4215,"y":3900,"wires":[]},{"id":"85d8cd27.cac9a","type":"function","z":"5a05b8f3.894b88","name":"Init eRVin Global Context","func":"//  20201212  Rob Picchione myERVIN.com\n// \n// Checks for global context variables\n// If they don't exist they are initialized to default or empty object.\n// If they do exist they are left alone.\n// \n// predefine enteredzip\n// This is to support systems that do not have a GPS receiver. If no zip is\n// entered the default will be set to Middlebury, IN.\n// If a GPS receiver is present and has a valid fix it will override \n// the context lat/lon with actual values (see function in Automations tab)\n\nif (typeof global.get('enteredzip') === 'undefined' || global.get('enteredzip') === null) {\n    global.set('enteredzip', \"46540\")\n}\n\n// predefine lon\n// default logitude for Middlebury, IN\nif (typeof global.get('lon') === 'undefined' || global.get('lon') === null) {\n    global.set('lon', -85.698192)\n}\n\n// predefine lat\n// default latitude for Middlebury, IN\nif (typeof global.get('lat') === 'undefined' || global.get('lat') === null) {\n    global.set('lat', 41.680015)\n}\n\n// predefine sunset\n// sets up an empty object in global context for capturing which devices\n// have been selected for actions at sunset. See Automation tab.\n// Note difference between defining and empty object vs an empty array\n// global.set(\"sunset.lights\",[]); //array\n// global.set(\"sunset.lights\", {}); //object\nif (typeof global.get('sunset') === 'undefined' || global.get('sunset') === null) {\n    global.set(\"sunset.lights\", {})\n    global.set(\"sunset.scenes\", {})\n}\n\n// predefine onmode\n// check to see if onmode exists in global context.\n// if not create it and set the value to default 125\n// which will return lights to theeir previous dim value\n// when turned on. If the onmode global already exists get\n// the value. Send the value to the switch node to ensure\n// it is positioned properly\n\nif (typeof global.get('options.onmode') === 'undefined' || global.get('options.onmode') === null) {\n    global.set('options.onmode', 125)\n}\n//var onmode = global.get('options.onmode');\n//var msg1 = {'payload' : onmode};\n//var msg1 = {'payload' : [global.get('onmode')]};\n\n// predefine sofasconcemode\n// Entegra combines the sofa overhead task lighting with the sofa sconce mood \n// lighting. The overhead task lights are touch activated pucks and therefore \n// non-dimmable so the entire circuit remains non-dimmable including the sconces. \n// Replace the overhead task pucks with no-touch dimmable versions and this circuit \n// can be made dimmable. Values are 'on' or 'dim'.\nif (typeof global.get('options.sofasconcemode') === 'undefined' || global.get('options.sofasconcemode') === null) {\n    global.set('options.sofasconcemode', 'on')\n}\n//var sofasconcemode = global.get('sofasconcemode');\n//var msg2 = {'payload' : sofasconcemode};\n//var msg2 = {'payload' : [global.get('sofasconcemode')]};\n\n//return [msg1, msg2];\nreturn null\n\n","outputs":2,"noerr":0,"initialize":"","finalize":"","x":4230,"y":3760,"wires":[[],[]]},{"id":"d7bfba76.7169e8","type":"comment","z":"5a05b8f3.894b88","name":"Initialize eRVin Global Context","info":"","x":4000,"y":3620,"wires":[]},{"id":"70618434.bbc80c","type":"function","z":"5a05b8f3.894b88","name":"","func":"var scenename = msg.payload\n//global.set('sunset.scenes', scenename);\n//global.set('sunset.scenes', {scenename});\n//global.set('sunset.scenes [+scenename+]', scenename);\nglobal.set('sunset.scenes[' + scenename + '].suntrig', false);\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2400,"y":4240,"wires":[[]]},{"id":"9dfb70b.e4a089","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.tabs","tot":"msg"},{"t":"set","p":"payload.tabs","pt":"msg","to":"options.tabs.locks","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":4090,"y":4160,"wires":[["9181d539.f61da8"]]},{"id":"41f0225f.29879c","type":"function","z":"5a05b8f3.894b88","name":"","func":"//  20210124  Rob Picchione myERVIN.com\n//\n// This function simply writes the status of the show/hide tabes\n// to globel context so state can be reloaded after a restart.\n\nswitch (msg.payload.tabs.hide || msg.payload.tabs.show) {\n    //Enter a case block like the below for each option:\n    case \"Scenes\":\n    global.set('options.tabs.scenes', msg.payload.tabs);\n    break;\n    //Enter a case block like the above for each option:\n    \n    case \"Shades\":\n    global.set('options.tabs.shades', msg.payload.tabs);\n    break;\n    \n    case \"Aquahot\":\n    global.set('options.tabs.aquahot', msg.payload.tabs);\n    break;\n    \n    case \"Locks\":\n    global.set('options.tabs.locks', msg.payload.tabs);\n    break;\n    \n    case \"Status\":\n    global.set('options.tabs.status', msg.payload.tabs);\n    break;\n    \n    case \"Location\":\n    global.set('options.tabs.location', msg.payload.tabs);\n    break;\n    \n    case \"Alexa\":\n    global.set('options.tabs.alexa', msg.payload.tabs);\n    break;\n    \n    case \"Notifications\":\n    global.set('options.tabs.notifications', msg.payload.tabs);\n    break;\n    \n    case \"System\":\n    global.set('options.tabs.system', msg.payload.tabs);\n    break;\n    \n}\n\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4680,"y":4220,"wires":[[]]},{"id":"1acef3f8.a3a2cc","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.tabs","tot":"msg"},{"t":"set","p":"payload.tabs","pt":"msg","to":"options.tabs.aquahot","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":4090,"y":4120,"wires":[["9b0f7310.0bf71"]]},{"id":"bcb2bcdd.20469","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.tabs","tot":"msg"},{"t":"set","p":"payload.tabs","pt":"msg","to":"options.tabs.shades","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":4090,"y":4080,"wires":[["92a2e3dc.7ffea"]]},{"id":"1bfe417b.e8bc3f","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.tabs","tot":"msg"},{"t":"set","p":"payload.tabs","pt":"msg","to":"options.tabs.scenes","tot":"global"},{"t":"set","p":"topic","pt":"msg","to":"[]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":4090,"y":4040,"wires":[["d5eefffc.a2669"]]},{"id":"a9ffc61d.bcd068","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.tabs","tot":"msg"},{"t":"set","p":"payload.tabs","pt":"msg","to":"options.tabs.status","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":4090,"y":4200,"wires":[["ed2a5854.b69aa8"]]},{"id":"e6a7827b.7a07","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.tabs","tot":"msg"},{"t":"set","p":"payload.tabs","pt":"msg","to":"options.tabs.location","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":4090,"y":4240,"wires":[["49eb607b.43a27"]]},{"id":"f8bc8247.933ad","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.tabs","tot":"msg"},{"t":"set","p":"payload.tabs","pt":"msg","to":"options.tabs.alexa","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":4090,"y":4280,"wires":[["e0684432.74ca78"]]},{"id":"217d707f.ab817","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.tabs","tot":"msg"},{"t":"set","p":"payload.tabs","pt":"msg","to":"options.tabs.notifications","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":4090,"y":4320,"wires":[["92c98fb6.69326"]]},{"id":"79377f76.6225d","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.tabs","tot":"msg"},{"t":"set","p":"payload.tabs","pt":"msg","to":"options.tabs.system","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":4090,"y":4360,"wires":[["a3987d3d.13a64"]]},{"id":"8a643317.4b405","type":"function","z":"5a05b8f3.894b88","name":"","func":"//  20210124  Rob Picchione myERVIN.com\n//\n// This function simply writes the status of the show/hide tabes\n// to global context so state can be reloaded after a restart.\n\nswitch (msg.payload.group.hide || msg.payload.group.show ) {\n    //Enter a case block like the below for each option:\n    case \"Exterior_Awnings\":\n    global.set('options.group.Exterior_Awnings', msg.payload.group);\n    break;\n    //Enter a case block like the above for each option:\n    \n    case \"Aquahot_Water_Pump\":\n    global.set('options.group.Aquahot_Water_Pump', msg.payload.group);\n    break;\n    \n    case \"Scenes_Scene_Builder\":\n    global.set('options.group.Scenes_Scene_Builder', msg.payload.group);\n    break;\n    \n    case \"Scenes_How_to_use_Scene_Builder\":\n    global.set('options.group.Scenes_How_to_use_Scene_Builder', msg.payload.group);\n    break;\n    \n    case \"Interior_Memory_Master\":\n    global.set('options.group.Interior_Memory_Master', msg.payload.group);\n    break;\n    \n    case \"Status_Power\":\n    global.set('options.group.Status_Power', msg.payload.group);\n    break;\n    \n    case \"Status_Generator\":\n    global.set('options.group.Status_Generator', msg.payload.group);\n    break;\n    \n    case \"System_Remote Access - Dataplicity\":\n    global.set('options.group.System_Remote_Access_-_Dataplicity', msg.payload.group);\n    break;\n    \n    case \"System_Remote_Access_-_ngrok\":\n    global.set('options.group.System_Remote_Access_-_ngrok', msg.payload.group);\n    break;\n    \n    case \"System_Update_Configuration_Files\":\n    global.set('options.group.System_Update_Configuration_Files', msg.payload.group);\n    break;\n    \n    case \"System_Install_Configuration_File\":\n    global.set('options.group.System_Install_Configuration_File', msg.payload.group);\n    break;\n    \n    case \"System_Change_System_Password\":\n    global.set('options.group.System_Change_System_Password', msg.payload.group);\n    break;\n\n}\n\nreturn null;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":4760,"y":4560,"wires":[[]]},{"id":"81979d38.3544b","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.group","tot":"msg"},{"t":"set","p":"payload.group","pt":"msg","to":"options.group.Exterior_Awnings","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":4090,"y":4460,"wires":[["d624cecb.3fa02"]]},{"id":"92c7162.c635be8","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.group","tot":"msg"},{"t":"set","p":"payload.group","pt":"msg","to":"options.group.Aquahot_Water_Pump","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":4090,"y":4500,"wires":[["9a0635ed.3d9788"]]},{"id":"ef8d0533.d2f5d8","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.group","tot":"msg"},{"t":"set","p":"payload.group","pt":"msg","to":"options.group.Scenes_Scene_Builder","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":4090,"y":4540,"wires":[["70feaae0.b7a494"]]},{"id":"9f5f8920.3a8b48","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.group","tot":"msg"},{"t":"set","p":"payload.group","pt":"msg","to":"options.group.Scenes_How_to_use_Scene_Builder","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":4090,"y":4580,"wires":[["caa02104.da274"]]},{"id":"867e9c8c.ced0e","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.group","tot":"msg"},{"t":"set","p":"payload.group","pt":"msg","to":"options.group.Interior_Memory_Master","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":4090,"y":4620,"wires":[["2904a8af.2151e8"]]},{"id":"452cd0b8.d6666","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.group","tot":"msg"},{"t":"set","p":"payload.group","pt":"msg","to":"options.group.Status_Power","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":4090,"y":4660,"wires":[["7e3eca66.93ae34"]]},{"id":"a38b7ac2.0f2318","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.group","tot":"msg"},{"t":"set","p":"payload.group","pt":"msg","to":"options.group.Status_Generator","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":4090,"y":4700,"wires":[["70ddbd93.392054"]]},{"id":"9e426ec2.bde2b","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"set","p":"payload","pt":"msg","to":"options.onmode","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":4270,"y":3700,"wires":[["414316ff.b86dc8"]]},{"id":"34faac01.43f524","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"set","p":"payload","pt":"msg","to":"options.sofasconcemode","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":4270,"y":3840,"wires":[["aaab3715.944c68"]]},{"id":"48fe2626.9ea438","type":"link in","z":"5a05b8f3.894b88","name":"","links":["617f1205.f5203c"],"x":3715,"y":4480,"wires":[["1bfe417b.e8bc3f","bcb2bcdd.20469","1acef3f8.a3a2cc","9dfb70b.e4a089","a9ffc61d.bcd068","e6a7827b.7a07","f8bc8247.933ad","217d707f.ab817","79377f76.6225d","81979d38.3544b","92c7162.c635be8","ef8d0533.d2f5d8","9f5f8920.3a8b48","867e9c8c.ced0e","452cd0b8.d6666","a38b7ac2.0f2318","882ee0dc.d5be9","1465fe9e.ef8601","fe428d5d.ce95d","5d5976.bd20668c","ffd6c7d2.6d5d58"]]},{"id":"d76c205.043c2e","type":"fs-ops-copy","z":"5a05b8f3.894b88","name":"","sourcePath":"/coachproxy/home/pi/.node-red","sourcePathType":"str","sourceFilename":"flows_coachproxy.json","sourceFilenameType":"str","destPath":"/coachproxy/home/pi/.node-red/flows","destPathType":"str","destFilename":"RVinfo","destFilenameType":"global","link":false,"overwrite":true,"x":400,"y":200,"wires":[[]]},{"id":"f92dc32f.e21c","type":"inject","z":"5a05b8f3.894b88","name":"Save This Flow - Deploy First!","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":170,"y":200,"wires":[["d76c205.043c2e"]]},{"id":"74da87e2.f6f698","type":"ui_switch","z":"5a05b8f3.894b88","name":"System/Remote Access - Dataplicity","label":"System/Remote Access - Dataplicity","tooltip":"","group":"c2caa18b.132cd","order":9,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"group\":{\"hide\":\"System_Remote_Access_-_Dataplicity\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"group\":{\"show\":\"System_Remote_Access_-_Dataplicity\"}}","offvalueType":"json","officon":"","offcolor":"","x":4370,"y":4740,"wires":[["8a643317.4b405","d27961fd.c7a35"]]},{"id":"132b269d.499359","type":"ui_switch","z":"5a05b8f3.894b88","name":"System/Remote Access - ngrok","label":"System/Remote Access - ngrok","tooltip":"","group":"c2caa18b.132cd","order":10,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"group\":{\"hide\":\"System_Remote_Access_-_ngrok\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"group\":{\"show\":\"System_Remote_Access_-_ngrok\"}}","offvalueType":"json","officon":"","offcolor":"","x":4350,"y":4780,"wires":[["8a643317.4b405","d27961fd.c7a35"]]},{"id":"b0eb7f14.8e3d","type":"ui_switch","z":"5a05b8f3.894b88","name":"System/Install Configuration File","label":"System/Install Configuration File","tooltip":"","group":"c2caa18b.132cd","order":12,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"group\":{\"hide\":\"System_Install_Configuration_File\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"group\":{\"show\":\"System_Install_Configuration_File\"}}","offvalueType":"json","officon":"","offcolor":"","x":4350,"y":4860,"wires":[["8a643317.4b405","d27961fd.c7a35"]]},{"id":"adc4fa81.556ac8","type":"ui_switch","z":"5a05b8f3.894b88","name":"System/Change System Password","label":"System/Change System Password","tooltip":"","group":"c2caa18b.132cd","order":13,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"group\":{\"hide\":\"System_Change_System_Password\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"group\":{\"show\":\"System_Change_System_Password\"}}","offvalueType":"json","officon":"","offcolor":"","x":4360,"y":4900,"wires":[["8a643317.4b405","d27961fd.c7a35"]]},{"id":"882ee0dc.d5be9","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.group","tot":"msg"},{"t":"set","p":"payload.group","pt":"msg","to":"options.group.System_Remote_Access_-_Dataplicity","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":4090,"y":4740,"wires":[["74da87e2.f6f698"]]},{"id":"1465fe9e.ef8601","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.group","tot":"msg"},{"t":"set","p":"payload.group","pt":"msg","to":"options.group.System_Remote_Access_-_ngrok","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":4090,"y":4780,"wires":[["132b269d.499359"]]},{"id":"fe428d5d.ce95d","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.group","tot":"msg"},{"t":"set","p":"payload.group","pt":"msg","to":"options.group.System_Install_Configuration_Files","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":4090,"y":4860,"wires":[["b0eb7f14.8e3d"]]},{"id":"5d5976.bd20668c","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.group","tot":"msg"},{"t":"set","p":"payload.group","pt":"msg","to":"options.group.System_Change_System_Password","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":4090,"y":4900,"wires":[["adc4fa81.556ac8"]]},{"id":"ae64ed30.c937c","type":"ui_switch","z":"5a05b8f3.894b88","name":"System/Update Configuration Files","label":"System/Update Configuration Files","tooltip":"","group":"c2caa18b.132cd","order":11,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"[]","style":"","onvalue":"{\"group\":{\"hide\":\"System_Update_Configuration_Files\"}}","onvalueType":"json","onicon":"","oncolor":"","offvalue":"{\"group\":{\"show\":\"System_Update_Configuration_Files\"}}","offvalueType":"json","officon":"","offcolor":"","x":4360,"y":4820,"wires":[["8a643317.4b405","d27961fd.c7a35"]]},{"id":"ffd6c7d2.6d5d58","type":"change","z":"5a05b8f3.894b88","name":"Load State","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.group","tot":"msg"},{"t":"set","p":"payload.group","pt":"msg","to":"options.group.System_Update_Configuration_Files","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":4090,"y":4820,"wires":[["ae64ed30.c937c"]]},{"id":"5813d45d.f5dd4c","type":"ui_switch","z":"5a05b8f3.894b88","d":true,"name":"15_","label":"","tooltip":"","group":"f92ef285.8be6b","order":3,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"15_state_","topicType":"str","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","animate":true,"className":"","x":1210,"y":880,"wires":[["ba8aebb.ea06618"]]},{"id":"a83588a1.387608","type":"ui_slider","z":"5a05b8f3.894b88","d":true,"name":"15_","label":"","tooltip":"","group":"f92ef285.8be6b","order":4,"width":3,"height":1,"passthru":false,"outs":"end","topic":"15_brightness","min":"1","max":"100","step":"","x":1210,"y":920,"wires":[["ba8aebb.ea06618"]]},{"id":"20c909a2.bd91b6","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":900,"wires":[["5813d45d.f5dd4c"],["a83588a1.387608"],["7b4eeb24928a39ec"]],"outputLabels":["on/off value","brightness value",null]},{"id":"1f10d7e4.6824a8","type":"comment","z":"5a05b8f3.894b88","name":"This flow is for...<open me>","info":"To check the flow version look at the 'RVinfo' value in global context","x":140,"y":60,"wires":[]},{"id":"85284fbd.5ad73","type":"ui_switch","z":"5a05b8f3.894b88","name":"24_Ext_Entry_Ceiling","label":"Entry Ceiling","tooltip":"","group":"2e0a52f8.6acbee","order":3,"width":3,"height":1,"passthru":false,"decouple":"true","topic":"24_state_Entry Ceiling","onvalue":"dim","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1160,"y":1600,"wires":[["ba8aebb.ea06618"]]},{"id":"68d5aadc.d00904","type":"ui_slider","z":"5a05b8f3.894b88","name":"24_Main_Entry_brightness","label":"","tooltip":"","group":"2e0a52f8.6acbee","order":4,"width":3,"height":1,"passthru":false,"outs":"end","topic":"24_brightness","min":"1","max":"100","step":"","x":1140,"y":1640,"wires":[["ba8aebb.ea06618"]]},{"id":"4cbf9743.3749e8","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":1620,"wires":[["85284fbd.5ad73"],["68d5aadc.d00904"],["b793c70f.9d1c48"]],"outputLabels":["on/off value","brightness value",null]},{"id":"5fed0bf6.6618c4","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/44","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":3080,"wires":[["11756490.c3a01b"]]},{"id":"972cef2.221471","type":"ui_switch","z":"5a05b8f3.894b88","name":"44_Ext_DS_Security_Light","label":"DS Security","tooltip":"","group":"4e2af34d.8f765c","order":8,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"44_state_Driver Side Security Light","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1140,"y":3040,"wires":[["ba8aebb.ea06618"]]},{"id":"11756490.c3a01b","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":3080,"wires":[["972cef2.221471"],[],["567b8b5d.d10364"]],"outputLabels":["on/off value","brightness value",null]},{"id":"3ab9c3b5.3bdb5c","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":3140,"wires":[["12b9f4c9.6de03b"],[],["843746d7.61c728"]],"outputLabels":["on/off value","brightness value",null]},{"id":"4c40410e.d0b54","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/45","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":3140,"wires":[["3ab9c3b5.3bdb5c"]]},{"id":"12b9f4c9.6de03b","type":"ui_switch","z":"5a05b8f3.894b88","name":"45_Ext_PS_Security_Light","label":"PS Security","tooltip":"","group":"4e2af34d.8f765c","order":7,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"45_state_Passenger Side Security Light","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1140,"y":3100,"wires":[["ba8aebb.ea06618"]]},{"id":"7c687c45.a76574","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":3200,"wires":[["139929.c10126d7"],[],["5108e19b.9e68a"]],"outputLabels":["on/off value","brightness value",null]},{"id":"e81b250d.ad1ab8","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/46","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":3200,"wires":[["7c687c45.a76574"]]},{"id":"139929.c10126d7","type":"ui_switch","z":"5a05b8f3.894b88","name":"46_Ext_Motion","label":"Motion","tooltip":"","group":"4e2af34d.8f765c","order":4,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"46_state_Motion","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1180,"y":3160,"wires":[["ba8aebb.ea06618"]]},{"id":"83f70b0b.46ee58","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":3260,"wires":[["8e6d486b.b7d298"],[],["ef9943dc6952cf9a"]],"outputLabels":["on/off value","brightness value",null]},{"id":"3839017b.671d5e","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/47","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":3260,"wires":[["83f70b0b.46ee58"]]},{"id":"8e6d486b.b7d298","type":"ui_switch","z":"5a05b8f3.894b88","d":true,"name":"47_Ext_Motion_Status","label":"Motion Status","tooltip":"","group":"4e2af34d.8f765c","order":11,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"47_state_Motion Status","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1160,"y":3220,"wires":[["ba8aebb.ea06618"]]},{"id":"57cf89c3.df6828","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":3320,"wires":[["1598247f.f05f9c"],[],["6660358f03d3fe03"]],"outputLabels":["on/off value","brightness value",null]},{"id":"7dd54349.7206fc","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/48","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":3320,"wires":[["57cf89c3.df6828"]]},{"id":"1598247f.f05f9c","type":"ui_switch","z":"5a05b8f3.894b88","d":true,"name":"48_","label":"","tooltip":"","group":"4e2af34d.8f765c","order":15,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"48_state_","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","x":1210,"y":3280,"wires":[["ba8aebb.ea06618"]]},{"id":"e4dd64e3.330458","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_35","mode":"link","links":["dbcba6e1.e04068"],"x":795,"y":2540,"wires":[]},{"id":"9647ec41.5edf6","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_34","mode":"link","links":["b8990680.f0e988"],"x":795,"y":2460,"wires":[]},{"id":"86bec4e3.edbcb8","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_33","mode":"link","links":["3b29db30.6449b4"],"x":795,"y":2380,"wires":[]},{"id":"cd682278.4ea26","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_32","mode":"link","links":["8bce12d5.294f5"],"x":795,"y":2300,"wires":[]},{"id":"4aa343b9.05a0ac","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_29","mode":"link","links":["730115bb.e5827c"],"x":795,"y":2220,"wires":[]},{"id":"a05ac2b7.d426d","type":"link in","z":"5a05b8f3.894b88","name":"Alexa-Virtual","links":["642adfa2.d5aad"],"x":1765,"y":2140,"wires":[["ba8aebb.ea06618"]]},{"id":"567b8b5d.d10364","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_44","mode":"link","links":["72be638f.48ddec"],"x":795,"y":3100,"wires":[]},{"id":"a2b09dcd.2d1c9","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_38","mode":"link","links":["3519cb72.41e9f4"],"x":795,"y":2740,"wires":[]},{"id":"a9a0ea5e.076e48","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_39","mode":"link","links":["b8a60677.1e09e8"],"x":795,"y":2800,"wires":[]},{"id":"4b4e169d.6f7af8","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_37","mode":"link","links":["200edc87.c78da4"],"x":795,"y":2680,"wires":[]},{"id":"fa9957ec.e18c88","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_36","mode":"link","links":["453ba02b.373cb"],"x":795,"y":2600,"wires":[]},{"id":"843746d7.61c728","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_45","mode":"link","links":["c1c97af8.d16f38"],"x":795,"y":3160,"wires":[]},{"id":"5108e19b.9e68a","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_46","mode":"link","links":["2571ef27.690ad"],"x":795,"y":3220,"wires":[]},{"id":"df75bd8c.2b2a5","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_43","mode":"link","links":["f339308f.e65b1"],"x":795,"y":3040,"wires":[]},{"id":"2aa529f4.33c4a6","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_42","mode":"link","links":["46dac7e3.71b938"],"x":795,"y":2980,"wires":[]},{"id":"af50c992.3824c8","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_30","mode":"link","links":["2abda940.0e39a6"],"x":795,"y":2140,"wires":[]},{"id":"5b7f4b58.21ada4","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_31","mode":"link","links":["c14f0b32.25e7b8"],"x":795,"y":2060,"wires":[]},{"id":"f8c9d73b.0bb9f8","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_28","mode":"link","links":["8353d7f.aac7f28"],"x":795,"y":1980,"wires":[]},{"id":"87c13d1d.828f3","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_27","mode":"link","links":["50ba1e98.e7568"],"x":795,"y":1900,"wires":[]},{"id":"1a89e6d0.a42329","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_26","mode":"link","links":["e7d606da.cac468"],"x":795,"y":1820,"wires":[]},{"id":"a1753018.3f292","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_25","mode":"link","links":["fb701e79.1dffa"],"x":795,"y":1740,"wires":[]},{"id":"b793c70f.9d1c48","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_24","mode":"link","links":["b603da9e.e963d8"],"x":795,"y":1660,"wires":[]},{"id":"bf70c94a.c7ef08","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_23","mode":"link","links":["b404cba3.691468"],"x":795,"y":1580,"wires":[]},{"id":"aa09b718.231ce8","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_22","mode":"link","links":["4d48de6e.28a5e"],"x":795,"y":1500,"wires":[]},{"id":"b9f024ce.83cf68","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_21","mode":"link","links":["58a0872b.435068"],"x":795,"y":1420,"wires":[]},{"id":"82ab32ba.46b1b","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_20","mode":"link","links":["5bf5ee15.87caa"],"x":795,"y":1340,"wires":[]},{"id":"504c6a7f.8ce8c4","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_19","mode":"link","links":["505ed23e.f14afc"],"x":795,"y":1260,"wires":[]},{"id":"c22fe021.cf732","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_18","mode":"link","links":["e29fb042.37a58"],"x":795,"y":1180,"wires":[]},{"id":"10d87f4b.cd7441","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_17","mode":"link","links":["76037a81.aa3f44"],"x":795,"y":1100,"wires":[]},{"id":"3d7c9499.7df9bc","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_16","mode":"link","links":["be0fac40.54a83"],"x":795,"y":1020,"wires":[]},{"id":"f8bce69b.995b08","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_14","mode":"link","links":["80ca6a2c.914828"],"x":795,"y":860,"wires":[]},{"id":"d6e2a045.7e358","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_13","mode":"link","links":["1e3517ea.25f258"],"x":795,"y":780,"wires":[]},{"id":"5e150fe7.c2b56","type":"change","z":"5a05b8f3.894b88","name":"","rules":[{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"OFF","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"100","fromt":"num","to":"ON","tot":"str"},{"t":"move","p":"payload","pt":"msg","to":"payload.powerState","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2040,"y":180,"wires":[["c3e71baa.c0e778"]]},{"id":"8b1dfef7.d82b7","type":"delay","z":"5a05b8f3.894b88","name":"","pauseType":"delay","timeout":"50","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":2030,"y":220,"wires":[["c3e71baa.c0e778"]]},{"id":"c3e71baa.c0e778","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_100_Panel_Lights","links":["9dc19879.3bb408"],"x":2195,"y":200,"wires":[]},{"id":"a8a021c.d7c75e","type":"link in","z":"5a05b8f3.894b88","name":"Alexa Panel Lights Out","links":["999e55ab.6e2308"],"x":2455,"y":200,"wires":[["335cd62f.8c75aa"]]},{"id":"57e39e8b.d28ef","type":"comment","z":"5a05b8f3.894b88","name":"Alexa Virtual","info":"","x":2370,"y":200,"wires":[]},{"id":"335cd62f.8c75aa","type":"change","z":"5a05b8f3.894b88","name":"","rules":[{"t":"change","p":"payload.directive","pt":"msg","from":"TurnOff","fromt":"str","to":"0","tot":"num"},{"t":"change","p":"payload.directive","pt":"msg","from":"TurnOn","fromt":"str","to":"100","tot":"num"},{"t":"change","p":"payload.directive","pt":"msg","from":"SetBrightness","fromt":"str","to":"payload.brightness","tot":"msg"},{"t":"move","p":"payload.directive","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2580,"y":200,"wires":[["10e80e93.5f0211"]]},{"id":"aadc418b.9f66e","type":"comment","z":"5a05b8f3.894b88","name":"Tank Levels","info":"","x":150,"y":4340,"wires":[]},{"id":"33bbf7c.dbe6808","type":"comment","z":"5a05b8f3.894b88","name":"Generator - Entegra w/Vegatouch","info":"","x":190,"y":4700,"wires":[]},{"id":"2a82e21f.33a77e","type":"function","z":"5a05b8f3.894b88","name":"Create Verbose Scene File","func":"var filename = msg.filename\nvar instance = msg.payload.split(' ')[0];\nvar command = msg.payload.split(' ')[1];\nvar brightness = msg.payload.split(' ')[2];\nvar instancename = global.get('status').lights[instance].instancename;\n\nvar commands = (command == 0) ? 'DIM' : (command == 2) ? 'ON' : 'OFF';\n\n//var command = commands['on'];\nmsg = {'payload':instancename + ',' + commands + ',' + brightness + ',' + instance, 'filename':filename + ' Verbose'};\n\n// var newMsg={\n//  'payload': instance + ' ' + command + space + brightness\n//};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2780,"y":3940,"wires":[["92fed2de.28b58"]]},{"id":"92fed2de.28b58","type":"file","z":"5a05b8f3.894b88","name":"","filename":"","appendNewline":true,"createDir":false,"overwriteFile":"false","encoding":"none","x":2670,"y":4040,"wires":[[]]},{"id":"b5b67036.f738a","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/ATS_AC_STATUS_2/#","qos":"2","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":200,"y":4080,"wires":[["9f7d5bc1.779508"]]},{"id":"ec11bfa.633044","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/ATS_AC_STATUS_3/#","qos":"2","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":200,"y":4120,"wires":[["9f7d5bc1.779508"]]},{"id":"9c386928.520bd8","type":"change","z":"5a05b8f3.894b88","name":"L2 frequency","rules":[{"t":"set","p":"payload","pt":"msg","to":"$round(payload.\"frequency\")","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":4220,"wires":[["e7dcabf1.10dc38"]]},{"id":"e7dcabf1.10dc38","type":"rbe","z":"5a05b8f3.894b88","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1010,"y":4220,"wires":[["b90bc9fb.c8adb8"]]},{"id":"b90bc9fb.c8adb8","type":"ui_text","z":"5a05b8f3.894b88","group":"fb4c3e00.5737a","order":12,"width":"2","height":"1","name":"ATS Frequency Leg 2","label":"","format":"{{msg.payload}} Hz","layout":"row-spread","x":1220,"y":4220,"wires":[]},{"id":"892f9d50.4cd24","type":"change","z":"5a05b8f3.894b88","name":"L1 frequency","rules":[{"t":"set","p":"payload","pt":"msg","to":"$round(payload.\"frequency\")","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":4100,"wires":[["38a7dd9b.6c9f32"]]},{"id":"38a7dd9b.6c9f32","type":"rbe","z":"5a05b8f3.894b88","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1010,"y":4100,"wires":[["30710704.c1cd28"]]},{"id":"30710704.c1cd28","type":"ui_text","z":"5a05b8f3.894b88","group":"fb4c3e00.5737a","order":9,"width":"2","height":"1","name":"ATS Frequency Leg 1","label":"","format":"{{msg.payload}} Hz","layout":"row-spread","x":1220,"y":4100,"wires":[]},{"id":"9a21ac60.c6e28","type":"ui_template","z":"5a05b8f3.894b88","group":"fb4c3e00.5737a","name":"120/240 VAC Power Source /ats/+pred/","order":4,"width":"6","height":"1","format":"<!DOCTYPE html>\n<div style=\"height: 10px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 10px; border-bottom: 1px solid black; text-align: left\">\n  <span style=\"font-size: 16px; background-color: #FEFEFE; padding: 0 10px; margin-left: 10px;\">\n    120/240 VAC Shore Power:  <b>{{msg.payload}}</b>\n  </span>\n</div>\n<div style=\"height: 8px;\">&nbsp;</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":1280,"y":3900,"wires":[[]]},{"id":"b6bb7350.e16cf","type":"ui_text","z":"5a05b8f3.894b88","group":"fb4c3e00.5737a","order":5,"width":"3","height":"1","name":"ATS Status","label":"Source:","format":"{{msg.payload}}","layout":"row-spread","x":1190,"y":3940,"wires":[]},{"id":"784a215e.49b2e","type":"change","z":"5a05b8f3.894b88","name":"phase status","rules":[{"t":"change","p":"payload[\"phase status\"]","pt":"msg","from":"0000","fromt":"str","to":"No Complementary Leg","tot":"str"},{"t":"change","p":"payload[\"phase status\"]","pt":"msg","from":"0001","fromt":"str","to":"20/30A","tot":"str"},{"t":"change","p":"payload[\"phase status\"]","pt":"msg","from":"0010","fromt":"str","to":"50A","tot":"str"},{"t":"change","p":"payload[\"phase status\"]","pt":"msg","from":"0011","fromt":"str","to":"Phase Relationship Variable","tot":"str"},{"t":"change","p":"payload[\"phase status\"]","pt":"msg","from":"1110","fromt":"str","to":"Error","tot":"str"},{"t":"change","p":"payload[\"phase status\"]","pt":"msg","from":"1111","fromt":"str","to":"No Data","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":3980,"wires":[["cd5b17e9.11ca98"]]},{"id":"cd5b17e9.11ca98","type":"rbe","z":"5a05b8f3.894b88","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload[\"phase status\"]","x":1010,"y":3980,"wires":[["b3285473.c3bb48"]]},{"id":"b3285473.c3bb48","type":"ui_text","z":"5a05b8f3.894b88","group":"fb4c3e00.5737a","order":6,"width":"3","height":"1","name":"ATS Phase","label":"","format":"{{msg.payload[\"phase status\"]}}","layout":"row-spread","x":1190,"y":3980,"wires":[]},{"id":"c2fc5b03.d08078","type":"ui_template","z":"5a05b8f3.894b88","group":"fb4c3e00.5737a","name":"120/240 VAC Faults","order":14,"width":"6","height":"2","format":"<!DOCTYPE html>\n<div style=\"height: 10px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 10px; border-bottom: 1px solid black; text-align: left\">\n  <span style=\"font-size: 16px; background-color: #FEFEFE; padding: 0 10px; margin-left: 10px;\">\n    120/240 VAC Faults:  <b>{{msg.payload}}</b><br><br><b>WARNING:</b> Valid <i>only</i> if equipment (i.e. Xfer Switch) supports fault reporting.\n  </span>\n</div>\n<div style=\"height: 8px;\">&nbsp;</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":540,"y":4000,"wires":[[]]},{"id":"4b785a97.23c184","type":"ui_text","z":"5a05b8f3.894b88","group":"fb4c3e00.5737a","order":15,"width":"0","height":"0","name":"Fault Ground Current","label":"Ground Current: ","format":"{{msg.payload[\"fault ground current definition\"]}}","layout":"row-spread","x":540,"y":4040,"wires":[]},{"id":"9998184b.6c3c98","type":"ui_text","z":"5a05b8f3.894b88","group":"fb4c3e00.5737a","order":15,"width":"0","height":"0","name":"Fault Open Ground","label":"Open Ground:","format":"{{msg.payload[\"fault open ground definition\"]}}","layout":"row-spread","x":530,"y":4080,"wires":[]},{"id":"94499c0c.3791d","type":"ui_text","z":"5a05b8f3.894b88","group":"fb4c3e00.5737a","order":15,"width":"0","height":"0","name":"Fault Open Neutral","label":"Open Neutral: ","format":"{{msg.payload[\"fault open neutral definition\"]}}","layout":"row-spread","x":530,"y":4120,"wires":[]},{"id":"ab5ffe8.4ce5","type":"ui_text","z":"5a05b8f3.894b88","group":"fb4c3e00.5737a","order":15,"width":"0","height":"0","name":"Fault Reverse Polarity","label":"Reverse Polarity:","format":"{{msg.payload[\"fault reverse polarity definition\"]}}","layout":"row-spread","x":540,"y":4160,"wires":[]},{"id":"f42557a7.647748","type":"exec","z":"5a05b8f3.894b88","command":"/coachproxy/rv-c/generator_entegra.pl ","addpay":true,"append":"","useSpawn":"","timer":"","oldrc":false,"name":"generator_entegra.pl /gencontrol/+pred/","x":1180,"y":4860,"wires":[["b395fdc1.ddfcf"],[],[]]},{"id":"b395fdc1.ddfcf","type":"delay","z":"5a05b8f3.894b88","name":"","pauseType":"delay","timeout":"15","timeoutUnits":"seconds","rate":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":1440,"y":4880,"wires":[["117f3253.fb0d6e"]]},{"id":"8b6c959a.2ccb78","type":"file function","z":"5a05b8f3.894b88","name":"genset_safety","filename":".node-red/js/genset_safety.js","reloadfile":false,"outputs":1,"x":1051.8572006225586,"y":4771.142890930176,"wires":[["f42557a7.647748"]]},{"id":"117f3253.fb0d6e","type":"template","z":"5a05b8f3.894b88","name":"Blank","field":"payload","fieldType":"msg","format":"handlebars","syntax":"plain","template":"","x":470,"y":4940,"wires":[["2cb12f4d.91c29"]]},{"id":"10252715.5d7679","type":"ui_switch","z":"5a05b8f3.894b88","name":"Gen Controls Enable","label":"Gen Controls Enable","group":"a4a573ee.d6bdf","order":3,"width":"6","height":"1","passthru":false,"decouple":"false","topic":"genstartenable","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":820,"y":4740,"wires":[["8b6c959a.2ccb78"]]},{"id":"88634112.ea46b","type":"ui_button","z":"5a05b8f3.894b88","name":"Start Generator","group":"a4a573ee.d6bdf","order":4,"width":"3","height":"1","passthru":false,"label":"Start Gen","tooltip":"","color":"","bgcolor":"","icon":"fa-repeat","payload":"1","payloadType":"str","topic":"generator","x":800,"y":4808,"wires":[["8b6c959a.2ccb78"]]},{"id":"ff059ace.885bf8","type":"ui_button","z":"5a05b8f3.894b88","name":"Stop Generator","group":"a4a573ee.d6bdf","order":5,"width":"3","height":"1","label":"Stop Gen","color":"","icon":"fa-stop","payload":"0","payloadType":"str","topic":"generator","x":800,"y":4844.5,"wires":[["8b6c959a.2ccb78"]]},{"id":"e1fee32d.4e081","type":"ui_template","z":"5a05b8f3.894b88","group":"a4a573ee.d6bdf","name":"Generator Note","order":1,"width":"0","height":"0","format":"<div>\n<p>\nAs a safety precaution for operating the generator,\nyou must turn on 'Gen Controls Enable', then press\n'Start Gen' or 'Stop Gen' within 5 seconds.\nGenerator may take up to 60 seconds to start.\n</p>\n<p>&nbsp;</p>\n</div>\n","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":800.5000114440918,"y":4773.750005722046,"wires":[["8b6c959a.2ccb78"]]},{"id":"6b10b0ec.6c7be","type":"ui_template","z":"5a05b8f3.894b88","group":"a4a573ee.d6bdf","name":"Gen Start Status","order":6,"width":"","height":"","format":"<div layout=\"row\" layout-align=\"center center\"><b>{{msg.payload}}</b></div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":810,"y":4881,"wires":[["8b6c959a.2ccb78"]]},{"id":"2cb12f4d.91c29","type":"rbe","z":"5a05b8f3.894b88","name":"","func":"rbe","gap":"","start":"","inout":"out","x":630,"y":4880,"wires":[["6b10b0ec.6c7be"]]},{"id":"cb4fb91a.10bb08","type":"inject","z":"5a05b8f3.894b88","name":"","props":[{"p":"payload","v":"","vt":"str"},{"p":"topic","v":"","vt":"string"}],"repeat":"","crontab":"","once":true,"topic":"","payload":"","payloadType":"str","x":310,"y":4940,"wires":[["117f3253.fb0d6e"]]},{"id":"e301480a.1c59d8","type":"file function","z":"5a05b8f3.894b88","name":"genset_countdown","filename":".node-red/js/genset_countdown.js","reloadfile":false,"outputs":"2","x":510,"y":4740,"wires":[["10252715.5d7679"],["a714a71f.0d6f78"]]},{"id":"a714a71f.0d6f78","type":"file function","z":"5a05b8f3.894b88","name":"genset_clear_buffer","filename":".node-red/js/genset_clear_buffer.js","reloadfile":false,"outputs":1,"x":440,"y":4800,"wires":[["2cb12f4d.91c29"]]},{"id":"8cdd597e.d3c978","type":"inject","z":"5a05b8f3.894b88","name":"Check Gen Start Enabled Timer","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":true,"onceDelay":"","topic":"checkgenenable","payload":"","payloadType":"date","x":220,"y":4740,"wires":[["e301480a.1c59d8"]]},{"id":"dd83a27a.5b2aa","type":"mqtt in","z":"5a05b8f3.894b88","name":"GenStart Message","topic":"GENSTART/MESSAGE","broker":"c1170463.5c7f8","inputs":0,"x":170,"y":4800,"wires":[["a714a71f.0d6f78"]]},{"id":"d155fbf4.390b58","type":"ui_template","z":"5a05b8f3.894b88","group":"5d7e55cd.f34c2c","name":"Awning Note /awning-message/","order":1,"width":"0","height":"0","format":"<div>\n<p>\n    Press a button to start the awning movement.\n    Optionally press the same button again to\n    stop awning movement early.\n</p>\n</div>\n","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","className":"","x":4550,"y":1640,"wires":[[]]},{"id":"ee44ed7c.4eace","type":"ui_button","z":"5a05b8f3.894b88","name":"/awning_0_retract/","group":"5d7e55cd.f34c2c","order":4,"width":"3","height":"1","passthru":false,"label":"Retract","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-left fa-2x","payload":"--id 110 --command 3 --duration 0 --reverse 109 --command 1 --duration 26","payloadType":"str","topic":"0 d","x":4510,"y":1720,"wires":[["c167d7a.b6fab28","f655e209.c54c2"]]},{"id":"3227d21b.3b8e6e","type":"ui_button","z":"5a05b8f3.894b88","name":"/awning_0_extend/","group":"5d7e55cd.f34c2c","order":5,"width":"3","height":"1","passthru":false,"label":"Extend","tooltip":"","color":"","bgcolor":"","icon":"fa-caret-right fa-2x","payload":"--id 109 --command 3 --duration 0 --reverse 110 --command 1 --duration 26","payloadType":"str","topic":"0 d","x":4510,"y":1760,"wires":[["c167d7a.b6fab28","f655e209.c54c2"]]},{"id":"d95d5e0a.a2c14","type":"ui_template","z":"5a05b8f3.894b88","group":"5d7e55cd.f34c2c","name":"Entry Door /awning_0_label/","order":3,"width":"6","height":"1","format":"<div style=\"height: 16px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 8px; border-bottom: 1px solid black; text-align: center\">\n  <span style=\"font-size: 16px; background-color: #FEFEFE; padding: 0 10px; margin-left: 10px;\">\n    Entry Door\n  </span>\n</div>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":4510,"y":1680,"wires":[[]]},{"id":"992720e5.228bd","type":"comment","z":"5a05b8f3.894b88","name":"Awnings Entegra","info":"","x":4060,"y":1600,"wires":[]},{"id":"978451b0.649a6","type":"ui_switch","z":"5a05b8f3.894b88","name":"/awning-enabler/","label":"Enable Awning Controls:","group":"5d7e55cd.f34c2c","order":2,"width":"6","height":"1","passthru":false,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":4230,"y":1640,"wires":[["fa88e5e8.5c9eb8","e3a9fd1d.6755c"]]},{"id":"fa88e5e8.5c9eb8","type":"trigger","z":"5a05b8f3.894b88","name":"","op1":"true","op2":"false","op1type":"bool","op2type":"bool","duration":"61","extend":true,"units":"s","reset":"false","bytopic":"all","outputs":1,"x":4270,"y":1700,"wires":[["e3a9fd1d.6755c","978451b0.649a6"]]},{"id":"e3a9fd1d.6755c","type":"change","z":"5a05b8f3.894b88","name":"","rules":[{"t":"set","p":"enabled","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4230,"y":1760,"wires":[["ee44ed7c.4eace","3227d21b.3b8e6e"]]},{"id":"535e5095.ab2b4","type":"inject","z":"5a05b8f3.894b88","name":"","props":[{"p":"payload","v":"false","vt":"bool"},{"p":"topic","v":"","vt":"string"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"false","payloadType":"bool","x":4030,"y":1700,"wires":[["e3a9fd1d.6755c","978451b0.649a6"]]},{"id":"c167d7a.b6fab28","type":"link out","z":"5a05b8f3.894b88","name":"Awning button pressed","links":["1748e449.ba1aec","c180533d.cf229"],"x":4715,"y":1740,"wires":[]},{"id":"c180533d.cf229","type":"link in","z":"5a05b8f3.894b88","name":"Reset awning timer","links":["c167d7a.b6fab28"],"x":4135,"y":1700,"wires":[["fa88e5e8.5c9eb8","79a01e1f.4a651"]]},{"id":"b74274f5.f13618","type":"ui_text","z":"5a05b8f3.894b88","group":"5d7e55cd.f34c2c","order":3,"width":"6","height":"1","name":"Awning Status","label":"","format":"{{msg.payload}}","layout":"row-center","x":4220,"y":1960,"wires":[]},{"id":"79a01e1f.4a651","type":"change","z":"5a05b8f3.894b88","name":"","rules":[{"t":"set","p":"duration","pt":"msg","to":"$substringAfter(payload, \"duration=\")","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":4230,"y":1840,"wires":[["516d198.e4a14e8"]]},{"id":"516d198.e4a14e8","type":"function","z":"5a05b8f3.894b88","name":"Countdown Message","func":"let duration = msg.duration;\n\nif (msg.duration >= 0) {\n    if (msg.duration === 0) {\n        msg.payload = '';\n    } else {\n        msg.payload = \"Awning active for \" + duration + \" sec.\";\n    }\n\n    msg.duration--;\n\n    return msg;\n}","outputs":1,"noerr":0,"x":4220,"y":1880,"wires":[["b74274f5.f13618","aab881ac.72287"]]},{"id":"aab881ac.72287","type":"delay","z":"5a05b8f3.894b88","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":4220,"y":1920,"wires":[["516d198.e4a14e8"]]},{"id":"2647f2f8.e759de","type":"ui_button","z":"5a05b8f3.894b88","name":"/entry-unlock/","group":"f6ae28b7.041968","order":6,"width":"3","height":"1","passthru":false,"label":"Unlock","tooltip":"","color":"","bgcolor":"","icon":"fa-unlock","payload":"/coachproxy/rv-c/dc_dimmer_pair.pl --id 89 --command 3 --duration 0 --reverse 86 --command 1 --duration 1","payloadType":"str","topic":"1","x":4020,"y":1260,"wires":[["277db83.c9b2048"]]},{"id":"59c653d8.12b71c","type":"ui_button","z":"5a05b8f3.894b88","name":"/entry-lock/","group":"f6ae28b7.041968","order":5,"width":"3","height":"1","passthru":false,"label":"Lock","tooltip":"","color":"","bgcolor":"","icon":"fa-lock","payload":"/coachproxy/rv-c/dc_dimmer_pair.pl --id 86 --command 3 --duration 0 --reverse 89 --command 1 --duration 1","payloadType":"str","topic":"1","x":4030,"y":1300,"wires":[["277db83.c9b2048"]]},{"id":"2fc1c4a1.50f2ec","type":"ui_button","z":"5a05b8f3.894b88","name":"/cargo-unlock/","group":"f6ae28b7.041968","order":9,"width":"3","height":"1","passthru":false,"label":"Unlock","tooltip":"","color":"","bgcolor":"","className":"","icon":"fa-unlock","payload":"/coachproxy/rv-c/dc_dimmer_pair.pl --id 88 --command 3 --duration 0 --reverse 85 --command 1 --duration 1","payloadType":"str","topic":"6","topicType":"str","x":4020,"y":1380,"wires":[["277db83.c9b2048"]]},{"id":"880baffc.8ffb5","type":"ui_button","z":"5a05b8f3.894b88","name":"/cargo-lock/","group":"f6ae28b7.041968","order":8,"width":"3","height":"1","passthru":false,"label":"Lock","tooltip":"","color":"","bgcolor":"","icon":"fa-lock","payload":"/coachproxy/rv-c/dc_dimmer_pair.pl --id 85 --command 3 --duration 0 --reverse 88 --command 1 --duration 1","payloadType":"str","topic":"6","x":4030,"y":1420,"wires":[["277db83.c9b2048"]]},{"id":"884cb25f.84c8d","type":"exec","z":"5a05b8f3.894b88","command":"/coachproxy/rv-c/locks.pl ","addpay":true,"append":"","useSpawn":"","timer":"","oldrc":false,"name":"locks.pl /locks/+pred/","x":4740,"y":1300,"wires":[[],[],[]]},{"id":"642aa0d.052ca6","type":"ui_button","z":"5a05b8f3.894b88","name":"/all-unlock/","group":"f6ae28b7.041968","order":3,"width":"3","height":"1","passthru":false,"label":"Unlock","tooltip":"","color":"","bgcolor":"","icon":"fa-unlock","payload":"/coachproxy/rv-c/dc_dimmer_pair.pl --id 88 --id 89 --command 3 --duration 0 --reverse 85 --reverse 86 --command 1 --duration 1","payloadType":"str","topic":"0","x":4030,"y":1140,"wires":[["277db83.c9b2048"]]},{"id":"86396210.e8412","type":"ui_button","z":"5a05b8f3.894b88","name":"/all-lock/","group":"f6ae28b7.041968","order":2,"width":"3","height":"1","passthru":false,"label":"Lock","tooltip":"","color":"","bgcolor":"","icon":"fa-lock","payload":"/coachproxy/rv-c/dc_dimmer_pair.pl --id 85 --id 86 --command 3 --duration 0 --reverse 88 --reverse 89 --command 1 --duration 1","payloadType":"str","topic":"0","x":4040,"y":1180,"wires":[["277db83.c9b2048"]]},{"id":"d1292ea2.d4241","type":"ui_template","z":"5a05b8f3.894b88","group":"f6ae28b7.041968","name":"All Locks","order":1,"width":"","height":"","format":"<!DOCTYPE html>\n<div style=\"height: 8px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 8px; border-bottom: 1px solid black; text-align: left\">\n  <span style=\"font-size: 16px; background-color: #FEFEFE; padding: 0 10px; margin-left: 10px;overflow:hidden;\">\n    All\n  </span>\n</div>\n<div style=\"height: 11px;\">&nbsp;</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":4040,"y":1100,"wires":[["277db83.c9b2048"]]},{"id":"1f929a91.e66895","type":"ui_template","z":"5a05b8f3.894b88","group":"f6ae28b7.041968","name":"Entrance Door","order":4,"width":"","height":"","format":"<!DOCTYPE html>\n<div style=\"height: 8px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 8px; border-bottom: 1px solid black; text-align: left;\">\n  <span style=\"font-size: 16px; background-color: #FEFEFE; padding: 0 10px; margin-left: 10px;overflow:hidden;\">\n    Entrance Door\n  </span>\n</div>\n<div style=\"height: 11px;\">&nbsp;</div>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":4020,"y":1220,"wires":[["277db83.c9b2048"]]},{"id":"7857416e.60ccc","type":"ui_template","z":"5a05b8f3.894b88","group":"f6ae28b7.041968","name":"Cargo Bays","order":7,"width":"","height":"","format":"<!DOCTYPE html>\n<div style=\"height: 8px;\">&nbsp;</div>\n<div style=\"width: 100%; height: 8px; border-bottom: 1px solid black; text-align: left\">\n  <span style=\"font-size: 16px; background-color: #FEFEFE; padding: 0 10px; margin-left: 10px;overflow:hidden;\">\n    Cargo Bays\n  </span>\n</div>\n<div style=\"height: 11px;\">&nbsp;</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":4030,"y":1340,"wires":[["277db83.c9b2048"]]},{"id":"bb46efb9.4ac88","type":"template","z":"5a05b8f3.894b88","name":"2015-2018 Lock Command","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{{topic}} {{payload}}","x":4480,"y":1300,"wires":[["884cb25f.84c8d"]]},{"id":"277db83.c9b2048","type":"switch","z":"5a05b8f3.894b88","name":"Lock Type","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"--","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":4250,"y":1260,"wires":[["88136862.bbee18"],["bb46efb9.4ac88"]],"outputLabels":["2019+","2015-2018"]},{"id":"88136862.bbee18","type":"exec","z":"5a05b8f3.894b88","command":"/coachproxy/rv-c/dc_dimmer_pair.pl ","addpay":true,"append":"","useSpawn":"","timer":"","oldrc":false,"name":"dc_dimmer_pair.pl /locks/+pred/","x":4490,"y":1240,"wires":[[],[],[]]},{"id":"720b73f1.6cfe8c","type":"comment","z":"5a05b8f3.894b88","name":"Locks Entegra V2","info":"","x":4040,"y":1060,"wires":[]},{"id":"36765a73.5fff46","type":"comment","z":"5a05b8f3.894b88","name":"Play Scene","info":"","x":2830,"y":200,"wires":[]},{"id":"9478b65fee158608","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_11","mode":"link","links":["b0d05b5245f69499"],"x":795,"y":640,"wires":[]},{"id":"06fe89c6a4171a2b","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_10","mode":"link","links":["55c25187aff44a85"],"x":795,"y":580,"wires":[]},{"id":"5c1cc29131f37d9e","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_9","mode":"link","links":["ad0beb683e9b4ca9"],"x":795,"y":520,"wires":[]},{"id":"714b4f8758d3392c","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_8","mode":"link","links":["06f49f8531485879"],"x":795,"y":460,"wires":[]},{"id":"e92f0dac376edd3c","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_7","mode":"link","links":["9462124d3a57e116"],"x":795,"y":400,"wires":[]},{"id":"7d77f212491812d9","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_6","mode":"link","links":["4f09c16683d05753"],"x":795,"y":340,"wires":[]},{"id":"47d4e9429d4d46f2","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":680,"wires":[[],[],["3b7ea03808879ed0"]],"outputLabels":["on/off value","brightness value",null]},{"id":"3b7ea03808879ed0","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_12","mode":"link","links":["1886ef783eb15df2"],"x":795,"y":700,"wires":[]},{"id":"7b4eeb24928a39ec","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_15","mode":"link","links":["4a6a12c8352e04d7"],"x":795,"y":940,"wires":[]},{"id":"4fd5c522c8aaa7b6","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_40","mode":"link","links":["ddb3a069e2a3edab"],"x":795,"y":2860,"wires":[]},{"id":"f90ea784d45baf53","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_41","mode":"link","links":["80c619e59f1da3ad"],"x":795,"y":2920,"wires":[]},{"id":"ef9943dc6952cf9a","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_47","mode":"link","links":["7927d2a74f562291"],"x":795,"y":3280,"wires":[]},{"id":"6660358f03d3fe03","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_48","mode":"link","links":["fd0d2dd6456887de"],"x":795,"y":3340,"wires":[]},{"id":"2a3343a800fdc580","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/111","qos":"0","datatype":"json","broker":"c1170463.5c7f8","nl":false,"rap":false,"inputs":0,"x":180,"y":3400,"wires":[["47121ae98047e89c"]]},{"id":"47121ae98047e89c","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":3400,"wires":[["74416d839a739e93"],[],["528a69d796d2d742"]],"outputLabels":["on/off value","brightness value",null]},{"id":"528a69d796d2d742","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_46","mode":"link","links":["f15f202be3fb5f3d"],"x":795,"y":3420,"wires":[]},{"id":"74416d839a739e93","type":"ui_switch","z":"5a05b8f3.894b88","d":true,"name":"111_Ext_Cargo","label":"Cargo","tooltip":"","group":"4e2af34d.8f765c","order":4,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"111_state_Cargo","topicType":"str","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","animate":true,"className":"","x":1180,"y":3360,"wires":[["ba8aebb.ea06618"]]},{"id":"0910a64767053fb8","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/112","qos":"0","datatype":"json","broker":"c1170463.5c7f8","nl":false,"rap":false,"inputs":0,"x":180,"y":3460,"wires":[["ddbb99e85360d6d0"]]},{"id":"ddbb99e85360d6d0","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":3460,"wires":[["986bcfa8a43ce3cb"],[],["f80fc6f618170ce8"]],"outputLabels":["on/off value","brightness value",null]},{"id":"f80fc6f618170ce8","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_46","mode":"link","links":["b3b2a82637e28d45"],"x":795,"y":3480,"wires":[]},{"id":"986bcfa8a43ce3cb","type":"ui_switch","z":"5a05b8f3.894b88","d":true,"name":"112_OneTwelve","label":"OneTwelve","tooltip":"","group":"4e2af34d.8f765c","order":4,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"112_state_OneTwelve","topicType":"str","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","animate":true,"className":"","x":1180,"y":3420,"wires":[["ba8aebb.ea06618"]]},{"id":"1bd11c5ae43a54ba","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/113","qos":"0","datatype":"json","broker":"c1170463.5c7f8","nl":false,"rap":false,"inputs":0,"x":180,"y":3520,"wires":[["d893251f81ab05c8"]]},{"id":"d893251f81ab05c8","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":3520,"wires":[["206dc47efbfdf00a"],[],["25d2ee6bf50df21b"]],"outputLabels":["on/off value","brightness value",null]},{"id":"25d2ee6bf50df21b","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_46","mode":"link","links":["04ab67e5b56adc8c"],"x":795,"y":3540,"wires":[]},{"id":"206dc47efbfdf00a","type":"ui_switch","z":"5a05b8f3.894b88","d":true,"name":"113_Main_Entry","label":"Entry","tooltip":"","group":"2e0a52f8.6acbee","order":4,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"113_state_Entry","topicType":"str","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","animate":true,"className":"","x":1180,"y":3480,"wires":[["ba8aebb.ea06618"]]},{"id":"7a871cfcd5fa7057","type":"mqtt in","z":"5a05b8f3.894b88","name":"","topic":"RVC/DC_DIMMER_STATUS_3/114","qos":"0","datatype":"json","broker":"c1170463.5c7f8","nl":false,"rap":false,"inputs":0,"x":180,"y":3580,"wires":[["0b5703588c9ae55a"]]},{"id":"0b5703588c9ae55a","type":"file function","z":"5a05b8f3.894b88","name":"decode_dc_dimmer_light_ervin.js","filename":".node-red/js/decode_dc_dimmer_light_ervin.js","reloadfile":false,"outputs":3,"x":560,"y":3580,"wires":[["e80d0fa01c842824"],[],["1458a5ba6627fd90"]],"outputLabels":["on/off value","brightness value",null]},{"id":"1458a5ba6627fd90","type":"link out","z":"5a05b8f3.894b88","name":"Alexa_46","mode":"link","links":["ff03456d63497c4f"],"x":795,"y":3600,"wires":[]},{"id":"e80d0fa01c842824","type":"ui_switch","z":"5a05b8f3.894b88","d":true,"name":"114_Ext_Porch","label":"Porch","tooltip":"","group":"4e2af34d.8f765c","order":4,"width":"3","height":"1","passthru":false,"decouple":"true","topic":"114_state_Porch","topicType":"str","onvalue":"on","onvalueType":"str","onicon":"","oncolor":"","offvalue":"off","offvalueType":"str","officon":"","offcolor":"","animate":true,"className":"","x":1180,"y":3540,"wires":[["ba8aebb.ea06618"]]},{"id":"c0ad1446.bbd908","type":"function","z":"23312cd9.0451a4","name":"Convert Alexa-Virtual to eRVin","func":"//\n// Copyright (C) 2019 Wandertech LLC\n// Copyright (C) eRVin project mods 2021\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\n// Input: the output from the Alexa-Virtual node. Commands can either originate from the Alexa app\n//        or an Alexa voice command (msg.payload.source will = 'Alexa').\n// Output: adapt the Alexa-Virtual parameters to be compatible with the eRVin infrastructure.\n//         Alexa 'ON' = 'on', ALEXA 'OFF' = 'off', 'dim' is sent if the Alexa-Virtual type is a\n//         DIMMER_SWITCH or DIMMABLE_LIGHT_BULB, otherwise 'on' is sent.\n\nvar instance = msg.topic;\nvar name = msg.payload.name;\nvar powerState = msg.payload.powerState;\nvar brightness = msg.payload.brightness;\nvar directive = msg.payload.directive;\nvar type = msg.payload.type\n\n// write the Alexa-Virtula name to global context in case it has been changed in the Alexa app.\nglobal.set('status.lights[' + instance + '].alexaname', name);\nglobal.set('status.lights[' + instance + '].type', type);\n\nif (type == 'DIMMER_SWITCH' || type == 'DIMMABLE_LIGHT_BULB') {command = 'dim';} else {command = 'on';}\n\nif (directive == 'SetBrightness') {\n    dimtopic = instance + '_brightness';\n    msg = {'topic':dimtopic, 'payload':brightness, 'directive':directive};\n}\n\nif (directive == 'TurnOff' ) {\n    statetopic = instance + '_state_' + name;\n    msg = {'topic':statetopic, 'payload':'off', 'directive':directive};\n}\n\nif (directive == 'TurnOn') {\n    statetopic = instance + '_state_' + name;\n    msg = {'topic':statetopic, 'payload':command, 'directive':directive};\n}\n\nreturn msg;\n\n\n// var instance = msg.topic.split('_')[0];\n// var msgtype = msg.topic.split('_')[1];\n//var commands = { 'dim': 0, 'on': 2, 'off': 3 };\n\n//global.set('status.lights[' + instance + '].instancename', instancename);\n\n\n\n","outputs":1,"noerr":9,"initialize":"","finalize":"","libs":[],"x":1070,"y":1180,"wires":[["642adfa2.d5aad","bbfeafb5.7c796"]]},{"id":"642adfa2.d5aad","type":"link out","z":"23312cd9.0451a4","name":"To command_dc_dimmer","links":["a05ac2b7.d426d"],"x":1375,"y":1180,"wires":[]},{"id":"b8990680.f0e988","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 34","links":["9647ec41.5edf6"],"x":265,"y":1320,"wires":[["89e9c53b.e64b58"]]},{"id":"3b29db30.6449b4","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 33","links":["86bec4e3.edbcb8"],"x":265,"y":1280,"wires":[["59a7ccd.814cb34"]]},{"id":"3519cb72.41e9f4","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 38","links":["a2b09dcd.2d1c9"],"x":265,"y":1480,"wires":[["fbb06888.62bb68"]]},{"id":"1e3517ea.25f258","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 13","links":["d6e2a045.7e358"],"x":265,"y":480,"wires":[["f8852b3f.b70ab8"]]},{"id":"80ca6a2c.914828","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 14","links":["f8bce69b.995b08"],"x":265,"y":520,"wires":[["d723cef.da7da3"]]},{"id":"be0fac40.54a83","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 16","links":["3d7c9499.7df9bc"],"x":265,"y":600,"wires":[["5bb67c50.382854"]]},{"id":"76037a81.aa3f44","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 17","links":["10d87f4b.cd7441"],"x":265,"y":640,"wires":[["e077a1a.da8466"]]},{"id":"e29fb042.37a58","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 18","links":["c22fe021.cf732"],"x":265,"y":680,"wires":[["4c8b831e.57ea0c"]]},{"id":"505ed23e.f14afc","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 19","links":["504c6a7f.8ce8c4"],"x":265,"y":720,"wires":[["fffe58fe.567438"]]},{"id":"5bf5ee15.87caa","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 20","links":["82ab32ba.46b1b"],"x":265,"y":760,"wires":[["1691134c.b2913d"]]},{"id":"58a0872b.435068","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 21","links":["b9f024ce.83cf68"],"x":265,"y":800,"wires":[["9886b4e4.3a9108"]]},{"id":"4d48de6e.28a5e","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 22","links":["aa09b718.231ce8"],"x":265,"y":840,"wires":[["5f0d4da2.d64cf4"]]},{"id":"b404cba3.691468","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 23","links":["bf70c94a.c7ef08"],"x":265,"y":880,"wires":[["4892b11e.e9c46"]]},{"id":"b603da9e.e963d8","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 24","links":["b793c70f.9d1c48"],"x":265,"y":920,"wires":[["6e9eddfd.aa97a4"]]},{"id":"fb701e79.1dffa","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 25","links":["a1753018.3f292"],"x":265,"y":960,"wires":[["ff6cac92.e5bf1"]]},{"id":"e7d606da.cac468","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 26","links":["1a89e6d0.a42329"],"x":265,"y":1000,"wires":[["f88a48d2.f858a8"]]},{"id":"50ba1e98.e7568","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 27","links":["87c13d1d.828f3"],"x":265,"y":1040,"wires":[["aba16958.e37c38"]]},{"id":"8353d7f.aac7f28","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 28","links":["f8c9d73b.0bb9f8"],"x":265,"y":1080,"wires":[["a95d97f5.43e1e8"]]},{"id":"730115bb.e5827c","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 29","links":["4aa343b9.05a0ac"],"x":265,"y":1120,"wires":[["2daa201.49e14e"]]},{"id":"2abda940.0e39a6","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 30","links":["af50c992.3824c8"],"x":265,"y":1160,"wires":[["784abba8.236c64"]]},{"id":"c14f0b32.25e7b8","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 31","links":["5b7f4b58.21ada4"],"x":265,"y":1200,"wires":[["397a3bf0.6fe314"]]},{"id":"8bce12d5.294f5","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 32","links":["cd682278.4ea26"],"x":265,"y":1240,"wires":[["cb575c89.c77b1"]]},{"id":"dbcba6e1.e04068","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 35","links":["e4dd64e3.330458"],"x":265,"y":1360,"wires":[["9d74e2df.16845"]]},{"id":"453ba02b.373cb","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 36","links":["fa9957ec.e18c88"],"x":265,"y":1400,"wires":[["2c6544f5.613ddc"]]},{"id":"200edc87.c78da4","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 37","links":["4b4e169d.6f7af8"],"x":265,"y":1440,"wires":[["154a1149.a295af"]]},{"id":"b8a60677.1e09e8","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 39","links":["a9a0ea5e.076e48"],"x":265,"y":1520,"wires":[["54914432.290a2c"]]},{"id":"46dac7e3.71b938","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 42","links":["2aa529f4.33c4a6"],"x":265,"y":1640,"wires":[["bcb2a962.cff848"]]},{"id":"f339308f.e65b1","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 43","links":["df75bd8c.2b2a5"],"x":265,"y":1680,"wires":[["8fcface5.3e792"]]},{"id":"72be638f.48ddec","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 44","links":["567b8b5d.d10364"],"x":265,"y":1720,"wires":[["8913e7ad.054e48"]]},{"id":"c1c97af8.d16f38","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 45","links":["843746d7.61c728"],"x":265,"y":1760,"wires":[["4292e089.5abe3"]]},{"id":"2571ef27.690ad","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 46","links":["5108e19b.9e68a"],"x":265,"y":1800,"wires":[["f0085a77.2268a8"]]},{"id":"9dc19879.3bb408","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 100 Panel Lights","links":["c3e71baa.c0e778"],"x":265,"y":2180,"wires":[["8bc7082e.3798d8"]]},{"id":"999e55ab.6e2308","type":"link out","z":"23312cd9.0451a4","name":"Alexa-Virtual Panel Lights Out","links":["a8a021c.d7c75e"],"x":595,"y":2180,"wires":[]},{"id":"bbfeafb5.7c796","type":"debug","z":"23312cd9.0451a4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1430,"y":1100,"wires":[]},{"id":"59a7ccd.814cb34","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Dinette Light","topic":"33","connection":"","template":"DIMMER_SWITCH","passthrough":false,"diff":false,"filter":false,"x":430,"y":1280,"wires":[["c0ad1446.bbd908"]]},{"id":"fbb06888.62bb68","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Driver Side Awning Lights","topic":"38","connection":"","template":"SWITCH","passthrough":false,"diff":false,"filter":false,"x":470,"y":1480,"wires":[["c0ad1446.bbd908"]]},{"id":"89e9c53b.e64b58","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Sink Light","topic":"34","connection":"","template":"DIMMER_SWITCH","passthrough":false,"diff":false,"filter":false,"x":420,"y":1320,"wires":[["c0ad1446.bbd908"]]},{"id":"f8852b3f.b70ab8","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Rear Bath Ceiling","topic":"13","connection":"","template":"DIMMER_SWITCH","passthrough":false,"diff":false,"filter":false,"x":450,"y":480,"wires":[["c0ad1446.bbd908"]]},{"id":"d723cef.da7da3","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Rear Bath Lav","topic":"14","connection":"","template":"DIMMER_SWITCH","passthrough":false,"diff":false,"filter":false,"x":440,"y":520,"wires":[["c0ad1446.bbd908"]]},{"id":"5bb67c50.382854","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Rear Bath Accent","topic":"16","connection":"","template":"DIMMER_SWITCH","passthrough":false,"diff":false,"filter":false,"x":450,"y":600,"wires":[["c0ad1446.bbd908"]]},{"id":"e077a1a.da8466","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Bedroom Ceiling","topic":"17","connection":"","template":"DIMMER_SWITCH","passthrough":false,"diff":false,"filter":false,"x":450,"y":640,"wires":[["c0ad1446.bbd908"]]},{"id":"4c8b831e.57ea0c","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Bedroom Reading","topic":"18","connection":"","template":"DIMMER_SWITCH","passthrough":false,"diff":false,"filter":false,"x":450,"y":680,"wires":[["c0ad1446.bbd908"]]},{"id":"fffe58fe.567438","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Bedroom Accent","topic":"19","connection":"","template":"DIMMER_SWITCH","passthrough":false,"diff":false,"filter":false,"x":440,"y":720,"wires":[["c0ad1446.bbd908"]]},{"id":"1691134c.b2913d","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Bedroom Vanity","topic":"20","connection":"","template":"DIMMER_SWITCH","passthrough":false,"diff":false,"filter":false,"x":440,"y":760,"wires":[["c0ad1446.bbd908"]]},{"id":"9886b4e4.3a9108","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Bedroom Courtesy","topic":"21","connection":"","template":"DIMMER_SWITCH","passthrough":false,"diff":false,"filter":false,"x":450,"y":800,"wires":[["c0ad1446.bbd908"]]},{"id":"5f0d4da2.d64cf4","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Mid Bath Ceiling","topic":"22","connection":"","template":"DIMMER_SWITCH","passthrough":false,"diff":false,"filter":false,"x":440,"y":840,"wires":[["c0ad1446.bbd908"]]},{"id":"4892b11e.e9c46","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Mid Bath Accent","topic":"23","connection":"","template":"DIMMER_SWITCH","passthrough":false,"diff":false,"filter":false,"x":440,"y":880,"wires":[["c0ad1446.bbd908"]]},{"id":"6e9eddfd.aa97a4","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Entry Ceiling","topic":"24","connection":"","template":"DIMMER_SWITCH","passthrough":false,"diff":false,"filter":false,"x":430,"y":920,"wires":[["c0ad1446.bbd908"]]},{"id":"ff6cac92.e5bf1","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Living Room Ceiling","topic":"25","connection":"","template":"DIMMER_SWITCH","passthrough":false,"diff":false,"filter":false,"x":460,"y":960,"wires":[["c0ad1446.bbd908"]]},{"id":"f88a48d2.f858a8","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Ceiling Accent","topic":"26","connection":"","template":"DIMMER_SWITCH","passthrough":false,"diff":false,"filter":false,"x":440,"y":1000,"wires":[["c0ad1446.bbd908"]]},{"id":"aba16958.e37c38","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Living Room Accent","topic":"27","connection":"","template":"DIMMER_SWITCH","passthrough":false,"diff":false,"filter":false,"x":460,"y":1040,"wires":[["c0ad1446.bbd908"]]},{"id":"a95d97f5.43e1e8","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Aquahot Electric","topic":"28","connection":"","template":"SWITCH","passthrough":false,"diff":false,"filter":false,"x":440,"y":1080,"wires":[["c0ad1446.bbd908"]]},{"id":"2daa201.49e14e","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Sofa Sconce","topic":"29","connection":"","template":"DIMMER_SWITCH","passthrough":false,"diff":false,"filter":false,"x":430,"y":1120,"wires":[["c0ad1446.bbd908"]]},{"id":"784abba8.236c64","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Driver Side Ceiling","topic":"30","connection":"","template":"DIMMER_SWITCH","passthrough":false,"diff":false,"filter":false,"x":450,"y":1160,"wires":[["c0ad1446.bbd908"]]},{"id":"397a3bf0.6fe314","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Passenger Side Ceiling","topic":"31","connection":"","template":"DIMMER_SWITCH","passthrough":false,"diff":false,"filter":false,"x":470,"y":1200,"wires":[["c0ad1446.bbd908"]]},{"id":"cb575c89.c77b1","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Driver Side Slide","topic":"32","connection":"","template":"DIMMER_SWITCH","passthrough":false,"diff":false,"filter":false,"x":450,"y":1240,"wires":[["c0ad1446.bbd908"]]},{"id":"9d74e2df.16845","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Midship Hall Light","topic":"35","connection":"","template":"DIMMER_SWITCH","passthrough":false,"diff":false,"filter":false,"x":450,"y":1360,"wires":[["c0ad1446.bbd908"]]},{"id":"2c6544f5.613ddc","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Aquahot Burner","topic":"36","connection":"","template":"SWITCH","passthrough":false,"diff":false,"filter":false,"x":440,"y":1400,"wires":[["c0ad1446.bbd908"]]},{"id":"154a1149.a295af","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Under Slideout Lights","topic":"37","connection":"","template":"SWITCH","passthrough":false,"diff":false,"filter":false,"x":460,"y":1440,"wires":[["c0ad1446.bbd908"]]},{"id":"54914432.290a2c","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Passenger Side Awning Lights","topic":"39","connection":"","template":"SWITCH","passthrough":false,"diff":false,"filter":false,"x":490,"y":1520,"wires":[["c0ad1446.bbd908"]]},{"id":"bcb2a962.cff848","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Porch Light","topic":"42","connection":"","template":"SWITCH","passthrough":false,"diff":false,"filter":false,"x":430,"y":1640,"wires":[["c0ad1446.bbd908"]]},{"id":"8fcface5.3e792","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Cargo Lights","topic":"43","connection":"","template":"SWITCH","passthrough":false,"diff":false,"filter":false,"x":430,"y":1680,"wires":[["c0ad1446.bbd908"]]},{"id":"8913e7ad.054e48","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Driver Side Security Light","topic":"44","connection":"","template":"SWITCH","passthrough":false,"diff":false,"filter":false,"x":470,"y":1720,"wires":[["c0ad1446.bbd908"]]},{"id":"4292e089.5abe3","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Passenger Side Security Light","topic":"45","connection":"","template":"SWITCH","passthrough":false,"diff":false,"filter":false,"x":490,"y":1760,"wires":[["c0ad1446.bbd908"]]},{"id":"f0085a77.2268a8","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Motion Lights","topic":"46","connection":"","template":"SWITCH","passthrough":false,"diff":false,"filter":false,"x":430,"y":1800,"wires":[["c0ad1446.bbd908"]]},{"id":"8bc7082e.3798d8","type":"vsh-virtual-device","z":"23312cd9.0451a4","name":"Panel Lights","topic":"100","connection":"","template":"DIMMER_SWITCH","passthrough":false,"diff":false,"filter":false,"x":430,"y":2180,"wires":[["999e55ab.6e2308"]]},{"id":"a32a60352abd271f","type":"vsh-virtual-device","z":"23312cd9.0451a4","d":true,"name":"Twelve","topic":"12","connection":"","template":"DIMMER_SWITCH","passthrough":false,"diff":false,"filter":false,"x":420,"y":440,"wires":[["c0ad1446.bbd908"]]},{"id":"59346b67228b63fb","type":"vsh-virtual-device","z":"23312cd9.0451a4","d":true,"name":"Driver Side Security Light","topic":"11","connection":"","template":"SWITCH","passthrough":false,"diff":false,"filter":false,"x":470,"y":400,"wires":[["c0ad1446.bbd908"]]},{"id":"6aa775bdf3a99d87","type":"vsh-virtual-device","z":"23312cd9.0451a4","d":true,"name":"Passenger Security Light","topic":"10","connection":"","template":"SWITCH","passthrough":false,"diff":false,"filter":false,"x":470,"y":360,"wires":[["c0ad1446.bbd908"]]},{"id":"cfc5103c4e804baa","type":"vsh-virtual-device","z":"23312cd9.0451a4","d":true,"name":"Motion Lights","topic":"9","connection":"","template":"SWITCH","passthrough":false,"diff":false,"filter":false,"x":430,"y":320,"wires":[["c0ad1446.bbd908"]]},{"id":"2e6ceb17717346c3","type":"vsh-virtual-device","z":"23312cd9.0451a4","d":true,"name":"Aquahot Preheat","topic":"8","connection":"","template":"SWITCH","passthrough":false,"diff":false,"filter":false,"x":450,"y":280,"wires":[["c0ad1446.bbd908"]]},{"id":"602eec460140f7ea","type":"vsh-virtual-device","z":"23312cd9.0451a4","d":true,"name":"Aquahot Electric","topic":"7","connection":"","template":"SWITCH","passthrough":false,"diff":false,"filter":false,"x":440,"y":240,"wires":[["c0ad1446.bbd908"]]},{"id":"a242b3df78654a74","type":"vsh-virtual-device","z":"23312cd9.0451a4","d":true,"name":"Aquahot Burner","topic":"6","connection":"","template":"SWITCH","passthrough":false,"diff":false,"filter":false,"x":440,"y":200,"wires":[["c0ad1446.bbd908"]]},{"id":"1886ef783eb15df2","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 12","links":["3b7ea03808879ed0"],"x":265,"y":440,"wires":[["a32a60352abd271f"]]},{"id":"b0d05b5245f69499","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 11","links":["9478b65fee158608"],"x":265,"y":400,"wires":[["59346b67228b63fb"]]},{"id":"55c25187aff44a85","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 10","links":["06fe89c6a4171a2b"],"x":265,"y":360,"wires":[["6aa775bdf3a99d87"]]},{"id":"ad0beb683e9b4ca9","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 9","links":["5c1cc29131f37d9e"],"x":265,"y":320,"wires":[["cfc5103c4e804baa"]]},{"id":"06f49f8531485879","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 8","links":["714b4f8758d3392c"],"x":265,"y":280,"wires":[["2e6ceb17717346c3"]]},{"id":"9462124d3a57e116","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 7","links":["e92f0dac376edd3c"],"x":265,"y":240,"wires":[["602eec460140f7ea"]]},{"id":"4f09c16683d05753","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 6","links":["7d77f212491812d9"],"x":265,"y":200,"wires":[["a242b3df78654a74"]]},{"id":"8467c7a4ba5ba6d9","type":"comment","z":"23312cd9.0451a4","name":"6","info":"","x":70,"y":200,"wires":[]},{"id":"1ea9082413f4e447","type":"comment","z":"23312cd9.0451a4","name":"7","info":"","x":70,"y":240,"wires":[]},{"id":"e3af196218abe825","type":"comment","z":"23312cd9.0451a4","name":"8","info":"","x":70,"y":280,"wires":[]},{"id":"ecb0a851abb58800","type":"comment","z":"23312cd9.0451a4","name":"9","info":"","x":70,"y":320,"wires":[]},{"id":"eacb7a4cf4f5c0ec","type":"comment","z":"23312cd9.0451a4","name":"10","info":"","x":70,"y":360,"wires":[]},{"id":"0c182bf81132cfe5","type":"comment","z":"23312cd9.0451a4","name":"11","info":"","x":70,"y":400,"wires":[]},{"id":"b2af0cd459287f5a","type":"comment","z":"23312cd9.0451a4","name":"12","info":"","x":70,"y":440,"wires":[]},{"id":"41644d472f7a8ea1","type":"comment","z":"23312cd9.0451a4","name":"13","info":"","x":70,"y":480,"wires":[]},{"id":"bfb052f14a476400","type":"comment","z":"23312cd9.0451a4","name":"14","info":"","x":70,"y":520,"wires":[]},{"id":"50966655b55a1328","type":"comment","z":"23312cd9.0451a4","name":"16","info":"","x":70,"y":600,"wires":[]},{"id":"da32ebccf0c04cd0","type":"comment","z":"23312cd9.0451a4","name":"17","info":"","x":70,"y":640,"wires":[]},{"id":"7c721184be860b0a","type":"comment","z":"23312cd9.0451a4","name":"18","info":"","x":70,"y":680,"wires":[]},{"id":"a89a9d6072b390f3","type":"comment","z":"23312cd9.0451a4","name":"19","info":"","x":70,"y":720,"wires":[]},{"id":"7afcf7ce6bacc616","type":"vsh-virtual-device","z":"23312cd9.0451a4","d":true,"name":"Fifteen","topic":"15","connection":"","template":"DIMMER_SWITCH","passthrough":false,"diff":false,"filter":false,"x":410,"y":560,"wires":[["c0ad1446.bbd908"]]},{"id":"918af9924f290735","type":"comment","z":"23312cd9.0451a4","name":"15","info":"","x":70,"y":560,"wires":[]},{"id":"4a6a12c8352e04d7","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 15","links":["7b4eeb24928a39ec"],"x":265,"y":560,"wires":[["7afcf7ce6bacc616"]]},{"id":"1eeabbc50c96719f","type":"comment","z":"23312cd9.0451a4","name":"20","info":"","x":70,"y":760,"wires":[]},{"id":"969f82939fa06bdc","type":"comment","z":"23312cd9.0451a4","name":"21","info":"","x":70,"y":800,"wires":[]},{"id":"0d7305bb9b901a7d","type":"comment","z":"23312cd9.0451a4","name":"22","info":"","x":70,"y":840,"wires":[]},{"id":"64a5b34377042d45","type":"comment","z":"23312cd9.0451a4","name":"23","info":"","x":70,"y":880,"wires":[]},{"id":"ec235be87cc1a346","type":"comment","z":"23312cd9.0451a4","name":"24","info":"","x":70,"y":919.7777709960938,"wires":[]},{"id":"b50beab0a07b6a66","type":"comment","z":"23312cd9.0451a4","name":"25","info":"","x":70,"y":960,"wires":[]},{"id":"31afbd3258568036","type":"comment","z":"23312cd9.0451a4","name":"26","info":"","x":70,"y":1000,"wires":[]},{"id":"f87d6315e0f95212","type":"comment","z":"23312cd9.0451a4","name":"27","info":"","x":70,"y":1040,"wires":[]},{"id":"8edac87a71295b61","type":"comment","z":"23312cd9.0451a4","name":"28","info":"","x":70,"y":1080,"wires":[]},{"id":"547c4b4b7cea81b7","type":"comment","z":"23312cd9.0451a4","name":"29","info":"","x":70,"y":1120,"wires":[]},{"id":"539230c6ac8047ec","type":"comment","z":"23312cd9.0451a4","name":"30","info":"","x":70,"y":1160,"wires":[]},{"id":"d9a830de614883fe","type":"comment","z":"23312cd9.0451a4","name":"31","info":"","x":70,"y":1200,"wires":[]},{"id":"a678ba5825ec28a8","type":"comment","z":"23312cd9.0451a4","name":"32","info":"","x":70,"y":1240,"wires":[]},{"id":"a872f6e7e4562864","type":"comment","z":"23312cd9.0451a4","name":"33","info":"","x":70,"y":1280,"wires":[]},{"id":"a9141d33d1706109","type":"comment","z":"23312cd9.0451a4","name":"34","info":"","x":70,"y":1320,"wires":[]},{"id":"f61ef912f35452b5","type":"comment","z":"23312cd9.0451a4","name":"35","info":"","x":70,"y":1360,"wires":[]},{"id":"6e429287b5842586","type":"comment","z":"23312cd9.0451a4","name":"36","info":"","x":70,"y":1400,"wires":[]},{"id":"1fa4586d622daaed","type":"comment","z":"23312cd9.0451a4","name":"37","info":"","x":70,"y":1440,"wires":[]},{"id":"aba5abb458eb6722","type":"comment","z":"23312cd9.0451a4","name":"38","info":"","x":70,"y":1480,"wires":[]},{"id":"19ec0c2f2bfbc478","type":"comment","z":"23312cd9.0451a4","name":"39","info":"","x":70,"y":1520,"wires":[]},{"id":"8bfeaa6f6a8c5f01","type":"comment","z":"23312cd9.0451a4","name":"40","info":"","x":70,"y":1560,"wires":[]},{"id":"f18693c82e4abc3a","type":"comment","z":"23312cd9.0451a4","name":"41","info":"","x":70,"y":1600,"wires":[]},{"id":"0ce28b6bbbc1c1c4","type":"comment","z":"23312cd9.0451a4","name":"42","info":"","x":70,"y":1640,"wires":[]},{"id":"fc3db983d6f079a1","type":"comment","z":"23312cd9.0451a4","name":"43","info":"","x":70,"y":1680,"wires":[]},{"id":"003c45df80b128f7","type":"comment","z":"23312cd9.0451a4","name":"44","info":"","x":70,"y":1720,"wires":[]},{"id":"e699ffa268284fe4","type":"comment","z":"23312cd9.0451a4","name":"45","info":"","x":70,"y":1760,"wires":[]},{"id":"f4c35f21dd93da7b","type":"comment","z":"23312cd9.0451a4","name":"46","info":"","x":70,"y":1800,"wires":[]},{"id":"f6fcf40aa66a677d","type":"vsh-virtual-device","z":"23312cd9.0451a4","d":true,"name":"Forty","topic":"40","connection":"","template":"SWITCH","passthrough":false,"diff":false,"filter":false,"x":410,"y":1560,"wires":[["c0ad1446.bbd908"]]},{"id":"6861ac71d564676d","type":"vsh-virtual-device","z":"23312cd9.0451a4","d":true,"name":"Forty One","topic":"41","connection":"","template":"SWITCH","passthrough":false,"diff":false,"filter":false,"x":420,"y":1600,"wires":[["c0ad1446.bbd908"]]},{"id":"ddb3a069e2a3edab","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 40","links":["4fd5c522c8aaa7b6"],"x":265,"y":1560,"wires":[["f6fcf40aa66a677d"]]},{"id":"80c619e59f1da3ad","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 41","links":["f90ea784d45baf53"],"x":265,"y":1600,"wires":[["6861ac71d564676d"]]},{"id":"4266ef8bc15458ab","type":"vsh-virtual-device","z":"23312cd9.0451a4","d":true,"name":"Cargo Lights","topic":"111","connection":"","template":"SWITCH","passthrough":false,"diff":false,"filter":false,"x":430,"y":1960,"wires":[["c0ad1446.bbd908"]]},{"id":"d8033c200d3d8fce","type":"vsh-virtual-device","z":"23312cd9.0451a4","d":true,"name":"One Twelve","topic":"112","connection":"","template":"SWITCH","passthrough":false,"diff":false,"filter":false,"x":430,"y":2000,"wires":[["c0ad1446.bbd908"]]},{"id":"5c1a1dd360e763a4","type":"vsh-virtual-device","z":"23312cd9.0451a4","d":true,"name":"Entry Light","topic":"113","connection":"","template":"SWITCH","passthrough":false,"diff":false,"filter":false,"x":430,"y":2040,"wires":[["c0ad1446.bbd908"]]},{"id":"f15f202be3fb5f3d","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 111","links":["528a69d796d2d742"],"x":265,"y":1960,"wires":[["4266ef8bc15458ab"]]},{"id":"b3b2a82637e28d45","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 112","links":["f80fc6f618170ce8"],"x":265,"y":2000,"wires":[["d8033c200d3d8fce"]]},{"id":"04ab67e5b56adc8c","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 113","links":["25d2ee6bf50df21b"],"x":265,"y":2040,"wires":[["5c1a1dd360e763a4"]]},{"id":"ff03456d63497c4f","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 114","links":["1458a5ba6627fd90"],"x":265,"y":2080,"wires":[["08e5237aafc3de84"]]},{"id":"08e5237aafc3de84","type":"vsh-virtual-device","z":"23312cd9.0451a4","d":true,"name":"Porch Light","topic":"114","connection":"","template":"SWITCH","passthrough":false,"diff":false,"filter":false,"x":430,"y":2080,"wires":[["c0ad1446.bbd908"]]},{"id":"f7b6fef723fa453b","type":"comment","z":"23312cd9.0451a4","name":"111","info":"","x":70,"y":1960,"wires":[]},{"id":"ac0259c1c8f53155","type":"comment","z":"23312cd9.0451a4","name":"112","info":"","x":70,"y":2000,"wires":[]},{"id":"48547f361c8aee23","type":"comment","z":"23312cd9.0451a4","name":"113","info":"","x":70,"y":2040,"wires":[]},{"id":"0ba772c709b31334","type":"comment","z":"23312cd9.0451a4","name":"114","info":"","x":70,"y":2080,"wires":[]},{"id":"b34e6902f766cd7f","type":"comment","z":"23312cd9.0451a4","name":"47","info":"","x":70,"y":1840,"wires":[]},{"id":"0137808c7cbbf194","type":"comment","z":"23312cd9.0451a4","name":"48","info":"","x":70,"y":1880,"wires":[]},{"id":"7927d2a74f562291","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 47","links":["ef9943dc6952cf9a"],"x":265,"y":1840,"wires":[["3abfc1ed63f3f222"]]},{"id":"3abfc1ed63f3f222","type":"vsh-virtual-device","z":"23312cd9.0451a4","d":true,"name":"Forty Seven","topic":"47","connection":"","template":"SWITCH","passthrough":false,"diff":false,"filter":false,"x":430,"y":1840,"wires":[[]]},{"id":"fd0d2dd6456887de","type":"link in","z":"23312cd9.0451a4","name":"Alexa-Virtual 48","links":["6660358f03d3fe03"],"x":265,"y":1880,"wires":[["c5aa1d75bb36df3f"]]},{"id":"c5aa1d75bb36df3f","type":"vsh-virtual-device","z":"23312cd9.0451a4","d":true,"name":"Forty Eight","topic":"48","connection":"","template":"SWITCH","passthrough":false,"diff":false,"filter":false,"x":430,"y":1880,"wires":[[]]},{"id":"9aaed093ec9ccc3e","type":"comment","z":"23312cd9.0451a4","name":"Instance #","info":"","x":80,"y":120,"wires":[]},{"id":"9634a554.eba588","type":"ui_button","z":"2fdd8124.05e35e","name":"Shutdown","group":"97b9ad54.9933e","order":7,"width":"3","height":"1","passthru":false,"label":"Shutdown","color":"","bgcolor":"","icon":"fa-power-off","payload":"","payloadType":"str","topic":"shutdown","x":560,"y":1900,"wires":[["415af2a8.5a947c"]]},{"id":"415af2a8.5a947c","type":"exec","z":"2fdd8124.05e35e","command":"sudo /coachproxy/bin/safe_shutdown","addpay":false,"append":"","useSpawn":"","name":"","x":830,"y":1900,"wires":[[],[],[]]},{"id":"4c3ea3a.8a313dc","type":"ui_button","z":"2fdd8124.05e35e","name":"Reboot","group":"97b9ad54.9933e","order":6,"width":"3","height":"1","passthru":true,"label":"Reboot","tooltip":"","color":"","bgcolor":"","icon":"fa-repeat","payload":"","payloadType":"str","topic":"reboot","x":560,"y":1840,"wires":[["14f6b812.2c4f78"]]},{"id":"14f6b812.2c4f78","type":"exec","z":"2fdd8124.05e35e","command":"sudo /coachproxy/bin/safe_reboot","addpay":false,"append":"","useSpawn":"","name":"","x":820,"y":1840,"wires":[[],[],[]]},{"id":"2c3ffc9c.ac652c","type":"ui_text","z":"2fdd8124.05e35e","group":"97b9ad54.9933e","order":8,"width":"","height":"","name":"Shutdown Feedback","label":"","format":"{{msg.payload}}","layout":"col-center","x":820,"y":2020,"wires":[]},{"id":"edae305b.745bc","type":"mqtt in","z":"2fdd8124.05e35e","name":"","topic":"GLOBAL/MESSAGE","qos":"0","datatype":"auto-detect","broker":"c1170463.5c7f8","nl":false,"rap":false,"inputs":0,"x":130,"y":320,"wires":[["2efaba3c.f2b586"]]},{"id":"4c937d76.07d3cc","type":"mqtt in","z":"2fdd8124.05e35e","name":"","topic":"GLOBAL/SN","qos":"0","broker":"c1170463.5c7f8","inputs":0,"x":150,"y":1300,"wires":[["961203aa.9823c"]]},{"id":"961203aa.9823c","type":"ui_text","z":"2fdd8124.05e35e","group":"97b9ad54.9933e","order":4,"width":"","height":"","name":"Serial Number","label":"Serial Number","format":"{{msg.payload}}","layout":"","x":340,"y":1300,"wires":[]},{"id":"ed8f62b5.c7ed48","type":"ui_text","z":"2fdd8124.05e35e","group":"f961f048.b0646","order":1,"width":"","height":"","name":"eRVin OS Version","label":"eRVin OS Version","format":"{{msg.payload}}","layout":"","className":"","x":950,"y":1360,"wires":[]},{"id":"f47d0e1c.87d328","type":"inject","z":"2fdd8124.05e35e","name":"Every Minute","repeat":"60","crontab":"","once":true,"onceDelay":"","topic":"","payload":"","payloadType":"date","x":160,"y":1780,"wires":[["e1ba3e99.4f13a"]]},{"id":"e1ba3e99.4f13a","type":"exec","z":"2fdd8124.05e35e","command":"date +%s -d \"$(uptime -s)\"","addpay":false,"append":"","useSpawn":"","name":"Uptime","x":380,"y":1780,"wires":[["3fcf94be.9ffbec"],[],[]]},{"id":"b6168986.1a2508","type":"ui_text","z":"2fdd8124.05e35e","group":"97b9ad54.9933e","order":5,"width":"","height":"","name":"Uptime","label":"Uptime","format":"{{msg.payload}}","layout":"","x":780,"y":1780,"wires":[]},{"id":"bcfdd5c3.eb51c","type":"mqtt in","z":"2fdd8124.05e35e","name":"","topic":"GLOBAL/SHUTDOWN","qos":"0","broker":"c1170463.5c7f8","inputs":0,"x":560,"y":2020,"wires":[["2c3ffc9c.ac652c"]]},{"id":"2efaba3c.f2b586","type":"change","z":"2fdd8124.05e35e","name":"Alert!","rules":[{"t":"set","p":"topic","pt":"msg","to":"Alert!","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":330,"y":320,"wires":[["d86399a0.0a9b08"]]},{"id":"3fcf94be.9ffbec","type":"file function","z":"2fdd8124.05e35e","name":"uptime_parse","filename":".node-red/js/uptime_parse.js","reloadfile":false,"outputs":1,"x":580,"y":1780,"wires":[["b6168986.1a2508"]]},{"id":"29d34722.717808","type":"comment","z":"2fdd8124.05e35e","name":"System Tab","info":"","x":150,"y":1260,"wires":[]},{"id":"d031d4bf.52d7b8","type":"mqtt in","z":"2fdd8124.05e35e","name":"","topic":"GLOBAL/VER","qos":"0","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":150,"y":1340,"wires":[["ccf1905a.52a16"]]},{"id":"8a00f07e.fdd1f","type":"sqlite","z":"2fdd8124.05e35e","mydb":"b2130e68.3a338","sql":"","name":"CoachProxy","x":890,"y":160,"wires":[["cdca660e.2a75e8"]]},{"id":"bb8e213c.41e4","type":"inject","z":"2fdd8124.05e35e","name":"At launch","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"","topic":"","payload":"0","payloadType":"num","x":100,"y":80,"wires":[["7544e81a.afed08","61fe328c.5c91cc"]]},{"id":"59ca8f91.7aff9","type":"template","z":"2fdd8124.05e35e","name":"Load settings2","field":"topic","fieldType":"msg","format":"handlebars","syntax":"plain","template":"select * from settings2;","output":"str","x":700,"y":160,"wires":[["8a00f07e.fdd1f"]]},{"id":"cdca660e.2a75e8","type":"function","z":"2fdd8124.05e35e","name":"Store settings2","func":"for (var i = 0; i < (msg.payload).length; i++) {\n    var key = msg.payload[i].key;\n    var value = msg.payload[i].value;\n\n    // If a JSON string is passed in, parse it and save the resulting\n    // object into global context. Otherwise, just save the raw value.\n    if (typeof(value) == 'string' && (value.charAt(0) == '[' || value.charAt(0) == '{')) {\n        global.set('settings2.' + key, JSON.parse(value));\n    } else {\n        global.set('settings2.' + key, value);\n    }\n}\n\n// Returning NULL would terminate the flow, but other\n// nodes want to know when settings have been loaded.\nreturn {};","outputs":1,"noerr":0,"x":1080,"y":160,"wires":[["b8e34e9a.dc367"]]},{"id":"1afee14e.f145af","type":"comment","z":"2fdd8124.05e35e","name":"settings2 database : Link here to save settings or be notified when settings are loaded","info":"","x":340,"y":40,"wires":[]},{"id":"5927abd3.f623e4","type":"function","z":"2fdd8124.05e35e","name":"Save settings2","func":"// Save the provided key and value to the settings2 DB table, and\n// update the settings2 global context.\nvar key = msg.topic;\nvar value = msg.payload;\n\n// If a JSON string is passed in, parse it and save the resulting\n// object into global context. Otherwise, just save the raw value.\nif (typeof(value) == 'string' && (value.charAt(0) == '[' || value.charAt(0) == '{')) {\n    global.set('settings2.' + key, JSON.parse(value));\n} else {\n    global.set('settings2.' + key, value);\n}\n\nvar newmsg = {};\nnewmsg.topic = 'INSERT OR REPLACE INTO settings2 (key, value) VALUES(?, ?)';\nnewmsg.payload = [key, String(value)];\n\nreturn newmsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":700,"y":200,"wires":[["8a6a2b57.dbc188"]]},{"id":"8a6a2b57.dbc188","type":"sqlite","z":"2fdd8124.05e35e","mydb":"b2130e68.3a338","sql":"","name":"CoachProxy","x":890,"y":200,"wires":[["b8e34e9a.dc367"]]},{"id":"b8e34e9a.dc367","type":"link out","z":"2fdd8124.05e35e","name":"Settings2 has been loaded","links":["8a1f3ae4.1ea3a8","cab70e7f.c6c35","72269b85.831204"],"x":1215,"y":200,"wires":[]},{"id":"e357c5ad.eaba18","type":"link in","z":"2fdd8124.05e35e","name":"Save key/value to settings2","links":["3a3cc1a1.4ee1ee","53444718.65a778","bc50fc72.5c00a","2ad4a4a5.c0435c"],"x":535,"y":200,"wires":[["5927abd3.f623e4"]]},{"id":"a71b65f6.8762e8","type":"comment","z":"2fdd8124.05e35e","name":"Send a message to GLOBAL/MESSAGE to display a pop-up alert","info":"","x":270,"y":260,"wires":[]},{"id":"d86399a0.0a9b08","type":"ui_toast","z":"2fdd8124.05e35e","position":"top right","displayTime":"5","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"","name":"","x":530,"y":320,"wires":[]},{"id":"1f37898c.ab8036","type":"template","z":"2fdd8124.05e35e","name":"Load presets","field":"topic","fieldType":"msg","format":"handlebars","syntax":"plain","template":"select * from presets;","output":"str","x":690,"y":80,"wires":[["b7dc14dd.f21c28"]]},{"id":"b7dc14dd.f21c28","type":"sqlite","z":"2fdd8124.05e35e","mydb":"b2130e68.3a338","sql":"","name":"CoachProxy","x":890,"y":80,"wires":[["7b893f4b.6cfd4"]]},{"id":"7b893f4b.6cfd4","type":"function","z":"2fdd8124.05e35e","name":"Store presets","func":"var presets = [];\nfor (let i = 1; i <= 10; i++) {\n    presets[i] = { name: '' };\n}\n\nfor (let i = 0; i < (msg.payload).length; i++) {\n    let number = msg.payload[i].number;\n    let data = JSON.parse(msg.payload[i].data);\n    presets[number] = data;\n}\n\nglobal.set('presets', presets);\n\n// Returning NULL would terminate the flow, but other\n// nodes want to know when settings have been loaded.\nreturn {};","outputs":1,"noerr":0,"x":1080,"y":80,"wires":[["e93057bd.d997f8"]]},{"id":"e93057bd.d997f8","type":"link out","z":"2fdd8124.05e35e","name":"presets have been loaded","links":["56509485.b3fb0c","a29e5196.33994","c6d920b4.871a"],"x":1215,"y":80,"wires":[]},{"id":"84c29343.d700a","type":"mqtt in","z":"2fdd8124.05e35e","name":"","topic":"NETWORK/#","qos":"0","datatype":"auto-detect","broker":"c1170463.5c7f8","nl":false,"rap":false,"inputs":0,"x":110,"y":420,"wires":[["ded540a8.bef63"]]},{"id":"19cb1b48.a85c05","type":"ui_template","z":"2fdd8124.05e35e","group":"cd05e210.dac658","name":"WiFi Network Info","order":1,"width":"0","height":"0","format":"<div layout=\"column\" layout-align=\"space-between\">\n    <div>{{msg.message}}</div>&nbsp;\n    <div>&nbsp;</div>\n    <div style=\"text-align: center; font-weight: bold\">Your WiFi Network</div>&nbsp;\n    <div layout=\"row\" layout-align=\"space-between\"><span>Network:</span>{{msg.data.WPA.SSID}}</div>&nbsp;\n    <div layout=\"row\" layout-align=\"space-between\"><span>IP Address:</span><a href='http://{{msg.data.WPA.IP}}'>{{msg.data.WPA.IP}}</a></div>&nbsp;\n    <div layout=\"row\" layout-align=\"space-between\"><span>HW Address:</span>{{msg.data.WPA.MAC}}</div>&nbsp;\n    <div layout=\"row\" layout-align=\"space-between\"><span>Connection Status:</span>{{msg.data.WPA.STATE}}</div>&nbsp;\n    <div layout=\"row\" layout-align=\"space-between\"><span>Connection Quality:</span>{{msg.data.WPA.QUALITY}}%</div>&nbsp;\n    <p>&nbsp;</p>\n</div>\n","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"local","className":"","x":890,"y":420,"wires":[[]]},{"id":"326735d2.c640ba","type":"rbe","z":"2fdd8124.05e35e","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":510,"y":420,"wires":[["998a248b.358218"]]},{"id":"ded540a8.bef63","type":"file function","z":"2fdd8124.05e35e","name":"network_info.js","filename":".node-red/js/network_info.js","reloadfile":false,"outputs":1,"x":320,"y":420,"wires":[["326735d2.c640ba"]]},{"id":"8a3a4af9.460768","type":"file function","z":"2fdd8124.05e35e","name":"initialize_global_context.js","filename":".node-red/js/initialize_global_context.js","reloadfile":true,"outputs":1,"x":470,"y":80,"wires":[["1f37898c.ab8036","59ca8f91.7aff9","6cb7aeff.ab5aa"]],"info":"// \r\n//\r\n// Copyright (C) 2019 Wandertech LLC\r\n//\r\n// This program is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// This program is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\r\n\r\n// Create global context objects that are used elsewhere\r\n// in flows/functions. This prevents many Javascript warnings\r\n// along the lines of: \"TypeError: Cannot read property 'foo' of null\"\r\n\r\n// To track form fields filled in by users\r\nglobal.set('form', {});\r\nglobal.set('form.preset', {});\r\n\r\n// To track the current status of various systems\r\nglobal.set('status', {});\r\nglobal.set('status.power', {});\r\nglobal.set('status.fans', {});\r\nglobal.set('status.vents', {});\r\nglobal.set('status.lights', {});\r\nglobal.set('status.chassis', {});\r\nglobal.set('status.network', { WPA: {}, AP: {} } );\r\n\r\nglobal.set('status.floors', {\r\n  0: { power: 0, setpoint: 68, setpoint_cp: 0, measured: 0 },\r\n  1: { power: 0, setpoint: 68, setpoint_cp: 0, measured: 0 }\r\n});\r\n\r\n// Set every light to \"off\" by default\r\nfor (let i = 0; i < msg.lights.length; i++) {\r\n  var light = { state: 'off', brightness: 0 };\r\n  global.set('status.lights[' + msg.lights[i] + ']', light);\r\n}\r\n\r\nfor (let i = 0; i <= 6; i++) {\r\n  global.set('status.tstat[' + i + ']', {});\r\n}\r\n\r\n// Settings\r\n\r\nglobal.set('settings2', {});\r\nglobal.set('settings2.notify_email1', '');\r\nglobal.set('settings2.notify_email2', '');\r\nglobal.set('settings2.pushover_key', '');\r\nglobal.set('settings2.remote_username', '');\r\nglobal.set('settings2.remote_subdomain', '');\r\nglobal.set('settings2.ngrok_auth', '');\r\n\r\n//eRVin additions - need to do this elsewhere, dont want to change values if they are already set\r\n//global.set('enteredzip', 46540); //predefines map location as Middlebury, IN if no user entered zipcode\r\n//global.set('sofasconcemode', 'on'); //predefines Sofa Sconce circuit as non-dimmable for Entegra 2017+\r\n//global.set('onmode', 125); //predefines when lights are turned on they resume to previous dim level\r\n\r\n\r\n// Legacy objects\r\nglobal.set(['ap', 'ign'], [{}, {}]);\r\n\r\nreturn {};\r\n"},{"id":"ea5d3dfc.eb98","type":"http request","z":"2fdd8124.05e35e","name":"ngrok tunnel info","method":"GET","ret":"txt","url":"http://localhost:4040/api/tunnels/coachproxy","tls":"","x":480,"y":840,"wires":[["5040b9f8.e68ee8"]]},{"id":"abd2f48d.eed968","type":"inject","z":"2fdd8124.05e35e","name":"","repeat":"1","crontab":"","once":true,"onceDelay":"1","topic":"","payload":"true","payloadType":"bool","x":280,"y":840,"wires":[["ea5d3dfc.eb98"]]},{"id":"7897c8d.05a0a38","type":"json","z":"2fdd8124.05e35e","name":"","property":"payload","action":"","pretty":false,"x":840,"y":820,"wires":[["87e5b74a.480508"]]},{"id":"5040b9f8.e68ee8","type":"switch","z":"2fdd8124.05e35e","name":"Status Code","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":680,"y":840,"wires":[["7897c8d.05a0a38"],["7342ea49.a2c6a4"]]},{"id":"7342ea49.a2c6a4","type":"change","z":"2fdd8124.05e35e","name":"Offline","rules":[{"t":"set","p":"payload","pt":"msg","to":"Offline","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":980,"y":860,"wires":[["861fe173.d8f1d"]]},{"id":"87e5b74a.480508","type":"change","z":"2fdd8124.05e35e","name":"Link URL","rules":[{"t":"set","p":"payload","pt":"msg","to":"\"<a target='_tunnel' href='\" & payload.public_url & \"/ui'>\" & payload.public_url & \"/ui</a>\"","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":990,"y":820,"wires":[["861fe173.d8f1d"]]},{"id":"bb6ebc9f.d7c91","type":"ui_text","z":"2fdd8124.05e35e","group":"23adf1d9.326cae","order":1,"width":0,"height":0,"name":"","label":"Remote Access URL:","format":"{{msg.payload}}","layout":"col-center","x":1330,"y":860,"wires":[]},{"id":"ca31e3a1.1f1d8","type":"comment","z":"2fdd8124.05e35e","name":"Remote Access Settings","info":"","x":310,"y":720,"wires":[]},{"id":"d396acc4.86d79","type":"ui_switch","z":"2fdd8124.05e35e","name":"","label":"Enable Remote Access","group":"23adf1d9.326cae","order":3,"width":0,"height":0,"passthru":false,"decouple":"false","topic":"remote_access","style":"","onvalue":"true","onvalueType":"str","onicon":"","oncolor":"","offvalue":"false","offvalueType":"str","officon":"","offcolor":"","x":680,"y":940,"wires":[["3a3cc1a1.4ee1ee","21546672.c4f77a"]]},{"id":"21546672.c4f77a","type":"exec","z":"2fdd8124.05e35e","command":"/coachproxy/bin/apply_remote_access_settings.sh","addpay":false,"append":"","useSpawn":"","timer":"","oldrc":false,"name":"apply_remote_access_settings.sh","x":1230,"y":1040,"wires":[["fa4267ba.859788"],[],["6d1d1ade.5487f4"]]},{"id":"8534daf0.679d88","type":"ui_text_input","z":"2fdd8124.05e35e","name":"ngrok Authtoken","label":"Enter your ngrok Authtoken","group":"23adf1d9.326cae","order":4,"width":"0","height":"0","passthru":false,"mode":"text","delay":"300","topic":"ngrok_auth","x":700,"y":980,"wires":[["3ac17815.cc7f48"]]},{"id":"cbbddadf.eeaac8","type":"ui_text_input","z":"2fdd8124.05e35e","name":"Remote Username","label":"Choose a Remote Access username","group":"23adf1d9.326cae","order":5,"width":"0","height":"0","passthru":false,"mode":"text","delay":"300","topic":"remote_username","x":700,"y":1020,"wires":[["3ac17815.cc7f48"]]},{"id":"34c110f5.5bae5","type":"ui_text_input","z":"2fdd8124.05e35e","name":"Remote Password","label":"Choose a Remote Access password","group":"23adf1d9.326cae","order":6,"width":"0","height":"0","passthru":false,"mode":"text","delay":"300","topic":"remote_password","x":700,"y":1060,"wires":[["3ac17815.cc7f48"]]},{"id":"c51c7274.fc736","type":"ui_button","z":"2fdd8124.05e35e","name":"","group":"23adf1d9.326cae","order":9,"width":"4","height":"1","passthru":false,"label":"Save","color":"","bgcolor":"","icon":"fa-check","payload":"save","payloadType":"str","topic":"","x":740,"y":1140,"wires":[["17ca583.8f6a7a8","21546672.c4f77a"]]},{"id":"253b33aa.a718ac","type":"ui_button","z":"2fdd8124.05e35e","name":"","group":"23adf1d9.326cae","order":10,"width":"2","height":"1","passthru":false,"label":"Undo","color":"","bgcolor":"#8D4040","icon":"fa-undo","payload":"delete","payloadType":"str","topic":"","x":200,"y":1140,"wires":[["99101545.c299f8","14042d19.bd9f63","2e7cb20.e483c4e","b0d20900.53b148"]]},{"id":"cf43085e.f93028","type":"ui_template","z":"2fdd8124.05e35e","group":"23adf1d9.326cae","name":"Remote Access Settings","order":2,"width":"6","height":"3","format":"<div layout=\"column\" layout-align=\"space-between\">\n<p>\nBefore using Remote Access, please read the\n<a target='_blank' href='http://coachproxy.com/remote-access-setup-new'>instructions\non how to set up and configure it.</a>\n</p>\n<p>\nEnter your ngrok Authtoken below, and choose a username and\npassword for your Remote Access service.\n</p>\n</div>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":680,"y":900,"wires":[[]]},{"id":"3a3cc1a1.4ee1ee","type":"link out","z":"2fdd8124.05e35e","name":"Remote access settings changed","links":["e357c5ad.eaba18"],"x":1105,"y":940,"wires":[]},{"id":"cab70e7f.c6c35","type":"link in","z":"2fdd8124.05e35e","name":"Set remote access fields","links":["b8e34e9a.dc367"],"x":165,"y":1000,"wires":[["faf5ce15.01fda","99101545.c299f8","14042d19.bd9f63","2e7cb20.e483c4e","b0d20900.53b148"]]},{"id":"faf5ce15.01fda","type":"change","z":"2fdd8124.05e35e","name":"settings2.remote_access","rules":[{"t":"set","p":"payload","pt":"msg","to":"$globalContext('settings2.remote_access')","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":400,"y":940,"wires":[["d396acc4.86d79"]]},{"id":"3ac17815.cc7f48","type":"file function","z":"2fdd8124.05e35e","name":"form_field_save.js","filename":".node-red/js/form_field_save.js","reloadfile":false,"outputs":1,"x":940,"y":1040,"wires":[[]]},{"id":"17ca583.8f6a7a8","type":"function","z":"2fdd8124.05e35e","name":"Save Remote Settings","func":"const topics = ['ngrok_auth', 'remote_username', 'remote_password', 'remote_subdomain'];\nvar msgs = [];\n\ntopics.forEach(function(topic) {\n  const value = global.get('form')[topic] || '';\n  const newmsg = { topic: topic, payload: value };\n  msgs.push(newmsg);\n});\n\nreturn [ msgs ];\n","outputs":1,"noerr":0,"x":950,"y":1140,"wires":[["3a3cc1a1.4ee1ee"]]},{"id":"99101545.c299f8","type":"change","z":"2fdd8124.05e35e","name":"settings2.ngrok_auth","rules":[{"t":"set","p":"payload","pt":"msg","to":"$globalContext('settings2.ngrok_auth')","tot":"jsonata"},{"t":"set","p":"form.ngrok_auth","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":980,"wires":[["8534daf0.679d88"]]},{"id":"14042d19.bd9f63","type":"change","z":"2fdd8124.05e35e","name":"settings2.remote_username","rules":[{"t":"set","p":"payload","pt":"msg","to":"$globalContext('settings2.remote_username')","tot":"jsonata"},{"t":"set","p":"form.remote_username","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":1020,"wires":[["cbbddadf.eeaac8"]]},{"id":"2e7cb20.e483c4e","type":"change","z":"2fdd8124.05e35e","name":"settings2.remote_password","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"},{"t":"set","p":"form.remote_password","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":1060,"wires":[["34c110f5.5bae5"]]},{"id":"5c225f1a.7e815","type":"catch","z":"2fdd8124.05e35e","name":"Catch ECONNREFUSED","scope":["ea5d3dfc.eb98"],"x":310,"y":780,"wires":[[]]},{"id":"6cf20fc6.84827","type":"ui_text_input","z":"2fdd8124.05e35e","name":"Remote Subdomain","label":"Custom subdomain (paid plan)","group":"23adf1d9.326cae","order":7,"width":"0","height":"0","passthru":false,"mode":"text","delay":"300","topic":"remote_subdomain","x":690,"y":1100,"wires":[["3ac17815.cc7f48"]]},{"id":"b0d20900.53b148","type":"change","z":"2fdd8124.05e35e","name":"settings2.remote_subdomain","rules":[{"t":"set","p":"payload","pt":"msg","to":"$globalContext('settings2.remote_subdomain')","tot":"jsonata"},{"t":"set","p":"form.remote_subdomain","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":1100,"wires":[["6cf20fc6.84827"]]},{"id":"54538fd2.68515","type":"mqtt in","z":"2fdd8124.05e35e","name":"","topic":"CP/MESSAGE/REMOTEACCESS","qos":"0","broker":"c1170463.5c7f8","inputs":0,"x":180,"y":1180,"wires":[["9e9b422.b80bbc","de6c0a1.abc44f8"]]},{"id":"9e9b422.b80bbc","type":"trigger","z":"2fdd8124.05e35e","name":"15 Second Reset","op1":"","op2":" ","op1type":"nul","op2type":"str","duration":"15","extend":true,"units":"s","reset":"","bytopic":"all","outputs":1,"x":440,"y":1160,"wires":[["de6c0a1.abc44f8"]]},{"id":"de6c0a1.abc44f8","type":"ui_text","z":"2fdd8124.05e35e","group":"23adf1d9.326cae","order":8,"width":0,"height":0,"name":"Remote Access Feedback","label":"","format":"{{msg.payload}}","layout":"col-center","x":690,"y":1180,"wires":[]},{"id":"fa4267ba.859788","type":"switch","z":"2fdd8124.05e35e","name":"","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"ERR_NGROK_108","vt":"str"},{"t":"cont","v":"ERR_NGROK_313","vt":"str"},{"t":"cont","v":"ERR_NGROK_320","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":1460,"y":1040,"wires":[["71ac1e37.e3b71","41dceeff.d7424"],["97a6afdb.4a884","41dceeff.d7424"],["e9293d09.b25e3","41dceeff.d7424"]]},{"id":"97a6afdb.4a884","type":"change","z":"2fdd8124.05e35e","name":"ERR: Requires paid account","rules":[{"t":"set","p":"payload","pt":"msg","to":"ERROR: Custom subdomains require a paid ngrok account.","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1670,"y":1040,"wires":[["c6f9b571.2537f8"]]},{"id":"e9293d09.b25e3","type":"change","z":"2fdd8124.05e35e","name":"ERR: Subdomain not reserved","rules":[{"t":"set","p":"payload","pt":"msg","to":"ERROR: Custom subdomain not available. Reserve at <a target='blank' href=\"https://dashboard.ngrok.com/reserved\">dashboard.ngrok.com/reserved</a>","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1680,"y":1080,"wires":[["c6f9b571.2537f8"]]},{"id":"c6f9b571.2537f8","type":"mqtt out","z":"2fdd8124.05e35e","name":"","topic":"CP/MESSAGE/REMOTEACCESS","qos":"","retain":"","broker":"c1170463.5c7f8","x":1990,"y":1040,"wires":[]},{"id":"71ac1e37.e3b71","type":"change","z":"2fdd8124.05e35e","name":"ERR: Authtoken in use","rules":[{"t":"set","p":"payload","pt":"msg","to":"ERROR: A tunnel is already in use with this Authtoken.","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1650,"y":1000,"wires":[["c6f9b571.2537f8"]]},{"id":"5014d075.e57f3","type":"link in","z":"2fdd8124.05e35e","name":"Load settings2 from sqlite","links":["794a5640.1d6578"],"x":535,"y":160,"wires":[["59ca8f91.7aff9"]]},{"id":"794a5640.1d6578","type":"link out","z":"2fdd8124.05e35e","name":"Remote access settings applied","links":["5014d075.e57f3"],"x":1585,"y":1120,"wires":[]},{"id":"6d1d1ade.5487f4","type":"delay","z":"2fdd8124.05e35e","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":1470,"y":1120,"wires":[["794a5640.1d6578"]]},{"id":"41dceeff.d7424","type":"change","z":"2fdd8124.05e35e","name":"Disable RA","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"remote_access","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1620,"y":940,"wires":[["3a3cc1a1.4ee1ee"]]},{"id":"861fe173.d8f1d","type":"rbe","z":"2fdd8124.05e35e","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":1140,"y":860,"wires":[["bb6ebc9f.d7c91"]]},{"id":"998a248b.358218","type":"throttle","z":"2fdd8124.05e35e","name":"","throttleType":"time","timeLimit":"1","timeLimitType":"seconds","countLimit":0,"blockSize":0,"locked":false,"x":680,"y":420,"wires":[["19cb1b48.a85c05"]]},{"id":"cf4a966e.f868f8","type":"ui_dropdown","z":"2fdd8124.05e35e","name":"Item Type","label":"","place":"Select item","group":"7f355d52.ee5a24","order":2,"width":"3","height":"1","passthru":true,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"notif_type","x":2800,"y":800,"wires":[["f660ee71.1ff5","aa67186c.ca8078"]]},{"id":"5c6e93d8.c5933c","type":"ui_dropdown","z":"2fdd8124.05e35e","name":"Test Type","label":"","place":"Select option","group":"7f355d52.ee5a24","order":3,"width":"3","height":"1","passthru":true,"options":[{"label":"","value":"is above","type":"str"},{"label":"","value":"is below","type":"str"}],"payload":"","topic":"notif_test","x":2800,"y":920,"wires":[["f660ee71.1ff5"]]},{"id":"5e908b9c.0afec4","type":"ui_text_input","z":"2fdd8124.05e35e","name":"Value","label":"Value","group":"7f355d52.ee5a24","order":4,"width":"2","height":"1","passthru":true,"mode":"text","delay":300,"topic":"notif_value","x":2790,"y":840,"wires":[["f660ee71.1ff5"]]},{"id":"f2cf45e0.6fea48","type":"ui_button","z":"2fdd8124.05e35e","name":"Add","group":"7f355d52.ee5a24","order":6,"width":"2","height":"1","passthru":false,"label":"Add","color":"","bgcolor":"","icon":"fa-plus","payload":"","payloadType":"str","topic":"","x":2790,"y":960,"wires":[["9e269e56.8db"]]},{"id":"7961b1ab.02f1d","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":5,"width":"2","height":"1","name":"Unit","label":"","format":"{{msg.payload}}","layout":"row-left","x":2790,"y":880,"wires":[]},{"id":"f660ee71.1ff5","type":"file function","z":"2fdd8124.05e35e","name":"form_field_save.js","filename":".node-red/js/form_field_save.js","reloadfile":false,"outputs":1,"x":3010,"y":840,"wires":[[]],"info":"//\r\n// Copyright (C) 2019 Wandertech LLC\r\n//\r\n// This program is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// This program is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\r\n\r\n// Save text input values to a global context structure as the user\r\n// types into the field. This makes it easy to retrieve later when\r\n// the user selects the \"Save\" or other action button.\r\n\r\nglobal.set('form.' + msg.topic, msg.payload);\r\n\r\nreturn null;\r\n"},{"id":"bc50fc72.5c00a","type":"link out","z":"2fdd8124.05e35e","name":"Notification list changed","links":["e357c5ad.eaba18"],"x":3435,"y":960,"wires":[]},{"id":"2d3813c5.7ca87c","type":"ui_ui_control","z":"2fdd8124.05e35e","name":"Tab Selected","x":2270,"y":820,"wires":[["534dbf84.f6e35","cb62cfa5.8c3ef","1f5437da.a92028"]]},{"id":"534dbf84.f6e35","type":"change","z":"2fdd8124.05e35e","name":"Blank","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2590,"y":820,"wires":[["cf4a966e.f868f8","5c6e93d8.c5933c","5e908b9c.0afec4"]]},{"id":"cb62cfa5.8c3ef","type":"function","z":"2fdd8124.05e35e","name":"Notification List","func":"const max_rules = 12;\n\nconst tests = { 'is below': '<', 'is above': '>', 'changes': 'changes' };\nlet notifs = global.get('settings2')['notify_rules'] || [];\n\nnotifs.sort((a,b) => a.notif_type.localeCompare(b.notif_type));\n\nfor (let notif in notifs) {\n    let n = notifs[notif];\n    n.notif_testval = tests[n.notif_test] + ' ' + n.notif_value + n.notif_unit;\n}\n\nreturn [{ payload: notifs }, { enabled: notifs.length < max_rules } ];\n","outputs":2,"noerr":0,"x":2580,"y":1240,"wires":[["2dab49fe.24e916","7bdc4b3a.af9fc4","73e7dc86.68de44","a6c3ff40.3ce2","8de79367.4f83b","80e3152b.1bb128","947e5874.8df9e8","2bc76923.3ecd26","1c1264e0.d3313b","341146e1.0f1a8a","56d0a29.9dd775c","c634ebcd.21fac8","c9ed7542.c74ad8","d6837164.277f7","5d1e530f.7e208c","c17cd721.637cf8","f576e5b3.65c158","10dde211.08883e","4557abd2.2ef3a4","8d2762ea.f3f7f","c99a187.ebca2e8","841132c6.23c0a","b96d0dac.2894f","41ee666a.983e78"],["f2cf45e0.6fea48"]]},{"id":"2dab49fe.24e916","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":11,"width":"3","height":"1","name":"Type1","label":"{{msg.payload[1].notif_type}}","format":"","layout":"row-left","x":2790,"y":1120,"wires":[]},{"id":"7bdc4b3a.af9fc4","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":12,"width":"2","height":"1","name":"Test1","label":"{{msg.payload[1].notif_testval}}","format":"","layout":"row-left","x":2910,"y":1120,"wires":[]},{"id":"4ad5ec39.fab5c4","type":"ui_button","z":"2fdd8124.05e35e","name":"Delete1","group":"7f355d52.ee5a24","order":13,"width":"1","height":"1","passthru":false,"label":"","color":"#8D0000","bgcolor":"#ffffff","icon":"fa-trash fa-lg","payload":"delete","payloadType":"str","topic":"1","x":3040,"y":1120,"wires":[["a14cd88f.1a8788"]]},{"id":"73e7dc86.68de44","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":14,"width":"3","height":"1","name":"Type2","label":"{{msg.payload[2].notif_type}}","format":"","layout":"row-left","x":2790,"y":1160,"wires":[]},{"id":"a6c3ff40.3ce2","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":15,"width":"2","height":"1","name":"Test2","label":"{{msg.payload[2].notif_testval}}","format":"","layout":"row-left","x":2910,"y":1160,"wires":[]},{"id":"984ac69b.44d468","type":"ui_button","z":"2fdd8124.05e35e","name":"Delete2","group":"7f355d52.ee5a24","order":16,"width":"1","height":"1","passthru":false,"label":"","color":"#8D0000","bgcolor":"#ffffff","icon":"fa-trash fa-lg","payload":"delete","payloadType":"str","topic":"2","x":3040,"y":1160,"wires":[["a14cd88f.1a8788"]]},{"id":"8de79367.4f83b","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":17,"width":"3","height":"1","name":"Type3","label":"{{msg.payload[3].notif_type}}","format":"","layout":"row-left","x":2790,"y":1200,"wires":[]},{"id":"80e3152b.1bb128","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":18,"width":"2","height":"1","name":"Test3","label":"{{msg.payload[3].notif_testval}}","format":"","layout":"row-left","x":2910,"y":1200,"wires":[]},{"id":"2e8c2647.e2c12a","type":"ui_button","z":"2fdd8124.05e35e","name":"Delete3","group":"7f355d52.ee5a24","order":19,"width":"1","height":"1","passthru":false,"label":"","color":"#8D0000","bgcolor":"#ffffff","icon":"fa-trash fa-lg","payload":"delete","payloadType":"str","topic":"3","x":3040,"y":1200,"wires":[["a14cd88f.1a8788"]]},{"id":"947e5874.8df9e8","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":20,"width":"3","height":"1","name":"Type4","label":"{{msg.payload[4].notif_type}}","format":"","layout":"row-left","x":2790,"y":1240,"wires":[]},{"id":"2bc76923.3ecd26","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":21,"width":"2","height":"1","name":"Test4","label":"{{msg.payload[4].notif_testval}}","format":"","layout":"row-left","x":2910,"y":1240,"wires":[]},{"id":"582295cf.dfd3fc","type":"ui_button","z":"2fdd8124.05e35e","name":"Delete4","group":"7f355d52.ee5a24","order":22,"width":"1","height":"1","passthru":false,"label":"","color":"#8D0000","bgcolor":"#ffffff","icon":"fa-trash fa-lg","payload":"delete","payloadType":"str","topic":"4","x":3040,"y":1240,"wires":[["a14cd88f.1a8788"]]},{"id":"1c1264e0.d3313b","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":23,"width":"3","height":"1","name":"Type5","label":"{{msg.payload[5].notif_type}}","format":"","layout":"row-left","x":2790,"y":1280,"wires":[]},{"id":"341146e1.0f1a8a","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":24,"width":"2","height":"1","name":"Test5","label":"{{msg.payload[5].notif_testval}}","format":"","layout":"row-left","x":2910,"y":1280,"wires":[]},{"id":"252de61b.38726a","type":"ui_button","z":"2fdd8124.05e35e","name":"Delete5","group":"7f355d52.ee5a24","order":25,"width":"1","height":"1","passthru":false,"label":"","color":"#8D0000","bgcolor":"#ffffff","icon":"fa-trash fa-lg","payload":"delete","payloadType":"str","topic":"5","x":3040,"y":1280,"wires":[["a14cd88f.1a8788"]]},{"id":"56d0a29.9dd775c","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":26,"width":"3","height":"1","name":"Type6","label":"{{msg.payload[6].notif_type}}","format":"","layout":"row-left","x":2790,"y":1320,"wires":[]},{"id":"c634ebcd.21fac8","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":27,"width":"2","height":"1","name":"Test6","label":"{{msg.payload[6].notif_testval}}","format":"","layout":"row-left","x":2910,"y":1320,"wires":[]},{"id":"ae9136db.e2dc08","type":"ui_button","z":"2fdd8124.05e35e","name":"Delete6","group":"7f355d52.ee5a24","order":28,"width":"1","height":"1","passthru":false,"label":"","color":"#8D0000","bgcolor":"#ffffff","icon":"fa-trash fa-lg","payload":"delete","payloadType":"str","topic":"6","x":3040,"y":1320,"wires":[["a14cd88f.1a8788"]]},{"id":"c9ed7542.c74ad8","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":29,"width":"3","height":"1","name":"Type7","label":"{{msg.payload[7].notif_type}}","format":"","layout":"row-left","x":2790,"y":1360,"wires":[]},{"id":"d6837164.277f7","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":30,"width":"2","height":"1","name":"Test7","label":"{{msg.payload[7].notif_testval}}","format":"","layout":"row-left","x":2910,"y":1360,"wires":[]},{"id":"cf0d028.30c63","type":"ui_button","z":"2fdd8124.05e35e","name":"Delete7","group":"7f355d52.ee5a24","order":31,"width":"1","height":"1","passthru":false,"label":"","color":"#8D0000","bgcolor":"#ffffff","icon":"fa-trash fa-lg","payload":"delete","payloadType":"str","topic":"7","x":3040,"y":1360,"wires":[["a14cd88f.1a8788"]]},{"id":"5d1e530f.7e208c","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":32,"width":"3","height":"1","name":"Type8","label":"{{msg.payload[8].notif_type}}","format":"","layout":"row-left","x":2790,"y":1400,"wires":[]},{"id":"c17cd721.637cf8","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":33,"width":"2","height":"1","name":"Test8","label":"{{msg.payload[8].notif_testval}}","format":"","layout":"row-left","x":2910,"y":1400,"wires":[]},{"id":"eda7b8e3.9d3dd8","type":"ui_button","z":"2fdd8124.05e35e","name":"Delete8","group":"7f355d52.ee5a24","order":34,"width":"1","height":"1","passthru":false,"label":"","color":"#8D0000","bgcolor":"#ffffff","icon":"fa-trash fa-lg","payload":"delete","payloadType":"str","topic":"8","x":3040,"y":1400,"wires":[["a14cd88f.1a8788"]]},{"id":"f576e5b3.65c158","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":35,"width":"3","height":"1","name":"Type9","label":"{{msg.payload[9].notif_type}}","format":"","layout":"row-left","x":2790,"y":1440,"wires":[]},{"id":"10dde211.08883e","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":36,"width":"2","height":"1","name":"Test9","label":"{{msg.payload[9].notif_testval}}","format":"","layout":"row-left","x":2910,"y":1440,"wires":[]},{"id":"bd303ab1.796f48","type":"ui_button","z":"2fdd8124.05e35e","name":"Delete9","group":"7f355d52.ee5a24","order":37,"width":"1","height":"1","passthru":false,"label":"","color":"#8D0000","bgcolor":"#ffffff","icon":"fa-trash fa-lg","payload":"delete","payloadType":"str","topic":"9","x":3040,"y":1440,"wires":[["a14cd88f.1a8788"]]},{"id":"4557abd2.2ef3a4","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":8,"width":"3","height":"1","name":"Type0","label":"{{msg.payload[0].notif_type}}","format":"","layout":"row-left","x":2790,"y":1080,"wires":[]},{"id":"8d2762ea.f3f7f","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":9,"width":"2","height":"1","name":"Test0","label":"{{msg.payload[0].notif_testval}}","format":"","layout":"row-left","x":2910,"y":1080,"wires":[]},{"id":"6b362347.21e69c","type":"ui_button","z":"2fdd8124.05e35e","name":"Delete0","group":"7f355d52.ee5a24","order":10,"width":"1","height":"1","passthru":false,"label":"","color":"#8D0000","bgcolor":"#ffffff","icon":"fa-trash fa-lg","payload":"delete","payloadType":"str","topic":"0","x":3040,"y":1080,"wires":[["a14cd88f.1a8788"]]},{"id":"a14cd88f.1a8788","type":"function","z":"2fdd8124.05e35e","name":"Delete Notification","func":"// Remove a notification rule, update the settings on disk,\n// and refresh the list.\n\nlet notifs = global.get('settings2')['notify_rules'] || [];\nnotifs.splice(msg.topic, 1);  // This changes in global context\n\nreturn { topic: 'notify_rules', payload: JSON.stringify(notifs) };","outputs":1,"noerr":0,"x":3270,"y":1160,"wires":[["bc50fc72.5c00a","cb62cfa5.8c3ef"]]},{"id":"a21456d1.3b7bb8","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":7,"width":"0","height":"0","name":"Your notification rules:","label":"","format":"Your notification rules:","layout":"row-center","x":2840,"y":1040,"wires":[]},{"id":"72269b85.831204","type":"link in","z":"2fdd8124.05e35e","name":"Set remote access fields","links":["b8e34e9a.dc367"],"x":2375,"y":180,"wires":[["a41f2c1.cca1ad","9a43afe.4e3335","17af52d.10478ad","b028ecd6.261778","74511b5e.c45cf4","327053dc.38f1ec","6c4a8998.9efa5"]]},{"id":"77c64da5.a00b14","type":"ui_template","z":"2fdd8124.05e35e","group":"d0c7f134.375fd","name":"Notification Intro","order":1,"width":"","height":"","format":"<div layout=\"column\" layout-align=\"space-between\">\n<p><b>Internet Connection Requirement:</b></p>\n<p>Notifications require an active Internet connection. See 'Network Information' in the 'System' tab to check your network status.</p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":2820,"y":100,"wires":[[]]},{"id":"a41f2c1.cca1ad","type":"change","z":"2fdd8124.05e35e","name":"settings2.pushover_key","rules":[{"t":"set","p":"payload","pt":"msg","to":"$globalContext('settings2.pushover_key')","tot":"jsonata"},{"t":"set","p":"form.pushover_key","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2570,"y":180,"wires":[[]]},{"id":"be01f371.8350a","type":"http request","z":"2fdd8124.05e35e","name":"Post to Pushover","method":"POST","ret":"txt","url":"https://api.pushover.net/1/messages.json","x":3330,"y":220,"wires":[[]]},{"id":"e6cb6cf.8a4b99","type":"function","z":"2fdd8124.05e35e","name":"Test Notification Message","func":"let message = \"Hi! This is a test notification from eRVin to Pushover.\\n\\n\";\nmessage = message + \"You can control your notification sounds, quiet hours, and other \";\nmessage = message + \"options in the Pushover app on your phone or tablet.\";\n\nmsg.headers = {\n    \"content-type\": \"application/x-www-form-urlencoded\"\n};\n\nmsg.payload = { \n    user: global.get('settings2')['pushover_key'],\n    token: 'afvtrcguexvtutk7orsc41m1fcw42i',\n    title: 'eRVin Test Notification',\n    message: message,\n};\n\nreturn msg;","outputs":1,"noerr":0,"x":3090,"y":220,"wires":[["be01f371.8350a"]]},{"id":"42a33c7d.d713f4","type":"sqlite","z":"2fdd8124.05e35e","mydb":"b2130e68.3a338","sql":"","name":"CoachProxy","x":890,"y":120,"wires":[["fdb3c34f.12887"]]},{"id":"6cb7aeff.ab5aa","type":"template","z":"2fdd8124.05e35e","name":"Load configs","field":"topic","fieldType":"msg","format":"handlebars","syntax":"plain","template":"select * from configs;","output":"str","x":690,"y":120,"wires":[["42a33c7d.d713f4"]]},{"id":"fdb3c34f.12887","type":"function","z":"2fdd8124.05e35e","name":"Store configs","func":"for (var i = 0; i < (msg.payload).length; i++) {\n    var key = msg.payload[i].key;\n    var value = msg.payload[i].value;\n    global.set('configs.' + key, value);\n}\n\n// Returning NULL would terminate the flow, but other\n// nodes want to know when settings have been loaded.\nreturn {};","outputs":1,"noerr":0,"x":1070,"y":120,"wires":[[]]},{"id":"87e329fa.cd01d8","type":"ui_template","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","name":"Notification Rule Info","order":1,"width":"","height":"","format":"<div>\n<p>Create customized rules below to be notified when values change:</p>\n<p>&nbsp;</p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":2840,"y":760,"wires":[[]]},{"id":"4d673358.e0d70c","type":"http request","z":"2fdd8124.05e35e","name":"Post to Pushover","method":"POST","ret":"txt","url":"https://api.pushover.net/1/messages.json","tls":"","x":3390,"y":1700,"wires":[[]]},{"id":"93012ad8.0aea38","type":"mqtt out","z":"2fdd8124.05e35e","name":"","topic":"GLOBAL/MESSAGE","qos":"","retain":"","broker":"c1170463.5c7f8","x":3400,"y":1660,"wires":[]},{"id":"1f5437da.a92028","type":"file function","z":"2fdd8124.05e35e","name":"notification_menu_options.js","filename":".node-red/js/notification_menu_options.js","reloadfile":false,"outputs":1,"x":2540,"y":780,"wires":[["cf4a966e.f868f8"]],"info":"//\r\n// Copyright (C) 2019 Wandertech LLC\r\n//\r\n// This program is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// This program is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\r\n\r\n// Populate the \"Notification Type\" menu with appropriate options\r\n// based on the user's choice of coach and options.\r\n\r\nconst configs = global.get('configs');\r\nconst features = global.get('features')[configs.year][configs.model]['Default'];\r\nconst ac_source = global.get('status').power.ac_source;\r\n\r\nlet options = [];\r\n\r\n// Tanks\r\noptions.push('Tank: Fresh');\r\noptions.push('Tank: Grey');\r\noptions.push('Tank: Black');\r\nif (configs.lpg === 'true') {\r\n    options.push('Tank: LPG');\r\n}\r\n\r\n// Batteries\r\noptions.push('Batt: House');\r\nif (configs.batt_chassis === 'true') {\r\n    options.push('Batt: Chassis');\r\n}\r\n\r\n// Temps\r\nif (configs.tstats === 'true') {\r\n    options.push('Temp: Front');\r\n    if (configs.thirdtstat === 'true') {\r\n        options.push('Temp: Mid');\r\n    }\r\n    options.push('Temp: Rear');\r\n    if (configs.exttemp === 'true') {\r\n        options.push('Temp: Wet Bay');\r\n    }\r\n}\r\n\r\n// Toggles\r\n\r\nif (ac_source) {\r\n  options.push('AC Power');\r\n}\r\nif (features.Ignition == 1) {\r\n    options.push('Ignition');\r\n}\r\nif (features.GeneratorStatus == 1) {\r\n    options.push('Generator');\r\n}\r\n\r\nmsg = { options: options, payload: null, topic: null };\r\nreturn msg;\r\n\r\n"},{"id":"aa67186c.ca8078","type":"file function","z":"2fdd8124.05e35e","name":"notification_submenu_options.js","filename":".node-red/js/notification_submenu_options.js","reloadfile":false,"outputs":3,"x":2530,"y":880,"wires":[["5e908b9c.0afec4"],["7961b1ab.02f1d","f660ee71.1ff5"],["5c6e93d8.c5933c"]],"info":"//\r\n// Copyright (C) 2019 Wandertech LLC\r\n//\r\n// This program is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// This program is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\r\n\r\n// Once a user chooses a notification type when creating a new rule, populate\r\n// the submenus (test case, test value) with sensible options and default values.\r\n\r\nconst values = { 'tank': '67', 'batt': '11.8', 'temp': '85', 'wet': '40' };\r\nconst units = { 'tank': '%', 'batt': 'V', 'temp': 'F', 'wet': 'F' };\r\nconst tests = { 'tank': 'is above', 'batt': 'is below', 'temp': 'is above', 'wet': 'is below' };\r\n\r\nvar msg_value = { topic: 'notif_value' };\r\nvar msg_unit  = { topic: 'notif_unit' };\r\nvar msg_test  = { topic: 'notif_test', payload: \"is above\" };\r\n\r\nmsg.topic = null; // Required to block existing topic from passing through\r\n\r\n// Update default value, unit, and test for numeric rules\r\nfor (let key in values) {\r\n  if (msg.payload && msg.payload.toLowerCase().includes(key)) {\r\n    msg_test.options = ['is above', 'is below'];\r\n    msg_test.payload = tests[key];\r\n    msg_value.payload = values[key];\r\n    msg_value.enabled = true;\r\n    msg_unit.payload = units[key];\r\n  }\r\n}\r\n\r\n// Update menus for non-numeric rules (e.g. Ignition)\r\nconst toggles = ['AC Power', 'Ignition', 'Generator'];\r\nif (toggles.includes(msg.payload)) {\r\n  msg_test.options = ['changes'];\r\n  msg_test.payload = 'changes';\r\n  msg_value.payload = '';\r\n  msg_value.enabled = false;\r\n  msg_unit.payload = '';\r\n}\r\n\r\nreturn [msg_value, msg_unit, msg_test];\r\n"},{"id":"9e269e56.8db","type":"file function","z":"2fdd8124.05e35e","name":"notification_save.js","filename":".node-red/js/notification_save.js","reloadfile":false,"outputs":1,"x":3010,"y":960,"wires":[["bc50fc72.5c00a","cb62cfa5.8c3ef"]],"info":"//\r\n// Copyright (C) 2019 Wandertech LLC\r\n//\r\n// This program is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// This program is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\r\n\r\n// After the user has defined a new notification rule, save it to the\r\n// database.\r\n\r\nvar notifs = global.get('settings2')['notify_rules'] || [];\r\nvar notif = {};\r\n\r\nconst topics = [\r\n    'notif_type',\r\n    'notif_test',\r\n    'notif_value',\r\n    'notif_unit'\r\n];\r\n\r\ntopics.forEach(function(topic) {\r\n  const value = global.get('form')[topic] || '';\r\n  notif[topic] = value;\r\n});\r\n\r\n// If a value is required but not present, give up.\r\nif (notif['notif_test'] != 'changes' && (notif['notif_value'] === '' || isNaN(notif['notif_value']))) {\r\n  msg = null;\r\n} else {\r\n  notifs.push(notif);\r\n  notifs.sort((a,b) => a.notif_type.localeCompare(b.notif_type));\r\n\r\n  // Delete \"notif_state\" for existing toggle rules (e.g. \"generator\") so\r\n  // their current state doesn't get saved to the database along with the rule.\r\n  notifs.forEach(function(n) {\r\n    delete n.notif_state;\r\n  });\r\n\r\n  msg = { topic: 'notify_rules', payload: JSON.stringify(notifs) };\r\n}\r\n\r\nreturn msg;\r\n\r\n"},{"id":"2ad4a4a5.c0435c","type":"link out","z":"2fdd8124.05e35e","name":"Notification list changed","links":["e357c5ad.eaba18"],"x":3255,"y":520,"wires":[]},{"id":"841132c6.23c0a","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":38,"width":"3","height":"1","name":"Type10","label":"{{msg.payload[10].notif_type}}","format":"","layout":"row-left","x":2800,"y":1480,"wires":[]},{"id":"c99a187.ebca2e8","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":39,"width":"2","height":"1","name":"Test10","label":"{{msg.payload[10].notif_testval}}","format":"","layout":"row-left","x":2930,"y":1480,"wires":[]},{"id":"12e77b35.cc70e5","type":"ui_button","z":"2fdd8124.05e35e","name":"Delete10","group":"7f355d52.ee5a24","order":40,"width":"1","height":"1","passthru":false,"label":"","color":"#8D0000","bgcolor":"#ffffff","icon":"fa-trash fa-lg","payload":"delete","payloadType":"str","topic":"10","x":3060,"y":1480,"wires":[["a14cd88f.1a8788"]]},{"id":"b96d0dac.2894f","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":41,"width":"3","height":"1","name":"Type11","label":"{{msg.payload[11].notif_type}}","format":"","layout":"row-left","x":2800,"y":1520,"wires":[]},{"id":"41ee666a.983e78","type":"ui_text","z":"2fdd8124.05e35e","group":"7f355d52.ee5a24","order":42,"width":"2","height":"1","name":"Test11","label":"{{msg.payload[11].notif_testval}}","format":"","layout":"row-left","x":2930,"y":1520,"wires":[]},{"id":"961b28dd.9a6368","type":"ui_button","z":"2fdd8124.05e35e","name":"Delete11","group":"7f355d52.ee5a24","order":43,"width":"1","height":"1","passthru":false,"label":"","color":"#8D0000","bgcolor":"#ffffff","icon":"fa-trash fa-lg","payload":"delete","payloadType":"str","topic":"11","x":3060,"y":1520,"wires":[["a14cd88f.1a8788"]]},{"id":"9ed0f068.bea57","type":"mqtt in","z":"2fdd8124.05e35e","name":"","topic":"CP/TANK_STATUS/#","qos":"2","broker":"c1170463.5c7f8","inputs":0,"x":2610,"y":1600,"wires":[["a588a38c.08e74"]]},{"id":"bb30fcde.3966a","type":"mqtt in","z":"2fdd8124.05e35e","name":"","topic":"CP/IGNITION","qos":"2","broker":"c1170463.5c7f8","inputs":0,"x":2630,"y":1740,"wires":[["aa0e517d.843a4"]]},{"id":"c1cc6bc8.971ed8","type":"mqtt in","z":"2fdd8124.05e35e","name":"","topic":"CP/PARKBRAKE","qos":"2","broker":"c1170463.5c7f8","inputs":0,"x":2620,"y":1780,"wires":[["aa0e517d.843a4"]]},{"id":"a193cfb7.3d38","type":"mqtt in","z":"2fdd8124.05e35e","name":"","topic":"CP/GENERATOR","qos":"2","broker":"c1170463.5c7f8","inputs":0,"x":2620,"y":1820,"wires":[["aa0e517d.843a4"]]},{"id":"a588a38c.08e74","type":"file function","z":"2fdd8124.05e35e","name":"notification_value_monitor.js","filename":".node-red/js/notification_value_monitor.js","reloadfile":false,"outputs":1,"x":2880,"y":1640,"wires":[["b2a6e1f.56d592"]],"info":"//\r\n// Copyright (C) 2019 Wandertech LLC\r\n//\r\n// This program is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// This program is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\r\n\r\n// Monitor MQTT topics for values that are outside the desired range (e.g.\r\n// battery voltage below 11.8 V). To prevent frequent notifications around\r\n// alarm thresholds (e.g. voltage may fluctuate from 11.7 to 11.8 for a while),\r\n// a value must be out of range (faulted) for a certain time before an alarm\r\n// is sent (triggered), and then must be within the valid range (recovering)\r\n// for a certain time before the alarm is considered cleared.\r\n//\r\n//           good value                           bad value\r\n//      +------------------+                 +------------------------+\r\n//      |                  |    >30 sec      |                        |\r\n//      v      bad         |      bad        v         good           |\r\n// +---------+ value +---------+ value  +-----------+  value   +------------+\r\n// | cleared |------>| faulted |------->| triggered |--------->| recovering |\r\n// +---------+       +---------+        +-----------+          +------------+\r\n//    ^   ^                                  |              good value|\r\n//    |   |             >24 hours            |                  >5 min|\r\n//    |   +----------------------------------+                        |\r\n//    +---------------------------------------------------------------+\r\n\r\nconst topics = {\r\n  'Tank: Fresh': 'CP/TANK_STATUS/Fresh',\r\n  'Tank: Grey': 'CP/TANK_STATUS/Grey',\r\n  'Tank: Black': 'CP/TANK_STATUS/Black',\r\n  'Temp: Front': 'CP/THERMISTOR_TEMP/Front',\r\n  'Temp: Mid': 'CP/THERMISTOR_TEMP/Mid',\r\n  'Temp: Rear': 'CP/THERMISTOR_TEMP/Rear',\r\n  'Temp: Wet Bay': 'CP/THERMISTOR_TEMP/Wet Bay',\r\n  'Batt: House': 'CP/BATTERY_VOLTS/House',\r\n  'Batt: Chassis': 'CP/BATTERY_VOLTS/Chassis',\r\n};\r\n\r\nconst fault_timeout   = 30 * 1000;      // receive bad messages for 30 seconds before alarming\r\nconst recover_timeout = 5 * 60 * 1000;  // receive good messages for 5 minutes before clearing\r\nconst trigger_timeout = 24 * 60 * 60 * 1000; // reset alarm after 24 hours even with bad messages\r\n\r\nlet notifs = global.get('settings2')['notify_rules'] || [];\r\nlet ignition = global.get('status').chassis.ignition || 'off';\r\nlet messages = [];\r\n\r\n// Check each notification rule\r\nfor (let notif in notifs) {\r\n  let n = notifs[notif];\r\n  let status = n.notif_status || 'cleared';\r\n\r\n  // If the current message topic matches a notification rule, process the rule.\r\n  // Exception: ignore tanks when the ignition is on.\r\n  if (topics[n.notif_type] == msg.topic && (ignition == 'off' || (msg.topic).includes('TANK') == false)) {\r\n\r\n    let oldstatus = status;\r\n\r\n    // Check whether the current value is outside the desired range\r\n    let outofrange = false;\r\n    if ((n.notif_test == 'is below' && parseFloat(msg.payload) < parseFloat(n.notif_value)) ||\r\n      (n.notif_test == 'is above' && parseFloat(msg.payload) > parseFloat(n.notif_value))) {\r\n      outofrange = true;\r\n    }\r\n\r\n    // Perform actions based on which state the rule is currently in\r\n    switch (status) {\r\n      case 'cleared':\r\n        if (outofrange) {\r\n          status = 'faulted';\r\n          n.fault_time = Date.now();\r\n        }\r\n        break;\r\n      case 'faulted':\r\n        if (!outofrange) {\r\n          status = 'cleared';\r\n        } else if (Date.now() - n.fault_time > fault_timeout) {\r\n          status = 'triggered';\r\n          n.trigger_time = Date.now();\r\n          let message = n.notif_type + ' is currently ' + msg.payload + n.notif_unit;\r\n          message += ' which ' + n.notif_test;\r\n          message += ' your threshold of ' + n.notif_value + n.notif_unit + \".\\n\";\r\n          let newmsg = {\r\n            subject: 'CoachProxy ALERT for ' + n.notif_type,\r\n            payload: message,\r\n          }\r\n          messages.push(newmsg);\r\n        }\r\n        break;\r\n      case 'triggered':\r\n        if (!outofrange) {\r\n          status = 'recovering';\r\n          n.recover_time = Date.now();\r\n        } else if (Date.now() - n.trigger_time > trigger_timeout) {\r\n          status = 'cleared';\r\n        }\r\n        break;\r\n      case 'recovering':\r\n        if (outofrange) {\r\n          status = 'triggered';\r\n          n.trigger_time - Date.now();\r\n        } else if (Date.now() - n.recover_time > recover_timeout) {\r\n          status = 'cleared';\r\n        }\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    n.notif_status = status;\r\n  }\r\n}\r\n\r\nreturn messages;\r\n"},{"id":"b2a6e1f.56d592","type":"file function","z":"2fdd8124.05e35e","name":"notification_deliver.js","filename":".node-red/js/notification_deliver.js","reloadfile":false,"outputs":3,"x":3160,"y":1700,"wires":[["93012ad8.0aea38"],[],["b1b6ffec.c0e758"]],"info":"//\r\n// Copyright (C) 2019 Wandertech LLC\r\n//\r\n// This program is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// This program is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\r\n\r\n// Take a notification message as input, and deliver it via a variety of\r\n// methods based on the user's settings.\r\n\r\nlet generic_msg = msg;\r\nlet push_msg = {};\r\nlet email_msg = {};\r\n\r\nmsg.topic = null;  // Block existing topic from passing through\r\n\r\n// Pushover message\r\n\r\nlet pushover_key = global.get('settings2')['pushover_key'];\r\nif (pushover_key) {\r\n    push_msg.headers = { \"content-type\": \"application/x-www-form-urlencoded\" };\r\n    push_msg.payload = {\r\n        user: pushover_key,\r\n        token: 'afvtrcguexvtutk7orsc41m1fcw42i',\r\n        title: msg.subject,\r\n        message: msg.payload,\r\n    };\r\n}\r\n\r\n// Email message\r\n\r\nlet smtp_host = global.get('settings2')['smtp_host'];\r\nlet smtp_port = global.get('settings2')['smtp_port'];\r\nlet smtp_user = global.get('settings2')['smtp_user'];\r\nlet smtp_pass = global.get('settings2')['smtp_password'];\r\n\r\nlet transport = {};\r\ntransport.host = smtp_host;\r\ntransport.port = smtp_port;\r\ntransport.auth = {};\r\ntransport.auth.user = smtp_user;\r\ntransport.auth.pass = smtp_pass;\r\n\r\nlet email1 = global.get('settings2')['notify_email1'];\r\nlet email2 = global.get('settings2')['notify_email2'];\r\n\r\nlet options = {};\r\noptions.from = smtp_user;\r\noptions.subject = msg.subject;\r\noptions.text = msg.payload;\r\n\r\n// If the user only added email2, change it to email1\r\nif (email2 && !email1) {\r\n    email1 = email2;\r\n    email2 = '';\r\n}\r\n\r\nif (email1) {\r\n    options.to = email1;\r\n    if (email2) {\r\n        options.to += ',' + email2;\r\n    }\r\n\r\n  email_msg = { 'mail': { 'transport': transport, 'options': options } };\r\n}\r\n\r\n// Deliver\r\n\r\nreturn [msg, push_msg, email_msg];\r\n"},{"id":"1fb31163.03642f","type":"mqtt in","z":"2fdd8124.05e35e","name":"","topic":"CP/THERMISTOR_TEMP/#","qos":"2","broker":"c1170463.5c7f8","inputs":0,"x":2590,"y":1640,"wires":[["a588a38c.08e74"]]},{"id":"aa0e517d.843a4","type":"file function","z":"2fdd8124.05e35e","name":"notification_state_monitor.js","filename":".node-red/js/notification_state_monitor.js","reloadfile":false,"outputs":1,"x":2880,"y":1800,"wires":[["b2a6e1f.56d592"]],"info":"//\r\n// Copyright (C) 2019 Wandertech LLC\r\n//\r\n// This program is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// This program is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\r\n\r\n// Monitor certain MQTT topics for a change in state (e.g. \"ignition\"\r\n// changing from \"off\" to \"on\") and send a notification. If too many\r\n// notifications are sent within a short time, enter a long \"backoff\"\r\n// phase where no notifications for the topic will be sent.\r\n\r\nconst topics = {\r\n  'Ignition': 'CP/IGNITION',\r\n  'Park Brake': 'CP/PARKBRAKE',\r\n  'Generator': 'CP/GENERATOR',\r\n  'AC Power': 'CP/AC_SOURCE',\r\n};\r\n\r\n// Pause for <pause_time> if <max_messages> are sent in <max_interval> for a topic.\r\n// Defaults: Pause for 60 minutes if 8 messages are sent within 5 minutes\r\nconst pause_time = 60 * 60 * 1000;\r\nconst max_messages = 8;\r\nconst max_interval = 5 * 60 * 1000;\r\n\r\nlet notifs = global.get('settings2')['notify_rules'] || [];\r\nlet newmsg = null;\r\n\r\n// Check each notification rule\r\nfor (let notif in notifs) {\r\n  let n = notifs[notif];\r\n\r\n  // If the current message topic matches a notification rule, process the rule\r\n  if (topics[n.notif_type] == msg.topic) {\r\n\r\n    // Look up the previous state of this topic. If this is the first time\r\n    // receiving a message for the topic, set it to the current state to\r\n    // prevent sending an alarm each time CoachProxy starts up.\r\n    let prev_state = n.notif_state || msg.payload;\r\n\r\n    // Look up the count of alarms sent recently for this topic\r\n    let count = n.notif_count || 0;\r\n\r\n    // Look up the start of the current backoff interval\r\n    let interval_start = n.notif_interval || Date.now();\r\n\r\n    // If notifications are paused, see if it's time to release them\r\n    if (n.notif_pause && Date.now() - n.notif_pause > pause_time) {\r\n      n.notif_pause = null;\r\n    }\r\n\r\n    // If the current interval is over, clear it out\r\n    if (Date.now() - interval_start > max_interval) {\r\n      count = 0;\r\n      n.notif_count = 0;\r\n      n.notif_interval = null;\r\n    }\r\n\r\n    // Alarm if the current value is different from the previous value.\r\n    if (msg.payload != prev_state && !n.notif_pause) {\r\n      count++;\r\n\r\n      // If it's over its threshold, start the pause clock, otherwise send alarm.\r\n      if (count > max_messages) {\r\n        newmsg = {};\r\n        newmsg.payload = 'Too many notifications being sent for ' + n.notif_type + '. ';\r\n        newmsg.payload += 'Pausing for ' + (pause_time / 60 / 1000) + \" minutes.\\n\";\r\n        newmsg.subject = 'eRVin ALERT for ' + n.notif_type;\r\n\r\n        n.notif_pause = Date.now();\r\n        n.notif_count = 0;\r\n        n.notif_interval = null;\r\n      } else {\r\n        newmsg = {};\r\n        newmsg.payload = n.notif_type + ' has changed from ' + prev_state + ' to ' + msg.payload + \".\\n\";\r\n        newmsg.subject = 'eRVin ALERT for ' + n.notif_type;\r\n\r\n        if (count == 1) {\r\n          n.notif_interval = Date.now();\r\n        }\r\n        n.notif_count = count;\r\n      }\r\n    }\r\n\r\n    // Update the latest state\r\n    n.notif_state = msg.payload;\r\n  }\r\n}\r\n\r\nreturn newmsg;\r\n"},{"id":"40b105ea.d78cfc","type":"mqtt in","z":"2fdd8124.05e35e","name":"","topic":"CP/BATTERY_VOLTS/#","qos":"2","broker":"c1170463.5c7f8","inputs":0,"x":2600,"y":1680,"wires":[["a588a38c.08e74"]]},{"id":"1839ea35.17c7f6","type":"mqtt in","z":"2fdd8124.05e35e","name":"","topic":"CP/AC_SOURCE","qos":"2","broker":"c1170463.5c7f8","inputs":0,"x":2620,"y":1860,"wires":[["aa0e517d.843a4"]]},{"id":"9a43afe.4e3335","type":"change","z":"2fdd8124.05e35e","name":"settings2.notify_email1","rules":[{"t":"set","p":"payload","pt":"msg","to":"$globalContext('settings2.notify_email1')","tot":"jsonata"},{"t":"set","p":"form.notify_email1","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2560,"y":320,"wires":[["373fb080.8bb7d"]]},{"id":"17af52d.10478ad","type":"change","z":"2fdd8124.05e35e","name":"settings2.notify_email2","rules":[{"t":"set","p":"payload","pt":"msg","to":"$globalContext('settings2.notify_email2')","tot":"jsonata"},{"t":"set","p":"form.notify_email2","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2560,"y":360,"wires":[["d8776ddc.8befd"]]},{"id":"373fb080.8bb7d","type":"ui_text_input","z":"2fdd8124.05e35e","name":"Email Address 1","label":"Email Address 1","group":"9ed66528.add608","order":2,"width":"","height":"","passthru":true,"mode":"email","delay":"300","topic":"notify_email1","x":2820,"y":320,"wires":[["1da8be4f.944f22"]]},{"id":"d8776ddc.8befd","type":"ui_text_input","z":"2fdd8124.05e35e","name":"Email Address 2","label":"Email Address 2","group":"9ed66528.add608","order":3,"width":"","height":"","passthru":true,"mode":"email","delay":"300","topic":"notify_email2","x":2820,"y":360,"wires":[["1da8be4f.944f22"]]},{"id":"27078391.774bbc","type":"ui_button","z":"2fdd8124.05e35e","name":"","group":"9ed66528.add608","order":4,"width":"3","height":"1","label":"Save","color":"","icon":"fa-check","payload":"save","payloadType":"str","topic":"commit","x":2790,"y":400,"wires":[["cfc33f37.56acf"]]},{"id":"967644d2.773408","type":"ui_button","z":"2fdd8124.05e35e","name":"","group":"9ed66528.add608","order":5,"width":"3","height":"1","label":"Undo","color":"","icon":"fa-times","payload":"undo","payloadType":"str","topic":"commit","x":2330,"y":340,"wires":[["9a43afe.4e3335","17af52d.10478ad"]]},{"id":"ac861c3c.4281a","type":"ui_template","z":"2fdd8124.05e35e","group":"9ed66528.add608","name":"Email Info","order":1,"width":"0","height":"0","format":"<div layout=\"column\" layout-align=\"space-between\">\n<p><b>E-mail Notification Setup:</b></p>\n<p>Enter up to two addresses to deliver notifications to:</p>\n<br>\n<p><b>To Receive Notifications via Text:</b></p>\n<p style=\"font-size:80%;\"><b>Verizon:</b> phone#@vtext.com<br>\n<b>AT&T:</b> phone#@txt.att<br>\n<b>TMobile:</b> phone#@tmomail.net<br>\n<b>Sprint:</b> phone#@messaging.sprintpcs.com\n</p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":2800,"y":280,"wires":[[]]},{"id":"1da8be4f.944f22","type":"file function","z":"2fdd8124.05e35e","name":"form_field_save.js","filename":".node-red/js/form_field_save.js","reloadfile":false,"outputs":1,"x":3070,"y":340,"wires":[[]]},{"id":"cfc33f37.56acf","type":"function","z":"2fdd8124.05e35e","name":"Save Email Settings","func":"const topics = ['notify_email1', 'notify_email2'];\nvar msgs = [];\n\ntopics.forEach(function(topic) {\n  const value = global.get('form')[topic] || '';\n  const newmsg = { topic: topic, payload: value };\n  msgs.push(newmsg);\n});\n\nreturn [ msgs ];\n","outputs":1,"noerr":0,"x":3080,"y":400,"wires":[["2ad4a4a5.c0435c"]]},{"id":"73d80bb.31573f4","type":"comment","z":"2fdd8124.05e35e","name":"INSERT PUSHOVER NODES HERE","info":"","x":2860,"y":180,"wires":[]},{"id":"b028ecd6.261778","type":"change","z":"2fdd8124.05e35e","name":"settings2.smtp_host","rules":[{"t":"set","p":"payload","pt":"msg","to":"$globalContext('settings2.smtp_host')","tot":"jsonata"},{"t":"set","p":"form.smtp_host","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2560,"y":500,"wires":[["2beb48cd.bc9f1"]]},{"id":"74511b5e.c45cf4","type":"change","z":"2fdd8124.05e35e","name":"settings2.smtp_port","rules":[{"t":"set","p":"payload","pt":"msg","to":"$globalContext('settings2.smtp_port')","tot":"jsonata"},{"t":"set","p":"form.smtp_port","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2560,"y":540,"wires":[["4e1f595b.06eef"]]},{"id":"327053dc.38f1ec","type":"change","z":"2fdd8124.05e35e","name":"settings2.smtp_user","rules":[{"t":"set","p":"payload","pt":"msg","to":"$globalContext('settings2.smtp_user')","tot":"jsonata"},{"t":"set","p":"form.smtp_user","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2560,"y":580,"wires":[["3a108da8.621912"]]},{"id":"6c4a8998.9efa5","type":"change","z":"2fdd8124.05e35e","name":"settings2.smtp_password","rules":[{"t":"set","p":"payload","pt":"msg","to":"$globalContext('settings2.smtp_password')","tot":"jsonata"},{"t":"set","p":"form.smtp_password","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2570,"y":620,"wires":[["a98ddc00.839c1"]]},{"id":"2beb48cd.bc9f1","type":"ui_text_input","z":"2fdd8124.05e35e","name":"SMTP Server","label":"SMTP Server Name","tooltip":"e.g. smtp.gmail.com","group":"b043acd4.87089","order":2,"width":"","height":"","passthru":true,"mode":"text","delay":"300","topic":"smtp_host","x":2810,"y":500,"wires":[["4275c6af.b94258"]]},{"id":"4e1f595b.06eef","type":"ui_text_input","z":"2fdd8124.05e35e","name":"SMTP Port","label":"SMTP Server Port","tooltip":"e.g. 587","group":"b043acd4.87089","order":3,"width":"","height":"","passthru":true,"mode":"text","delay":"300","topic":"smtp_port","x":2810,"y":540,"wires":[["4275c6af.b94258"]]},{"id":"657e579.184f228","type":"ui_button","z":"2fdd8124.05e35e","name":"","group":"b043acd4.87089","order":6,"width":"3","height":"1","label":"Save","color":"","icon":"fa-check","payload":"save","payloadType":"str","topic":"commit","x":2790,"y":660,"wires":[["9767a76d.1419a"]]},{"id":"13ab390c.eaec7f","type":"ui_template","z":"2fdd8124.05e35e","group":"b043acd4.87089","name":"SMTP Info","order":1,"width":"6","height":"2","format":"<div layout=\"column\" layout-align=\"space-between\">\n<p><b>E-mail Server Setup:</b></p>\n<p>Enter your E-mail SMTP Server information:</p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":2810,"y":460,"wires":[[]]},{"id":"3a108da8.621912","type":"ui_text_input","z":"2fdd8124.05e35e","name":"SMTP Username","label":"SMTP Username","tooltip":"","group":"b043acd4.87089","order":4,"width":"","height":"","passthru":true,"mode":"text","delay":"300","topic":"smtp_user","x":2830,"y":580,"wires":[["4275c6af.b94258"]]},{"id":"a98ddc00.839c1","type":"ui_text_input","z":"2fdd8124.05e35e","name":"SMTP Password","label":"SMTP Password","tooltip":"","group":"b043acd4.87089","order":5,"width":"","height":"","passthru":true,"mode":"text","delay":"300","topic":"smtp_password","x":2830,"y":620,"wires":[["4275c6af.b94258"]]},{"id":"4275c6af.b94258","type":"file function","z":"2fdd8124.05e35e","name":"form_field_save.js","filename":".node-red/js/form_field_save.js","reloadfile":false,"outputs":1,"x":3070,"y":560,"wires":[[]]},{"id":"9767a76d.1419a","type":"function","z":"2fdd8124.05e35e","name":"Save SMTP Settings","func":"const topics = ['smtp_host', 'smtp_port', 'smtp_user', 'smtp_password'];\nvar msgs = [];\n\ntopics.forEach(function(topic) {\n  const value = global.get('form')[topic] || '';\n  const newmsg = { topic: topic, payload: value };\n  msgs.push(newmsg);\n});\n\nreturn [ msgs ];\n","outputs":1,"noerr":0,"x":3080,"y":660,"wires":[["2ad4a4a5.c0435c"]]},{"id":"effffbd9.b9af7","type":"ui_button","z":"2fdd8124.05e35e","name":"","group":"b043acd4.87089","order":7,"width":"3","height":"1","label":"Undo","color":"","icon":"fa-times","payload":"undo","payloadType":"str","topic":"commit","x":2290,"y":560,"wires":[["b028ecd6.261778","74511b5e.c45cf4","327053dc.38f1ec","6c4a8998.9efa5"]]},{"id":"b1b6ffec.c0e758","type":"simple-sendmail","z":"2fdd8124.05e35e","name":"simple sendmail","x":3380,"y":1740,"wires":[["188160bb.3534f7"]]},{"id":"188160bb.3534f7","type":"ui_text","z":"2fdd8124.05e35e","group":"d0c7f134.375fd","order":0,"width":"6","height":"1","name":"Mail Notification Status","label":"Succeeded: {{msg.payload.accepted.length}}","format":"","layout":"col-center","x":3630,"y":1740,"wires":[]},{"id":"9ab94ac.b9e2b38","type":"ui_button","z":"2fdd8124.05e35e","name":"","group":"d0c7f134.375fd","order":2,"width":"6","height":"1","passthru":false,"label":"Send Test Message","tooltip":"","color":"","bgcolor":"green","icon":"fa-envelope-o","payload":"test","payloadType":"str","topic":"commit","x":2610,"y":1920,"wires":[["b4cc8482.ebf358"]]},{"id":"b4cc8482.ebf358","type":"change","z":"2fdd8124.05e35e","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"This is a test notification from eRVin","tot":"str"},{"t":"set","p":"subject","pt":"msg","to":"eRVin Alert!","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2920,"y":1920,"wires":[["bceb7ebc.6c1f9","b2a6e1f.56d592"]]},{"id":"bceb7ebc.6c1f9","type":"change","z":"2fdd8124.05e35e","name":"Clear output","rules":[{"t":"set","p":"payload","pt":"msg","to":"{'accepted': []}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":3130,"y":1920,"wires":[["188160bb.3534f7"]]},{"id":"ccf1905a.52a16","type":"split","z":"2fdd8124.05e35e","name":"split version","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"topic","x":490,"y":1340,"wires":[["248271cb.62ddae"]]},{"id":"248271cb.62ddae","type":"switch","z":"2fdd8124.05e35e","name":"Switch Versions","property":"topic","propertyType":"msg","rules":[{"t":"cont","v":"CoachProxy","vt":"str"},{"t":"cont","v":"eRVin","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":680,"y":1340,"wires":[["215362d2.a415de"],["ed8f62b5.c7ed48"]]},{"id":"215362d2.a415de","type":"ui_text","z":"2fdd8124.05e35e","d":true,"group":"f961f048.b0646","order":2,"width":"","height":"","name":"CoachProxy Version","label":"CoachProxy Version","format":"{{msg.payload}}","layout":"","x":960,"y":1320,"wires":[]},{"id":"6ff1784.4905788","type":"exec","z":"2fdd8124.05e35e","command":"vcgencmd measure_temp","addpay":false,"append":"","useSpawn":"","timer":"","name":"RPi Temp.","x":390,"y":2640,"wires":[["a8306e37.1aea1"],[],[]]},{"id":"b5aead74.45e12","type":"inject","z":"2fdd8124.05e35e","name":"","props":[{"p":"payload","v":"","vt":"date"},{"p":"topic","v":"","vt":"string"}],"repeat":"5","crontab":"","once":false,"topic":"","payload":"","payloadType":"date","x":190,"y":2680,"wires":[["6ff1784.4905788","72ad22de.f531cc"]]},{"id":"a8306e37.1aea1","type":"function","z":"2fdd8124.05e35e","name":"","func":"str = msg.payload\nmsg.payload = str.substring(5,9);\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":2640,"wires":[["673d497b.d99438"]]},{"id":"72ad22de.f531cc","type":"exec","z":"2fdd8124.05e35e","command":"top -d 0.5 -b -n2 | grep \"Cpu(s)\"|tail -n 1 | awk '{print $2 + $4}'","addpay":false,"append":"","useSpawn":"","timer":"","name":"CPU Load","x":390,"y":2720,"wires":[["7ca1d2d2.e6c56c"],[],[]]},{"id":"673d497b.d99438","type":"ui_text","z":"2fdd8124.05e35e","group":"97b9ad54.9933e","order":2,"width":0,"height":0,"name":"","label":"CPU Temp C","format":"{{msg.payload}}","layout":"row-spread","x":720,"y":2640,"wires":[]},{"id":"7ca1d2d2.e6c56c","type":"ui_text","z":"2fdd8124.05e35e","group":"97b9ad54.9933e","order":3,"width":0,"height":0,"name":"","label":"CPU Load %","format":"{{msg.payload}}","layout":"row-spread","x":710,"y":2720,"wires":[]},{"id":"abe22ccd.3d812","type":"file in","z":"2fdd8124.05e35e","name":"Get RPi Model","filename":"/proc/device-tree/model","format":"lines","chunk":false,"sendError":false,"x":400,"y":2800,"wires":[["23928d8.3251672"]]},{"id":"c24175b1.66b958","type":"inject","z":"2fdd8124.05e35e","name":"","props":[{"p":"payload","v":"","vt":"date"},{"p":"topic","v":"","vt":"string"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.6","topic":"","payload":"","payloadType":"date","x":190,"y":2820,"wires":[["abe22ccd.3d812","7bb0179a.03d168"]]},{"id":"23928d8.3251672","type":"ui_text","z":"2fdd8124.05e35e","group":"97b9ad54.9933e","order":1,"width":0,"height":0,"name":"RPi Model","label":"","format":"{{msg.payload}}","layout":"row-left","x":710,"y":2800,"wires":[]},{"id":"a04336c0.d5d3f8","type":"comment","z":"2fdd8124.05e35e","name":"Get Add'l Raspberry Pi Info","info":"","x":230,"y":2580,"wires":[]},{"id":"7bb0179a.03d168","type":"exec","z":"2fdd8124.05e35e","command":"lsb_release -a","addpay":false,"append":"","useSpawn":"","timer":"","name":"RPi Release","x":390,"y":2860,"wires":[["4c30c495.24846c"],[],[]]},{"id":"7db88a8b.6a59b4","type":"ui_text","z":"2fdd8124.05e35e","group":"97b9ad54.9933e","order":1,"width":0,"height":0,"name":"Raspian Version","label":"","format":"{{msg.payload}}","layout":"row-left","x":820,"y":2860,"wires":[]},{"id":"4c30c495.24846c","type":"csv","z":"2fdd8124.05e35e","name":"","sep":"\\t","hdrin":"","hdrout":"","multi":"mult","ret":"\\n","temp":"","skip":"1","strings":true,"x":570,"y":2920,"wires":[["f64cef8f.93259"]]},{"id":"f64cef8f.93259","type":"change","z":"2fdd8124.05e35e","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.0.col2","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":2860,"wires":[["7db88a8b.6a59b4"]]},{"id":"7544e81a.afed08","type":"change","z":"2fdd8124.05e35e","name":"Light List","rules":[{"t":"set","p":"lights","pt":"msg","to":"[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250]","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":260,"y":80,"wires":[["8a3a4af9.460768"]]},{"id":"61fe328c.5c91cc","type":"function","z":"2fdd8124.05e35e","name":"Init eRVin Global Context","func":"//  20201212  Rob Picchione myERVIN.com\n// \n// Checks for global variable for lat, lon, zipcode and sunset\n// If they don't exist they are initialized to default Middlebury, IN\n// If they do exist they are left alone.\n// \n// This is to support systems that do not have a GPS receiver.\n// If a GPS receiver is present and has a valid fix it will override \n// the context lat/lon with actual values (see function in Automations tab)\n\n\nif (typeof global.get('enteredzip') === 'undefined' || global.get('enteredzip') === null) {\n    global.set('enteredzip', \"46540\")\n}\n\nif (typeof global.get('lon') === 'undefined' || global.get('lon') === null) {\n    global.set('lon', -85.698192)\n}\n\nif (typeof global.get('lat') === 'undefined' || global.get('lat') === null) {\n    global.set('lat', 41.680015)\n}\n\nif (typeof global.get('sunset') === 'undefined' || global.get('sunset') === null) {\n    global.set(\"sunset.lights\", {})\n}\n\n// global.set(\"sunset.lights\", {});\n// global.set(\"sunset.lights\",[]); //array\n// global.set(\"sunset.lights\", {}); //object\n\n\nreturn null;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":310,"y":160,"wires":[[]]},{"id":"d4502958.2b9688","type":"link in","z":"2fdd8124.05e35e","name":"Reboot","links":["2fcc3be9.512344","84b16fa4.89f34","d096e4f3.6fdec8"],"x":435,"y":1840,"wires":[["4c3ea3a.8a313dc"]]},{"id":"406f7d8e.c9e964","type":"mqtt in","z":"477cac19.6a9e64","name":"","topic":"RVC/TANK_STATUS/#","qos":"2","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":140,"y":80,"wires":[["f5e5995e.fe3888","bc43d294.b8c1c"]]},{"id":"b253067e.9633c8","type":"mqtt out","z":"477cac19.6a9e64","name":"CP/TANK_STATUS/TankName","topic":"","qos":"","retain":"","broker":"c1170463.5c7f8","x":890,"y":80,"wires":[]},{"id":"16624199.59e1ee","type":"comment","z":"477cac19.6a9e64","name":"Determine parking brake and ignition status and republish it","info":"","x":260,"y":160,"wires":[]},{"id":"d04e0e71.972ce","type":"mqtt in","z":"477cac19.6a9e64","name":"","topic":"RVC/CHASSIS_MOBILITY_STATUS","qos":"2","datatype":"json","broker":"c1170463.5c7f8","nl":false,"rap":false,"inputs":0,"x":180,"y":200,"wires":[["d4932ecd.c9281"]]},{"id":"3f6d5ecb.388b62","type":"mqtt out","z":"477cac19.6a9e64","name":"CP/IGNITION or CP/PARKBRAKE","topic":"","qos":"","retain":"","broker":"c1170463.5c7f8","x":900,"y":200,"wires":[]},{"id":"660b012f.2bc5b","type":"comment","z":"477cac19.6a9e64","name":"Calculate holding tank percent full and republish it","info":"","x":230,"y":40,"wires":[]},{"id":"8a3a667e.b770d8","type":"mqtt in","z":"477cac19.6a9e64","name":"","topic":"RVC/GENERATOR_STATUS_1","qos":"2","datatype":"json","broker":"c1170463.5c7f8","nl":false,"rap":false,"inputs":0,"x":160,"y":320,"wires":[["4c155211.73165c"]]},{"id":"f0779982.feef28","type":"mqtt out","z":"477cac19.6a9e64","name":"","topic":"CP/GENERATOR","qos":"","retain":"","broker":"c1170463.5c7f8","x":910,"y":320,"wires":[]},{"id":"45e1761e.135ae8","type":"comment","z":"477cac19.6a9e64","name":"Republish generator status in simple form","info":"","x":200,"y":280,"wires":[]},{"id":"d4932ecd.c9281","type":"file function","z":"477cac19.6a9e64","name":"decode_chassis_mobility","filename":".node-red/js/decode_chassis_mobility.js","reloadfile":false,"outputs":1,"x":610,"y":200,"wires":[["3f6d5ecb.388b62"]],"info":"//\r\n// Copyright (C) 2019 Wandertech LLC\r\n//\r\n// This program is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// This program is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\r\n\r\n// Newer coaches (2018+) report two different sets of\r\n// chassis statuses, identified by F1 or F2 in Byte 0.\r\n// The F1 message includes the ignition status, and the\r\n// F2 message includes the parking brake status.\r\n//\r\n// Older coaches always have 00 in Byte 0 and only report\r\n// ignition status.\r\n\r\nconst instance = msg.payload.data.substring(0, 2);\r\nmsg.topic = null; // Required to block pass-through topic\r\nlet newmsg = {};\r\n\r\nif (instance == 'F1' || instance == '00') {\r\n  newmsg.topic = 'CP/IGNITION';\r\n  newmsg.payload = msg.payload['ignition switch status'] == '00' ? 'off' : 'on';\r\n  global.set('status.chassis.ignition', newmsg.payload);\r\n} else if (instance == 'F2') {\r\n  newmsg.topic = 'CP/PARKBRAKE';\r\n  newmsg.payload = msg.payload['park brake status'] == '00' ? 'off' : 'on';\r\n  global.set('status.chassis.parkbrake', newmsg.payload);\r\n}\r\n\r\nreturn newmsg;\r\n"},{"id":"f5e5995e.fe3888","type":"file function","z":"477cac19.6a9e64","name":"decode_tank","filename":".node-red/js/decode_tank.js","reloadfile":false,"outputs":1,"x":570,"y":80,"wires":[["b253067e.9633c8","a7fa5f82.dafc7"]],"info":"//\r\n// Copyright (C) 2019 Wandertech LLC\r\n//\r\n// This program is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// This program is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\r\n\r\n// Calculate the tank percent full and republish it to the \"CP/\" topic.\r\n\r\nlet newmsg = {};\r\nmsg.topic = null; // Required to block pass-through topic\r\n\r\nlet pct_full = Math.round(msg.payload['relative level'] / msg.payload.resolution * 100);\r\n\r\nconst labels = ['Fresh', 'Black', 'Grey', 'LPG'];\r\n\r\nnewmsg.topic = 'CP/TANK_STATUS/' + labels[msg.payload.instance];\r\nnewmsg.payload = pct_full;\r\n\r\nreturn newmsg;\r\n"},{"id":"c72fb0d.22e175","type":"mqtt in","z":"477cac19.6a9e64","name":"","topic":"RVC/DC_SOURCE_STATUS_SPYDER/#","qos":"2","datatype":"json","broker":"c1170463.5c7f8","nl":false,"rap":false,"inputs":0,"x":190,"y":480,"wires":[["f3f48ab4.40e4c8"]]},{"id":"a59c49cb.b37798","type":"mqtt out","z":"477cac19.6a9e64","name":"CP/BATTERY_VOLTS/BatteryName","topic":"","qos":"","retain":"","broker":"c1170463.5c7f8","x":900,"y":460,"wires":[]},{"id":"f3f48ab4.40e4c8","type":"function","z":"477cac19.6a9e64","name":"decode battery","func":"// Newer coaches send DC_SOURCE_STATUS_SPYDER in addition to the\n// normal DC_SOURCE_STATUS. In these cases, ignore the legacy values.\n\nlet newmsg = {};\n\nconst labels = ['N/A', 'House', 'Chassis', 'House2'];\nnewmsg.topic = 'CP/BATTERY_VOLTS/' + labels[msg.payload.instance];\nnewmsg.payload = msg.payload['dc voltage'];\n\nif ((msg.topic).includes('SPYDER')) {\n    // Remember to only parse _SPYDER messages from now on\n    context.set('use_spyder', true);\n} else {\n    // If _SPYDER messages are used, ignore legacy messages\n    if (context.get('use_spyder')) {\n        newmsg = null;\n    }\n}\n\nmsg.topic = null;  // Overwrite incoming msg topic\nreturn newmsg;\n","outputs":1,"noerr":0,"x":620,"y":460,"wires":[["a59c49cb.b37798"]]},{"id":"94a20186.0131e","type":"mqtt in","z":"477cac19.6a9e64","name":"","topic":"RVC/DC_SOURCE_STATUS/#","qos":"2","datatype":"json","broker":"c1170463.5c7f8","nl":false,"rap":false,"inputs":0,"x":220,"y":440,"wires":[["f3f48ab4.40e4c8"]]},{"id":"75cc5225.c008dc","type":"mqtt in","z":"477cac19.6a9e64","name":"","topic":"RVC/THERMOSTAT_AMBIENT_STATUS/#","qos":"0","datatype":"json","broker":"c1170463.5c7f8","nl":false,"rap":false,"inputs":0,"x":200,"y":600,"wires":[["e077ae80.1b7e9"]]},{"id":"e077ae80.1b7e9","type":"function","z":"477cac19.6a9e64","name":"decode ambient temp","func":"const first_zone = global.get('settings2').tstat_first_zone || 0;\nconst zone_names = {\n  0: 'Front',\n  1: 'Mid',\n  2: 'Rear',\n  4: 'Wet Bay',\n  5: 'Generator Bay'\n};\n\nconst zone = parseInt(msg.payload.instance) - first_zone;\n\nlet newmsg = {};\nif (zone in zone_names) {\n  newmsg.topic = 'CP/THERMISTOR_TEMP/' + zone_names[zone];\n  newmsg.payload = msg.payload['ambient temp F'];\n\n  return newmsg;\n}\n","outputs":1,"noerr":0,"x":640,"y":600,"wires":[["3e5bd4e9.96126c"]]},{"id":"3e5bd4e9.96126c","type":"mqtt out","z":"477cac19.6a9e64","name":"CP/THERMISTOR_TEMP/ZoneName","topic":"","qos":"","retain":"","broker":"c1170463.5c7f8","x":930,"y":600,"wires":[]},{"id":"80d680be.7453e","type":"comment","z":"477cac19.6a9e64","name":"Republish battery status in simple form","info":"","x":190,"y":400,"wires":[]},{"id":"4c155211.73165c","type":"change","z":"477cac19.6a9e64","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload['status definition']","tot":"msg"},{"t":"set","p":"status.power.generator_state","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":320,"wires":[["f0779982.feef28","f36c20e2.5fa84"]]},{"id":"447f35ec.e5ed8c","type":"comment","z":"477cac19.6a9e64","name":"Republish thermister status in simple form","info":"","x":200,"y":560,"wires":[]},{"id":"6b55576d.e2cef8","type":"mqtt in","z":"477cac19.6a9e64","name":"","topic":"RVC/ATS_AC_STATUS_1/#","qos":"2","datatype":"json","broker":"c1170463.5c7f8","nl":false,"rap":false,"inputs":0,"x":150,"y":720,"wires":[["caa1f759.57aeb8"]]},{"id":"caa1f759.57aeb8","type":"function","z":"477cac19.6a9e64","name":"decode power status","func":"// Output 1: name of current ATS power source\n\nconst genset_status = global.get('status').power.generator_state || 'stopped';\n\n// If the rmsc value is not numeric (e.g. 'n/a'), then\n// the ATS is not receiving any external power.\nif (isNaN(parseFloat(msg.payload['rms current']))) {\n    msg.payload = 'None';\n} else if (genset_status == 'running') {\n    msg.payload = 'Generator';\n} else {\n    msg.payload = 'Shore';\n}\n\nglobal.set('status.power.ac_source', msg.payload);\n\nmsg.type = 'acsource';\nreturn msg;\n","outputs":1,"noerr":0,"x":640,"y":720,"wires":[["12c2cbaa.fb05d4"]]},{"id":"12c2cbaa.fb05d4","type":"mqtt out","z":"477cac19.6a9e64","name":"","topic":"CP/AC_SOURCE","qos":"","retain":"","broker":"c1170463.5c7f8","x":870,"y":720,"wires":[]},{"id":"c1547432.acf568","type":"comment","z":"477cac19.6a9e64","name":"Republish shore power status in simple form","info":"","x":210,"y":680,"wires":[]},{"id":"eacf2d96.2dff4","type":"mqtt out","z":"477cac19.6a9e64","name":"","topic":"CP/GENERATOR_STATUS","qos":"","retain":"","broker":"c1170463.5c7f8","x":940,"y":360,"wires":[]},{"id":"f36c20e2.5fa84","type":"change","z":"477cac19.6a9e64","name":"Generator Status with Timestamp","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload & \",\" & ($floor($millis() / 1000))","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":360,"wires":[["eacf2d96.2dff4"]]},{"id":"bc43d294.b8c1c","type":"debug","z":"477cac19.6a9e64","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":320,"y":120,"wires":[]},{"id":"a7fa5f82.dafc7","type":"debug","z":"477cac19.6a9e64","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":710,"y":140,"wires":[]},{"id":"4f256116.a0922","type":"function","z":"f6c367c2.63b9b8","name":"Save Option","func":"// Save the user's selection for future use\nflow.set(msg.topic, msg.payload); ","outputs":1,"noerr":0,"x":1150,"y":760,"wires":[[]]},{"id":"6a460ddd.614d34","type":"ui_switch","z":"f6c367c2.63b9b8","d":true,"name":"","label":"Heated Floors","tooltip":"","group":"dd373808.7ec1d8","order":3,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"floorheat","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":780,"y":640,"wires":[["4f256116.a0922"]]},{"id":"e17935c4.9179d8","type":"ui_switch","z":"f6c367c2.63b9b8","d":true,"name":"","label":"Aqua-Hot","tooltip":"","group":"dd373808.7ec1d8","order":2,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"aquahot","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":760,"y":580,"wires":[["4f256116.a0922"]]},{"id":"d47744cb.8e65a8","type":"ui_switch","z":"f6c367c2.63b9b8","d":true,"name":"","label":"Third Air Conditioner Zone","tooltip":"","group":"dd373808.7ec1d8","order":8,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"thirdtstat","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":820,"y":980,"wires":[["4f256116.a0922"]]},{"id":"ebfe21a.9252fe","type":"ui_switch","z":"f6c367c2.63b9b8","d":true,"name":"","label":"Ceiling Fan","tooltip":"","group":"dd373808.7ec1d8","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"ceilfan","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":770,"y":700,"wires":[["4f256116.a0922"]]},{"id":"dc84eec5.90206","type":"ui_switch","z":"f6c367c2.63b9b8","d":true,"name":"","label":"TV Lift","tooltip":"","group":"dd373808.7ec1d8","order":5,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"tvlift","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":750,"y":780,"wires":[["4f256116.a0922"]]},{"id":"3e7decdc.b1a0f4","type":"ui_switch","z":"f6c367c2.63b9b8","d":true,"name":"","label":"Bus Undercoach Light (2018+)","tooltip":"","group":"dd373808.7ec1d8","order":6,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"busundercoach","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":830,"y":840,"wires":[["4f256116.a0922"]]},{"id":"a5725878.456328","type":"ui_switch","z":"f6c367c2.63b9b8","d":true,"name":"","label":"Second Furnace Zone","tooltip":"","group":"dd373808.7ec1d8","order":9,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"secondfurnace","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":800,"y":1060,"wires":[["4f256116.a0922"]]},{"id":"d1929547.5808b8","type":"change","z":"f6c367c2.63b9b8","name":"Set Saved Heated Floors","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.floorheat = 'true'","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":640,"wires":[["6a460ddd.614d34"]]},{"id":"a11e14a2.3f8368","type":"function","z":"f6c367c2.63b9b8","name":"Set Aqua-Hot","func":"// Populate the \"Aqua-Hot\" toggle based on the chosen model.\n\nvar aquahot_standard = ['Allegro_Bus', 'Zephyr'];\nvar msg = { topic: '', payload: '' };\n\nif (flow.get('model')) {\n    if (aquahot_standard.includes(flow.get('model'))) {\n        msg.payload = true;\n    }\n} else {\n    msg = null;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":600,"wires":[["e17935c4.9179d8"]]},{"id":"9367e589.40dcc8","type":"change","z":"f6c367c2.63b9b8","name":"Set Saved Aquahot","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.aquahot = 'true'","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":560,"wires":[["e17935c4.9179d8"]]},{"id":"52b131c0.3e0bc","type":"function","z":"f6c367c2.63b9b8","name":"Set Third Tstat","func":"// Populate the \"Number of Thermostats\" toggle based on the chosen model.\n\nvar third_zone = ['Phaeton', 'Allegro_Bus', 'Zephyr'];\nvar msg = { topic: '', payload: '', enabled: true };\n\nif (flow.get('model')) {\n    if (third_zone.includes(flow.get('model'))) {\n        msg.payload = true;\n    }\n}\n\nif (flow.get('year') < 2018 && flow.get('model').substr(0,8) != 'VanLeigh') {\n    msg.enabled = false;\n    msg.payload = false;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":1000,"wires":[["d47744cb.8e65a8"]]},{"id":"96cb49b8.8b8178","type":"change","z":"f6c367c2.63b9b8","name":"Set Saved Third Tstat","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.thirdtstat = 'true'","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":960,"wires":[["d47744cb.8e65a8"]]},{"id":"d7334b34.c939a8","type":"change","z":"f6c367c2.63b9b8","name":"Set Saved Ceiling Fan","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.ceilfan = 'true'","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":680,"wires":[["ebfe21a.9252fe"]]},{"id":"c850c110.ae628","type":"function","z":"f6c367c2.63b9b8","name":"Set Ceiling Fan","func":"// Populate the \"Ceiling Fan\" toggle based on the chosen model.\n\nvar ceilfan_standard = ['Phaeton', 'Allegro_Bus', 'Zephyr'];\nvar msg = { topic: '', payload: '' };\n\nif (flow.get('model')) {\n    if (ceilfan_standard.includes(flow.get('model'))) {\n        msg.payload = true;\n    }\n} else {\n    msg = null;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":720,"wires":[["ebfe21a.9252fe"]]},{"id":"9b73dccc.9604f","type":"function","z":"f6c367c2.63b9b8","name":"Set TV Lift","func":"// Populate the \"TV Lift\" toggle based on the chosen model.\n\nvar tvlift = ['37_BH', '40_IH', '44_OH', '45_MP', '45_OPP', '45_PZ'];\nvar msg = { topic: '', payload: '' };\n\nmsg.payload = tvlift.includes(flow.get('floorplan'));\n\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":800,"wires":[["dc84eec5.90206"]]},{"id":"e55635a0.d71c08","type":"change","z":"f6c367c2.63b9b8","name":"Set Saved TV Lift","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.tvlift = 'true'","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":760,"wires":[["dc84eec5.90206"]]},{"id":"339d95b3.f8e70a","type":"change","z":"f6c367c2.63b9b8","name":"Set Saved Under Light","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.busundercoach = 'true'","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":840,"wires":[["3e7decdc.b1a0f4"]]},{"id":"fae26113.b499f","type":"change","z":"f6c367c2.63b9b8","name":"Set Saved Second Furnace","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.secondfurnace = 'true'","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":1040,"wires":[["a5725878.456328"]]},{"id":"415cf9bf.4a48f8","type":"link in","z":"f6c367c2.63b9b8","name":"Stored Configs Out","links":["f064e789.8ee718"],"x":95,"y":440,"wires":[["4dfe1b9e.8930a4","9367e589.40dcc8","d1929547.5808b8","d7334b34.c939a8","e55635a0.d71c08","96cb49b8.8b8178","4e592cfc.f31974","339d95b3.f8e70a","fae26113.b499f","3d01252.b8a7ada","c55f7e9a.5b269","bb656f06.c9eb4","d6e99aed.9f4498","4eb415af.b6f65c","f900b347.058da"]]},{"id":"9f2c8e4f.b0e94","type":"link in","z":"f6c367c2.63b9b8","name":"Coach Config Changed - Out","links":["8b7ede7f.8f951"],"x":95,"y":740,"wires":[["a11e14a2.3f8368","52b131c0.3e0bc","9adc4e9b.8e2d2","9b73dccc.9604f","c850c110.ae628","98b23545.c429e8","b28430f0.302e8","5dff0e93.907d5"]]},{"id":"4dfe1b9e.8930a4","type":"delay","z":"f6c367c2.63b9b8","name":"","pauseType":"delay","timeout":"750","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":290,"y":480,"wires":[["7fdd649c.54de1c"]]},{"id":"b33f57fb.ddb3c8","type":"change","z":"f6c367c2.63b9b8","name":"Set Saved Model","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.model","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":420,"wires":[["25d3ff72.475b8"]]},{"id":"8466b73c.6d83f8","type":"change","z":"f6c367c2.63b9b8","name":"Set Saved Year","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.year","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":360,"wires":[["6303f680.65dfe8"]]},{"id":"4e592cfc.f31974","type":"change","z":"f6c367c2.63b9b8","name":"Buttons Enabled?","rules":[{"t":"set","p":"enabled","pt":"msg","to":"payload.floorplan != null","tot":"jsonata"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":1560,"wires":[["66a1a845.bdd5e8"]]},{"id":"9adc4e9b.8e2d2","type":"change","z":"f6c367c2.63b9b8","name":"Buttons Enabled?","rules":[{"t":"set","p":"enabled","pt":"msg","to":"$flowContext('floorplan') != ''","tot":"jsonata"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":1600,"wires":[["66a1a845.bdd5e8"]]},{"id":"7fdd649c.54de1c","type":"change","z":"f6c367c2.63b9b8","name":"Set Saved Floor Plan","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.floorplan","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":480,"wires":[["21735e3b.c9fa92"]]},{"id":"25d3ff72.475b8","type":"ui_dropdown","z":"f6c367c2.63b9b8","d":true,"name":"Model Menu","label":"","tooltip":"","place":"Coach model","group":"5cbd9089.f3b65","order":3,"width":"0","height":"0","passthru":true,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"model","x":770,"y":420,"wires":[["c14463eb.5b67e"]]},{"id":"6303f680.65dfe8","type":"ui_dropdown","z":"f6c367c2.63b9b8","d":true,"name":"Year Menu","label":"","tooltip":"","place":"Coach year","group":"5cbd9089.f3b65","order":2,"width":"0","height":"0","passthru":true,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"year","x":770,"y":360,"wires":[["5da86ad4.9ce744"]]},{"id":"66a1a845.bdd5e8","type":"ui_button","z":"f6c367c2.63b9b8","d":true,"name":"Save and Install","group":"e1a5049d.4cee88","order":2,"width":0,"height":0,"passthru":false,"label":"Save and Install","tooltip":"","color":"","bgcolor":"","icon":"fa-check","payload":"","payloadType":"str","topic":"save","x":790,"y":1580,"wires":[["67d471e1.e9d42","956586e8.3221f8","d61ef8cb.9169a8","6504b8c0.3a9508"]]},{"id":"21735e3b.c9fa92","type":"ui_dropdown","z":"f6c367c2.63b9b8","d":true,"name":"Floor Plan Menu","label":"","tooltip":"","place":"Coach floor plan","group":"5cbd9089.f3b65","order":4,"width":"0","height":"0","passthru":true,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"floorplan","x":780,"y":480,"wires":[["5da0435a.8fc65c"]]},{"id":"c14463eb.5b67e","type":"change","z":"f6c367c2.63b9b8","name":"Save Model","rules":[{"t":"set","p":"model","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":990,"y":420,"wires":[["8b7ede7f.8f951","4c222ef8.3b6f2"]]},{"id":"5da86ad4.9ce744","type":"change","z":"f6c367c2.63b9b8","name":"Save Year","rules":[{"t":"set","p":"year","pt":"flow","to":"$number(msg.payload)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":980,"y":360,"wires":[["8b7ede7f.8f951","e166715c.d96cc"]]},{"id":"67d471e1.e9d42","type":"function","z":"f6c367c2.63b9b8","name":"Save to Database","func":"// Save the global config settings to the database\n\nvar msgs = [];  // An array of database query messages\n\nfor (var item of ['year', 'model', 'floorplan', 'aquahot', 'floorheat', 'ceilfan', 'tvlift', 'thirdtstat', 'secondfurnace', 'midheat', 'rearheat', 'busundercoach', 'powerbed', 'shades_interior']) {\n    var newmsg = {};\n    newmsg.topic = 'INSERT OR REPLACE INTO configs (key, value) VALUES(?, ?)';\n    newmsg.payload = [item, String(flow.get(item))];\n    msgs.push(newmsg);\n}\n\nreturn [msgs, {payload: 'Saving changes...'}];","outputs":2,"noerr":0,"x":1070,"y":1560,"wires":[["c2127265.468ad"],["426d2ff7.9aa5f"]],"outputLabels":["array of queries","feedback message"]},{"id":"956586e8.3221f8","type":"delay","z":"f6c367c2.63b9b8","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":1040,"y":1600,"wires":[["430d058c.29f94c","7cd87312.e8638c"]]},{"id":"d61ef8cb.9169a8","type":"change","z":"f6c367c2.63b9b8","name":"Disable Button","rules":[{"t":"set","p":"enabled","pt":"msg","to":"false","tot":"bool"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":1660,"wires":[["66a1a845.bdd5e8"]]},{"id":"6504b8c0.3a9508","type":"delay","z":"f6c367c2.63b9b8","name":"","pauseType":"delay","timeout":"30","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":630,"y":1700,"wires":[["fc78cf2.39df13","60ea3bd5.a290b4"]]},{"id":"fc78cf2.39df13","type":"change","z":"f6c367c2.63b9b8","name":"Enable Button","rules":[{"t":"set","p":"enabled","pt":"msg","to":"true","tot":"bool"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":1700,"wires":[["66a1a845.bdd5e8"]]},{"id":"5da0435a.8fc65c","type":"function","z":"f6c367c2.63b9b8","name":"Save Floor Plan","func":"// Save the user's selection for future use\nif (msg.payload !== '') {\n    flow.set('floorplan', msg.payload);\n    return msg;\n}","outputs":1,"noerr":0,"x":1000,"y":480,"wires":[["8b7ede7f.8f951"]]},{"id":"8b7ede7f.8f951","type":"link out","z":"f6c367c2.63b9b8","name":"Coach Config Changed - In","links":["9f2c8e4f.b0e94","6ec94471.102c8c","c8c58e81.c105a"],"x":1135,"y":480,"wires":[]},{"id":"c2127265.468ad","type":"sqlite","z":"f6c367c2.63b9b8","mydb":"b9bfcd9c.3c935","name":"","x":1340,"y":1540,"wires":[[]]},{"id":"426d2ff7.9aa5f","type":"ui_text","z":"f6c367c2.63b9b8","d":true,"group":"e1a5049d.4cee88","order":3,"width":0,"height":0,"name":"Feedback Text","label":"","format":"{{msg.payload}}","layout":"row-center","x":1670,"y":1560,"wires":[]},{"id":"430d058c.29f94c","type":"exec","z":"f6c367c2.63b9b8","command":"/coachproxy/configurator/cp_config.pl --habridge","addpay":false,"append":"","useSpawn":"true","timer":"","oldrc":false,"name":"","x":1350,"y":1600,"wires":[[],[],[]]},{"id":"7cd87312.e8638c","type":"change","z":"f6c367c2.63b9b8","name":"Message: Building configuration...","rules":[{"t":"set","p":"payload","pt":"msg","to":"Building configuration...","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1360,"y":1640,"wires":[["426d2ff7.9aa5f"]]},{"id":"60ea3bd5.a290b4","type":"change","z":"f6c367c2.63b9b8","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":1740,"wires":[["426d2ff7.9aa5f"]]},{"id":"b9c3efcf.5b28","type":"change","z":"f6c367c2.63b9b8","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1420,"y":1460,"wires":[["426d2ff7.9aa5f"]]},{"id":"7439d0ba.87459","type":"ui_ui_control","z":"f6c367c2.63b9b8","name":"Update when tab is displayed","x":190,"y":160,"wires":[["1f4566f5.e96699","b54d8c76.440fd"]]},{"id":"1f4566f5.e96699","type":"template","z":"f6c367c2.63b9b8","name":"Load Configs","field":"topic","fieldType":"msg","format":"handlebars","syntax":"plain","template":"select * from configs;","output":"str","x":440,"y":160,"wires":[["56106b2a.7d2784"]]},{"id":"56106b2a.7d2784","type":"sqlite","z":"f6c367c2.63b9b8","mydb":"b9bfcd9c.3c935","name":"coachproxy.sqlite","x":650,"y":160,"wires":[["13e55d69.864273"]]},{"id":"13e55d69.864273","type":"function","z":"f6c367c2.63b9b8","name":"Parse Configs","func":"// msg.payload = msg.payload[0];\n// return msg;\n\nvar payload = {};\nfor (var i = 0; i < (msg.payload).length; i++) {\n    var key = msg.payload[i].key;\n    var val = msg.payload[i].value;\n    flow.set(key, val);\n    if (val !== '') {\n        payload[key] = val;\n    }\n}\n\nmsg.payload = payload;\nreturn msg;","outputs":1,"noerr":0,"x":860,"y":160,"wires":[["f064e789.8ee718"]]},{"id":"f064e789.8ee718","type":"link out","z":"f6c367c2.63b9b8","name":"Stored Configs In","links":["415cf9bf.4a48f8","a9afea44.76da08"],"x":995,"y":160,"wires":[]},{"id":"53414f0e.6d8a","type":"ui_template","z":"f6c367c2.63b9b8","group":"39ecc94c.7e22c6","name":"eRVin Logo","order":1,"width":"6","height":"6","format":"<img src=\"ervin_logo.jpg\">","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"local","x":470,"y":260,"wires":[[]]},{"id":"805121eb.01323","type":"ui_template","z":"f6c367c2.63b9b8","d":true,"group":"dd373808.7ec1d8","name":"Configuration Message","order":1,"width":"0","height":"0","format":"<div style=\"height: 150px;\">\n<p>\n    Next, confirm the configuration options below are\n    correct for your coach.\n</p>\n<p>\n    <br>\n    Some options are only relevant to specific years\n    (e.g. thermostats) or models (e.g. undercoach lights).\n</p>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":810,"y":540,"wires":[[]]},{"id":"21500205.ffa20e","type":"ui_template","z":"f6c367c2.63b9b8","d":true,"group":"5cbd9089.f3b65","name":"Old Welcome Message","order":1,"width":"0","height":"0","format":"<div style=\"height: 130px;\">\n<p>\n    Welcome to eRVin!\n</p>\n<p>\n    <br>\n    Please select your year, model, and floor plan\n    below to begin. Note, you may need to scroll down\n    in the menu to find your model or floor plan.\n</p>\n</div>\n","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":990,"y":260,"wires":[["6303f680.65dfe8"]]},{"id":"47165ea9.fdf12","type":"ui_template","z":"f6c367c2.63b9b8","d":true,"group":"e1a5049d.4cee88","name":"Save and Install Message","order":1,"width":"0","height":"0","format":"<div style='height: 220px;'>\n<p>\n    When finished, use the \"Save and Install\" button\n    below to save your changes and re-configure\n    CoachProxyOS.\n</p>\n<p>\n    <br>\n    <b>Important</b>: Your web browser will disconnect momentarily while CoachProxyOS reloads. This re-configuration process will take approximately 30 seconds to complete.\n</p>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":810,"y":1540,"wires":[[]]},{"id":"e1e629e7.af8af8","type":"mqtt in","z":"f6c367c2.63b9b8","name":"","topic":"GLOBAL/SHUTDOWN","qos":"2","broker":"c1170463.5c7f8","inputs":0,"x":1400,"y":1500,"wires":[["426d2ff7.9aa5f"]]},{"id":"1ad1aea9.866741","type":"ui_switch","z":"f6c367c2.63b9b8","d":true,"name":"","label":"Mid Zone Heat Pump","tooltip":"","group":"dd373808.7ec1d8","order":10,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"midheat","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":800,"y":1140,"wires":[["4f256116.a0922"]]},{"id":"771b1df0.fe0b74","type":"ui_switch","z":"f6c367c2.63b9b8","d":true,"name":"","label":"Rear Zone Heat Pump","tooltip":"","group":"dd373808.7ec1d8","order":11,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"rearheat","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":800,"y":1220,"wires":[["4f256116.a0922"]]},{"id":"3d01252.b8a7ada","type":"change","z":"f6c367c2.63b9b8","name":"Set Saved Mid Heat Pump","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.midheat = 'true'","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":1120,"wires":[["1ad1aea9.866741"]]},{"id":"c55f7e9a.5b269","type":"change","z":"f6c367c2.63b9b8","name":"Set Saved Rear Heat Pump","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.rearheat = 'true'","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":1200,"wires":[["771b1df0.fe0b74"]]},{"id":"176c91be.746e3e","type":"ui_template","z":"f6c367c2.63b9b8","d":true,"group":"dd373808.7ec1d8","name":"Config HVAC Header","order":7,"width":"6","height":"1","format":"<div style=\"width: 100%; height: 10px; border-bottom: 1px solid black; text-align: center\">\n  <span style=\"background-color: #ffffff; padding: 0 10px;\">\n    2018+ Thermostat Controls\n  </span>\n</div>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":800,"y":940,"wires":[[]]},{"id":"98b23545.c429e8","type":"function","z":"f6c367c2.63b9b8","name":"Set Second Furnace","func":"// Populate the \"Number of Furnaces\" toggle based on the chosen model.\n\nvar second_furn = ['Phaeton', 'Allegro_Bus', 'Zephyr'];\nvar msg = { topic: '', payload: '', enabled: true };\n\nif (flow.get('model')) {\n    if (second_furn.includes(flow.get('model'))) {\n        msg.payload = true;\n    }\n}\n\nif (flow.get('year') < 2018 && flow.get('model').substr(0,8) != 'VanLeigh') {\n    msg.enabled = false;\n    msg.payload = false;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":480,"y":1080,"wires":[["a5725878.456328"]]},{"id":"b28430f0.302e8","type":"function","z":"f6c367c2.63b9b8","name":"Set Mid Heat Pump","func":"var mid_hp = ['Phaeton', 'Allegro_Bus', 'Zephyr'];\nvar msg = { topic: '', payload: '', enabled: true };\n\nif (flow.get('model')) {\n    if (mid_hp.includes(flow.get('model'))) {\n        msg.payload = true;\n    }\n}\n\nif (flow.get('year') < 2018 && flow.get('model').substr(0,8) != 'VanLeigh') {\n    msg.enabled = false;\n    msg.payload = false;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":1160,"wires":[["1ad1aea9.866741"]]},{"id":"5dff0e93.907d5","type":"function","z":"f6c367c2.63b9b8","name":"Set Rear Heat Pump","func":"var rear_hp = ['Phaeton', 'Allegro_Bus', 'Zephyr'];\nvar msg = { topic: '', payload: '', enabled: true };\n\nif (flow.get('model')) {\n    if (rear_hp.includes(flow.get('model'))) {\n        msg.payload = true;\n    }\n}\n\nif (flow.get('year') < 2018 && flow.get('model').substr(0,8) != 'VanLeigh') {\n    msg.enabled = false;\n    msg.payload = false;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":480,"y":1240,"wires":[["771b1df0.fe0b74"]]},{"id":"bb656f06.c9eb4","type":"delay","z":"f6c367c2.63b9b8","name":"","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":290,"y":420,"wires":[["b33f57fb.ddb3c8"]]},{"id":"ec2c7c9d.42b27","type":"ui_switch","z":"f6c367c2.63b9b8","d":true,"name":"","label":"Power Smart Bed","tooltip":"","group":"dd373808.7ec1d8","order":6,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"powerbed","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":790,"y":880,"wires":[["4f256116.a0922"]]},{"id":"d6e99aed.9f4498","type":"change","z":"f6c367c2.63b9b8","name":"Set Saved Power Bed","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.powerbed = 'true'","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":880,"wires":[["ec2c7c9d.42b27"]]},{"id":"9e8ccc55.4f957","type":"ui_switch","z":"f6c367c2.63b9b8","d":true,"name":"Interior Shades","label":"Move Window Shades to \"Interior\" Page","tooltip":"","group":"f4d0f875.b5dda8","order":11,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"shades_interior","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":780,"y":1360,"wires":[["4f256116.a0922"]]},{"id":"4eb415af.b6f65c","type":"change","z":"f6c367c2.63b9b8","name":"Set Saved Interior Shades","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.shades_interior = 'true'","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":1360,"wires":[["9e8ccc55.4f957"]]},{"id":"b54d8c76.440fd","type":"file in","z":"f6c367c2.63b9b8","name":"features.json","filename":"/coachproxy/configurator/features.json","format":"utf8","chunk":false,"sendError":false,"x":430,"y":200,"wires":[["697d0cce.bc0fa4"]]},{"id":"697d0cce.bc0fa4","type":"json","z":"f6c367c2.63b9b8","name":"","property":"payload","action":"","pretty":false,"x":590,"y":200,"wires":[["4c3c9b2.e18a464"]]},{"id":"4c3c9b2.e18a464","type":"change","z":"f6c367c2.63b9b8","name":"","rules":[{"t":"set","p":"features","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":770,"y":200,"wires":[["bfb2c3a4.58ad4"]]},{"id":"bfb2c3a4.58ad4","type":"function","z":"f6c367c2.63b9b8","name":"Year Option List","func":"// Populate the \"Year\" menu with appropriate options based\n// on the features.json file.\n\nlet years = global.get('features');\nyears = Object.keys(years).filter(year => year[0] == 2).reverse();\n\nconst yearmsg = { options: years, payload: null, topic: null };\nconst blankmsg = { options: [], payload: null, topic: null }\n\nreturn [yearmsg, blankmsg];","outputs":2,"noerr":0,"x":980,"y":200,"wires":[["6303f680.65dfe8"],["25d3ff72.475b8","21735e3b.c9fa92"]]},{"id":"42d5d825.d7a988","type":"ui_ui_control","z":"f6c367c2.63b9b8","name":"Update when tab is displayed","x":1150,"y":1460,"wires":[["b9c3efcf.5b28"]]},{"id":"e166715c.d96cc","type":"function","z":"f6c367c2.63b9b8","name":"Model Option List","func":"// Populate the \"Floor Plan\" menu with appropriate options based\n// on the user's choice of year and model.\n\nconst years = global.get('features');\n\n// User's choice of year\nconst year = flow.get('year');\n\nif (year && years[year]) {\n  const models = Object.keys(years[year]).filter(model => model != '_comment');\n\n  const modelmsg = { options: models, payload: null, topic: null };\n  const blankmsg = { options: [], payload: null, topic: null }\n\n  return [modelmsg, blankmsg];\n}\n","outputs":2,"noerr":0,"x":1210,"y":360,"wires":[["25d3ff72.475b8"],["21735e3b.c9fa92"]]},{"id":"4c222ef8.3b6f2","type":"function","z":"f6c367c2.63b9b8","name":"Floor Plan Option List","func":"// Populate the \"Floor Plan\" menu with appropriate options based\n// on the user's choice of year and model.\n\nconst years = global.get('features');\n\n// User's choice of year and model\nconst year = flow.get('year');\nconst model = flow.get('model');\n\nif (year && model && years[year][model]) {\n  const floors = Object.keys(years[year][model]).filter(floor => floor != 'Default');\n\n  const floormsg = { options: floors, payload: null, topic: null };\n\n  return [floormsg];\n}\n","outputs":1,"noerr":0,"x":1220,"y":420,"wires":[["21735e3b.c9fa92"]]},{"id":"f900b347.058da","type":"delay","z":"f6c367c2.63b9b8","name":"","pauseType":"delay","timeout":"250","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":290,"y":360,"wires":[["8466b73c.6d83f8"]]},{"id":"bb67848e.4759b8","type":"ui_template","z":"f6c367c2.63b9b8","group":"e4fd4ed4.a377f","name":"Copyright","order":3,"width":"0","height":"0","format":"<div layout='column' layout-align='space-between'>\n  <p>eRVin  2020</p>\n  <p>CoachProxyOS  2019</p>\n  <p>CoachProxyOS/eRVin comes with ABSOLUTELY NO WARRANTY.\n  This is free software, and you are welcome to redistribute it\n  under certain conditions.</p>\n  <p>See <a href=\"https://www.gnu.org/licenses/gpl-3.0.html\">https://www.gnu.org/licenses/gpl-3.0.html</a>\n  for complete details.</p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":700,"y":80,"wires":[[]]},{"id":"589bd084.7b41d","type":"ui_template","z":"f6c367c2.63b9b8","group":"39ecc94c.7e22c6","name":"eRVin Welcome Message","order":2,"width":"0","height":"0","format":"<div style=\"height: 130px;\">\n<p>\n    <b>Welcome to eRVin!</b>\n</p>\n<p style=\"font-size:90%;\"> \n    <b>E</b>nhancing <b>RV</b> <b>I</b>ntegrated <b>N</b>etworks\n</p>\n<br>\n<p>\n    Email: <a href=\"mailto: info@myervin.com\">info@myervin.com</a>\n</p>\n    <p style=\"font-size:100%;\">Web: <a href=\"http://myervin.com\">http://myervin.com</a></p>\n</div>","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"local","x":710,"y":260,"wires":[[]]},{"id":"9bb36106.dac15","type":"ui_template","z":"f6c367c2.63b9b8","group":"ca514016.47102","name":"About","order":1,"width":"0","height":"0","format":"<div style=\"height: 130px;\">\n<p>\n    eRVin is based on CoachProxy (for Tiffin products), but modified here for other RV models. The goal of eRVin is to expand beyond basic control and integrate enhanced automation capabilities. It is a work in progress and needs input from other automation enthusiasts. \n</p>\n<br>\n<p> Many thanks to the hard work of the CoachProxy developers who have made their product open source and free to the world.\n</p>\n</div>\n","storeOutMessages":false,"fwdInMessages":false,"resendOnRefresh":false,"templateScope":"local","x":450,"y":300,"wires":[[]]},{"id":"69df32bd.da144c","type":"comment","z":"f6c367c2.63b9b8","name":"Old Coachproxy Configurator","info":"","x":170,"y":60,"wires":[]},{"id":"3619a07.66d096","type":"exec","z":"f6c367c2.63b9b8","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"Change PW","x":910,"y":2720,"wires":[[],["588f10b3.9736d"],[]]},{"id":"a0212bd6.1eb478","type":"inject","z":"f6c367c2.63b9b8","name":"Clear PW Fields","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.4","topic":"","payload":"{\"opw\":\"\",\"epw\":\"\",\"cpw\":\"\"}","payloadType":"json","x":180,"y":2760,"wires":[["e3e9d958.66bc28"]]},{"id":"e3e9d958.66bc28","type":"ui_form","z":"f6c367c2.63b9b8","name":"Change Password","label":"","group":"7706781c.a53ca8","order":2,"width":0,"height":0,"options":[{"label":"Current Password","value":"opw","type":"password","required":true,"rows":null},{"label":"Enter New Password","value":"epw","type":"password","required":true,"rows":null},{"label":"Confirm New Password","value":"cpw","type":"password","required":true,"rows":null}],"formValue":{"opw":"","epw":"","cpw":""},"payload":"","submit":"submit","cancel":"clear","topic":"","x":170,"y":2820,"wires":[["18675f27.26e691"]]},{"id":"18675f27.26e691","type":"function","z":"f6c367c2.63b9b8","name":"PW Match?","func":"\n\nif (msg.payload.epw !== msg.payload.cpw) {\n    msg.status = \"Passwords do not match, try again...\"\n}\nelse {\n    msg.status = \"match\";\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":370,"y":2820,"wires":[["549989fe.a18108"]]},{"id":"549989fe.a18108","type":"switch","z":"f6c367c2.63b9b8","name":"Match or Error?","property":"status","propertyType":"msg","rules":[{"t":"eq","v":"match","vt":"str"},{"t":"eq","v":"Passwords do not match, try again...","vt":"str"}],"checkall":"false","repair":true,"outputs":2,"x":560,"y":2820,"wires":[["e2deef77.6b867"],["cec1194b.dac778"]]},{"id":"91c1a436.fe0cb8","type":"ui_toast","z":"f6c367c2.63b9b8","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"","name":"Show Error","x":910,"y":2820,"wires":[["c02caa35.d4bf98"]]},{"id":"c02caa35.d4bf98","type":"change","z":"f6c367c2.63b9b8","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"opw\":\"\",\"epw\":\"\",\"cpw\":\"\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1260,"y":2820,"wires":[["e3e9d958.66bc28"]]},{"id":"cec1194b.dac778","type":"change","z":"f6c367c2.63b9b8","name":"No Match","rules":[{"t":"set","p":"payload","pt":"msg","to":"status","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":2820,"wires":[["91c1a436.fe0cb8"]]},{"id":"81a5b5a8.c4b588","type":"string","z":"f6c367c2.63b9b8","name":"Inject PW","methods":[{"name":"replaceAll","params":[{"type":"str","value":"opw"},{"type":"msg","value":"payload.opw"}]},{"name":"replaceAll","params":[{"type":"str","value":"epw"},{"type":"msg","value":"payload.epw"}]}],"prop":"command","propout":"payload","object":"msg","objectout":"msg","x":900,"y":2780,"wires":[["3619a07.66d096"]]},{"id":"e2deef77.6b867","type":"change","z":"f6c367c2.63b9b8","name":"Format Exec","rules":[{"t":"set","p":"command","pt":"msg","to":"echo -e \"opw\\nepw\\nepw\" | passwd pi","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":750,"y":2780,"wires":[["81a5b5a8.c4b588"]]},{"id":"4cc8e728.f47738","type":"ui_toast","z":"f6c367c2.63b9b8","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"","name":"Show Success","x":1260,"y":2620,"wires":[["c02caa35.d4bf98"]]},{"id":"588f10b3.9736d","type":"string","z":"f6c367c2.63b9b8","name":"Format System Response","methods":[{"name":"delLeftMost","params":[{"type":"str","value":"passwd: "}]}],"prop":"payload","propout":"payload","object":"msg","objectout":"msg","x":950,"y":2660,"wires":[["510b7ab0.64df64"]]},{"id":"bf9b8786.fbf868","type":"comment","z":"f6c367c2.63b9b8","name":"Change Raspberry Pi System Password","info":"","x":230,"y":2580,"wires":[]},{"id":"510b7ab0.64df64","type":"switch","z":"f6c367c2.63b9b8","name":"Succeed?","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"password unchanged","vt":"str"},{"t":"cont","v":"password updated successfully","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":900,"y":2600,"wires":[["12cc0926.ca8497"],["4cc8e728.f47738"]]},{"id":"183426a1.418a59","type":"ui_toast","z":"f6c367c2.63b9b8","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"","name":"Show Error","x":1270,"y":2580,"wires":[["c02caa35.d4bf98"]]},{"id":"12cc0926.ca8497","type":"change","z":"f6c367c2.63b9b8","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Current password incorrect, try again...","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1080,"y":2580,"wires":[["183426a1.418a59"]]},{"id":"6480dafb.3b65c4","type":"ui_template","z":"f6c367c2.63b9b8","group":"7706781c.a53ca8","name":"Change Password Instructions","order":1,"width":0,"height":0,"format":"<div>\n    <p>\n    <br><b>eRVin runs on a Raspberry Pi microcomputer, for best security the Pi password should be changed from the default. If the password has never been changed the Current Password will be \"ervin2020\".</b>\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":210,"y":2700,"wires":[[]]},{"id":"fc272ff6.395b3","type":"fs-ops-copy","z":"f6c367c2.63b9b8","name":"icon64x64.png","sourcePath":"/coachproxy/home/pi/.node-red/icons","sourcePathType":"str","sourceFilename":"ervin_icon64x64.png","sourceFilenameType":"str","destPath":"/coachproxy/home/pi/.node-red/node_modules/node-red-dashboard/dist","destPathType":"str","destFilename":"icon64x64.png","destFilenameType":"str","link":false,"overwrite":true,"x":540,"y":2960,"wires":[[]]},{"id":"88cd1ea3.47b59","type":"fs-ops-copy","z":"f6c367c2.63b9b8","name":"icon120x120.png","sourcePath":"/coachproxy/home/pi/.node-red/icons","sourcePathType":"str","sourceFilename":"ervin_icon120x120.png","sourceFilenameType":"str","destPath":"/coachproxy/home/pi/.node-red/node_modules/node-red-dashboard/dist","destPathType":"str","destFilename":"icon120x120.png","destFilenameType":"str","link":false,"overwrite":true,"x":550,"y":3000,"wires":[[]]},{"id":"b91770be.5e38c","type":"fs-ops-copy","z":"f6c367c2.63b9b8","name":"icon192x192.png","sourcePath":"/coachproxy/home/pi/.node-red/icons","sourcePathType":"str","sourceFilename":"ervin_icon192x192.png","sourceFilenameType":"str","destPath":"/coachproxy/home/pi/.node-red/node_modules/node-red-dashboard/dist","destPathType":"str","destFilename":"icon192x192.png","destFilenameType":"str","link":false,"overwrite":true,"x":550,"y":3040,"wires":[[]]},{"id":"932d068a.4424c8","type":"fs-ops-copy","z":"f6c367c2.63b9b8","name":"icon407x407.png","sourcePath":"/coachproxy/home/pi/.node-red/icons","sourcePathType":"str","sourceFilename":"ervin_icon407x407.png","sourceFilenameType":"str","destPath":"/coachproxy/home/pi/.node-red/node_modules/node-red-dashboard/dist","destPathType":"str","destFilename":"icon407x407.png","destFilenameType":"str","link":false,"overwrite":true,"x":550,"y":3080,"wires":[[]]},{"id":"7b0400a3.01c35","type":"fs-ops-copy","z":"f6c367c2.63b9b8","name":"ervin_logo.jpg","sourcePath":"/coachproxy/home/pi/.node-red/icons","sourcePathType":"str","sourceFilename":"ervin_logo.jpg","sourceFilenameType":"str","destPath":"/coachproxy/home/pi/.node-red/node_modules/node-red-dashboard/dist","destPathType":"str","destFilename":"ervin_logo.jpg","destFilenameType":"str","link":false,"overwrite":true,"x":540,"y":3120,"wires":[[]]},{"id":"854f1131.40a74","type":"inject","z":"f6c367c2.63b9b8","name":"Update Favicons after Dashboard Update","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":240,"y":3040,"wires":[["7b0400a3.01c35","fc272ff6.395b3","88cd1ea3.47b59","b91770be.5e38c","932d068a.4424c8"]]},{"id":"a794d2cf.5e6d","type":"comment","z":"f6c367c2.63b9b8","name":"Update Favicons after Dashboard Update","info":"When the Dashboard contrib in Node-Red is updated it overwrites the following directory: /coachproxy/home/pi/.node-red/node_modules/node-red-dashboard/dist\n\nThis reverts the favicon icons to default amd also deletes the large eRVin logo.\n\nThis small flow simply copies backup ervin favicons and logo loacated at /coachproxy/home/pi/.node-red/icons\nto /coachproxy/home/pi/.node-red/node_modules/node-red-dashboard/dist\n\nFor a more permanent solution see this link.\n\nhttps://gist.github.com/mohnen/6923d5eb2e4547bb7e5bd90546d2ee80","x":230,"y":2980,"wires":[]},{"id":"f43ba533.bdbcc8","type":"exec","z":"f6c367c2.63b9b8","command":"sudo /coachproxy/configurator/remove_dataplicity.sh","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"Remove Dataplicity","x":670,"y":3320,"wires":[[],[],["a1463f73.55326"]]},{"id":"97acfae3.e798a8","type":"ui_button","z":"f6c367c2.63b9b8","name":"","group":"7d76c12c.bccc4","order":3,"width":"0","height":"0","passthru":false,"label":"Remove Dataplicity","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Do you really want to remove Dataplicity?","payloadType":"str","topic":"Are you sure?","x":170,"y":3320,"wires":[["407a4c84.f7e224"]]},{"id":"407a4c84.f7e224","type":"ui_toast","z":"f6c367c2.63b9b8","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"Cancel","raw":false,"topic":"","name":"r u sure?","x":340,"y":3320,"wires":[["2187ede2.1e1c32"]]},{"id":"c9142614.3d54a8","type":"ui_template","z":"f6c367c2.63b9b8","group":"7d76c12c.bccc4","name":"Dataplicity","order":1,"width":"0","height":"0","format":"\n<div layout=\"column\" layout-align=\"space-between\">\n<p>\nDataplicity provides remote access to eRVin from anywhere there is internet access. To install Dataplicity, please follow these \n<a target='_blank' href='https://myervin.com/how-to-install-dataplicity-for-remote-access-to-ervin'>instructions.</a>\n</p>\n<p>\nIf you need to reset your Dataplicity link or want to remove Dataplicity, click the Remove Dataplicity button below:\n</p>\n</div>\n","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","className":"","x":150,"y":3280,"wires":[[]]},{"id":"88950e74.74d73","type":"comment","z":"f6c367c2.63b9b8","name":"Dataplicity Installation and Removal","info":"","x":220,"y":3220,"wires":[]},{"id":"388e2849.6fbed8","type":"ui_toast","z":"f6c367c2.63b9b8","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"","name":"Removed","x":1040,"y":3320,"wires":[[]]},{"id":"a1463f73.55326","type":"function","z":"f6c367c2.63b9b8","name":"","func":"msg.topic = \"\"\n//code = msg.payload.code\n\nif (msg.payload.code !== 0) {\n    msg.topic = 'Error #'\n    msg.payload = msg.payload.code\n} else {\n    msg.payload = \"Dataplicity Sucessfully Removed\"\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":880,"y":3320,"wires":[["388e2849.6fbed8"]]},{"id":"2187ede2.1e1c32","type":"switch","z":"f6c367c2.63b9b8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"OK","vt":"str"},{"t":"eq","v":"Cancel","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":490,"y":3320,"wires":[["f43ba533.bdbcc8"],[]]},{"id":"c5938d76.20e9a","type":"comment","z":"f6c367c2.63b9b8","name":"Download config (flow) files from flows.myervin.com - No HaBridge v0.61","info":"This flow accesses the ervin server at flows.myervin.com to download updated or new flows to /coachproxy/home/pi/.node-red/flows.\n\nIf a flow file of the exact same name and version is already installed on the ervin raspberry pi at /coachproxy/home/pi/.node-red/flows, a confirmation dialog is presented to confirm overwrite. If yes, the existing flow file in the above folder are deleted first (because wget does not overwrite existing files but instead creates a new one with a modified name).\n\nv0.61 changed \"update\" to \"download\" to prevent confusion","x":340,"y":3400,"wires":[]},{"id":"cc147543.fbcb38","type":"http request","z":"f6c367c2.63b9b8","name":"get filenames","method":"GET","ret":"txt","paytoqs":"ignore","url":"https://flows.myervin.com","tls":"","persist":false,"proxy":"","authType":"","x":480,"y":3460,"wires":[["6ac26fc5.73564"]]},{"id":"44b9529b.38a35c","type":"ui_list","z":"f6c367c2.63b9b8","group":"43a9d023.b2434","name":"list","order":3,"width":"6","height":"4","lineType":"one","actionType":"check","allowHTML":false,"outputs":1,"topic":"","x":470,"y":3540,"wires":[["47b011e9.9acb3"]]},{"id":"6ac26fc5.73564","type":"html","z":"f6c367c2.63b9b8","name":"clean up","property":"payload","outproperty":"payload","tag":"a[href*=\"_\"]","ret":"text","as":"multi","x":640,"y":3460,"wires":[["e69c1ca2.ccca8"]]},{"id":"dd079be7.1c5b98","type":"join","z":"f6c367c2.63b9b8","name":"make obj","mode":"custom","build":"object","property":"payload","propertyType":"msg","key":"parts.index","joiner":"\\n","joinerType":"str","accumulate":true,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"num","reduceFixup":"","x":980,"y":3460,"wires":[["44b9529b.38a35c"]]},{"id":"e69c1ca2.ccca8","type":"change","z":"f6c367c2.63b9b8","name":"payload.title","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.title","tot":"msg"},{"t":"set","p":"filecount","pt":"flow","to":"parts.count","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":3460,"wires":[["dd079be7.1c5b98"]]},{"id":"c89537e6.54c568","type":"exec","z":"f6c367c2.63b9b8","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1010,"y":3660,"wires":[[],[],["b200af0d.41b39"]]},{"id":"2a54d809.917418","type":"function","z":"f6c367c2.63b9b8","name":"","func":"// Copyright 20201 Rob Picchione\n// Formats wget for exec node to download selected file\n\nif (msg.payload.isChecked === false ) {\n    return null\n}\n\n\nflowfiles = \"wget \" + \"https://flows.myervin.com/\" + msg.payload.title + \" -P \" + \"/coachproxy/home/pi/.node-red/flows\"\nhabridgefiles = \"wget \" + \"https://habridge.myervin.com/\" + msg.payload.habridge +'.db' + \" -P \" + \"/coachproxy/home/pi/.node-red/flows\"\nvar msg3 = { 'enabled': false };\nvar msg2 = { 'payload': habridgefiles};\nvar msg1 = { 'payload': flowfiles};\n\nreturn [ msg1, msg2, msg3 ];\n","outputs":3,"noerr":0,"initialize":"","finalize":"","x":780,"y":3640,"wires":[["c89537e6.54c568","42cb365e.86b638"],["60f07e17.292dd"],["44b9529b.38a35c"]]},{"id":"29e16d97.1804b2","type":"ui_toast","z":"f6c367c2.63b9b8","position":"top right","displayTime":"3","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"Successful","x":450,"y":3800,"wires":[]},{"id":"82fe1d03.14547","type":"change","z":"f6c367c2.63b9b8","name":"","rules":[{"t":"change","p":"payload.code","pt":"msg","from":"0","fromt":"num","to":"true","tot":"str"},{"t":"move","p":"payload.code","pt":"msg","to":"enabled","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"File Sucessfully Downloaded","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":240,"y":3800,"wires":[["44b9529b.38a35c","b687723b.7a269","29e16d97.1804b2","2ea0a0c2.397e2"]]},{"id":"b687723b.7a269","type":"ui_button","z":"f6c367c2.63b9b8","name":"","group":"43a9d023.b2434","order":2,"width":0,"height":0,"passthru":true,"label":"List Online Config Files","tooltip":"","color":"","bgcolor":"","className":"","icon":"","payload":"","payloadType":"str","topic":"","topicType":"str","x":230,"y":3460,"wires":[["cc147543.fbcb38"]]},{"id":"b200af0d.41b39","type":"switch","z":"f6c367c2.63b9b8","name":"error?","property":"payload.code","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"neq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1350,"y":3740,"wires":[["82fe1d03.14547"],["6c0e6404.17ca6c"]]},{"id":"dfcf11b6.b1cec","type":"ui_toast","z":"f6c367c2.63b9b8","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"","name":"Error","x":1570,"y":3760,"wires":[[]]},{"id":"6c0e6404.17ca6c","type":"change","z":"f6c367c2.63b9b8","name":"","rules":[{"t":"move","p":"payload.code","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"topic","pt":"msg","to":"Error #","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1600,"y":3700,"wires":[["dfcf11b6.b1cec"]]},{"id":"47b011e9.9acb3","type":"fs-ops-access","z":"f6c367c2.63b9b8","name":"file exists?","path":"/coachproxy/home/pi/.node-red/flows","pathType":"str","filename":"payload.title","filenameType":"msg","read":true,"write":false,"throwerror":false,"x":630,"y":3540,"wires":[["7781fab9.07b334"],["cdfbee1.29a1e1"]]},{"id":"7781fab9.07b334","type":"change","z":"f6c367c2.63b9b8","name":"","rules":[{"t":"move","p":"payload","pt":"msg","to":"payloadtoo","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"The configuration file selected already exists on eRVin, are you sure you want to overwrite it?","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":3540,"wires":[["86c8d3d5.c01e1"]]},{"id":"1c34be58.ee6552","type":"ui_template","z":"f6c367c2.63b9b8","group":"43a9d023.b2434","name":"Configuration Files","order":1,"width":"0","height":"0","format":"\n<div layout=\"column\" layout-align=\"space-between\">\n<p>\n - This feature will allow you to download new and/or updated configuration files from the eRVin server online and copy them to your eRVin system.\n <br>- First click the <b>List Online Config Files</b> button below, then click the checkbox for the file you want.\n <br>- Once downloaded, use the <b>Install Configuration File</b> section below to update eRVin.\n <br>- This feature requires that eRVin have an internet connection. \n</p>\n</div>\n","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","className":"","x":270,"y":3540,"wires":[[]]},{"id":"60f07e17.292dd","type":"exec","z":"f6c367c2.63b9b8","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1010,"y":3720,"wires":[[],[],["b200af0d.41b39"]]},{"id":"cdfbee1.29a1e1","type":"string","z":"f6c367c2.63b9b8","name":"","methods":[{"name":"delRightMost","params":[{"type":"str","value":"_v"}]}],"prop":"payload.title","propout":"payload.habridge","object":"msg","objectout":"msg","x":630,"y":3640,"wires":[["2a54d809.917418"]]},{"id":"42cb365e.86b638","type":"ui_toast","z":"f6c367c2.63b9b8","position":"top right","displayTime":"3","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"File Download in Progress","name":"Downloading","x":1190,"y":3620,"wires":[]},{"id":"2ea0a0c2.397e2","type":"link out","z":"f6c367c2.63b9b8","name":"Send Refresh","links":["d8d5c35c.b0eaf","f060a860.679988","e3c8e0a7.76c6b"],"x":395,"y":3840,"wires":[]},{"id":"86c8d3d5.c01e1","type":"ui_toast","z":"f6c367c2.63b9b8","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"Overwrite","cancel":"Cancel","raw":false,"topic":"","name":"","x":1030,"y":3540,"wires":[["2ce4c109.ece74e"]]},{"id":"2ce4c109.ece74e","type":"switch","z":"f6c367c2.63b9b8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Overwrite","vt":"str"},{"t":"eq","v":"Cancel","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1190,"y":3540,"wires":[["cd24bace.44d558"],["b687723b.7a269"]]},{"id":"cd24bace.44d558","type":"change","z":"f6c367c2.63b9b8","name":"","rules":[{"t":"move","p":"payloadtoo","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1240,"y":3460,"wires":[["cc70425b.94225"]]},{"id":"cc70425b.94225","type":"fs-ops-delete","z":"f6c367c2.63b9b8","name":"del flows file","path":"/coachproxy/home/pi/.node-red/flows","pathType":"str","filename":"payload.title","filenameType":"msg","x":1390,"y":3540,"wires":[["5c672a22.792b04","cdfbee1.29a1e1"]]},{"id":"80fd8703.d20088","type":"fs-ops-delete","z":"f6c367c2.63b9b8","name":"del habridge file","path":"/coachproxy/home/pi/.node-red/flows","pathType":"str","filename":"payload.title","filenameType":"msg","x":1600,"y":3600,"wires":[[]]},{"id":"5c672a22.792b04","type":"string","z":"f6c367c2.63b9b8","name":"","methods":[{"name":"delRightMost","params":[{"type":"str","value":"_v"}]},{"name":"append","params":[{"type":"str","value":".db"}]}],"prop":"payload.title","propout":"payload.title","object":"msg","objectout":"msg","x":1570,"y":3540,"wires":[["80fd8703.d20088"]]},{"id":"fc13abe8.5b7bd8","type":"fs-ops-copy","z":"f6c367c2.63b9b8","name":"","sourcePath":"/coachproxy/home/pi/.node-red","sourcePathType":"str","sourceFilename":"flows_coachproxy.json","sourceFilenameType":"str","destPath":"/coachproxy/home/pi/.node-red/flows","destPathType":"str","destFilename":"RVinfo","destFilenameType":"global","link":false,"overwrite":true,"x":600,"y":4900,"wires":[[]]},{"id":"67b13987.d1f268","type":"inject","z":"f6c367c2.63b9b8","name":"Copy This Flow - Deploy First!","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":230,"y":4900,"wires":[["fc13abe8.5b7bd8"]]},{"id":"2623c77b.dc0de8","type":"comment","z":"f6c367c2.63b9b8","name":"Save this flow to the Flows file on the Raspberry Pi","info":"This tool should be run after a Deploy to ensure the flow is written to a file with a descriptive filename at /coachproxy/home/pi/.node-red/flows.\n\nThe Load eRVin Configuration flow above will copy a file with a descriptive filename from /coachproxy/home/pi/.node-red/flows and write it to the node red flows file at /coachproxy/home/pi/.node-red with the filename flows_coachproxy.json. This is the default flow node-red will use when it starts up.\n\nThe Load eRVin Configuration flow also copies the appropriate HAbridge file located at /coachproxy/home/pi/.node-red/flows to the following path /coachproxy/ha-bridge\n\nThe HAbridge file is relatively static for each floorplan so initially it is manually saved to /coachproxy/home/pi/.node-red/flows. The HAbridge filename must be identical to the flows file name but without the version (_v_nnn) and a \".db\" extension. When copied to /coachproxy/ha-bridge the name is changed to device.db ","x":290,"y":4860,"wires":[]},{"id":"b9955953.ac37e8","type":"fs-ops-copy","z":"f6c367c2.63b9b8","name":"","sourcePath":"/coachproxy/ha-bridge","sourcePathType":"str","sourceFilename":"device.db","sourceFilenameType":"str","destPath":"/coachproxy/home/pi/.node-red/flows","destPathType":"str","destFilename":"RVhabridge","destFilenameType":"global","link":false,"overwrite":true,"x":600,"y":4940,"wires":[[]]},{"id":"7a0c66bd.3b88a8","type":"inject","z":"f6c367c2.63b9b8","name":"Copy the HAbridge device.db - Deploy First!","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":4940,"wires":[["b9955953.ac37e8"]]},{"id":"fd3cac22.9e29c","type":"ui_text","z":"f6c367c2.63b9b8","group":"f961f048.b0646","order":4,"width":"0","height":"0","name":"RV Year","label":"RV Year","format":"{{msg.payload}}","layout":"","x":800,"y":4520,"wires":[]},{"id":"389485c1.a7c58a","type":"ui_text","z":"f6c367c2.63b9b8","group":"f961f048.b0646","order":6,"width":"","height":"","name":"RV Model","label":"RV Model","format":"{{msg.payload}}","layout":"","x":800,"y":4600,"wires":[]},{"id":"116b4baa.7495d4","type":"ui_text","z":"f6c367c2.63b9b8","group":"f961f048.b0646","order":7,"width":"","height":"","name":"RV Floorplan","label":"RV Floorplan","format":"{{msg.payload}}","layout":"","x":810,"y":4640,"wires":[]},{"id":"4faafacd.5a95b4","type":"ui_text","z":"f6c367c2.63b9b8","group":"f961f048.b0646","order":5,"width":"0","height":"0","name":"RV Brand","label":"RV Brand","format":"{{msg.payload}}","layout":"","x":800,"y":4560,"wires":[]},{"id":"5ff26403.0801bc","type":"ui_text","z":"f6c367c2.63b9b8","group":"f961f048.b0646","order":3,"width":"","height":"","name":"Flow Version","label":"eRVin Flow Version","format":"{{msg.payload}}","layout":"","x":810,"y":4680,"wires":[]},{"id":"a083fd62.16532","type":"mqtt out","z":"f6c367c2.63b9b8","name":"","topic":"GLOBAL/RVINFO","qos":"","retain":"","broker":"c1170463.5c7f8","x":410,"y":4660,"wires":[]},{"id":"f0ee341f.4eb798","type":"inject","z":"f6c367c2.63b9b8","name":"RIVINFO","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.5","topic":"eRVin","payload":"2017_Entegra_Aspire_44B_v_0.62_beta","payloadType":"str","x":180,"y":4600,"wires":[["9f8f43a0.25b69","a083fd62.16532","c0236fca.7fafa","98ea7fa9.04146"]],"info":"Enter the RV Info for this flow\nFormat to be 5 parameters as follows with spaces between:\n\nYear Brand Model Floorplan Flow_Version"},{"id":"9f8f43a0.25b69","type":"split","z":"f6c367c2.63b9b8","name":"","splt":"_","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":360,"y":4600,"wires":[["a9bbdd8e.0b7f5"]]},{"id":"a9bbdd8e.0b7f5","type":"switch","z":"f6c367c2.63b9b8","name":"","property":"parts.index","propertyType":"msg","rules":[{"t":"cont","v":"0","vt":"str"},{"t":"cont","v":"1","vt":"str"},{"t":"cont","v":"2","vt":"str"},{"t":"cont","v":"3","vt":"str"},{"t":"cont","v":"5","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":580,"y":4600,"wires":[["fd3cac22.9e29c"],["4faafacd.5a95b4"],["389485c1.a7c58a"],["116b4baa.7495d4"],["5ff26403.0801bc"]]},{"id":"8c874975.db1158","type":"comment","z":"f6c367c2.63b9b8","name":"Enter RV Info Below","info":"Enter the RV Info for this flow\n\nFormat to be 5 parameters as follows with underbar between:\n\nYear_Brand_Model_Floorplan_v_Version","x":185,"y":4536.08349609375,"wires":[]},{"id":"c0236fca.7fafa","type":"change","z":"f6c367c2.63b9b8","name":"","rules":[{"t":"set","p":"RVinfo","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":4720,"wires":[[]]},{"id":"98ea7fa9.04146","type":"string","z":"f6c367c2.63b9b8","d":true,"name":"","methods":[{"name":"delRightMost","params":[{"type":"str","value":"_v"}]},{"name":"append","params":[{"type":"str","value":".db"}]}],"prop":"payload","propout":"payload","object":"msg","objectout":"msg","x":350,"y":4780,"wires":[["cf96ad2e.ef8b6"]]},{"id":"cf96ad2e.ef8b6","type":"change","z":"f6c367c2.63b9b8","d":true,"name":"","rules":[{"t":"set","p":"RVhabridge","pt":"global","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":4780,"wires":[[]]},{"id":"e4261e91.a24ae","type":"comment","z":"f6c367c2.63b9b8","name":"Install System OS File v0.51","info":"","x":200,"y":4000,"wires":[]},{"id":"ce8dcee7.55c8b","type":"http request","z":"f6c367c2.63b9b8","name":"get filenames","method":"GET","ret":"txt","paytoqs":"ignore","url":"https://files.myervin.com/file-path.json","tls":"","persist":false,"proxy":"","authType":"","x":500,"y":4060,"wires":[["ef016d74.d578b"]]},{"id":"b20c2b31.9dd018","type":"ui_list","z":"f6c367c2.63b9b8","group":"14b5b6dc.5ab249","name":"List OS Files","order":2,"width":"6","height":"4","lineType":"one","actionType":"check","allowHTML":false,"outputs":1,"topic":"","x":470,"y":4140,"wires":[["9281a58b.a08a48"]]},{"id":"e267f53d.e9f508","type":"exec","z":"f6c367c2.63b9b8","command":"","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":770,"y":4280,"wires":[[],[],["77de7bd0.513ff4"]]},{"id":"6c5a8878.f6a268","type":"function","z":"f6c367c2.63b9b8","name":"","func":"// Copyright 20201 Rob Picchione\n// Formats wget for exec node to download selected file\n\nif (msg.payload.isChecked === false ) {\n    return null\n}\n\n\nosfiles = \"wget \" + \"https://files.myervin.com/\" + msg.payload.title + \" -P \" + msg.payload.description\n//habridgefiles = \"wget \" + \"https://habridge.myervin.com/\" + msg.payload.habridge +'.db' + \" -P \" + \"/coachproxy/home/pi/.node-red/flows\"\nvar msg2 = { 'enabled': false };\n//if (global.get('overwrite_habridge') == true) {\n//    var msg2 = { 'payload': habridgefiles};\n//}\nvar msg1 = { 'payload': osfiles};\n\nreturn [ msg1, msg2 ];\n","outputs":2,"noerr":0,"initialize":"","finalize":"","x":580,"y":4240,"wires":[["e267f53d.e9f508","72779d37.fa8394"],["b20c2b31.9dd018"]]},{"id":"5228abb8.d8fb44","type":"ui_toast","z":"f6c367c2.63b9b8","position":"top right","displayTime":"5","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"Successful","x":430,"y":4340,"wires":[]},{"id":"8868fd6c.ad1a","type":"change","z":"f6c367c2.63b9b8","name":"","rules":[{"t":"change","p":"payload.code","pt":"msg","from":"0","fromt":"num","to":"true","tot":"str"},{"t":"move","p":"payload.code","pt":"msg","to":"enabled","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"File Sucessfully Downloaded and Installled - Restarting eRVin may be necessary.","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":200,"y":4360,"wires":[["b20c2b31.9dd018","18524185.0ca25e","5228abb8.d8fb44"]]},{"id":"18524185.0ca25e","type":"ui_button","z":"f6c367c2.63b9b8","name":"","group":"14b5b6dc.5ab249","order":1,"width":0,"height":0,"passthru":true,"label":"List Online OS Files","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":240,"y":4060,"wires":[["ce8dcee7.55c8b"]]},{"id":"77de7bd0.513ff4","type":"switch","z":"f6c367c2.63b9b8","name":"error?","property":"payload.code","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"neq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":930,"y":4280,"wires":[["8868fd6c.ad1a"],["f8b4d841.938358"]]},{"id":"afacd380.920f5","type":"ui_toast","z":"f6c367c2.63b9b8","position":"dialog","displayTime":"3","highlight":"","sendall":false,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"","name":"Error","x":1290,"y":4280,"wires":[["8c34ed45.8be18"]]},{"id":"f8b4d841.938358","type":"change","z":"f6c367c2.63b9b8","name":"","rules":[{"t":"move","p":"payload.message","pt":"msg","to":"payload","tot":"msg"},{"t":"set","p":"topic","pt":"msg","to":"Error: ","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1120,"y":4280,"wires":[["afacd380.920f5"]]},{"id":"9281a58b.a08a48","type":"fs-ops-access","z":"f6c367c2.63b9b8","name":"file exists?","path":"payload.description","pathType":"msg","filename":"payload.title","filenameType":"msg","read":true,"write":false,"throwerror":false,"x":650,"y":4140,"wires":[["2d98d890.2d8818"],["6c5a8878.f6a268"]]},{"id":"2d98d890.2d8818","type":"change","z":"f6c367c2.63b9b8","name":"","rules":[{"t":"move","p":"payload","pt":"msg","to":"payloadtoo","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"The configuration file selected already exists on eRVin, are you sure you want to overwrite it?","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":860,"y":4140,"wires":[["b3f1d80c.0ab3a8"]]},{"id":"c4594cf6.bc839","type":"ui_template","z":"f6c367c2.63b9b8","group":"14b5b6dc.5ab249","name":"Install OS Files","order":3,"width":"0","height":"0","format":"\n<div layout=\"column\" layout-align=\"space-between\">\n<p>\n- This feature will allow you to download and automatically install new and/or updated operating system (OS) files from the eRVin server online. OS files differ from configuration files in that they replace core system files. This is not normally necessary, but sometimes an OS file needs an adjustement and it is much quicker than flashing a new image.\n<br>- <b>Do not use this feature unless you have been instructed to do so and know exactly what file you need.</b>\n<br>- To use, simply click the checkbox of the file you need. If the file already exists you will be prompted to confirm its replacement.\n<br>- This feature requires that eRVin have an internet connection. \n</p>\n</div>\n","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","className":"","x":260,"y":4120,"wires":[[]]},{"id":"72779d37.fa8394","type":"ui_toast","z":"f6c367c2.63b9b8","position":"top right","displayTime":"4","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"File Download in Progress","name":"Downloading","x":790,"y":4220,"wires":[]},{"id":"b3f1d80c.0ab3a8","type":"ui_toast","z":"f6c367c2.63b9b8","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"Overwrite","cancel":"Cancel","raw":false,"topic":"","name":"","x":1050,"y":4140,"wires":[["60560544.3feb1c"]]},{"id":"60560544.3feb1c","type":"switch","z":"f6c367c2.63b9b8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Overwrite","vt":"str"},{"t":"eq","v":"Cancel","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1210,"y":4140,"wires":[["94dae68f.65c928"],["18524185.0ca25e"]]},{"id":"94dae68f.65c928","type":"change","z":"f6c367c2.63b9b8","name":"","rules":[{"t":"move","p":"payloadtoo","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1420,"y":4140,"wires":[["c1b99c6a.a851e"]]},{"id":"c1b99c6a.a851e","type":"fs-ops-delete","z":"f6c367c2.63b9b8","name":"del OS file","path":"payload.description","pathType":"msg","filename":"payload.title","filenameType":"msg","x":1630,"y":4140,"wires":[["6c5a8878.f6a268"]]},{"id":"ef016d74.d578b","type":"json","z":"f6c367c2.63b9b8","name":"","property":"payload","action":"obj","pretty":false,"x":670,"y":4060,"wires":[["b20c2b31.9dd018"]]},{"id":"8c34ed45.8be18","type":"change","z":"f6c367c2.63b9b8","name":"","rules":[{"t":"set","p":"enabled","pt":"msg","to":"true","tot":"bool"},{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"topic","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":200,"y":4420,"wires":[["b20c2b31.9dd018"]]},{"id":"8b958bd5.8a9ad8","type":"comment","z":"f6c367c2.63b9b8","name":"Install eRVin Configuration File No HaBridge v0.60","info":"This flow will copy a file with a descriptive filename from /coachproxy/home/pi/.node-red/flows write it to the node red flows file at /coachproxy/home/pi/.node-red with the filename flows_coachproxy.json. This is the default flow node-red will use when it starts up.\n","x":270,"y":2140,"wires":[]},{"id":"9ce9d4c9.879228","type":"inject","z":"f6c367c2.63b9b8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.5","topic":"","payload":"","payloadType":"date","x":270,"y":2200,"wires":[["a5b16965.f4ca58"]]},{"id":"a5b16965.f4ca58","type":"fs-ops-dir","z":"f6c367c2.63b9b8","name":"","path":"/coachproxy/home/pi/.node-red/flows/","pathType":"str","filter":"v","filterType":"str","dir":"options","dirType":"msg","x":160,"y":2280,"wires":[["2d42c8e6.2554c8"]]},{"id":"fa5ac586.0a6e88","type":"fs-ops-copy","z":"f6c367c2.63b9b8","name":"Write Flow File","sourcePath":"/coachproxy/home/pi/.node-red/flows","sourcePathType":"str","sourceFilename":"payload","sourceFilenameType":"msg","destPath":"/coachproxy/home/pi/.node-red","destPathType":"str","destFilename":"flows_coachproxy.json","destFilenameType":"str","link":false,"overwrite":true,"x":1080,"y":2420,"wires":[["bb8a7d75.0c309"]]},{"id":"2d42c8e6.2554c8","type":"ui_dropdown","z":"f6c367c2.63b9b8","name":"Select RV Flow File","label":"","tooltip":"","place":"Select RV Model","group":"9c7e0074.77f72","order":2,"width":"0","height":"0","passthru":false,"multiple":false,"options":[{"label":"","value":"","type":"str"}],"payload":"","topic":"","x":350,"y":2280,"wires":[["1ceae998.c833f6"]]},{"id":"1ceae998.c833f6","type":"change","z":"f6c367c2.63b9b8","name":"Set Global","rules":[{"t":"set","p":"RVflow","pt":"global","to":"payload","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"Are you sure you want to reset the RV Info? This will restart eRVin. Please allow 5 minutes for the new configuration to load.","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":2280,"wires":[[]]},{"id":"1507084a.495cc8","type":"ui_template","z":"f6c367c2.63b9b8","group":"9c7e0074.77f72","name":"Install Configuration Instructions","order":1,"width":"0","height":"0","format":"<div>\n    <p>\n    <br><b>To reconfigure eRVin for your RV, please select your RV model from the dropdown list below, then click the INSTALL CONFIGURATION button below.</b>\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","className":"","x":210,"y":2380,"wires":[[]]},{"id":"f776b1fd.3f32f","type":"ui_toast","z":"f6c367c2.63b9b8","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"Restart","cancel":"Cancel","raw":false,"topic":"","name":"","x":490,"y":2420,"wires":[["12bcf7ee.2c0ac8"]]},{"id":"135557e3.35e948","type":"change","z":"f6c367c2.63b9b8","name":"Get Flow Name","rules":[{"t":"change","p":"payload","pt":"msg","from":"Restart","fromt":"str","to":"RVflow","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":860,"y":2420,"wires":[["fa5ac586.0a6e88","ccb40c64.34ea8","2e22588b.4fc708"]]},{"id":"12bcf7ee.2c0ac8","type":"switch","z":"f6c367c2.63b9b8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Restart","vt":"str"},{"t":"eq","v":"Cancel","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":650,"y":2420,"wires":[["135557e3.35e948"],["a5b16965.f4ca58"]]},{"id":"bb8a7d75.0c309","type":"change","z":"f6c367c2.63b9b8","name":"Reset","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1270,"y":2420,"wires":[["a5b16965.f4ca58"]]},{"id":"d096e4f3.6fdec8","type":"link out","z":"f6c367c2.63b9b8","name":"Reboot","links":["d4502958.2b9688"],"x":1215,"y":2500,"wires":[]},{"id":"2e22588b.4fc708","type":"ui_toast","z":"f6c367c2.63b9b8","position":"top right","displayTime":"5","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"Restarting eRVin now - Please allow a few minutes for the new configuration to load...","name":"Restart eRVin","x":1080,"y":2460,"wires":[]},{"id":"ccb40c64.34ea8","type":"delay","z":"f6c367c2.63b9b8","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":1060,"y":2500,"wires":[["d096e4f3.6fdec8"]]},{"id":"404ef446.d4f0bc","type":"ui_button","z":"f6c367c2.63b9b8","name":"","group":"9c7e0074.77f72","order":16,"width":0,"height":0,"passthru":false,"label":"Install Configuration","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Are you sure you want to replace the configuration file? This will reset your settings to default and restart eRVin. Please allow up to 5 minutes for the new configuration to load.","payloadType":"str","topic":"","x":180,"y":2420,"wires":[["f776b1fd.3f32f"]]},{"id":"e3c8e0a7.76c6b","type":"link in","z":"f6c367c2.63b9b8","name":"Refresh File List","links":["a2637dd4.1984e","2ea0a0c2.397e2"],"x":115,"y":2200,"wires":[["a5b16965.f4ca58"]]},{"id":"7e24c7bb.c6e078","type":"catch","z":"f6c367c2.63b9b8","name":"Missing HAbridge File","scope":["20a0a995.f8edc6","fa5ac586.0a6e88"],"uncaught":false,"x":180,"y":2480,"wires":[["68a5ba10.f26414"]]},{"id":"1eacc907.629517","type":"ui_toast","z":"f6c367c2.63b9b8","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"Error","name":"Error","x":630,"y":2480,"wires":[[]]},{"id":"68a5ba10.f26414","type":"change","z":"f6c367c2.63b9b8","name":"","rules":[{"t":"move","p":"error.message","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":2480,"wires":[["1eacc907.629517"]]},{"id":"26400bbb.894a74","type":"sunriseinput","z":"84f0327e.4d899","name":"","lat":"0","lon":"0","start":"sunrise","end":"sunset","x":2030,"y":200,"wires":[["98dc4ffc.5ba9a"],["717f8a1a.529584","e475a59d.caa8c8"]]},{"id":"5bddb5f3.7fdd0c","type":"e-mail","z":"84f0327e.4d899","server":"smtp.ionos,com","port":"465","secure":true,"tls":false,"name":"picchione@symatica.com","dname":"email","x":2470,"y":260,"wires":[]},{"id":"717f8a1a.529584","type":"change","z":"84f0327e.4d899","name":"","rules":[{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"The sun has risen!","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"The sun has set!","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2280,"y":260,"wires":[["5bddb5f3.7fdd0c"]]},{"id":"e475a59d.caa8c8","type":"change","z":"84f0327e.4d899","d":true,"name":"Underslideout Lights","rules":[{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"37 3","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"37 2","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2300,"y":140,"wires":[["401e792b.e6cb28","8c8302fc.0811b"]]},{"id":"81539a29.32aa88","type":"ui_gauge","z":"84f0327e.4d899","name":"","group":"4ba9cfc2.1a222","order":0,"width":0,"height":0,"gtype":"donut","title":"Moon_Phase","label":"Full","format":"{{value * 100}}%","min":0,"max":"1","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":2490,"y":200,"wires":[]},{"id":"98dc4ffc.5ba9a","type":"change","z":"84f0327e.4d899","name":"Change to Moon","rules":[{"t":"move","p":"moon","pt":"msg","to":"payload","tot":"msg"},{"t":"change","p":"topic","pt":"msg","from":"sun","fromt":"str","to":"moon","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2280,"y":200,"wires":[["81539a29.32aa88"]]},{"id":"da466187.b92b","type":"gpsd","z":"84f0327e.4d899","name":"","hostname":"localhost","port":"2947","tpv":true,"sky":false,"info":false,"device":false,"gst":false,"att":false,"x":150,"y":140,"wires":[["95e3a2fb.f8f4c","668ef115.321fd","3eaa4f8c.b0751","61c02ef5.4c7d4","953418c5.5e4b28","a9f408e1.e5f158","f4c9ccbe.3c18a","bd3be246.2ee1f","9d55a071.cd775","238a32bb.fc048e"]]},{"id":"3a0fc3c7.305cec","type":"file","z":"84f0327e.4d899","name":"gpsd_output","filename":"/coachproxy/gps/gpsd.json","appendNewline":true,"createDir":false,"overwriteFile":"false","x":1030,"y":140,"wires":[[]]},{"id":"4769a2fc.eda06c","type":"csv","z":"84f0327e.4d899","name":"gpsd-csv","sep":",","hdrin":"","hdrout":false,"multi":"one","ret":"\\n","temp":"class,tag,device,mode,time,ept,lat,lon,alt,epx,epy,epv,track,speed,climb,eps,epc","skip":0,"strings":true,"x":1020,"y":180,"wires":[["2321febd.6c2042"]]},{"id":"2321febd.6c2042","type":"file","z":"84f0327e.4d899","name":"gpsd-csv-file","filename":"/coachproxy/gps/gpsd.csv","appendNewline":true,"createDir":false,"overwriteFile":"false","x":1190,"y":180,"wires":[[]]},{"id":"2451ae81.0f3022","type":"ui_text","z":"84f0327e.4d899","d":true,"group":"fc3455d4.45be98","order":2,"width":"6","height":"3","name":"Location","label":"","format":"Time: {{msg.payload.time}} <br> Lat:      {{msg.payload.lat}} <br> Lon: {{msg.payload.lon}} <br> Altitude: {{msg.payload.alt}}<br> Speed: {{msg.payload.speed}} <br>","layout":"row-left","x":1020,"y":220,"wires":[]},{"id":"7db7a4f6.12374c","type":"comment","z":"84f0327e.4d899","name":"GPS","info":"no gps antenna no output\n\nwith antenna but no fix there will be output with mode less than 2","x":150,"y":80,"wires":[]},{"id":"a83ac3e4.11903","type":"comment","z":"84f0327e.4d899","name":"Sunrise/Sunset Preliminary","info":"","x":1690,"y":100,"wires":[]},{"id":"401e792b.e6cb28","type":"link out","z":"84f0327e.4d899","name":"GPS","links":["c5b4b8df.138d88"],"x":2455,"y":140,"wires":[]},{"id":"95e3a2fb.f8f4c","type":"change","z":"84f0327e.4d899","name":"GPS Status","rules":[{"t":"change","p":"payload.mode","pt":"msg","from":"3","fromt":"num","to":"<font color=\"green\">3D Fix","tot":"str"},{"t":"change","p":"payload.mode","pt":"msg","from":"2","fromt":"num","to":"<font color=\"orange\">2D Fix","tot":"str"},{"t":"change","p":"payload.mode","pt":"msg","from":"1","fromt":"num","to":"<font color=\"red\">No Fix","tot":"str"},{"t":"change","p":"payload.mode","pt":"msg","from":"0","fromt":"num","to":"<font color=\"black\">No Signal","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":170,"y":480,"wires":[["6ebe1f77.189ed"]]},{"id":"6ebe1f77.189ed","type":"ui_text","z":"84f0327e.4d899","group":"fc3455d4.45be98","order":1,"width":0,"height":0,"name":"","label":"GPS Signal:","format":"{{msg.payload.mode}}","layout":"row-spread","x":610,"y":480,"wires":[]},{"id":"3eaa4f8c.b0751","type":"ui_text","z":"84f0327e.4d899","group":"fc3455d4.45be98","order":3,"width":"0","height":"0","name":"Time","label":"Time:","format":"{{msg.payload.time}}","layout":"row-spread","x":590,"y":400,"wires":[]},{"id":"2c136ef8.e21892","type":"ui_text","z":"84f0327e.4d899","group":"fc3455d4.45be98","order":4,"width":"0","height":"0","name":"Latitude","label":"Latitude:","format":"{{msg.payload.lat}}","layout":"row-spread","x":600,"y":580,"wires":[]},{"id":"b8929554.9ee848","type":"ui_text","z":"84f0327e.4d899","group":"fc3455d4.45be98","order":5,"width":"0","height":"0","name":"Longitude","label":"Longitude:","format":"{{msg.payload.lon}}","layout":"row-spread","x":600,"y":660,"wires":[]},{"id":"cc5f38b1.f0b3a8","type":"ui_text","z":"84f0327e.4d899","group":"fc3455d4.45be98","order":6,"width":"0","height":"0","name":"Altitude","label":"Altitude:","format":"{{msg.payload.alt}}","layout":"row-spread","x":600,"y":700,"wires":[]},{"id":"209de8a9.806048","type":"ui_text","z":"84f0327e.4d899","group":"fc3455d4.45be98","order":7,"width":"0","height":"0","name":"Speed","label":"Speed:","format":"{{payload}}","layout":"row-spread","x":590,"y":440,"wires":[]},{"id":"668ef115.321fd","type":"smooth","z":"84f0327e.4d899","name":"Smooth Lat","property":"payload.lat","action":"mean","count":"10","round":"9","mult":"single","reduce":true,"x":170,"y":580,"wires":[["2c136ef8.e21892","476fa4b7.b0490c"]]},{"id":"a9f408e1.e5f158","type":"mqtt out","z":"84f0327e.4d899","name":"","topic":"CP/GPSDATA","qos":"","retain":"","broker":"c1170463.5c7f8","x":380,"y":100,"wires":[]},{"id":"e2540de8.587fd","type":"worldmap","z":"84f0327e.4d899","name":"","lat":"","lon":"","zoom":"","layer":"OSM","cluster":"","maxage":"","usermenu":"show","layers":"show","panit":"false","panlock":"false","zoomlock":"false","hiderightclick":"false","coords":"none","showgrid":"false","path":"/worldmap","x":1120,"y":880,"wires":[]},{"id":"618c8254.f7b8dc","type":"worldmap in","z":"84f0327e.4d899","name":"","path":"/worldmap","events":"all","x":1120,"y":820,"wires":[["a4c2bb96.24c3d8","ea6b2a10.916738"]]},{"id":"2efb075b.189718","type":"worldmap-tracks","z":"84f0327e.4d899","name":"","depth":20,"layer":"combined","x":830,"y":940,"wires":[["e2540de8.587fd","259f35a3.b1545a"]]},{"id":"476fa4b7.b0490c","type":"function","z":"84f0327e.4d899","name":"Format JSON","func":"//  20201130  Rob Picchione myERVIN.com\n// \n// Using the output of the 'node-red-contrib-gpsd' node.\n//\n// Checks to see if there is a fix (mode >=2) and if so\n// sets 'lat' and 'lon' values in global context. \n// mode = 2 is a 2D fix, mode = 3 is a 3D fix\n// \n// Aditionally formats and outputs lat, lon, name, speed and icon\n// values formatted for the worldmap node.\n\nlet mode = msg.payload.mode;\n\nif (mode >= 2 ) {\n    global.set('lat', msg.payload.lat); \n    global.set('lon', msg.payload.lon);\n    global.set('locsource', 'GPS');\n}\n\n// global.set('lat',msg.payload.lat);\n// global.set('lon',msg.payload.lon);\n\nreturn {\n    payload: {\n        location: global.get('locsource'),\n        lat: msg.payload.lat,\n        lon: msg.payload.lon,\n        name: \"eRVin\",\n        speed: msg.payload.speed,\n        icon: 'fa-bus'\n    }\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":620,"y":820,"wires":[["2efb075b.189718","e2540de8.587fd","259f35a3.b1545a"]]},{"id":"61c02ef5.4c7d4","type":"smooth","z":"84f0327e.4d899","name":"Smooth Lon","property":"payload.lon","action":"mean","count":"10","round":"9","mult":"single","reduce":true,"x":170,"y":660,"wires":[["b8929554.9ee848"]]},{"id":"953418c5.5e4b28","type":"smooth","z":"84f0327e.4d899","name":"Smooth Alt","property":"payload.alt","action":"mean","count":"15","round":"2","mult":"single","reduce":true,"x":170,"y":700,"wires":[["cc5f38b1.f0b3a8"]]},{"id":"259f35a3.b1545a","type":"ui_worldmap","z":"84f0327e.4d899","group":"b7dc85ae.2ad0a8","order":1,"width":0,"height":0,"name":"","lat":"","lon":"","zoom":"","layer":"OSM","cluster":"","maxage":"","usermenu":"show","layers":"show","panit":"true","panlock":"false","zoomlock":"false","hiderightclick":"true","coords":"none","showgrid":"false","path":"/worldmap","x":1120,"y":940,"wires":[]},{"id":"f4c9ccbe.3c18a","type":"rbe","z":"84f0327e.4d899","name":"Deadband Speed","func":"deadband","gap":"1","start":"","inout":"in","property":"payload.speed","x":190,"y":440,"wires":[["c6c2b096.d89e5"]]},{"id":"c6c2b096.d89e5","type":"function","z":"84f0327e.4d899","name":"Noise","func":"let speed = msg.payload.speed;\n\nif (speed <=2) {\n    speed = 0;\n}\n\nreturn {payload: speed };\n\n","outputs":1,"noerr":0,"x":370,"y":440,"wires":[["209de8a9.806048"]]},{"id":"bd3be246.2ee1f","type":"function","z":"84f0327e.4d899","d":true,"name":"Moving?","func":"// checks to see if speed is high enough to indicate a moving vehicle\n// if so passes gps data on, if not supresses gps data\n\nlet speed = msg.payload.speed;\n\nif (speed >= 3) {\n     \n     var msg1 = {\n        'payload' : msg.payload,\n    };\n\n  return [ msg1 ];\n} ","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":140,"wires":[["3a0fc3c7.305cec","4769a2fc.eda06c"]]},{"id":"bbd128c0.0f84d8","type":"ui_template","z":"84f0327e.4d899","group":"9ee7e038.56def","name":"","order":1,"width":"6","height":"2","format":"<div>\n<p>\n    If not using a GPS receiver enter a 5 digit Zip Code below which will provide approximate lat/lon to ensure accurate sunrise/sunset info.\n</p>\n</div>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1160,"y":360,"wires":[[]]},{"id":"9d40e137.b7104","type":"file in","z":"84f0327e.4d899","name":"zip2latlon.txt","filename":"/coachproxy/home/pi/.node-red/location/zip2latlon.txt","format":"lines","chunk":false,"sendError":false,"encoding":"none","x":1590,"y":440,"wires":[["6850bc9e.1a7c34"]]},{"id":"6850bc9e.1a7c34","type":"csv","z":"84f0327e.4d899","name":"","sep":",","hdrin":true,"hdrout":"none","multi":"one","ret":"\\n","temp":"","skip":"0","strings":false,"x":1750,"y":440,"wires":[["52555894.4ea9c8"]]},{"id":"cca4f073.9d09a","type":"ui_form","z":"84f0327e.4d899","name":"Enter Zip","label":"","group":"9ee7e038.56def","order":2,"width":"0","height":"0","options":[{"label":"Zip Code","value":"enteredzip","type":"text","required":true,"rows":null}],"formValue":{"enteredzip":""},"payload":"","submit":"submit","cancel":"cancel","topic":"","x":1160,"y":400,"wires":[["20cf9cbf.605ea4"]]},{"id":"9109986c.6a03f8","type":"change","z":"84f0327e.4d899","name":"Format man lat/lon","rules":[{"t":"set","p":"payload.lat","pt":"msg","to":"$number(payload.lat)","tot":"jsonata"},{"t":"set","p":"payload.lon","pt":"msg","to":"$number(payload.lon)","tot":"jsonata"},{"t":"set","p":"payload.name","pt":"msg","to":"eRVin","tot":"str"},{"t":"set","p":"payload.icon","pt":"msg","to":"fa-bus","tot":"str"},{"t":"set","p":"lat","pt":"global","to":"payload.lat","tot":"msg"},{"t":"set","p":"lon","pt":"global","to":"payload.lon","tot":"msg"},{"t":"set","p":"payload.location","pt":"msg","to":"locsource","tot":"global"},{"t":"set","p":"topic","pt":"msg","to":"manloc","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":580,"wires":[["e2540de8.587fd","259f35a3.b1545a","2c136ef8.e21892","b8929554.9ee848"]]},{"id":"239a5efd.4a95c2","type":"change","z":"84f0327e.4d899","name":"","rules":[{"t":"set","p":"enteredzip","pt":"global","to":"payload.enteredzip","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"payload.enteredzip","tot":"msg"},{"t":"set","p":"enteredzipvalid","pt":"global","to":"false","tot":"bool"},{"t":"set","p":"locsource","pt":"global","to":"zipcode","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1720,"y":380,"wires":[["9d40e137.b7104","c58b2c5b.eea6c"]]},{"id":"c96bf7c.fdaa908","type":"function","z":"84f0327e.4d899","name":"PrePop","func":"//  20201212  Rob Picchione myERVIN.com\n// \n// prepopulates previously entered zipcode\n\n\n// initialize with location source based on zipcode, if gps is connected\n// this will be reset to 'gps' by the gps flow when it comes online.\nglobal.set('locsource','zipcode')\n\n// define existing zipcode saveed in global context.\nvar zip = global.get('enteredzip');\n\n// on msg1 output the format required by the form node to \n// prepopulate the entry field.\n// output format for form node: {\"enteredzip\":\"32043\"}\n\nvar msg1 = {payload : {'enteredzip': zip}}\n\n// on msg2 output the enteredzip value as a numeric.\nvar msg2 = {payload : zip}\n\nreturn [ msg1, msg2 ];\n","outputs":2,"noerr":0,"initialize":"","finalize":"","x":980,"y":440,"wires":[["cca4f073.9d09a"],[]]},{"id":"235f5819.83fcd8","type":"change","z":"84f0327e.4d899","name":"","rules":[{"t":"set","p":"lat","pt":"msg","to":"lat","tot":"global"},{"t":"set","p":"lon","pt":"msg","to":"lon","tot":"global"}],"action":"","property":"","from":"","to":"","reg":false,"x":1820,"y":200,"wires":[["26400bbb.894a74"]]},{"id":"a1c6f71c.7c4828","type":"inject","z":"84f0327e.4d899","name":"","props":[{"p":"time","v":"","vt":"date"},{"p":"topic","vt":"str"}],"repeat":"1800","crontab":"","once":true,"onceDelay":"5","topic":"","payloadType":"str","x":1650,"y":200,"wires":[["235f5819.83fcd8"]]},{"id":"3c8106.4aa23efa","type":"comment","z":"84f0327e.4d899","name":"Write GPS data to file","info":"","x":860,"y":80,"wires":[]},{"id":"326e6727.f61518","type":"comment","z":"84f0327e.4d899","name":"Enter Zip Code if no GPS","info":"If there is no GPS or there is no valid GPS signal the zip code can be entereed manually to approximate location. This will allow the sunset and other location based routines to be accurate.\n\nAt startup if there is a value for the zip code saved in global context (enteredzip) it is used to populate the zip code field in the form entry.\n\nThe zip code is compared to a csv file containing zip, lat and lon. If there is a hit, the zip code is entered in the global context and the gate is closed. If there is no hit the gate never closes and the end of file is reached with non0existant zip of 99999 which triggers an error pop up.","x":870,"y":340,"wires":[]},{"id":"92b1f48e.9f48c8","type":"comment","z":"84f0327e.4d899","name":"Worldmap","info":"","x":1120,"y":760,"wires":[]},{"id":"ed7f1f5f.1c157","type":"inject","z":"84f0327e.4d899","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"","payloadType":"date","x":850,"y":380,"wires":[["c96bf7c.fdaa908"]]},{"id":"babd038b.2cf2","type":"ui_list","z":"84f0327e.4d899","d":true,"group":"fcc7d16a.5f2a2","name":"Sunset Actions","order":1,"width":"6","height":"6","lineType":"two","actionType":"check","allowHTML":true,"outputs":1,"topic":"/coachproxy/node-red/sunset","x":2640,"y":420,"wires":[["806f1675.9b7ef8"]]},{"id":"4eae0c33.89c844","type":"link in","z":"84f0327e.4d899","name":"Sunset List","links":["bed0fea6.6dc72","d28dfe3db7c5517b"],"x":2505,"y":420,"wires":[["babd038b.2cf2"]]},{"id":"f44cb000.cb3e9","type":"change","z":"84f0327e.4d899","d":true,"name":"","rules":[{"t":"set","p":"sunset,[key]","pt":"global","to":"payload.description","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2880,"y":340,"wires":[[]]},{"id":"806f1675.9b7ef8","type":"function","z":"84f0327e.4d899","d":true,"name":"","func":"// (c) 2020 eRVin project Rob Picchion\n\n// var instance = msg.payload.description;\n// var title = msg.payload.title;\n// var brightness = msg.payload.brightness;\n\nvar state = msg.payload.isChecked;\nvar description = msg.payload.description\n\n\nglobal.set('sunset.lights[' + description + '].suntrig', state);\n\nvar suntrig = global.get('sunset.lights');\n\nmsg.payload = suntrig\n\n\n// global.set('sunset[' + description + ']', description);\n\n// global.set ('sunset[' + instance + '].instance', instance);\n\n//var brightness = global.get('status').lights[description].brightness;\n//var state = global.get('status').lights[description].state;\n//var command = (brightness == 100) ? 2 : (brightness > 0) ? 0 : 3;\n\n// alternate code for above to get 'brightness' and 'state' global context variables\n// var lightlist = global.get ('status').lights;\n// var brightness = lightlist[description].brightness;\n// var state = lightlist[description].state;\n\n// Add to the global context data the friendly name associated with the device instance\n// global.set('status.lights[' + description + '].instancename', title);\n\n\n//msg.payload = { title, description, command, brightness};\n//var newmsg = { payload: msg.payload};\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2880,"y":400,"wires":[[]]},{"id":"ebbddd3f.50c51","type":"inject","z":"84f0327e.4d899","d":true,"name":"Day of Week","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"[{\"title\":\"Porch Light\",\"isChecked\":true}]","payloadType":"json","x":2570,"y":500,"wires":[["babd038b.2cf2"]]},{"id":"fa391523.dd9e58","type":"function","z":"84f0327e.4d899","d":true,"name":"","func":"global.set(\"sunset.lights\", {});\nreturn msg;\n//global.set(\"RangeTemperaturesA\",[]); //array\n// global.set('status.lights', {}); //object","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2890,"y":540,"wires":[[]]},{"id":"5381f084.b6ded","type":"inject","z":"84f0327e.4d899","d":true,"name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2730,"y":600,"wires":[["fa391523.dd9e58"]]},{"id":"15d2cf79.bf2951","type":"inject","z":"84f0327e.4d899","name":"Simulate Sunset","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"0","payloadType":"num","x":2020,"y":100,"wires":[["e475a59d.caa8c8"]]},{"id":"e49bff45.ad2b2","type":"inject","z":"84f0327e.4d899","name":"Simulate Sunrise","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"num","x":2020,"y":140,"wires":[["e475a59d.caa8c8"]]},{"id":"8c8302fc.0811b","type":"debug","z":"84f0327e.4d899","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2470,"y":100,"wires":[]},{"id":"40592451.43825c","type":"string","z":"84f0327e.4d899","name":"","methods":[{"name":"padLeft","params":[{"type":"num","value":"5"},{"type":"str","value":"0"}]}],"prop":"payload.enteredzip","propout":"payload.enteredzip","object":"msg","objectout":"msg","x":1550,"y":380,"wires":[["239a5efd.4a95c2"]]},{"id":"eba7b64f.104578","type":"switch","z":"84f0327e.4d899","name":"Limit Range","property":"$number(payload.enteredzip)","propertyType":"jsonata","rules":[{"t":"btwn","v":"00601","vt":"num","v2":"99929","v2t":"num"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":1350,"y":440,"wires":[["40592451.43825c"],["ba041831.2d1658"]]},{"id":"f0229cb7.c8943","type":"ui_toast","z":"84f0327e.4d899","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"","raw":false,"topic":"Invalid ZipCode","name":"Invalid ZipCode","x":2080,"y":340,"wires":[[]]},{"id":"52555894.4ea9c8","type":"function","z":"84f0327e.4d899","name":"","func":"// copyright 2021 Rob Picchione myervin.com\n// This function checks for a valid zipcode. As the \n// /coachproxy/home/pi/.node-red/location/zip2latlon.txt is scanned line by\n// line lookoig for a match to enteredzip. When a match is found, the zip plus\n// lat lon info is output on msg1 and the pop up message is cancelled by the\n// null output on msg3. If no match is found the enteredzip plus an error\n// message is output on msg2 and again the pop up is cancelled via msg3.\n\n\nvar msg3 = {'payload':\"\"};\n\nif (msg.payload.zip == global.get('enteredzip')) {\n    global.set('enteredzipvalid', true);\n    var msg1 = {'payload':msg.payload};\n    return [msg1,[],msg3];\n}\n\n\nif (msg.parts.count == 33144 && global.get('enteredzipvalid') == false) {\n     var msg2 = { 'payload' : global.get('enteredzip') + ' Does Not Exist'};\n    return [[],msg2, msg3];\n}\n\nreturn null\n","outputs":3,"noerr":0,"initialize":"","finalize":"","x":1900,"y":440,"wires":[["9109986c.6a03f8"],["f0229cb7.c8943"],["c58b2c5b.eea6c"]]},{"id":"ba041831.2d1658","type":"change","z":"84f0327e.4d899","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Bad Format","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1560,"y":340,"wires":[["f0229cb7.c8943"]]},{"id":"c58b2c5b.eea6c","type":"ui_toast","z":"84f0327e.4d899","position":"top right","displayTime":"20","highlight":"","sendall":false,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"Searching for Lat/Lon","name":"Searching","x":2100,"y":380,"wires":[]},{"id":"20cf9cbf.605ea4","type":"string","z":"84f0327e.4d899","name":"","methods":[{"name":"left","params":[{"type":"num","value":"5"}]}],"prop":"payload.enteredzip","propout":"payload.enteredzip","object":"msg","objectout":"msg","x":1170,"y":460,"wires":[["eba7b64f.104578"]]},{"id":"b0a2ddd.92d4f2","type":"comment","z":"84f0327e.4d899","name":"Refresh Map and Location Icon","info":"Refresehes the map and icon when the Location tab is accessed. Only active when a GPS is not connected and a valid zip code has been provided.","x":1430,"y":760,"wires":[]},{"id":"aeeab90a.af5058","type":"inject","z":"84f0327e.4d899","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":310,"y":320,"wires":[["9d55a071.cd775"]]},{"id":"9d55a071.cd775","type":"trigger","z":"84f0327e.4d899","name":"Clear GPS Data","op1":"","op2":"","op1type":"nul","op2type":"str","duration":"2","extend":true,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"payload.time","outputs":1,"x":320,"y":380,"wires":[["3eaa4f8c.b0751","209de8a9.806048","6ebe1f77.189ed","cc5f38b1.f0b3a8"]],"info":"Clears the GPS data displayed in the dashboard if the GPS is not active."},{"id":"f373ef81.a66a1","type":"change","z":"84f0327e.4d899","name":"","rules":[{"t":"set","p":"payload.zip","pt":"msg","to":"enteredzip","tot":"global"},{"t":"set","p":"payload.location","pt":"msg","to":"locsource","tot":"global"},{"t":"set","p":"payload.name","pt":"msg","to":"eRVin","tot":"str"},{"t":"set","p":"payload.lat","pt":"msg","to":"lat","tot":"global"},{"t":"set","p":"payload.lon","pt":"msg","to":"lon","tot":"global"},{"t":"set","p":"payload.icon","pt":"msg","to":"fa-bus","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"manloc","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1540,"y":840,"wires":[["c96bf7c.fdaa908","e2540de8.587fd","259f35a3.b1545a","7d2a86a7.0d1c88"]]},{"id":"a4c2bb96.24c3d8","type":"switch","z":"84f0327e.4d899","name":"","property":"payload.action","propertyType":"msg","rules":[{"t":"eq","v":"connected","vt":"str"},{"t":"eq","v":"layer","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":1350,"y":820,"wires":[["f373ef81.a66a1"],["f373ef81.a66a1"],[]]},{"id":"ea6b2a10.916738","type":"debug","z":"84f0327e.4d899","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1450,"y":940,"wires":[]},{"id":"7d2a86a7.0d1c88","type":"debug","z":"84f0327e.4d899","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1460,"y":1020,"wires":[]},{"id":"238a32bb.fc048e","type":"smooth","z":"84f0327e.4d899","name":"Smooth Track","property":"payload.track","action":"mean","count":"5","round":"1","mult":"single","reduce":true,"x":180,"y":740,"wires":[["a9c537c7.d96018","c07dc05c.f4c1f","148574dd.95d4ab","7c273514.5ad06c","204166c2.37421a","db01536b.99015","be605291.1fda2","94bfad75.b2923","16f55d76.97f383"]]},{"id":"bc4ce6fa.d31f78","type":"ui_text","z":"84f0327e.4d899","group":"fc3455d4.45be98","order":6,"width":"0","height":"0","name":"Track/Heading","label":"Heading:","format":"{{msg.payload.track}}","layout":"row-spread","x":620,"y":740,"wires":[]},{"id":"a9c537c7.d96018","type":"range","z":"84f0327e.4d899","minin":"337.6","maxin":"360","minout":"0","maxout":"0","action":"scale","round":true,"property":"payload,track","name":"N0","x":350,"y":740,"wires":[["80672e7a.74eae"]]},{"id":"c07dc05c.f4c1f","type":"range","z":"84f0327e.4d899","minin":"0","maxin":"180","minout":"0","maxout":"0","action":"scale","round":true,"property":"payload.track","name":"N360","x":350,"y":760,"wires":[["80672e7a.74eae"]]},{"id":"148574dd.95d4ab","type":"range","z":"84f0327e.4d899","minin":"22.6","maxin":"67.5","minout":"45","maxout":"45","action":"scale","round":false,"property":"payload.track","name":"NE45","x":350,"y":780,"wires":[["80672e7a.74eae"]]},{"id":"7c273514.5ad06c","type":"range","z":"84f0327e.4d899","minin":"67.6","maxin":"112.5","minout":"90","maxout":"90","action":"scale","round":true,"property":"payload.track","name":"E90","x":350,"y":800,"wires":[["80672e7a.74eae"]]},{"id":"204166c2.37421a","type":"range","z":"84f0327e.4d899","minin":"112.6","maxin":"157.5","minout":"135","maxout":"135","action":"scale","round":true,"property":"payload.track","name":"SE135","x":350,"y":820,"wires":[["80672e7a.74eae"]]},{"id":"db01536b.99015","type":"range","z":"84f0327e.4d899","minin":"157.6","maxin":"202.5","minout":"180","maxout":"180","action":"scale","round":true,"property":"payload.track","name":"S180","x":350,"y":840,"wires":[["80672e7a.74eae"]]},{"id":"be605291.1fda2","type":"range","z":"84f0327e.4d899","minin":"202.6","maxin":"247.5","minout":"225","maxout":"225","action":"scale","round":true,"property":"payload.track","name":"SW225","x":360,"y":860,"wires":[["80672e7a.74eae"]]},{"id":"94bfad75.b2923","type":"range","z":"84f0327e.4d899","minin":"247.6","maxin":"292.5","minout":"270","maxout":"270","action":"scale","round":true,"property":"payload.track","name":"W270","x":350,"y":880,"wires":[["80672e7a.74eae"]]},{"id":"16f55d76.97f383","type":"range","z":"84f0327e.4d899","minin":"292.6","maxin":"337.5","minout":"315","maxout":"315","action":"scale","round":true,"property":"payload.track","name":"NW315","x":360,"y":900,"wires":[["80672e7a.74eae"]]},{"id":"80672e7a.74eae","type":"change","z":"84f0327e.4d899","name":"Deg to Cardinal","rules":[{"t":"change","p":"payload.track","pt":"msg","from":"0","fromt":"num","to":"N","tot":"str"},{"t":"change","p":"payload.track","pt":"msg","from":"45","fromt":"num","to":"NE","tot":"str"},{"t":"change","p":"payload.track","pt":"msg","from":"90","fromt":"num","to":"E","tot":"str"},{"t":"change","p":"payload.track","pt":"msg","from":"135","fromt":"num","to":"SE","tot":"str"},{"t":"change","p":"payload.track","pt":"msg","from":"180","fromt":"num","to":"S","tot":"str"},{"t":"change","p":"payload.track","pt":"msg","from":"225","fromt":"num","to":"SW","tot":"str"},{"t":"change","p":"payload.track","pt":"msg","from":"270","fromt":"num","to":"W","tot":"str"},{"t":"change","p":"payload.track","pt":"msg","from":"315","fromt":"num","to":"NW","tot":"str"},{"t":"set","p":"track","pt":"global","to":"payload.track","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":900,"wires":[["bc4ce6fa.d31f78"]]},{"id":"7b24a62e.8f5458","type":"debug","z":"ceeb844e7eb3d728","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":310,"y":540,"wires":[]},{"id":"5f671b29.cd24bc","type":"socketcan-out","z":"ceeb844e7eb3d728","name":"socketcan-out","config":"b2855d5b.1215c8","x":130,"y":540,"wires":[["7b24a62e.8f5458"]]},{"id":"caba412f.047b2","type":"socketcan-in","z":"ceeb844e7eb3d728","name":"socketcan-in","config":"b2855d5b.1215c8","x":370,"y":100,"wires":[]},{"id":"a64240cb.3f0788","type":"inject","z":"ceeb844e7eb3d728","name":"Send object - std","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"ext\":false,\"canid\":123,\"dlc\":5,\"data\":[1,2,3,4,5]}","payloadType":"json","x":160,"y":100,"wires":[["caba412f.047b2"]]},{"id":"3ff96369.ef6f5c","type":"inject","z":"ceeb844e7eb3d728","name":"Send string - std","props":[{"p":"payload","v":"123#00112233","vt":"str"},{"p":"topic","v":"","vt":"string"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"123#00112233","payloadType":"str","x":160,"y":180,"wires":[["caba412f.047b2"]]},{"id":"6879c00a.5edb68","type":"inject","z":"ceeb844e7eb3d728","name":"Send string - ext","props":[{"p":"payload","v":"1F334455#1122334455667788","vt":"str"},{"p":"topic","v":"","vt":"string"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1F334455#1122334455667788","payloadType":"str","x":160,"y":220,"wires":[["caba412f.047b2"]]},{"id":"1ee3b274.4cb8fe","type":"inject","z":"ceeb844e7eb3d728","name":"Send object - ext","props":[{"p":"payload","v":"{\"ext\":true,\"canid\":32278,\"dlc\":5,\"data\":[1,2,3,4,5]}","vt":"json"},{"p":"topic","v":"","vt":"string"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"ext\":true,\"canid\":32278,\"dlc\":5,\"data\":[1,2,3,4,5]}","payloadType":"json","x":160,"y":140,"wires":[["caba412f.047b2"]]},{"id":"391a4c45.7acd8c","type":"comment","z":"ceeb844e7eb3d728","name":"Send CAN frames in using different payloads on CAN0","info":"canid explanation\nThe DGN is prefixed and suffixed by additional bits to create the actual canid, then the entire number is convereted to hex or decimal.\n\nexample DGN: 1FEDB DC_DIMMER_COMMAND_2\n\nactual canid:\n\n19FEDB99  hex\n436132761 decimal\n110 0 1 1111 1110 1101 1011 1001 1001 binary\n\nPRIORITY + RESERVED   +   DGN-HIGH   +   DGN-LOW   +   SOURCE ADDR\n  3bits      1bit          9bits          8bits           8bits\n  110         0         1 1111 1110     1101 1011       1001 1001\n                        1   F   E         D   B           9   9\n\n\n9---------------------------------------\n                                       |\n9---------------------------------     |\n                                 |     |\nB---------------------------     |     |\n                           |     |     |\nD---------------------     |     |     |\n                     |     |     |     |\nE---------------     |     |     |     |\n               |     |     |     |     |\nF---------     |     |     |     |     |\n         |     |     |     |     |     |\n9----    |     |     |     |     |     |\n    |    |     |     |     |     |     |\n1   |    |     |     |     |     |     |\n|   |    |     |     |     |     |     |\n|   |    |     |     |     |     |     |\n_ ____  ____  ____  ____  ____  ____  ____\n1 1001  1111  1110  1101  1011  1001  1001\n\n","x":260,"y":60,"wires":[]},{"id":"912f9928.da2758","type":"comment","z":"ceeb844e7eb3d728","name":"Receive CAN data from interface CAN0","info":"","x":190,"y":500,"wires":[]},{"id":"84b50189.50f2a","type":"inject","z":"ceeb844e7eb3d728","name":"Send obj 13 on - ext","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"ext\":true,\"canid\":436132761,\"dlc\":8,\"data\":[13,255,200,2,255,0,255,255]}","payloadType":"json","x":170,"y":260,"wires":[["caba412f.047b2"]]},{"id":"7a73ed3.725c814","type":"inject","z":"ceeb844e7eb3d728","name":"Send obj 13 off - ext","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"ext\":true,\"canid\":436132761,\"dlc\":8,\"data\":[13,255,200,3,255,0,255,255]}","payloadType":"json","x":170,"y":300,"wires":[["caba412f.047b2"]]},{"id":"11aa0ab4.f5e935","type":"inject","z":"ceeb844e7eb3d728","name":"Send obj hex 13 on - ext","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"ext\":true,\"canid\":436132761,\"dlc\":8,\"data\":[\"0xd\",\"0xff\",\"0xc8\",\"0x2\",\"0xff\",\"0x0\",\"0xff\",\"0xff\"]}","payloadType":"json","x":190,"y":340,"wires":[["caba412f.047b2"]]},{"id":"b40baf92.744f5","type":"inject","z":"ceeb844e7eb3d728","name":"Send string 13 on - ext","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"19FEDB99#0DFFC802FF00FFFF","payloadType":"str","x":180,"y":380,"wires":[["caba412f.047b2"]]},{"id":"70fecd4b.3636d4","type":"inject","z":"ceeb844e7eb3d728","name":"Send string 13 off - ext","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"19FEDB99#0DFFC803FF00FFFF","payloadType":"str","x":180,"y":420,"wires":[["caba412f.047b2"]]},{"id":"b0f6374a.05b988","type":"comment","z":"ceeb844e7eb3d728","name":"Read Me","info":"The lower 5 examples show various ways to send DC_DIMMER_COMMAND_2 to instance 13 on and off\n\ncanid explanation\nThe DGN is prefixed and suffixed by additional bits to create the actual canid, then the entire number is convereted to hex or decimal.\n\nexample DGN: 1FEDB DC_DIMMER_COMMAND_2\n\nactual canid:\n\n19FEDB99  hex\n436132761 decimal\n110 0 1 1111 1110 1101 1011 1001 1001 binary\n\nPRIORITY + RESERVED   +   DGN-HIGH   +   DGN-LOW   +   SOURCE ADDR\n  3bits      1bit          9bits          8bits           8bits\n  110         0         1 1111 1110     1101 1011       1001 1001\n                        1   F   E         D   B           9   9\n\n\n9---------------------------------------\n                                       |\n9---------------------------------     |\n                                 |     |\nB---------------------------     |     |\n                           |     |     |\nD---------------------     |     |     |\n                     |     |     |     |\nE---------------     |     |     |     |\n               |     |     |     |     |\nF---------     |     |     |     |     |\n         |     |     |     |     |     |\n9----    |     |     |     |     |     |\n    |    |     |     |     |     |     |\n1   |    |     |     |     |     |     |\n|   |    |     |     |     |     |     |\n|   |    |     |     |     |     |     |\n_ ____  ____  ____  ____  ____  ____  ____\n1 1001  1111  1110  1101  1011  1001  1001\n\n","x":380,"y":260,"wires":[]},{"id":"8d2158368bb788b6","type":"mqtt in","z":"ceeb844e7eb3d728","name":"","topic":"RVC/DC_DIMMER_COMMAND_2/+","qos":"2","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":780,"y":160,"wires":[["b96f94fbc6a1a4fa"]]},{"id":"ed9c5aa5dd006267","type":"comment","z":"ceeb844e7eb3d728","name":"Mini Instance Scanner","info":"Listens for:\nall DC_DIMMER_COMMAND_2 commands\nall WINDOW_SHADE_CONTROL_COMMAND commands\n\ndsiplays the instances in a pop up on the dashboard","x":740,"y":60,"wires":[]},{"id":"8d2be593d232e7ce","type":"ui_toast","z":"ceeb844e7eb3d728","position":"top right","displayTime":"5","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":990,"y":300,"wires":[]},{"id":"fd01898165462213","type":"change","z":"ceeb844e7eb3d728","name":"Get Instance","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.instance","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":300,"wires":[["8d2be593d232e7ce"]]},{"id":"9c1d8857e127b0b3","type":"ui_switch","z":"ceeb844e7eb3d728","name":"","label":"","tooltip":"","group":"4a4ad95f11329591","order":0,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"control","topicType":"str","style":"","onvalue":"open","onvalueType":"str","onicon":"","oncolor":"","offvalue":"close","offvalueType":"str","officon":"","offcolor":"","animate":false,"className":"","x":870,"y":220,"wires":[["b96f94fbc6a1a4fa"]]},{"id":"0f60620beff29fce","type":"inject","z":"ceeb844e7eb3d728","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"close","payloadType":"str","x":710,"y":220,"wires":[["9c1d8857e127b0b3"]]},{"id":"b96f94fbc6a1a4fa","type":"gate","z":"ceeb844e7eb3d728","name":"","controlTopic":"control","defaultState":"closed","openCmd":"open","closeCmd":"close","toggleCmd":"toggle","defaultCmd":"default","statusCmd":"status","persist":false,"x":1030,"y":220,"wires":[["fd01898165462213"]]},{"id":"0f848639d9c1e714","type":"mqtt in","z":"ceeb844e7eb3d728","name":"","topic":"RVC/WINDOW_SHADE_CONTROL_COMMAND/+","qos":"2","datatype":"json","broker":"c1170463.5c7f8","inputs":0,"x":830,"y":120,"wires":[["b96f94fbc6a1a4fa"]]},{"id":"bce4130ecafe1221","type":"ui_template","z":"ceeb844e7eb3d728","group":"4a4ad95f11329591","name":"Instance Scanner Notes","order":1,"width":0,"height":0,"format":"<div>\n    <p>\n    <br><b>Turn on to detect the \"instance\" value for a light switch or shade on your coach. Press the wall switch and watch for a popup on the eRVin dashboard. You should see the RV-C command as well as a number. The number is the instance and can be used to help configure your dashboard controls. WARNING: do not leave this switch ON, use only when needed.</b>\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","className":"Custom-CSS","x":750,"y":360,"wires":[[]]}]